<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>26. 反復処理 | 私たちのR: ベストプラクティスの探究</title>
  <meta name="description" content="R Not for Everyone: An Esoteric Guide." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="26. 反復処理 | 私たちのR: ベストプラクティスの探究" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://jaysong.net/RBook/" />
  <meta property="og:image" content="https://jaysong.net/RBook//HTML/cover.png" />
  <meta property="og:description" content="R Not for Everyone: An Esoteric Guide." />
  <meta name="github-repo" content="JaehyunSong/RBook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="26. 反復処理 | 私たちのR: ベストプラクティスの探究" />
  
  <meta name="twitter:description" content="R Not for Everyone: An Esoteric Guide." />
  <meta name="twitter:image" content="https://jaysong.net/RBook//HTML/cover.png" />

<meta name="author" content="宋財泫 (Jaehyun Song)・矢内勇生 (Yuki Yanai)" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="HTML/apple-favicon.png" />
  <link rel="shortcut icon" href="HTML/favicon.png" type="image/x-icon" />
<link rel="prev" href="datahandling3.html"/>
<link rel="next" href="oop.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<meta name="twitter:title" content="R Not for Everyone"/>
<meta name="twitter:description" content="An Esoteric Guide"/>
<meta name="twitter:url" content="https://www.jaysong.net/RBook"/>
<meta name="twitter:image" content="https://www.jaysong.net/RBook/figures/Cover.png"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@Tintstyle"/>
<meta name="twitter:site" content="@Tintstyle"/>
<meta property="og:title" content="R Not for Everyone"/>
<meta property="og:description" content="An Esoteric Guide"/>
<meta property="og:url" content="https://www.jaysong.net/RBook"/>
<meta property="og:image" content="https://www.jaysong.net/RBook/figures/Cover.png"/>
<meta property="og:type" content="book"/>
<meta property="og:locale" content="en_US"/>
<meta property="article:author" content="Jaehyun Song"/>
<meta property="article:author" content="Yuki Yanai"/>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.21/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-165592410-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-165592410-1');
  gtag('set', {'user_id': 'USER_ID'}); 
</script>

<meta name="google-site-verification" content="QJouPRaPKBPU1jDp6VaBuFbVV5imTI-Aazl_ScJwVgU" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="HTML/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">私たちのR</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>紹介</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#進捗状況"><i class="fa fa-check"></i>進捗状況</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#著者紹介"><i class="fa fa-check"></i>著者紹介</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#データのダウンロード"><i class="fa fa-check"></i>データのダウンロード</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#本書における表記法"><i class="fa fa-check"></i>本書における表記法</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#著作権"><i class="fa fa-check"></i>著作権</a></li>
</ul></li>
<li class="part"><span><b>I Rの導入</b></span></li>
<li class="chapter" data-level="1" data-path="aboutR.html"><a href="aboutR.html"><i class="fa fa-check"></i><b>1</b> R?</a>
<ul>
<li class="chapter" data-level="1.1" data-path="aboutR.html"><a href="aboutR.html#WhatIsR"><i class="fa fa-check"></i><b>1.1</b> Rとは</a></li>
<li class="chapter" data-level="1.2" data-path="aboutR.html"><a href="aboutR.html#WhyR"><i class="fa fa-check"></i><b>1.2</b> Why R?</a></li>
<li class="chapter" data-level="1.3" data-path="aboutR.html"><a href="aboutR.html#GUI_IDE"><i class="fa fa-check"></i><b>1.3</b> GUIとIDE</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="aboutR.html"><a href="aboutR.html#gui"><i class="fa fa-check"></i><b>1.3.1</b> GUI</a></li>
<li class="chapter" data-level="1.3.2" data-path="aboutR.html"><a href="aboutR.html#aboutR-IDE"><i class="fa fa-check"></i><b>1.3.2</b> IDE</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>2</b> Rのインストール</a></li>
<li class="chapter" data-level="3" data-path="ide.html"><a href="ide.html"><i class="fa fa-check"></i><b>3</b> IDEの導入</a></li>
<li class="chapter" data-level="4" data-path="R-Customize.html"><a href="R-Customize.html"><i class="fa fa-check"></i><b>4</b> 分析環境のカスタマイズ</a>
<ul>
<li class="chapter" data-level="4.1" data-path="R-Customize.html"><a href="R-Customize.html#Customize-rprofile"><i class="fa fa-check"></i><b>4.1</b> .Rprofileの設定</a></li>
<li class="chapter" data-level="4.2" data-path="R-Customize.html"><a href="R-Customize.html#Customize-rstudio"><i class="fa fa-check"></i><b>4.2</b> RStudioのカスタマイズ</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>5</b> Rパッケージ</a>
<ul>
<li class="chapter" data-level="5.1" data-path="packages.html"><a href="packages.html#packages_intro"><i class="fa fa-check"></i><b>5.1</b> パッケージとは</a></li>
<li class="chapter" data-level="5.2" data-path="packages.html"><a href="packages.html#packages_install"><i class="fa fa-check"></i><b>5.2</b> パッケージのインストール</a></li>
<li class="chapter" data-level="5.3" data-path="packages.html"><a href="packages.html#packages_library"><i class="fa fa-check"></i><b>5.3</b> パッケージの読み込み</a></li>
<li class="chapter" data-level="5.4" data-path="packages.html"><a href="packages.html#packages_update"><i class="fa fa-check"></i><b>5.4</b> パッケージのアップデート</a></li>
<li class="chapter" data-level="5.5" data-path="packages.html"><a href="packages.html#packages_pacman"><i class="fa fa-check"></i><b>5.5</b> {pacman}によるパッケージ管理</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="packages.html"><a href="packages.html#インストール"><i class="fa fa-check"></i><b>5.5.1</b> インストール</a></li>
<li class="chapter" data-level="5.5.2" data-path="packages.html"><a href="packages.html#読み込み"><i class="fa fa-check"></i><b>5.5.2</b> 読み込み</a></li>
<li class="chapter" data-level="5.5.3" data-path="packages.html"><a href="packages.html#アップデート"><i class="fa fa-check"></i><b>5.5.3</b> アップデート</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="packages.html"><a href="packages.html#packages_tidyverse"><i class="fa fa-check"></i><b>5.6</b> 必須パッケージのインストール</a></li>
</ul></li>
<li class="part"><span><b>II Rの基礎</b></span></li>
<li class="chapter" data-level="6" data-path="rbasic.html"><a href="rbasic.html"><i class="fa fa-check"></i><b>6</b> 基本的な操作</a>
<ul>
<li class="chapter" data-level="6.1" data-path="rbasic.html"><a href="rbasic.html#rbasic-compbasic"><i class="fa fa-check"></i><b>6.1</b> コンピュータの基礎知識</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="rbasic.html"><a href="rbasic.html#ファイル名"><i class="fa fa-check"></i><b>6.1.1</b> ファイル名</a></li>
<li class="chapter" data-level="6.1.2" data-path="rbasic.html"><a href="rbasic.html#ファイルシステムとパス"><i class="fa fa-check"></i><b>6.1.2</b> ファイルシステムとパス</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="rbasic.html"><a href="rbasic.html#rbasic-project"><i class="fa fa-check"></i><b>6.2</b> 「プロジェクト」のすゝめ</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="rbasic.html"><a href="rbasic.html#プロジェクト"><i class="fa fa-check"></i><b>6.2.1</b> プロジェクト</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="rbasic.html"><a href="rbasic.html#rbasic-calc"><i class="fa fa-check"></i><b>6.3</b> 電卓としてのR</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="rbasic.html"><a href="rbasic.html#算術演算子"><i class="fa fa-check"></i><b>6.3.1</b> 算術演算子</a></li>
<li class="chapter" data-level="6.3.2" data-path="rbasic.html"><a href="rbasic.html#論理演算子"><i class="fa fa-check"></i><b>6.3.2</b> 論理演算子</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="rbasic.html"><a href="rbasic.html#rbasic-input"><i class="fa fa-check"></i><b>6.4</b> 格納とオブジェクトの作成</a></li>
<li class="chapter" data-level="6.5" data-path="rbasic.html"><a href="rbasic.html#rbasic-extract"><i class="fa fa-check"></i><b>6.5</b> 要素の抽出</a></li>
<li class="chapter" data-level="" data-path="rbasic.html"><a href="rbasic.html#rbasic-exercise"><i class="fa fa-check"></i>演習問題</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="io.html"><a href="io.html"><i class="fa fa-check"></i><b>7</b> データの入出力</a>
<ul>
<li class="chapter" data-level="7.1" data-path="io.html"><a href="io.html#io-read"><i class="fa fa-check"></i><b>7.1</b> データの読み込み</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="io.html"><a href="io.html#csvファイルの場合"><i class="fa fa-check"></i><b>7.1.1</b> csvファイルの場合</a></li>
<li class="chapter" data-level="7.1.2" data-path="io.html"><a href="io.html#エンコーディングの話"><i class="fa fa-check"></i><b>7.1.2</b> エンコーディングの話</a></li>
<li class="chapter" data-level="7.1.3" data-path="io.html"><a href="io.html#その他のフォーマット"><i class="fa fa-check"></i><b>7.1.3</b> その他のフォーマット</a></li>
<li class="chapter" data-level="7.1.4" data-path="io.html"><a href="io.html#rdataファイルの場合"><i class="fa fa-check"></i><b>7.1.4</b> RDataファイルの場合</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="io.html"><a href="io.html#io-export"><i class="fa fa-check"></i><b>7.2</b> データの書き出し</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="io.html"><a href="io.html#csvファイル"><i class="fa fa-check"></i><b>7.2.1</b> csvファイル</a></li>
<li class="chapter" data-level="7.2.2" data-path="io.html"><a href="io.html#rdataファイル"><i class="fa fa-check"></i><b>7.2.2</b> RDataファイル</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="datatype.html"><a href="datatype.html"><i class="fa fa-check"></i><b>8</b> データの型</a>
<ul>
<li class="chapter" data-level="8.1" data-path="datatype.html"><a href="datatype.html#WhatIsDatatype"><i class="fa fa-check"></i><b>8.1</b> データ型とは</a></li>
<li class="chapter" data-level="8.2" data-path="datatype.html"><a href="datatype.html#type-logical"><i class="fa fa-check"></i><b>8.2</b> Logical</a></li>
<li class="chapter" data-level="8.3" data-path="datatype.html"><a href="datatype.html#type-numeric"><i class="fa fa-check"></i><b>8.3</b> Numeric</a></li>
<li class="chapter" data-level="8.4" data-path="datatype.html"><a href="datatype.html#type-complex"><i class="fa fa-check"></i><b>8.4</b> Complex</a></li>
<li class="chapter" data-level="8.5" data-path="datatype.html"><a href="datatype.html#type-character"><i class="fa fa-check"></i><b>8.5</b> Character</a></li>
<li class="chapter" data-level="8.6" data-path="datatype.html"><a href="datatype.html#type-factor"><i class="fa fa-check"></i><b>8.6</b> Factor</a></li>
<li class="chapter" data-level="8.7" data-path="datatype.html"><a href="datatype.html#type-date"><i class="fa fa-check"></i><b>8.7</b> Date</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="datatype.html"><a href="datatype.html#なぜdate型があるのか"><i class="fa fa-check"></i><b>8.7.1</b> なぜDate型があるのか</a></li>
<li class="chapter" data-level="8.7.2" data-path="datatype.html"><a href="datatype.html#date型の作り方"><i class="fa fa-check"></i><b>8.7.2</b> Date型の作り方</a></li>
<li class="chapter" data-level="8.7.3" data-path="datatype.html"><a href="datatype.html#posixctposixlt型について"><i class="fa fa-check"></i><b>8.7.3</b> POSIXct、POSIXlt型について</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="datatype.html"><a href="datatype.html#type-na"><i class="fa fa-check"></i><b>8.8</b> NA</a></li>
<li class="chapter" data-level="8.9" data-path="datatype.html"><a href="datatype.html#type-null"><i class="fa fa-check"></i><b>8.9</b> NULL</a></li>
<li class="chapter" data-level="8.10" data-path="datatype.html"><a href="datatype.html#type-nan"><i class="fa fa-check"></i><b>8.10</b> NaN</a></li>
<li class="chapter" data-level="8.11" data-path="datatype.html"><a href="datatype.html#type-inf"><i class="fa fa-check"></i><b>8.11</b> Inf</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="datastructure.html"><a href="datastructure.html"><i class="fa fa-check"></i><b>9</b> データの構造</a>
<ul>
<li class="chapter" data-level="9.1" data-path="datastructure.html"><a href="datastructure.html#WhatIsDatastructure"><i class="fa fa-check"></i><b>9.1</b> データ構造とは</a></li>
<li class="chapter" data-level="9.2" data-path="datastructure.html"><a href="datastructure.html#structure-vector"><i class="fa fa-check"></i><b>9.2</b> ベクトル (vector)</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="datastructure.html"><a href="datastructure.html#ベクトルの作り方"><i class="fa fa-check"></i><b>9.2.1</b> ベクトルの作り方</a></li>
<li class="chapter" data-level="9.2.2" data-path="datastructure.html"><a href="datastructure.html#ベクトルの操作"><i class="fa fa-check"></i><b>9.2.2</b> ベクトルの操作</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="datastructure.html"><a href="datastructure.html#structure-matrix"><i class="fa fa-check"></i><b>9.3</b> 行列 (matrix)</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="datastructure.html"><a href="datastructure.html#行列の作り方"><i class="fa fa-check"></i><b>9.3.1</b> 行列の作り方</a></li>
<li class="chapter" data-level="9.3.2" data-path="datastructure.html"><a href="datastructure.html#行列の操作"><i class="fa fa-check"></i><b>9.3.2</b> 行列の操作</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="datastructure.html"><a href="datastructure.html#structure-dataframe"><i class="fa fa-check"></i><b>9.4</b> データフレーム (data.frame)</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="datastructure.html"><a href="datastructure.html#データフレームの作成"><i class="fa fa-check"></i><b>9.4.1</b> データフレームの作成</a></li>
<li class="chapter" data-level="9.4.2" data-path="datastructure.html"><a href="datastructure.html#データフレームの操作"><i class="fa fa-check"></i><b>9.4.2</b> データフレームの操作</a></li>
<li class="chapter" data-level="9.4.3" data-path="datastructure.html"><a href="datastructure.html#tibble型"><i class="fa fa-check"></i><b>9.4.3</b> tibble型</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="datastructure.html"><a href="datastructure.html#structure-list"><i class="fa fa-check"></i><b>9.5</b> リスト (list)</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="datastructure.html"><a href="datastructure.html#リスト型データの作成"><i class="fa fa-check"></i><b>9.5.1</b> リスト型データの作成</a></li>
<li class="chapter" data-level="9.5.2" data-path="datastructure.html"><a href="datastructure.html#リスト型データの操作"><i class="fa fa-check"></i><b>9.5.2</b> リスト型データの操作</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="datastructure.html"><a href="datastructure.html#structure-array"><i class="fa fa-check"></i><b>9.6</b> 配列 (array)</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="datastructure.html"><a href="datastructure.html#配列型データの作成"><i class="fa fa-check"></i><b>9.6.1</b> 配列型データの作成</a></li>
<li class="chapter" data-level="9.6.2" data-path="datastructure.html"><a href="datastructure.html#配列型データの操作"><i class="fa fa-check"></i><b>9.6.2</b> 配列型データの操作</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datastructure.html"><a href="datastructure.html#structure-exercise"><i class="fa fa-check"></i>練習問題</a>
<ul>
<li class="chapter" data-level="9.6.3" data-path="datastructure.html"><a href="datastructure.html#ベクトル"><i class="fa fa-check"></i><b>9.6.3</b> ベクトル</a></li>
<li class="chapter" data-level="9.6.4" data-path="datastructure.html"><a href="datastructure.html#行列"><i class="fa fa-check"></i><b>9.6.4</b> 行列</a></li>
<li class="chapter" data-level="9.6.5" data-path="datastructure.html"><a href="datastructure.html#データフレーム"><i class="fa fa-check"></i><b>9.6.5</b> データフレーム</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="programming.html"><a href="programming.html"><i class="fa fa-check"></i><b>10</b> Rプログラミングの基礎</a>
<ul>
<li class="chapter" data-level="10.1" data-path="programming.html"><a href="programming.html#programming-intro"><i class="fa fa-check"></i><b>10.1</b> R言語の基礎概念</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="programming.html"><a href="programming.html#オブジェクト"><i class="fa fa-check"></i><b>10.1.1</b> オブジェクト</a></li>
<li class="chapter" data-level="10.1.2" data-path="programming.html"><a href="programming.html#クラス"><i class="fa fa-check"></i><b>10.1.2</b> クラス</a></li>
<li class="chapter" data-level="10.1.3" data-path="programming.html"><a href="programming.html#関数と引数"><i class="fa fa-check"></i><b>10.1.3</b> 関数と引数</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="programming.html"><a href="programming.html#programming-style"><i class="fa fa-check"></i><b>10.2</b> Rのコーディングスタイル</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="programming.html"><a href="programming.html#オブジェクト名"><i class="fa fa-check"></i><b>10.2.1</b> オブジェクト名</a></li>
<li class="chapter" data-level="10.2.2" data-path="programming.html"><a href="programming.html#改行"><i class="fa fa-check"></i><b>10.2.2</b> 改行</a></li>
<li class="chapter" data-level="10.2.3" data-path="programming.html"><a href="programming.html#スペースとインデント"><i class="fa fa-check"></i><b>10.2.3</b> スペースとインデント</a></li>
<li class="chapter" data-level="10.2.4" data-path="programming.html"><a href="programming.html#代入"><i class="fa fa-check"></i><b>10.2.4</b> 代入</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="programming.html"><a href="programming.html#programming-iteration"><i class="fa fa-check"></i><b>10.3</b> 反復</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="programming.html"><a href="programming.html#for-による反復"><i class="fa fa-check"></i><b>10.3.1</b> <code>for</code> による反復</a></li>
<li class="chapter" data-level="10.3.2" data-path="programming.html"><a href="programming.html#whileによる反復"><i class="fa fa-check"></i><b>10.3.2</b> <code>while</code>による反復</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="programming.html"><a href="programming.html#programming-condition"><i class="fa fa-check"></i><b>10.4</b> 条件分岐</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="programming.html"><a href="programming.html#ifelse-ifelse-による条件分岐"><i class="fa fa-check"></i><b>10.4.1</b> <code>if</code>、<code>else if</code>、<code>else</code> による条件分岐</a></li>
<li class="chapter" data-level="10.4.2" data-path="programming.html"><a href="programming.html#ifelseによる条件分岐"><i class="fa fa-check"></i><b>10.4.2</b> <code>ifelse()</code>による条件分岐</a></li>
<li class="chapter" data-level="10.4.3" data-path="programming.html"><a href="programming.html#switchによる条件分岐"><i class="fa fa-check"></i><b>10.4.3</b> <code>switch()</code>による条件分岐</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#programming-exercise"><i class="fa fa-check"></i>練習問題</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>11</b> 関数の自作</a>
<ul>
<li class="chapter" data-level="11.1" data-path="functions.html"><a href="functions.html#func-intro"><i class="fa fa-check"></i><b>11.1</b> 関数の作成</a></li>
<li class="chapter" data-level="11.2" data-path="functions.html"><a href="functions.html#func-adv"><i class="fa fa-check"></i><b>11.2</b> ちょっと複雑な関数</a></li>
<li class="chapter" data-level="11.3" data-path="functions.html"><a href="functions.html#func-in-func"><i class="fa fa-check"></i><b>11.3</b> 関数 in 関数</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#func-exercise"><i class="fa fa-check"></i>練習問題</a></li>
</ul></li>
<li class="part"><span><b>III データハンドリング</b></span></li>
<li class="chapter" data-level="12" data-path="datahandling1.html"><a href="datahandling1.html"><i class="fa fa-check"></i><b>12</b> データハンドリング [基礎編: 抽出]</a>
<ul>
<li class="chapter" data-level="12.1" data-path="datahandling1.html"><a href="datahandling1.html#handling1-intro"><i class="fa fa-check"></i><b>12.1</b> データハンドリングとtidyverse</a></li>
<li class="chapter" data-level="12.2" data-path="datahandling1.html"><a href="datahandling1.html#handling1-pipe"><i class="fa fa-check"></i><b>12.2</b> パイプ演算子 (<code>%&gt;%</code>)</a></li>
<li class="chapter" data-level="12.3" data-path="datahandling1.html"><a href="datahandling1.html#handling1-select"><i class="fa fa-check"></i><b>12.3</b> 列の抽出</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="datahandling1.html"><a href="datahandling1.html#特定の列を抽出する"><i class="fa fa-check"></i><b>12.3.1</b> 特定の列を抽出する</a></li>
<li class="chapter" data-level="12.3.2" data-path="datahandling1.html"><a href="datahandling1.html#特定の列を抽出し列名を変更する"><i class="fa fa-check"></i><b>12.3.2</b> 特定の列を抽出し、列名を変更する</a></li>
<li class="chapter" data-level="12.3.3" data-path="datahandling1.html"><a href="datahandling1.html#特定の列を除外する"><i class="fa fa-check"></i><b>12.3.3</b> 特定の列を除外する</a></li>
<li class="chapter" data-level="12.3.4" data-path="datahandling1.html"><a href="datahandling1.html#隣接した列を指定する"><i class="fa fa-check"></i><b>12.3.4</b> 隣接した列を指定する</a></li>
<li class="chapter" data-level="12.3.5" data-path="datahandling1.html"><a href="datahandling1.html#一部の列の順番だけを変える"><i class="fa fa-check"></i><b>12.3.5</b> 一部の列の順番だけを変える</a></li>
<li class="chapter" data-level="12.3.6" data-path="datahandling1.html"><a href="datahandling1.html#selectの便利な機能"><i class="fa fa-check"></i><b>12.3.6</b> <code>select()</code>の便利な機能</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="datahandling1.html"><a href="datahandling1.html#handling1-filter"><i class="fa fa-check"></i><b>12.4</b> 行の抽出</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="datahandling1.html"><a href="datahandling1.html#指定した行を抽出する"><i class="fa fa-check"></i><b>12.4.1</b> 指定した行を抽出する</a></li>
<li class="chapter" data-level="12.4.2" data-path="datahandling1.html"><a href="datahandling1.html#条件に合致する行を抽出する"><i class="fa fa-check"></i><b>12.4.2</b> 条件に合致する行を抽出する</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="datahandling1.html"><a href="datahandling1.html#handling1-arrange"><i class="fa fa-check"></i><b>12.5</b> 行のソート</a></li>
<li class="chapter" data-level="" data-path="datahandling1.html"><a href="datahandling1.html#handling1-exercise"><i class="fa fa-check"></i>練習問題</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="datahandling2.html"><a href="datahandling2.html"><i class="fa fa-check"></i><b>13</b> データハンドリング [基礎編: 拡張]</a>
<ul>
<li class="chapter" data-level="13.1" data-path="datahandling2.html"><a href="datahandling2.html#handling2-summarise"><i class="fa fa-check"></i><b>13.1</b> 記述統計量の計算</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="datahandling2.html"><a href="datahandling2.html#summariseによる記述統計量の計算"><i class="fa fa-check"></i><b>13.1.1</b> <code>summarise()</code>による記述統計量の計算</a></li>
<li class="chapter" data-level="13.1.2" data-path="datahandling2.html"><a href="datahandling2.html#summariseに使える便利な関数"><i class="fa fa-check"></i><b>13.1.2</b> <code>summarise()</code>に使える便利な関数</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="datahandling2.html"><a href="datahandling2.html#handling2-group"><i class="fa fa-check"></i><b>13.2</b> グルーピング</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="datahandling2.html"><a href="datahandling2.html#group_byによるグループ化"><i class="fa fa-check"></i><b>13.2.1</b> <code>group_by()</code>によるグループ化</a></li>
<li class="chapter" data-level="13.2.2" data-path="datahandling2.html"><a href="datahandling2.html#複数の変数を用いたグループ化"><i class="fa fa-check"></i><b>13.2.2</b> 複数の変数を用いたグループ化</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="datahandling2.html"><a href="datahandling2.html#handling2-mutate"><i class="fa fa-check"></i><b>13.3</b> 変数の計算</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="datahandling2.html"><a href="datahandling2.html#mutate関数の使い方"><i class="fa fa-check"></i><b>13.3.1</b> <code>mutate()</code>関数の使い方</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="datahandling2.html"><a href="datahandling2.html#handling2-rowwise"><i class="fa fa-check"></i><b>13.4</b> 行単位の操作</a></li>
<li class="chapter" data-level="13.5" data-path="datahandling2.html"><a href="datahandling2.html#handling2-merge"><i class="fa fa-check"></i><b>13.5</b> データの結合</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="datahandling2.html"><a href="datahandling2.html#行の結合"><i class="fa fa-check"></i><b>13.5.1</b> 行の結合</a></li>
<li class="chapter" data-level="13.5.2" data-path="datahandling2.html"><a href="datahandling2.html#列の結合"><i class="fa fa-check"></i><b>13.5.2</b> 列の結合</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datahandling2.html"><a href="datahandling2.html#handling2-exercise"><i class="fa fa-check"></i>練習問題</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="factor.html"><a href="factor.html"><i class="fa fa-check"></i><b>14</b> データハンドリング [基礎編: factor型]</a>
<ul>
<li class="chapter" data-level="14.1" data-path="factor.html"><a href="factor.html#factor-intro"><i class="fa fa-check"></i><b>14.1</b> 名目変数を含むグラフを作成する際の注意点</a></li>
<li class="chapter" data-level="14.2" data-path="factor.html"><a href="factor.html#factor-forcats"><i class="fa fa-check"></i><b>14.2</b> {forcats}パッケージについて</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="factor.html"><a href="factor.html#fct_relevel-水準の順番を変更する"><i class="fa fa-check"></i><b>14.2.1</b> <code>fct_relevel()</code>: 水準の順番を変更する</a></li>
<li class="chapter" data-level="14.2.2" data-path="factor.html"><a href="factor.html#fct_recode-水準のラベルを変更する"><i class="fa fa-check"></i><b>14.2.2</b> <code>fct_recode()</code>: 水準のラベルを変更する</a></li>
<li class="chapter" data-level="14.2.3" data-path="factor.html"><a href="factor.html#fct_rev-水準の順番を反転させる"><i class="fa fa-check"></i><b>14.2.3</b> <code>fct_rev()</code>: 水準の順番を反転させる</a></li>
<li class="chapter" data-level="14.2.4" data-path="factor.html"><a href="factor.html#fct_infreq-頻度順に順番を変更する"><i class="fa fa-check"></i><b>14.2.4</b> <code>fct_infreq()</code>: 頻度順に順番を変更する</a></li>
<li class="chapter" data-level="14.2.5" data-path="factor.html"><a href="factor.html#fct_inorder-データ内の出現順番に順番を変更する"><i class="fa fa-check"></i><b>14.2.5</b> <code>fct_inorder()</code>: データ内の出現順番に順番を変更する</a></li>
<li class="chapter" data-level="14.2.6" data-path="factor.html"><a href="factor.html#fct_shift-水準の順番をずらす"><i class="fa fa-check"></i><b>14.2.6</b> <code>fct_shift()</code>: 水準の順番をずらす</a></li>
<li class="chapter" data-level="14.2.7" data-path="factor.html"><a href="factor.html#fct_shuffle-水準の順番をランダム化する"><i class="fa fa-check"></i><b>14.2.7</b> <code>fct_shuffle()</code>: 水準の順番をランダム化する</a></li>
<li class="chapter" data-level="14.2.8" data-path="factor.html"><a href="factor.html#fct_reorder-別の1変数の値を基準に水準の順番を変更する"><i class="fa fa-check"></i><b>14.2.8</b> <code>fct_reorder()</code>: 別の1変数の値を基準に水準の順番を変更する</a></li>
<li class="chapter" data-level="14.2.9" data-path="factor.html"><a href="factor.html#factor-forcat-reorder2"><i class="fa fa-check"></i><b>14.2.9</b> <code>fct_reorder2()</code>: 別の2変数の値を基準に水準の順番を変更する</a></li>
<li class="chapter" data-level="14.2.10" data-path="factor.html"><a href="factor.html#fct_collapse-水準を統合する"><i class="fa fa-check"></i><b>14.2.10</b> <code>fct_collapse()</code>: 水準を統合する</a></li>
<li class="chapter" data-level="14.2.11" data-path="factor.html"><a href="factor.html#fct_drop-使われていない水準を除去する"><i class="fa fa-check"></i><b>14.2.11</b> <code>fct_drop()</code>: 使われていない水準を除去する</a></li>
<li class="chapter" data-level="14.2.12" data-path="factor.html"><a href="factor.html#fct_expand-水準を追加する"><i class="fa fa-check"></i><b>14.2.12</b> <code>fct_expand()</code>: 水準を追加する</a></li>
<li class="chapter" data-level="14.2.13" data-path="factor.html"><a href="factor.html#fct_explicit_na-欠損値に水準を与える"><i class="fa fa-check"></i><b>14.2.13</b> <code>fct_explicit_na()</code>: 欠損値に水準を与える</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="factor.html"><a href="factor.html#factor-excersie"><i class="fa fa-check"></i>練習問題</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="tidydata.html"><a href="tidydata.html"><i class="fa fa-check"></i><b>15</b> 整然データ構造</a>
<ul>
<li class="chapter" data-level="15.1" data-path="tidydata.html"><a href="tidydata.html#tidydata-intro"><i class="fa fa-check"></i><b>15.1</b> 整然データ (tidy data)とは</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="tidydata.html"><a href="tidydata.html#つの列は1つの変数を表す"><i class="fa fa-check"></i><b>15.1.1</b> 1つの列は、1つの変数を表す</a></li>
<li class="chapter" data-level="15.1.2" data-path="tidydata.html"><a href="tidydata.html#つの行は1つの観測を表す"><i class="fa fa-check"></i><b>15.1.2</b> 1つの行は、1つの観測を表す</a></li>
<li class="chapter" data-level="15.1.3" data-path="tidydata.html"><a href="tidydata.html#つのセルは1つの値を表す"><i class="fa fa-check"></i><b>15.1.3</b> 1つのセルは、1つの値を表す</a></li>
<li class="chapter" data-level="15.1.4" data-path="tidydata.html"><a href="tidydata.html#つの表は1つの観測単位をもつ"><i class="fa fa-check"></i><b>15.1.4</b> 1つの表は、1つの観測単位をもつ</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="tidydata.html"><a href="tidydata.html#tidydata-gather"><i class="fa fa-check"></i><b>15.2</b> Wide型からLong型へ</a></li>
<li class="chapter" data-level="15.3" data-path="tidydata.html"><a href="tidydata.html#tidydata-spread"><i class="fa fa-check"></i><b>15.3</b> Long型からWide型へ</a></li>
<li class="chapter" data-level="15.4" data-path="tidydata.html"><a href="tidydata.html#tidydata-separate"><i class="fa fa-check"></i><b>15.4</b> 列の操作</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="string.html"><a href="string.html"><i class="fa fa-check"></i><b>16</b> 文字列の処理</a></li>
<li class="part"><span><b>IV 可視化</b></span></li>
<li class="chapter" data-level="17" data-path="visualization1.html"><a href="visualization1.html"><i class="fa fa-check"></i><b>17</b> 可視化[理論]</a>
<ul>
<li class="chapter" data-level="17.1" data-path="visualization1.html"><a href="visualization1.html#visual-packages"><i class="fa fa-check"></i><b>17.1</b> 可視化のためのパッケージ</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="visualization1.html"><a href="visualization1.html#base-r"><i class="fa fa-check"></i><b>17.1.1</b> Base R</a></li>
<li class="chapter" data-level="17.1.2" data-path="visualization1.html"><a href="visualization1.html#latticeパッケージ"><i class="fa fa-check"></i><b>17.1.2</b> {lattice}パッケージ</a></li>
<li class="chapter" data-level="17.1.3" data-path="visualization1.html"><a href="visualization1.html#ggplot2パッケージ"><i class="fa fa-check"></i><b>17.1.3</b> {ggplot2}パッケージ</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="visualization1.html"><a href="visualization1.html#visual-ggplot"><i class="fa fa-check"></i><b>17.2</b> グラフィックの文法</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="visualization1.html"><a href="visualization1.html#グラフィックの文法"><i class="fa fa-check"></i><b>17.2.1</b> グラフィックの文法</a></li>
<li class="chapter" data-level="17.2.2" data-path="visualization1.html"><a href="visualization1.html#ggplot2のイメージ"><i class="fa fa-check"></i><b>17.2.2</b> ggplot2のイメージ</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="visualization1.html"><a href="visualization1.html#グラフィックの構成要素"><i class="fa fa-check"></i><b>17.3</b> グラフィックの構成要素</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="visualization1.html"><a href="visualization1.html#データ"><i class="fa fa-check"></i><b>17.3.1</b> データ</a></li>
<li class="chapter" data-level="17.3.2" data-path="visualization1.html"><a href="visualization1.html#幾何オブジェクト"><i class="fa fa-check"></i><b>17.3.2</b> 幾何オブジェクト</a></li>
<li class="chapter" data-level="17.3.3" data-path="visualization1.html"><a href="visualization1.html#マッピング"><i class="fa fa-check"></i><b>17.3.3</b> マッピング</a></li>
<li class="chapter" data-level="17.3.4" data-path="visualization1.html"><a href="visualization1.html#マッピング-その他"><i class="fa fa-check"></i><b>17.3.4</b> マッピング: その他</a></li>
<li class="chapter" data-level="17.3.5" data-path="visualization1.html"><a href="visualization1.html#座標系"><i class="fa fa-check"></i><b>17.3.5</b> 座標系</a></li>
<li class="chapter" data-level="17.3.6" data-path="visualization1.html"><a href="visualization1.html#スケール"><i class="fa fa-check"></i><b>17.3.6</b> スケール</a></li>
<li class="chapter" data-level="17.3.7" data-path="visualization1.html"><a href="visualization1.html#ファセット"><i class="fa fa-check"></i><b>17.3.7</b> ファセット</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="visualization1.html"><a href="visualization1.html#visual-principal"><i class="fa fa-check"></i><b>17.4</b> 良いグラフとは</a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="visualization1.html"><a href="visualization1.html#データインク比"><i class="fa fa-check"></i><b>17.4.1</b> データ・インク比</a></li>
<li class="chapter" data-level="17.4.2" data-path="visualization1.html"><a href="visualization1.html#次元プロット"><i class="fa fa-check"></i><b>17.4.2</b> 3次元プロット</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="visualization2.html"><a href="visualization2.html"><i class="fa fa-check"></i><b>18</b> 可視化[基礎]</a>
<ul>
<li class="chapter" data-level="18.1" data-path="visualization2.html"><a href="visualization2.html#本章の内容"><i class="fa fa-check"></i><b>18.1</b> 本章の内容</a></li>
<li class="chapter" data-level="18.2" data-path="visualization2.html"><a href="visualization2.html#visual2-data"><i class="fa fa-check"></i><b>18.2</b> 実習用データ</a></li>
<li class="chapter" data-level="18.3" data-path="visualization2.html"><a href="visualization2.html#visual2-japanese"><i class="fa fa-check"></i><b>18.3</b> 日本語が含まれた図について</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="visualization2.html"><a href="visualization2.html#macosの場合"><i class="fa fa-check"></i><b>18.3.1</b> macOSの場合</a></li>
<li class="chapter" data-level="18.3.2" data-path="visualization2.html"><a href="visualization2.html#windowsの場合"><i class="fa fa-check"></i><b>18.3.2</b> Windowsの場合</a></li>
<li class="chapter" data-level="18.3.3" data-path="visualization2.html"><a href="visualization2.html#raggの使用"><i class="fa fa-check"></i><b>18.3.3</b> {ragg}の使用</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="visualization2.html"><a href="visualization2.html#visual2-barplot"><i class="fa fa-check"></i><b>18.4</b> 棒グラフ</a>
<ul>
<li class="chapter" data-level="18.4.1" data-path="visualization2.html"><a href="visualization2.html#ケース数のグラフ"><i class="fa fa-check"></i><b>18.4.1</b> ケース数のグラフ</a></li>
<li class="chapter" data-level="18.4.2" data-path="visualization2.html"><a href="visualization2.html#記述統計量のグラフ"><i class="fa fa-check"></i><b>18.4.2</b> 記述統計量のグラフ</a></li>
<li class="chapter" data-level="18.4.3" data-path="visualization2.html"><a href="visualization2.html#次元を追加する"><i class="fa fa-check"></i><b>18.4.3</b> 次元を追加する</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="visualization2.html"><a href="visualization2.html#visual2-histogram"><i class="fa fa-check"></i><b>18.5</b> ヒストグラム</a>
<ul>
<li class="chapter" data-level="18.5.1" data-path="visualization2.html"><a href="visualization2.html#ヒストグラムの棒の大きさを調整する"><i class="fa fa-check"></i><b>18.5.1</b> ヒストグラムの棒の大きさを調整する</a></li>
<li class="chapter" data-level="18.5.2" data-path="visualization2.html"><a href="visualization2.html#密度を追加する"><i class="fa fa-check"></i><b>18.5.2</b> 密度を追加する</a></li>
<li class="chapter" data-level="18.5.3" data-path="visualization2.html"><a href="visualization2.html#次元を追加する-1"><i class="fa fa-check"></i><b>18.5.3</b> 次元を追加する</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="visualization2.html"><a href="visualization2.html#visual2-box"><i class="fa fa-check"></i><b>18.6</b> 箱ひげ図</a>
<ul>
<li class="chapter" data-level="18.6.1" data-path="visualization2.html"><a href="visualization2.html#個別のデータを表示する"><i class="fa fa-check"></i><b>18.6.1</b> 個別のデータを表示する</a></li>
<li class="chapter" data-level="18.6.2" data-path="visualization2.html"><a href="visualization2.html#次元を追加する-2"><i class="fa fa-check"></i><b>18.6.2</b> 次元を追加する</a></li>
<li class="chapter" data-level="18.6.3" data-path="visualization2.html"><a href="visualization2.html#複数の変数の場合"><i class="fa fa-check"></i><b>18.6.3</b> 複数の変数の場合</a></li>
</ul></li>
<li class="chapter" data-level="18.7" data-path="visualization2.html"><a href="visualization2.html#visual2-scatter"><i class="fa fa-check"></i><b>18.7</b> 散布図</a>
<ul>
<li class="chapter" data-level="18.7.1" data-path="visualization2.html"><a href="visualization2.html#次元を追加する-3"><i class="fa fa-check"></i><b>18.7.1</b> 次元を追加する</a></li>
<li class="chapter" data-level="18.7.2" data-path="visualization2.html"><a href="visualization2.html#一部の点をハイライトする"><i class="fa fa-check"></i><b>18.7.2</b> 一部の点をハイライトする</a></li>
</ul></li>
<li class="chapter" data-level="18.8" data-path="visualization2.html"><a href="visualization2.html#visual2-line"><i class="fa fa-check"></i><b>18.8</b> 折れ線グラフ</a>
<ul>
<li class="chapter" data-level="18.8.1" data-path="visualization2.html"><a href="visualization2.html#一部の線をハイライトする"><i class="fa fa-check"></i><b>18.8.1</b> 一部の線をハイライトする</a></li>
</ul></li>
<li class="chapter" data-level="18.9" data-path="visualization2.html"><a href="visualization2.html#visual2-save"><i class="fa fa-check"></i><b>18.9</b> 図の保存</a>
<ul>
<li class="chapter" data-level="18.9.1" data-path="visualization2.html"><a href="visualization2.html#ggsaveを利用した図の保存"><i class="fa fa-check"></i><b>18.9.1</b> <code>ggsave()</code>を利用した図の保存</a></li>
<li class="chapter" data-level="18.9.2" data-path="visualization2.html"><a href="visualization2.html#quartzを利用した図の保存"><i class="fa fa-check"></i><b>18.9.2</b> <code>quartz()</code>を利用した図の保存</a></li>
</ul></li>
<li class="chapter" data-level="18.10" data-path="visualization2.html"><a href="visualization2.html#visual2-summary"><i class="fa fa-check"></i><b>18.10</b> まとめ</a></li>
<li class="chapter" data-level="" data-path="visualization2.html"><a href="visualization2.html#visual2-excersie"><i class="fa fa-check"></i>練習問題</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="visualization3.html"><a href="visualization3.html"><i class="fa fa-check"></i><b>19</b> 可視化[応用]</a>
<ul>
<li class="chapter" data-level="19.1" data-path="visualization3.html"><a href="visualization3.html#visual3-labs"><i class="fa fa-check"></i><b>19.1</b> <code>labs()</code>: ラベルの修正</a></li>
<li class="chapter" data-level="19.2" data-path="visualization3.html"><a href="visualization3.html#visual3-coordinate"><i class="fa fa-check"></i><b>19.2</b> <code>coord_*()</code>: 座標系の調整</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="visualization3.html"><a href="visualization3.html#直交座標系の操作"><i class="fa fa-check"></i><b>19.2.1</b> 直交座標系の操作</a></li>
<li class="chapter" data-level="19.2.2" data-path="visualization3.html"><a href="visualization3.html#座標系の変換"><i class="fa fa-check"></i><b>19.2.2</b> 座標系の変換</a></li>
<li class="chapter" data-level="19.2.3" data-path="visualization3.html"><a href="visualization3.html#座標系の回転"><i class="fa fa-check"></i><b>19.2.3</b> 座標系の回転</a></li>
<li class="chapter" data-level="19.2.4" data-path="visualization3.html"><a href="visualization3.html#座標系の固定"><i class="fa fa-check"></i><b>19.2.4</b> 座標系の固定</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="visualization3.html"><a href="visualization3.html#visual3-scale"><i class="fa fa-check"></i><b>19.3</b> <code>scale_*_*()</code>: スケールの調整</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="visualization3.html"><a href="visualization3.html#横軸縦軸スケールの調整"><i class="fa fa-check"></i><b>19.3.1</b> 横軸・縦軸スケールの調整</a></li>
<li class="chapter" data-level="19.3.2" data-path="visualization3.html"><a href="visualization3.html#colorスケールの調整"><i class="fa fa-check"></i><b>19.3.2</b> <code>color</code>スケールの調整</a></li>
<li class="chapter" data-level="19.3.3" data-path="visualization3.html"><a href="visualization3.html#alphaスケールの調整"><i class="fa fa-check"></i><b>19.3.3</b> <code>alpha</code>スケールの調整</a></li>
<li class="chapter" data-level="19.3.4" data-path="visualization3.html"><a href="visualization3.html#sizeスケールの調整"><i class="fa fa-check"></i><b>19.3.4</b> <code>size</code>スケールの調整</a></li>
<li class="chapter" data-level="19.3.5" data-path="visualization3.html"><a href="visualization3.html#shapelinetypeスケールの調整"><i class="fa fa-check"></i><b>19.3.5</b> <code>shape</code>、<code>linetype</code>スケールの調整</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="visualization3.html"><a href="visualization3.html#visual3-theme"><i class="fa fa-check"></i><b>19.4</b> <code>theme_*()</code>と<code>theme()</code>: テーマの指定</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="visualization3.html"><a href="visualization3.html#文字の大きさ"><i class="fa fa-check"></i><b>19.4.1</b> 文字の大きさ</a></li>
<li class="chapter" data-level="19.4.2" data-path="visualization3.html"><a href="visualization3.html#背景のグリッド"><i class="fa fa-check"></i><b>19.4.2</b> 背景のグリッド</a></li>
<li class="chapter" data-level="19.4.3" data-path="visualization3.html"><a href="visualization3.html#目盛りラベルの回転"><i class="fa fa-check"></i><b>19.4.3</b> 目盛りラベルの回転</a></li>
<li class="chapter" data-level="19.4.4" data-path="visualization3.html"><a href="visualization3.html#scale__を用いたラベル重複の回避"><i class="fa fa-check"></i><b>19.4.4</b> <code>scale_*_*()</code>を用いたラベル重複の回避</a></li>
<li class="chapter" data-level="19.4.5" data-path="visualization3.html"><a href="visualization3.html#凡例の表示非表示"><i class="fa fa-check"></i><b>19.4.5</b> 凡例の表示/非表示</a></li>
<li class="chapter" data-level="19.4.6" data-path="visualization3.html"><a href="visualization3.html#凡例の位置"><i class="fa fa-check"></i><b>19.4.6</b> 凡例の位置</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="visualization3.html"><a href="visualization3.html#visual3-merge"><i class="fa fa-check"></i><b>19.5</b> 図の結合</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="visualization4.html"><a href="visualization4.html"><i class="fa fa-check"></i><b>20</b> 可視化[発展]</a>
<ul>
<li class="chapter" data-level="20.1" data-path="visualization4.html"><a href="visualization4.html#visual4-intro"><i class="fa fa-check"></i><b>20.1</b> 概要</a></li>
<li class="chapter" data-level="20.2" data-path="visualization4.html"><a href="visualization4.html#visual4-violin"><i class="fa fa-check"></i><b>20.2</b> バイオリンプロット</a></li>
<li class="chapter" data-level="20.3" data-path="visualization4.html"><a href="visualization4.html#visual4-rug"><i class="fa fa-check"></i><b>20.3</b> ラグプロット</a></li>
<li class="chapter" data-level="20.4" data-path="visualization4.html"><a href="visualization4.html#visual4-ridge"><i class="fa fa-check"></i><b>20.4</b> リッジプロット</a></li>
<li class="chapter" data-level="20.5" data-path="visualization4.html"><a href="visualization4.html#visual4-pointrange"><i class="fa fa-check"></i><b>20.5</b> エラーバー付き散布図</a></li>
<li class="chapter" data-level="20.6" data-path="visualization4.html"><a href="visualization4.html#visual4-lollipop"><i class="fa fa-check"></i><b>20.6</b> ロリーポップチャート</a></li>
<li class="chapter" data-level="20.7" data-path="visualization4.html"><a href="visualization4.html#visual4-smooth"><i class="fa fa-check"></i><b>20.7</b> 平滑化ライン</a></li>
<li class="chapter" data-level="20.8" data-path="visualization4.html"><a href="visualization4.html#visual4-heatmap"><i class="fa fa-check"></i><b>20.8</b> ヒートマップ</a>
<ul>
<li class="chapter" data-level="20.8.1" data-path="visualization4.html"><a href="visualization4.html#つの離散変数の分布を表すヒートマップ"><i class="fa fa-check"></i><b>20.8.1</b> 2つの離散変数の分布を表すヒートマップ</a></li>
<li class="chapter" data-level="20.8.2" data-path="visualization4.html"><a href="visualization4.html#離散変数times離散変数における連続変数の値を示すヒートマップ"><i class="fa fa-check"></i><b>20.8.2</b> 離散変数<span class="math inline">\(\times\)</span>離散変数における連続変数の値を示すヒートマップ</a></li>
</ul></li>
<li class="chapter" data-level="20.9" data-path="visualization4.html"><a href="visualization4.html#visual4-contour"><i class="fa fa-check"></i><b>20.9</b> 等高線図</a></li>
<li class="chapter" data-level="20.10" data-path="visualization4.html"><a href="visualization4.html#visual4-map"><i class="fa fa-check"></i><b>20.10</b> 地図</a>
<ul>
<li class="chapter" data-level="20.10.1" data-path="visualization4.html"><a href="visualization4.html#世界地図"><i class="fa fa-check"></i><b>20.10.1</b> 世界地図</a></li>
<li class="chapter" data-level="20.10.2" data-path="visualization4.html"><a href="visualization4.html#日本地図全体"><i class="fa fa-check"></i><b>20.10.2</b> 日本地図（全体）</a></li>
<li class="chapter" data-level="20.10.3" data-path="visualization4.html"><a href="visualization4.html#日本地図特定の都道府県"><i class="fa fa-check"></i><b>20.10.3</b> 日本地図（特定の都道府県）</a></li>
</ul></li>
<li class="chapter" data-level="20.11" data-path="visualization4.html"><a href="visualization4.html#visual4-dag"><i class="fa fa-check"></i><b>20.11</b> 非巡回有向グラフ</a>
<ul>
<li class="chapter" data-level="20.11.1" data-path="visualization4.html"><a href="visualization4.html#ノードの位置を指定する"><i class="fa fa-check"></i><b>20.11.1</b> ノードの位置を指定する</a></li>
</ul></li>
<li class="chapter" data-level="20.12" data-path="visualization4.html"><a href="visualization4.html#visual4-bump"><i class="fa fa-check"></i><b>20.12</b> バンプチャート</a></li>
<li class="chapter" data-level="20.13" data-path="visualization4.html"><a href="visualization4.html#visual4-alluvial"><i class="fa fa-check"></i><b>20.13</b> 沖積図</a></li>
<li class="chapter" data-level="20.14" data-path="visualization4.html"><a href="visualization4.html#visual4-tree"><i class="fa fa-check"></i><b>20.14</b> ツリーマップ</a></li>
<li class="chapter" data-level="20.15" data-path="visualization4.html"><a href="visualization4.html#visual4-mosaic"><i class="fa fa-check"></i><b>20.15</b> モザイクプロット</a></li>
<li class="chapter" data-level="20.16" data-path="visualization4.html"><a href="visualization4.html#visual4-further"><i class="fa fa-check"></i><b>20.16</b> その他のグラフ</a></li>
</ul></li>
<li class="part"><span><b>V 再現可能な研究</b></span></li>
<li class="chapter" data-level="21" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>21</b> R Markdown [基礎]</a>
<ul>
<li class="chapter" data-level="21.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-intro"><i class="fa fa-check"></i><b>21.1</b> R Markdownとは</a></li>
<li class="chapter" data-level="21.2" data-path="rmarkdown.html"><a href="rmarkdown.html#とりあえずknit"><i class="fa fa-check"></i><b>21.2</b> とりあえずKnit</a></li>
<li class="chapter" data-level="21.3" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-grammar"><i class="fa fa-check"></i><b>21.3</b> Markdown文法の基本</a>
<ul>
<li class="chapter" data-level="21.3.1" data-path="rmarkdown.html"><a href="rmarkdown.html#改行-1"><i class="fa fa-check"></i><b>21.3.1</b> 改行</a></li>
<li class="chapter" data-level="21.3.2" data-path="rmarkdown.html"><a href="rmarkdown.html#強調"><i class="fa fa-check"></i><b>21.3.2</b> 強調</a></li>
<li class="chapter" data-level="21.3.3" data-path="rmarkdown.html"><a href="rmarkdown.html#箇条書き"><i class="fa fa-check"></i><b>21.3.3</b> 箇条書き</a></li>
<li class="chapter" data-level="21.3.4" data-path="rmarkdown.html"><a href="rmarkdown.html#見出し"><i class="fa fa-check"></i><b>21.3.4</b> 見出し</a></li>
<li class="chapter" data-level="21.3.5" data-path="rmarkdown.html"><a href="rmarkdown.html#区切り線"><i class="fa fa-check"></i><b>21.3.5</b> 区切り線</a></li>
<li class="chapter" data-level="21.3.6" data-path="rmarkdown.html"><a href="rmarkdown.html#表"><i class="fa fa-check"></i><b>21.3.6</b> 表</a></li>
<li class="chapter" data-level="21.3.7" data-path="rmarkdown.html"><a href="rmarkdown.html#画像"><i class="fa fa-check"></i><b>21.3.7</b> 画像</a></li>
<li class="chapter" data-level="21.3.8" data-path="rmarkdown.html"><a href="rmarkdown.html#リンク"><i class="fa fa-check"></i><b>21.3.8</b> リンク</a></li>
<li class="chapter" data-level="21.3.9" data-path="rmarkdown.html"><a href="rmarkdown.html#脚注"><i class="fa fa-check"></i><b>21.3.9</b> 脚注</a></li>
<li class="chapter" data-level="21.3.10" data-path="rmarkdown.html"><a href="rmarkdown.html#数式"><i class="fa fa-check"></i><b>21.3.10</b> 数式</a></li>
<li class="chapter" data-level="21.3.11" data-path="rmarkdown.html"><a href="rmarkdown.html#引用"><i class="fa fa-check"></i><b>21.3.11</b> 引用</a></li>
<li class="chapter" data-level="21.3.12" data-path="rmarkdown.html"><a href="rmarkdown.html#コメント"><i class="fa fa-check"></i><b>21.3.12</b> コメント</a></li>
<li class="chapter" data-level="21.3.13" data-path="rmarkdown.html"><a href="rmarkdown.html#コード"><i class="fa fa-check"></i><b>21.3.13</b> コード</a></li>
</ul></li>
<li class="chapter" data-level="21.4" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-chunk"><i class="fa fa-check"></i><b>21.4</b> チャンクのオプション</a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="rmarkdown.html"><a href="rmarkdown.html#チャンク名とチャンク間依存関係"><i class="fa fa-check"></i><b>21.4.1</b> チャンク名とチャンク間依存関係</a></li>
<li class="chapter" data-level="21.4.2" data-path="rmarkdown.html"><a href="rmarkdown.html#コードまたは結果の表示非常時"><i class="fa fa-check"></i><b>21.4.2</b> コードまたは結果の表示/非常時</a></li>
<li class="chapter" data-level="21.4.3" data-path="rmarkdown.html"><a href="rmarkdown.html#プロット"><i class="fa fa-check"></i><b>21.4.3</b> プロット</a></li>
<li class="chapter" data-level="21.4.4" data-path="rmarkdown.html"><a href="rmarkdown.html#コードの見栄"><i class="fa fa-check"></i><b>21.4.4</b> コードの見栄</a></li>
<li class="chapter" data-level="21.4.5" data-path="rmarkdown.html"><a href="rmarkdown.html#チャンクオプションのもう一つの書き方"><i class="fa fa-check"></i><b>21.4.5</b> チャンクオプションのもう一つの書き方</a></li>
</ul></li>
<li class="chapter" data-level="21.5" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-header"><i class="fa fa-check"></i><b>21.5</b> ヘッダーのオプション</a>
<ul>
<li class="chapter" data-level="21.5.1" data-path="rmarkdown.html"><a href="rmarkdown.html#目次の追加"><i class="fa fa-check"></i><b>21.5.1</b> 目次の追加</a></li>
<li class="chapter" data-level="21.5.2" data-path="rmarkdown.html"><a href="rmarkdown.html#コードのハイライト"><i class="fa fa-check"></i><b>21.5.2</b> コードのハイライト</a></li>
</ul></li>
<li class="chapter" data-level="21.6" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-japanese"><i class="fa fa-check"></i><b>21.6</b> 日本語が含まれているPDFの出力</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="rmarkdown2.html"><a href="rmarkdown2.html"><i class="fa fa-check"></i><b>22</b> R Markdown [応用]</a>
<ul>
<li class="chapter" data-level="22.1" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-slide"><i class="fa fa-check"></i><b>22.1</b> スライド作成</a></li>
<li class="chapter" data-level="22.2" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-book"><i class="fa fa-check"></i><b>22.2</b> 書籍</a></li>
<li class="chapter" data-level="22.3" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-homepage"><i class="fa fa-check"></i><b>22.3</b> ホームページ</a></li>
<li class="chapter" data-level="22.4" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-cv"><i class="fa fa-check"></i><b>22.4</b> 履歴書</a></li>
<li class="chapter" data-level="22.5" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-package"><i class="fa fa-check"></i><b>22.5</b> パッケージ開発</a></li>
<li class="chapter" data-level="22.6" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-tutorial"><i class="fa fa-check"></i><b>22.6</b> チュートリアル</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="table.html"><a href="table.html"><i class="fa fa-check"></i><b>23</b> 表の作成</a></li>
<li class="chapter" data-level="24" data-path="visualization5.html"><a href="visualization5.html"><i class="fa fa-check"></i><b>24</b> モデルの可視化</a></li>
<li class="part"><span><b>VI 中級者向け</b></span></li>
<li class="chapter" data-level="25" data-path="datahandling3.html"><a href="datahandling3.html"><i class="fa fa-check"></i><b>25</b> データハンドリング[応用編]</a></li>
<li class="chapter" data-level="26" data-path="iteration.html"><a href="iteration.html"><i class="fa fa-check"></i><b>26</b> 反復処理</a>
<ul>
<li class="chapter" data-level="26.1" data-path="iteration.html"><a href="iteration.html#iteration-abstract"><i class="fa fa-check"></i><b>26.1</b> 概要</a></li>
<li class="chapter" data-level="26.2" data-path="iteration.html"><a href="iteration.html#iteration-intro"><i class="fa fa-check"></i><b>26.2</b> <code>*apply()</code>関数群と<code>map_*()</code>関数群</a></li>
<li class="chapter" data-level="26.3" data-path="iteration.html"><a href="iteration.html#iteration-two-arguments"><i class="fa fa-check"></i><b>26.3</b> 引数が2つ以上の場合</a></li>
<li class="chapter" data-level="26.4" data-path="iteration.html"><a href="iteration.html#iteration-df"><i class="fa fa-check"></i><b>26.4</b> データフレームと{purrr}</a>
<ul>
<li class="chapter" data-level="26.4.1" data-path="iteration.html"><a href="iteration.html#iteration-tibble"><i class="fa fa-check"></i><b>26.4.1</b> tibbleの話</a></li>
</ul></li>
<li class="chapter" data-level="26.5" data-path="iteration.html"><a href="iteration.html#iteration-model1"><i class="fa fa-check"></i><b>26.5</b> モデルの反復推定</a>
<ul>
<li class="chapter" data-level="26.5.1" data-path="iteration.html"><a href="iteration.html#iteration-split1"><i class="fa fa-check"></i><b>26.5.1</b> サンプルの分割とモデル推定（<code>split()</code>利用）</a></li>
<li class="chapter" data-level="26.5.2" data-path="iteration.html"><a href="iteration.html#iteration-split2"><i class="fa fa-check"></i><b>26.5.2</b> サンプルの分割とモデル推定（<code>nest()</code>利用）</a></li>
<li class="chapter" data-level="26.5.3" data-path="iteration.html"><a href="iteration.html#iteration-range"><i class="fa fa-check"></i><b>26.5.3</b> データの範囲を指定したモデル推定</a></li>
<li class="chapter" data-level="26.5.4" data-path="iteration.html"><a href="iteration.html#iteration-variables"><i class="fa fa-check"></i><b>26.5.4</b> 説明・応答変数を指定したモデル推定</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="27" data-path="oop.html"><a href="oop.html"><i class="fa fa-check"></i><b>27</b> オブジェクト指向型プログラミング</a>
<ul>
<li class="chapter" data-level="27.1" data-path="oop.html"><a href="oop.html#oop-intro"><i class="fa fa-check"></i><b>27.1</b> まずは例から</a></li>
<li class="chapter" data-level="27.2" data-path="oop.html"><a href="oop.html#what-is-oop"><i class="fa fa-check"></i><b>27.2</b> OOPとは</a>
<ul>
<li class="chapter" data-level="27.2.1" data-path="oop.html"><a href="oop.html#オブジェクト-1"><i class="fa fa-check"></i><b>27.2.1</b> オブジェクト</a></li>
<li class="chapter" data-level="27.2.2" data-path="oop.html"><a href="oop.html#クラス-1"><i class="fa fa-check"></i><b>27.2.2</b> クラス</a></li>
<li class="chapter" data-level="27.2.3" data-path="oop.html"><a href="oop.html#メソッドと多態性"><i class="fa fa-check"></i><b>27.2.3</b> メソッドと多態性</a></li>
<li class="chapter" data-level="27.2.4" data-path="oop.html"><a href="oop.html#継承"><i class="fa fa-check"></i><b>27.2.4</b> 継承</a></li>
</ul></li>
<li class="chapter" data-level="27.3" data-path="oop.html"><a href="oop.html#oop-in-r"><i class="fa fa-check"></i><b>27.3</b> RにおけるOOP</a>
<ul>
<li class="chapter" data-level="27.3.1" data-path="oop.html"><a href="oop.html#オブジェクトに任意のクラスを付ける"><i class="fa fa-check"></i><b>27.3.1</b> オブジェクトに任意のクラスを付ける</a></li>
<li class="chapter" data-level="27.3.2" data-path="oop.html"><a href="oop.html#メソッドの作り方"><i class="fa fa-check"></i><b>27.3.2</b> メソッドの作り方</a></li>
<li class="chapter" data-level="27.3.3" data-path="oop.html"><a href="oop.html#検証用関数を作る"><i class="fa fa-check"></i><b>27.3.3</b> 検証用関数を作る</a></li>
</ul></li>
<li class="chapter" data-level="27.4" data-path="oop.html"><a href="oop.html#oop-sample"><i class="fa fa-check"></i><b>27.4</b> 例題</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="monte.html"><a href="monte.html"><i class="fa fa-check"></i><b>28</b> モンテカルロシミュレーション</a>
<ul>
<li class="chapter" data-level="28.1" data-path="monte.html"><a href="monte.html#monte-intro"><i class="fa fa-check"></i><b>28.1</b> モンテカルロシミュレーションとは</a></li>
<li class="chapter" data-level="28.2" data-path="monte.html"><a href="monte.html#monte-rng"><i class="fa fa-check"></i><b>28.2</b> 乱数生成</a>
<ul>
<li class="chapter" data-level="28.2.1" data-path="monte.html"><a href="monte.html#sampleによるサンプリング"><i class="fa fa-check"></i><b>28.2.1</b> <code>sample()</code>によるサンプリング</a></li>
<li class="chapter" data-level="28.2.2" data-path="monte.html"><a href="monte.html#確率分布からの乱数制制"><i class="fa fa-check"></i><b>28.2.2</b> 確率分布からの乱数制制</a></li>
<li class="chapter" data-level="28.2.3" data-path="monte.html"><a href="monte.html#シードについて"><i class="fa fa-check"></i><b>28.2.3</b> シードについて</a></li>
</ul></li>
<li class="chapter" data-level="28.3" data-path="monte.html"><a href="monte.html#monte-birthday"><i class="fa fa-check"></i><b>28.3</b> 例1: 誕生日問題</a></li>
<li class="chapter" data-level="28.4" data-path="monte.html"><a href="monte.html#monte-montyhall"><i class="fa fa-check"></i><b>28.4</b> 例2: モンティ・ホール問題</a></li>
<li class="chapter" data-level="28.5" data-path="monte.html"><a href="monte.html#monte-pi"><i class="fa fa-check"></i><b>28.5</b> 応用1: 円周率の計算</a></li>
<li class="chapter" data-level="28.6" data-path="monte.html"><a href="monte.html#monte-bootstrap"><i class="fa fa-check"></i><b>28.6</b> 応用2: ブートストラップ法</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="scraping.html"><a href="scraping.html"><i class="fa fa-check"></i><b>29</b> スクレイピング</a></li>
<li class="chapter" data-level="30" data-path="api.html"><a href="api.html"><i class="fa fa-check"></i><b>30</b> API</a></li>
<li class="chapter" data-level="" data-path="solution.html"><a href="solution.html"><i class="fa fa-check"></i>演習問題の回答</a>
<ul>
<li class="chapter" data-level="30.1" data-path="solution.html"><a href="solution.html#solution-rbasic"><i class="fa fa-check"></i><b>30.1</b> 基本的な操作</a></li>
<li class="chapter" data-level="30.2" data-path="solution.html"><a href="solution.html#solution-datastructure"><i class="fa fa-check"></i><b>30.2</b> データの構造</a>
<ul>
<li class="chapter" data-level="30.2.1" data-path="solution.html"><a href="solution.html#ベクトル-1"><i class="fa fa-check"></i><b>30.2.1</b> ベクトル</a></li>
<li class="chapter" data-level="30.2.2" data-path="solution.html"><a href="solution.html#行列-1"><i class="fa fa-check"></i><b>30.2.2</b> 行列</a></li>
<li class="chapter" data-level="30.2.3" data-path="solution.html"><a href="solution.html#データフレーム-1"><i class="fa fa-check"></i><b>30.2.3</b> データフレーム</a></li>
</ul></li>
<li class="chapter" data-level="30.3" data-path="solution.html"><a href="solution.html#rプログラミングの基礎"><i class="fa fa-check"></i><b>30.3</b> Rプログラミングの基礎</a></li>
<li class="chapter" data-level="30.4" data-path="solution.html"><a href="solution.html#関数の自作"><i class="fa fa-check"></i><b>30.4</b> 関数の自作</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="session.html"><a href="session.html"><i class="fa fa-check"></i>本書の執筆環境</a></li>
<li class="chapter" data-level="" data-path="reference.html"><a href="reference.html"><i class="fa fa-check"></i>参考資料</a></li>
<li class="divider"></li>
<p style = "text-align:center;"><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></p>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">私たちのR: ベストプラクティスの探究</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="iteration" class="section level1" number="26">
<h1><span class="header-section-number">26.</span> 反復処理</h1>
<div id="iteration-abstract" class="section level2" number="26.1">
<h2><span class="header-section-number">26.1</span> 概要</h2>
<ul>
<li><a href="iteration.html#iteration-intro"><code>*apply()</code>関数群と<code>map_*()</code>関数群</a></li>
<li><a href="iteration.html#iteration-two-arguments">引数が2つ以上の場合</a></li>
<li><a href="iteration.html#iteration-df">データフレームと{purrr}</a></li>
<li><a href="iteration.html#iteration-model1">モデルの反復推定</a>
<ul>
<li><a href="iteration.html#iteration-split1">サンプルの分割とモデル推定（<code>split()</code>利用）</a></li>
<li><a href="iteration.html#iteration-split2">サンプルの分割とモデル推定（<code>nest()</code>利用）</a></li>
<li><a href="iteration.html#iteration-range">データの範囲を指定したモデル推定</a></li>
<li><a href="iteration.html#iteration-variables">説明・応答変数を指定したモデル推定</a></li>
</ul></li>
</ul>
<hr />
</div>
<div id="iteration-intro" class="section level2" number="26.2">
<h2><span class="header-section-number">26.2</span> <code>*apply()</code>関数群と<code>map_*()</code>関数群</h2>
<p>まず、我らの盟友、{tidyverse}を読み込んでおきましょう。</p>
<div class="sourceCode" id="cb1698"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1698-1"><a href="iteration.html#cb1698-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse)</span></code></pre></div>
<p>それでは、<code>*apply()</code>関数群と<code>map_*()</code>関数群の動きとその仕組について調べてみましょう。まず、実習用データとして長さ5のnumericベクトル<code>num_vec</code>を用意します。</p>
<div class="sourceCode" id="cb1699"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1699-1"><a href="iteration.html#cb1699-1"></a>num_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">7</span>)</span></code></pre></div>
<p>この<code>num_vec</code>の個々の要素に2を足す場合はどうすれば良いでしょうか。Rはベクトル単位での演算が行われるため、<code>num_vec + 2</code>だけで十分です。<code>+</code>の右側にある2は長さ1のベクトルですが、<code>num_vec</code>の長さに合わせてリサイクルされます（第<a href="datastructure.html#structure-vector">9.2</a>章を参照）。</p>
<div class="sourceCode" id="cb1700"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1700-1"><a href="iteration.html#cb1700-1"></a>num_vec <span class="sc">+</span> <span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 5 4 7 6 9</code></pre>
<p>賢明なRユーザーなら上のコードが正解でしょう。しかし、これからの練習のために<code>+</code>を使わずに、<code>for()</code>文を使用してみましょう（第<a href="programming.html#programming-iteration">10.3</a>章を参照）。</p>
<div class="sourceCode" id="cb1702"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1702-1"><a href="iteration.html#cb1702-1"></a><span class="cf">for</span> (i <span class="cf">in</span> num_vec) {</span>
<span id="cb1702-2"><a href="iteration.html#cb1702-2"></a>    <span class="fu">print</span>(i <span class="sc">+</span> <span class="dv">2</span>)</span>
<span id="cb1702-3"><a href="iteration.html#cb1702-3"></a>}</span></code></pre></div>
<pre><code>## [1] 5
## [1] 4
## [1] 7
## [1] 6
## [1] 9</code></pre>
<p>実はこれと同じ役割をする関数がRには内蔵されており、それが<code>lapply()</code>関数です。</p>
<div class="sourceCode" id="cb1704"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1704-1"><a href="iteration.html#cb1704-1"></a><span class="fu">lapply</span>(オブジェクト名, 関数名, 関数の引数)</span></code></pre></div>
<p>以下のコードからも確認出来ますが、足し算を意味する<code>+</code>も関数です。ただし、演算子を関数として使う場合は演算子を<code>`</code>で囲む必要があり、<code>+</code>だと<code>`+`</code>と表記します。</p>
<div class="sourceCode" id="cb1705"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1705-1"><a href="iteration.html#cb1705-1"></a><span class="st">`</span><span class="at">+</span><span class="st">`</span>(num_vec, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 5 4 7 6 9</code></pre>
<p>したがって、<code>lapply()</code>関数を使用して<code>num_vec</code>の全要素に2を足す場合、以下のようなコードとなります。</p>
<div class="sourceCode" id="cb1707"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1707-1"><a href="iteration.html#cb1707-1"></a><span class="fu">lapply</span>(num_vec, <span class="st">`</span><span class="at">+</span><span class="st">`</span>, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 5
## 
## [[2]]
## [1] 4
## 
## [[3]]
## [1] 7
## 
## [[4]]
## [1] 6
## 
## [[5]]
## [1] 9</code></pre>
<p>これと同じ動きをする関数が{purrr}パッケージの<code>map()</code>です。{purrr}は{tidyverse}を読み込むと自動的に読み込まれます。</p>
<div class="sourceCode" id="cb1709"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1709-1"><a href="iteration.html#cb1709-1"></a><span class="fu">map</span>(num_vec, <span class="st">`</span><span class="at">+</span><span class="st">`</span>, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 5
## 
## [[2]]
## [1] 4
## 
## [[3]]
## [1] 7
## 
## [[4]]
## [1] 6
## 
## [[5]]
## [1] 9</code></pre>
<p>ただし、<code>lapply()</code>と<code>map()</code>の場合、戻り値はリスト型となります。もし、ベクトル型の戻り値が必要な場合は更に<code>unlist()</code>関数を使うか、<code>sapply()</code>を使います。</p>
<div class="sourceCode" id="cb1711"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1711-1"><a href="iteration.html#cb1711-1"></a><span class="co"># unlist()を利用し、リストを解除する</span></span>
<span id="cb1711-2"><a href="iteration.html#cb1711-2"></a><span class="fu">lapply</span>(num_vec, <span class="st">`</span><span class="at">+</span><span class="st">`</span>, <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>()</span></code></pre></div>
<pre><code>## [1] 5 4 7 6 9</code></pre>
<div class="sourceCode" id="cb1713"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1713-1"><a href="iteration.html#cb1713-1"></a><span class="co"># sapply()を利用すると戻り値はベクトルとなる</span></span>
<span id="cb1713-2"><a href="iteration.html#cb1713-2"></a><span class="fu">sapply</span>(num_vec, <span class="st">`</span><span class="at">+</span><span class="st">`</span>, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 5 4 7 6 9</code></pre>
<p><code>map()</code>関数なら<code>unlist()</code>でも良いですが、<code>sapply()</code>と同じ動きをする<code>map_dbl()</code>があります。これは戻り値がdoubleのnumericベクトルになる<code>map()</code>関数です。</p>
<div class="sourceCode" id="cb1715"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1715-1"><a href="iteration.html#cb1715-1"></a><span class="co"># map_dbl()を利用するとnumeric (double)のベクトルが返される</span></span>
<span id="cb1715-2"><a href="iteration.html#cb1715-2"></a><span class="fu">map_dbl</span>(num_vec, <span class="st">`</span><span class="at">+</span><span class="st">`</span>, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 5 4 7 6 9</code></pre>
<p>もし、2を足すだけでなく、更に3で割るためにはどうすれば良いでしょうか。まず考えられるのは更に<code>sapply()</code>や<code>map_dbl</code>を使うことです。</p>
<div class="sourceCode" id="cb1717"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1717-1"><a href="iteration.html#cb1717-1"></a><span class="fu">map_dbl</span>(num_vec, <span class="st">`</span><span class="at">+</span><span class="st">`</span>, <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1717-2"><a href="iteration.html#cb1717-2"></a>    <span class="fu">map_dbl</span>(<span class="st">`</span><span class="at">/</span><span class="st">`</span>, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 1.666667 1.333333 2.333333 2.000000 3.000000</code></pre>
<p>もう一つの方法は<code>sapply()</code>や<code>map_dbl()</code>の第二引数に直接関数を指定する方法です。</p>
<div class="sourceCode" id="cb1719"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1719-1"><a href="iteration.html#cb1719-1"></a><span class="fu">sapply</span>(num_vec, <span class="cf">function</span>(x){(x <span class="sc">+</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="dv">3</span>})</span></code></pre></div>
<pre><code>## [1] 1.666667 1.333333 2.333333 2.000000 3.000000</code></pre>
<div class="sourceCode" id="cb1721"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1721-1"><a href="iteration.html#cb1721-1"></a><span class="fu">map_dbl</span>(num_vec, <span class="cf">function</span>(x){(x <span class="sc">+</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="dv">3</span>})</span></code></pre></div>
<pre><code>## [1] 1.666667 1.333333 2.333333 2.000000 3.000000</code></pre>
<p>上のコードだと、<code>num_vec</code>の要素が第二引数で指定した関数の引数（<code>x</code>）として用いられます。関数が長くなる場合は、<code>sapply()</code>や<code>map()</code>の外側に関数を予め指定して置くことも可能です。</p>
<div class="sourceCode" id="cb1723"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1723-1"><a href="iteration.html#cb1723-1"></a>add_two_divide_three <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb1723-2"><a href="iteration.html#cb1723-2"></a>    (x <span class="sc">+</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="dv">3</span> </span>
<span id="cb1723-3"><a href="iteration.html#cb1723-3"></a>}</span>
<span id="cb1723-4"><a href="iteration.html#cb1723-4"></a><span class="fu">sapply</span>(num_vec, add_two_divide_three)</span></code></pre></div>
<pre><code>## [1] 1.666667 1.333333 2.333333 2.000000 3.000000</code></pre>
<div class="sourceCode" id="cb1725"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1725-1"><a href="iteration.html#cb1725-1"></a><span class="fu">map_dbl</span>(num_vec, add_two_divide_three)</span></code></pre></div>
<pre><code>## [1] 1.666667 1.333333 2.333333 2.000000 3.000000</code></pre>
<p>ここまでの例だと<code>sapply()</code>と<code>map_dbl()</code>はほぼ同じ関数です。なぜわざわざ{purrr}パッケージを読み込んでまで<code>map_dbl()</code>関数を使う必要があるでしょうか。それは<code>map_dbl()</code>の内部にはラムダ（lambda）式、あるいは無名関数（anonymous function）と呼ばれるものが使用可能だからです。ラムダ式は第<a href="datahandling2.html#handling2-summarise">13.1</a>章でも説明しましたが、もう一回解説します。ラムダ式は使い捨ての関数で、<code>map_dbl()</code>内部での処理が終わるとメモリ上から削除される関数です。使い捨てですので、関数の名前（オブジェクト名）も与えられておりません。</p>
<p>このラムダ式の作り方ですが、<code>~</code>で始まり、引数の部分には<code>.x</code>が入ります<a href="reference.html#fn101" class="footnote-ref" id="fnref101"><sup>101</sup></a>。したがって、<code>~(.x + 2) / 3</code>は<code>function(x){(x + 2) / 3}</code>の簡略したものとなります。ただし、後者だと無名関数の引数に該当する<code>x</code>を<code>y</code>や<code>j</code>などに書き換えても問題ありませんが、ラムダ式では必ず<code>.x</code>と表記する必要があります。</p>
<div class="sourceCode" id="cb1727"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1727-1"><a href="iteration.html#cb1727-1"></a><span class="fu">map_dbl</span>(num_vec, <span class="sc">~</span>(.x <span class="sc">+</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 1.666667 1.333333 2.333333 2.000000 3.000000</code></pre>
<p>かなり短めなコードで「<code>num_vec</code>の全要素に2を足して3で割る」処理ができました。一方、<code>sapply()</code>や<code>lapply()</code>のような<code>*apply()</code>関数群だとラムダ式を使うことはできません。現在のメモリ上にある関数のみしか使うことができません。</p>
<div class="sourceCode" id="cb1729"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1729-1"><a href="iteration.html#cb1729-1"></a><span class="fu">sapply</span>(num_vec, <span class="sc">~</span>(.x <span class="sc">+</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Error in match.fun(FUN):  &#39;~(.x + 2)/3&#39; は関数、文字、またはシンボルではありません</code></pre>
<p>これまでの例は<strong>正しい</strong>コードではありますが、<strong>良い</strong>コードとは言えないでしょう。なぜなら<code>num_vec + 2</code>という最適解が存在するからです。<code>*apply()</code>と<code>map_*()</code>はより複雑な処理に特化しています。たとえば、リスト型データの処理です。以下の例を考えてみましょう。</p>
<div class="sourceCode" id="cb1731"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1731-1"><a href="iteration.html#cb1731-1"></a>num_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">List1 =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>),</span>
<span id="cb1731-2"><a href="iteration.html#cb1731-2"></a>                 <span class="at">List2 =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">3</span>),</span>
<span id="cb1731-3"><a href="iteration.html#cb1731-3"></a>                 <span class="at">List3 =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="cn">NA</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><code>num_list</code>は3つのnumeric型ベクトルで構成されたリスト型オブジェクトです。それぞれのベクトルの平均値を求めてみましょう。これを普通に<code>mean()</code>関数のみで済まそうとすると、リストからベクトルを一つずつ抽出し、3回の<code>mean()</code>関数を使用する必要があります、</p>
<div class="sourceCode" id="cb1732"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1732-1"><a href="iteration.html#cb1732-1"></a><span class="fu">mean</span>(num_list[[<span class="st">&quot;List1&quot;</span>]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb1734"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1734-1"><a href="iteration.html#cb1734-1"></a><span class="fu">mean</span>(num_list[[<span class="st">&quot;List2&quot;</span>]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 6.571429</code></pre>
<div class="sourceCode" id="cb1736"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1736-1"><a href="iteration.html#cb1736-1"></a><span class="fu">mean</span>(num_list[[<span class="st">&quot;List3&quot;</span>]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 4.666667</code></pre>
<p>もしリストの長さが大きくなると、以下のように<code>for()</code>文の方が効率的でしょう。</p>
<div class="sourceCode" id="cb1738"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1738-1"><a href="iteration.html#cb1738-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">names</span>(num_list)) {</span>
<span id="cb1738-2"><a href="iteration.html#cb1738-2"></a>    <span class="fu">print</span>(<span class="fu">mean</span>(num_list[[i]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb1738-3"><a href="iteration.html#cb1738-3"></a>}</span></code></pre></div>
<pre><code>## [1] 5
## [1] 6.571429
## [1] 4.666667</code></pre>
<p>計算結果をベクトルとして出力/保存する場合は予めベクトルを用意しておく必要があります。</p>
<div class="sourceCode" id="cb1740"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1740-1"><a href="iteration.html#cb1740-1"></a><span class="co"># num_listの長さと同じ長さの空ベクトルを生成</span></span>
<span id="cb1740-2"><a href="iteration.html#cb1740-2"></a>Return_vec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(num_list))</span>
<span id="cb1740-3"><a href="iteration.html#cb1740-3"></a></span>
<span id="cb1740-4"><a href="iteration.html#cb1740-4"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(num_list)) {</span>
<span id="cb1740-5"><a href="iteration.html#cb1740-5"></a>    Return_vec[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(num_list[[i]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1740-6"><a href="iteration.html#cb1740-6"></a>}</span>
<span id="cb1740-7"><a href="iteration.html#cb1740-7"></a></span>
<span id="cb1740-8"><a href="iteration.html#cb1740-8"></a>Return_vec</span></code></pre></div>
<pre><code>## [1] 5.000000 6.571429 4.666667</code></pre>
<p>以上の例は<code>sapply()</code>、または<code>map_dbl</code>関数を使うとより短くすることができます。</p>
<div class="sourceCode" id="cb1742"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1742-1"><a href="iteration.html#cb1742-1"></a><span class="fu">sapply</span>(num_list, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##    List1    List2    List3 
## 5.000000 6.571429 4.666667</code></pre>
<div class="sourceCode" id="cb1744"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1744-1"><a href="iteration.html#cb1744-1"></a><span class="fu">map_dbl</span>(num_list, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##    List1    List2    List3 
## 5.000000 6.571429 4.666667</code></pre>
<p><code>*apply()</code>も<code>map_*()</code>も、それぞれの要素に対して同じ処理を行うことを得意とする関数です。他の応用としては、各ベクトルからn番目の要素を抽出することもできます。ベクトルからn番目の要素を抽出するには<code>ベクトル名[n]</code>と入力しますが、実はこの<code>[</code>も関数です。関数として使う場合は<code>+</code>と同様、<code>`[`</code>と表記します。<code>num_list</code>内の3つのベクトルから3番目の要素を抽出してみましょう<a href="reference.html#fn102" class="footnote-ref" id="fnref102"><sup>102</sup></a>。</p>
<div class="sourceCode" id="cb1746"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1746-1"><a href="iteration.html#cb1746-1"></a><span class="fu">map_dbl</span>(num_list, <span class="st">`</span><span class="at">[</span><span class="st">`</span>, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## List1 List2 List3 
##     5     6    NA</code></pre>
<p>ここまで来たら<code>map_*()</code>関数群の仕組みについてイメージが出来たかと思います。<code>map_*()</code>関数群の動きは図<a href="iteration.html#fig:iteration-intro-21">26.1</a>のように表すことができます。第一引数はデータであり、そのデータの各要素に対して第二引数で指定された関数を適用します。この関数に必要な（データを除く）引数は第三引数以降に指定します。この関数部（第二引数）はRやパッケージなどで予め提供されている関数でも、内部に直接無名関数を作成することもできます。この無名関数は<code>function(x){}</code>のような従来の書き方も可能ですが、<code>map_*()</code>関数群の場合<code>~</code>で始まるラムダ式を使うことも可能です。</p>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:iteration-intro-21"></span>
<img src="figures/Iteration/map_inside.png" alt="map_*()関数群のイメージ" width="100%" />
<p class="caption">
図 26.1: <code>map_*()</code>関数群のイメージ
</p>
</div>
<p><code>map()</code>の場合、返り値はリストとなり、<code>map_dbl()</code>の返り値はnumeric (double)型のベクトルとなります。他にも<code>map_*()</code>関数群には<code>map_int()</code>、<code>map_lgl()</code>、<code>map_chr()</code>、<code>map_df()</code>などがあり、それぞれ返り値のデータ型/データ構造を表しています。例えば、返り値がcharacter型のベクトルであれば、<code>map_chr()</code>を使います。<code>c(1, 2, 3, 4, 5)</code>のベクトルの各要素の前に<code>"ID: "</code>を付ける例だと以下のように書きます。</p>
<div class="sourceCode" id="cb1748"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1748-1"><a href="iteration.html#cb1748-1"></a><span class="co"># 以下のコードでもOK</span></span>
<span id="cb1748-2"><a href="iteration.html#cb1748-2"></a><span class="co"># map_chr(c(1, 2, 3, 4, 5), ~paste0(&quot;ID: &quot;, .x))</span></span>
<span id="cb1748-3"><a href="iteration.html#cb1748-3"></a><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1748-4"><a href="iteration.html#cb1748-4"></a>  <span class="fu">map_chr</span>(<span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;ID: &quot;</span>, .x))</span></code></pre></div>
<pre><code>## [1] &quot;ID: 1&quot; &quot;ID: 2&quot; &quot;ID: 3&quot; &quot;ID: 4&quot; &quot;ID: 5&quot;</code></pre>
<hr />
</div>
<div id="iteration-two-arguments" class="section level2" number="26.3">
<h2><span class="header-section-number">26.3</span> 引数が2つ以上の場合</h2>
<p>{purrr}を使った本格的な例を紹介する前に、引数が2つ以上の場合を考えたいと思います。まずは引数が2つの場合です。この場合、<code>map2_*()</code>関数群を使用します。例えば、<code>num_vec</code>に長さ5のnumeric型ベクトル<code>num_vec2</code>をかける例を考えてみましょう。</p>
<p>この場合、データとして<code>num_vec</code>と<code>num_vec2</code>が必要となり、ラムダ式にも2つの引数が必要です。まず、<code>num_vec2</code>を用意します。</p>
<div class="sourceCode" id="cb1750"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1750-1"><a href="iteration.html#cb1750-1"></a>num_vec2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span></code></pre></div>
<p>続いて<code>map2_dbl()</code>関数を使用し<code>num_vec</code>と<code>num_vec2</code>の掛け算を行います。<code>map2_*()</code>の使い方は<code>map_*()</code>とほぼ同様です。</p>
<div class="sourceCode" id="cb1751"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1751-1"><a href="iteration.html#cb1751-1"></a><span class="fu">map2_dbl</span>(データ1, データ2, 関数 or ラムダ式, 追加の引数)</span></code></pre></div>
<p><code>map_*()</code>との違いとしては、(1) データが2つである、(2) 関数、またはラムダ式に2つの引数が必要である点です。この2点目の引数ですが、データ2は<code>.y</code>と表記します。したがって、データ1とデータ2の掛け算を意味するラムダ式は<code>~.x * .y</code>です。</p>
<div class="sourceCode" id="cb1752"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1752-1"><a href="iteration.html#cb1752-1"></a><span class="fu">map2_dbl</span>(num_vec, num_vec2, <span class="sc">~</span>.x <span class="sc">*</span> .y)</span></code></pre></div>
<pre><code>## [1] 3 0 5 0 7</code></pre>
<p><code>num_vec</code>と<code>num_vec2</code>が必ずしも同じデータ構造、データ型、同じ長さである必要がありません。数字の前に<code>"ID:"</code>を付ける先ほどの例を<code>map2_chr()</code>で書いてみましょう。</p>
<div class="sourceCode" id="cb1754"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1754-1"><a href="iteration.html#cb1754-1"></a><span class="fu">map2_chr</span>(num_vec, <span class="st">&quot;ID:&quot;</span>, <span class="sc">~</span><span class="fu">paste0</span>(.y, .x))</span></code></pre></div>
<pre><code>## [1] &quot;ID:3&quot; &quot;ID:2&quot; &quot;ID:5&quot; &quot;ID:4&quot; &quot;ID:7&quot;</code></pre>
<p>それでは3つ以上の引数について考えてみましょう。たとえば、<code>num_vec</code>の前に<code>"ID"</code>を付けるとします。そして<code>"ID"</code>と<code>num_vec</code>の間に<code>":"</code>を入れたい場合はどうすればい良いでしょう。むろん、賢い解決方法は単純に<code>paste()</code>関数を使うだけです。</p>
<div class="sourceCode" id="cb1756"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1756-1"><a href="iteration.html#cb1756-1"></a><span class="fu">paste</span>(<span class="st">&quot;ID&quot;</span>, num_vec, <span class="at">sep =</span> <span class="st">&quot;:&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;ID:3&quot; &quot;ID:2&quot; &quot;ID:5&quot; &quot;ID:4&quot; &quot;ID:7&quot;</code></pre>
<p>この場合、引数は3つです<a href="reference.html#fn103" class="footnote-ref" id="fnref103"><sup>103</sup></a>。この場合の書き方はどうなるでしょうか。<code>map2_*()</code>はデータを2つまでしか指定できません。3つ目以降は関数/ラムダ式の後ろに書くこととなります。ただし、関数/ラムダ式の後ろに指定される引数は長さ1のベクトルでなければなりません。また、ラムダ式内の引数は<code>.x</code>と<code>.y</code>でなく、<code>..1</code>、<code>..2</code>、<code>..3</code>、…となります。</p>
<p>今回の例だと<code>map2_chr()</code>内に<code>num_vec</code>がデータ1、<code>"ID"</code>がデータ2です。そして、期待される結果は、「“ID” + <code>sep</code>の実引数 + <code>num_vec</code>の値」となります。したがって、ラムダ式は<code>paste(..2, ..1, sep = ..3)</code>となります。</p>
<div class="sourceCode" id="cb1758"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1758-1"><a href="iteration.html#cb1758-1"></a><span class="fu">map2_chr</span>(num_vec, <span class="st">&quot;ID&quot;</span>, <span class="sc">~</span><span class="fu">paste</span>(..<span class="dv">2</span>, ..<span class="dv">1</span>, <span class="at">sep =</span> ..<span class="dv">3</span>), <span class="st">&quot;-&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;ID-3&quot; &quot;ID-2&quot; &quot;ID-5&quot; &quot;ID-4&quot; &quot;ID-7&quot;</code></pre>
<p>データ2である<code>"ID"</code>は長さ1のcharacter型ベクトルであるため、以下のように<code>map_chr()</code>を使うことも可能です。</p>
<div class="sourceCode" id="cb1760"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1760-1"><a href="iteration.html#cb1760-1"></a><span class="co"># データ2も長さ1なのでmap_chr()もOK</span></span>
<span id="cb1760-2"><a href="iteration.html#cb1760-2"></a><span class="fu">map_chr</span>(num_vec, <span class="sc">~</span><span class="fu">paste</span>(..<span class="dv">2</span>, ..<span class="dv">1</span>, <span class="at">sep =</span> ..<span class="dv">3</span>), <span class="st">&quot;ID&quot;</span>, <span class="st">&quot;-&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;ID-3&quot; &quot;ID-2&quot; &quot;ID-5&quot; &quot;ID-4&quot; &quot;ID-7&quot;</code></pre>
<p>それではデータを3つ以上使うにはどうすれば良いでしょうか。そこで登場するのが<code>pmap_*()</code>関数です。以下の3つのベクトルを利用し、「名前:数学成績」を出力してみましょう。ただし、不正行為がある場合（<code>cheat_vec</code>の値が1）は成績が0点になるようにしましょう。</p>
<div class="sourceCode" id="cb1762"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1762-1"><a href="iteration.html#cb1762-1"></a>name_vec  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Hadley&quot;</span>, <span class="st">&quot;Song&quot;</span>, <span class="st">&quot;Yanai&quot;</span>)</span>
<span id="cb1762-2"><a href="iteration.html#cb1762-2"></a>math_vec  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">70</span>, <span class="dv">55</span>, <span class="dv">80</span>)</span>
<span id="cb1762-3"><a href="iteration.html#cb1762-3"></a>cheat_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code></pre></div>
<p>賢い解決法は普通に<code>paste0()</code>関数を使う方法です。</p>
<div class="sourceCode" id="cb1763"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1763-1"><a href="iteration.html#cb1763-1"></a><span class="fu">paste0</span>(name_vec, <span class="st">&quot;:&quot;</span>, math_vec <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> cheat_vec))</span></code></pre></div>
<pre><code>## [1] &quot;Hadley:70&quot; &quot;Song:0&quot;    &quot;Yanai:80&quot;</code></pre>
<p>今回はあえて<code>pmap_*()</code>関数を使ってみましょう。<code>pmap_*()</code>の場合、第一引数であるデータはリスト型で渡す必要があります。したがって、3つのベクトルを<code>list()</code>関数を用いてリスト化します。第二引数には既存の関数やラムダ式を入力し、各引数は<code>..1</code>、<code>..2</code>、…といった形で表記します。</p>
<div class="sourceCode" id="cb1765"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1765-1"><a href="iteration.html#cb1765-1"></a><span class="fu">pmap_chr</span>(<span class="fu">list</span>(name_vec, math_vec, cheat_vec), </span>
<span id="cb1765-2"><a href="iteration.html#cb1765-2"></a>         <span class="sc">~</span><span class="fu">paste0</span>(..<span class="dv">1</span>, <span class="st">&quot;:&quot;</span>, ..<span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> ..<span class="dv">3</span>)))</span></code></pre></div>
<pre><code>## [1] &quot;Hadley:70&quot; &quot;Song:0&quot;    &quot;Yanai:80&quot;</code></pre>
<p>第一引数はデータであるため、まずリストを作成し、パイプ演算子（<code>%&gt;%</code>）で<code>pmap_*()</code>に渡すことも可能です。</p>
<div class="sourceCode" id="cb1767"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1767-1"><a href="iteration.html#cb1767-1"></a><span class="fu">list</span>(name_vec, math_vec, cheat_vec) <span class="sc">%&gt;%</span></span>
<span id="cb1767-2"><a href="iteration.html#cb1767-2"></a>  <span class="fu">pmap_chr</span>(<span class="sc">~</span><span class="fu">paste0</span>(..<span class="dv">1</span>, <span class="st">&quot;:&quot;</span>, ..<span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> ..<span class="dv">3</span>)))</span></code></pre></div>
<pre><code>## [1] &quot;Hadley:70&quot; &quot;Song:0&quot;    &quot;Yanai:80&quot;</code></pre>
<hr />
</div>
<div id="iteration-df" class="section level2" number="26.4">
<h2><span class="header-section-number">26.4</span> データフレームと{purrr}</h2>
<p><code>map_*()</code>関数のデータとしてデータフレームを渡すことも可能です。ここでは5行3列のデータフレームを作成してみましょう。</p>
<div class="sourceCode" id="cb1769"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1769-1"><a href="iteration.html#cb1769-1"></a>Dummy_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">X =</span> <span class="fu">seq</span>(<span class="dv">1</span>,  <span class="dv">5</span>,  <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb1769-2"><a href="iteration.html#cb1769-2"></a>                       <span class="at">Y =</span> <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">50</span>, <span class="at">by =</span> <span class="dv">10</span>),</span>
<span id="cb1769-3"><a href="iteration.html#cb1769-3"></a>                       <span class="at">Z =</span> <span class="fu">seq</span>(<span class="dv">2</span>,  <span class="dv">10</span>, <span class="at">by =</span> <span class="dv">2</span>))</span></code></pre></div>
<p>各行の<code>X</code>、<code>Y</code>、<code>Z</code>の合計を計算するには{dplyr}の<code>rowwise()</code>と<code>mutate()</code>を組み合わせることで計算出来ることを第<a href="datahandling2.html#handling2-rowwise">13.4</a>章で紹介しました。</p>
<div class="sourceCode" id="cb1770"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1770-1"><a href="iteration.html#cb1770-1"></a>Dummy_df <span class="sc">%&gt;%</span></span>
<span id="cb1770-2"><a href="iteration.html#cb1770-2"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1770-3"><a href="iteration.html#cb1770-3"></a>  <span class="fu">mutate</span>(<span class="at">Sum =</span> <span class="fu">sum</span>(X, Y, Z)) <span class="sc">%&gt;%</span></span>
<span id="cb1770-4"><a href="iteration.html#cb1770-4"></a>  <span class="co"># rowwise()は1行を1グループとする関数であるため、最後にグループ化を解除</span></span>
<span id="cb1770-5"><a href="iteration.html#cb1770-5"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 × 4
##       X     Y     Z   Sum
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1    10     2    13
## 2     2    20     4    26
## 3     3    30     6    39
## 4     4    40     8    52
## 5     5    50    10    65</code></pre>
<p>それでは各列の平均値を計算するにはどうすれば良いでしょうか。ここではR内蔵関数である<code>colMeans()</code>を使わないことにしましょう。</p>
<div class="sourceCode" id="cb1772"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1772-1"><a href="iteration.html#cb1772-1"></a><span class="fu">colMeans</span>(Dummy_df)</span></code></pre></div>
<pre><code>##  X  Y  Z 
##  3 30  6</code></pre>
<p>まず、<code>mean(Dummy_df$X)</code>を3回実行する方法や、{dplyr}の<code>summarise()</code>関数を使う方法があります。</p>
<div class="sourceCode" id="cb1774"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1774-1"><a href="iteration.html#cb1774-1"></a>Dummy_df <span class="sc">%&gt;%</span></span>
<span id="cb1774-2"><a href="iteration.html#cb1774-2"></a>  <span class="fu">summarise</span>(<span class="at">X =</span> <span class="fu">mean</span>(X), </span>
<span id="cb1774-3"><a href="iteration.html#cb1774-3"></a>            <span class="at">Y =</span> <span class="fu">mean</span>(Y),</span>
<span id="cb1774-4"><a href="iteration.html#cb1774-4"></a>            <span class="at">Z =</span> <span class="fu">mean</span>(Z))</span></code></pre></div>
<pre><code>##   X  Y Z
## 1 3 30 6</code></pre>
<p>実はこの操作、<code>map_dbl()</code>関数を使えば、より簡単です。</p>
<div class="sourceCode" id="cb1776"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1776-1"><a href="iteration.html#cb1776-1"></a><span class="fu">map_dbl</span>(Dummy_df, mean)</span></code></pre></div>
<pre><code>##  X  Y  Z 
##  3 30  6</code></pre>
<p><code>map_dbl()</code>はnumeric (double) 型ベクトルを返しますが、データフレーム（具体的にはtibble）に返すなら<code>map_df()</code>を使います。</p>
<div class="sourceCode" id="cb1778"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1778-1"><a href="iteration.html#cb1778-1"></a><span class="fu">map_df</span>(Dummy_df, mean)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##       X     Y     Z
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     3    30     6</code></pre>
<p>なぜこれが出来るでしょうか。これを理解するためにはデータフレームとtibbleが本質的にはリスト型と同じであることを理解する必要があります。たとえば、以下のようなリストについて考えてみましょう。</p>
<div class="sourceCode" id="cb1780"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1780-1"><a href="iteration.html#cb1780-1"></a>Dummy_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">X =</span> <span class="fu">seq</span>(<span class="dv">1</span>,  <span class="dv">5</span>,  <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb1780-2"><a href="iteration.html#cb1780-2"></a>                   <span class="at">Y =</span> <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">50</span>, <span class="at">by =</span> <span class="dv">10</span>),</span>
<span id="cb1780-3"><a href="iteration.html#cb1780-3"></a>                   <span class="at">Z =</span> <span class="fu">seq</span>(<span class="dv">2</span>,  <span class="dv">10</span>, <span class="at">by =</span> <span class="dv">2</span>))</span>
<span id="cb1780-4"><a href="iteration.html#cb1780-4"></a></span>
<span id="cb1780-5"><a href="iteration.html#cb1780-5"></a>Dummy_list</span></code></pre></div>
<pre><code>## $X
## [1] 1 2 3 4 5
## 
## $Y
## [1] 10 20 30 40 50
## 
## $Z
## [1]  2  4  6  8 10</code></pre>
<p>この<code>Dummy_list</code>を<code>as.data.frame()</code>関数を使用して強制的にデータフレームに変換してみましょう。</p>
<div class="sourceCode" id="cb1782"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1782-1"><a href="iteration.html#cb1782-1"></a><span class="fu">as.data.frame</span>(Dummy_list)</span></code></pre></div>
<pre><code>##   X  Y  Z
## 1 1 10  2
## 2 2 20  4
## 3 3 30  6
## 4 4 40  8
## 5 5 50 10</code></pre>
<p><code>Dummy_df</code>と同じものが出てきました。逆に<code>Dummy_df</code>を、<code>as.list()</code>を使用してリストに変換すると<code>Dummy_list</code>と同じものが返されます。</p>
<div class="sourceCode" id="cb1784"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1784-1"><a href="iteration.html#cb1784-1"></a><span class="fu">as.list</span>(Dummy_df)</span></code></pre></div>
<pre><code>## $X
## [1] 1 2 3 4 5
## 
## $Y
## [1] 10 20 30 40 50
## 
## $Z
## [1]  2  4  6  8 10</code></pre>
<p>ここまで理解できれば、<code>map_*()</code>関数のデータがデータフレームの場合、内部ではリストとして扱われることが分かるでしょう。実際、<code>Dummy_list</code>をデータとして入れても<code>Dummy_df</code>を入れた結果と同じものが得られます。</p>
<div class="sourceCode" id="cb1786"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1786-1"><a href="iteration.html#cb1786-1"></a><span class="fu">map_df</span>(Dummy_list, mean)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##       X     Y     Z
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     3    30     6</code></pre>
<div id="iteration-tibble" class="section level3" number="26.4.1">
<h3><span class="header-section-number">26.4.1</span> tibbleの話</h3>
<p>ここまで「データフレーム」と「tibble」を区別せずに説明してきましたが、これからの話しではこの2つを区別する必要があります。tibbleは{tidyverse}のコアパッケージの一つである{tibble}が提供するデータ構造であり、データフレームの上位互換です。tibbleもデータフレーム同様、本質的にはリストですが、リストの構造をより的確に表すことが出来ます。</p>
<p>データフレームをリストとして考える場合、リストの各要素は<strong>必ずベクトル</strong>である必要があります。たとえば、<code>Dummy_list</code>には3つの要素があり、それぞれ長さ5のベクトルです。一方、リストの中にはリストを入れることも出来ます。たとえば、以下のような<code>Dummy_list2</code>について考えてみましょう。</p>
<div class="sourceCode" id="cb1788"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1788-1"><a href="iteration.html#cb1788-1"></a>Dummy_list2 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">ID   =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, </span>
<span id="cb1788-2"><a href="iteration.html#cb1788-2"></a>                    <span class="at">Data =</span> <span class="fu">list</span>(Dummy_df, Dummy_df, Dummy_df))</span>
<span id="cb1788-3"><a href="iteration.html#cb1788-3"></a></span>
<span id="cb1788-4"><a href="iteration.html#cb1788-4"></a>Dummy_list2</span></code></pre></div>
<pre><code>## $ID
## [1] 1 2 3
## 
## $Data
## $Data[[1]]
##   X  Y  Z
## 1 1 10  2
## 2 2 20  4
## 3 3 30  6
## 4 4 40  8
## 5 5 50 10
## 
## $Data[[2]]
##   X  Y  Z
## 1 1 10  2
## 2 2 20  4
## 3 3 30  6
## 4 4 40  8
## 5 5 50 10
## 
## $Data[[3]]
##   X  Y  Z
## 1 1 10  2
## 2 2 20  4
## 3 3 30  6
## 4 4 40  8
## 5 5 50 10</code></pre>
<p><code>Dummy_list2</code>には2つの要素があり、最初の要素は長さ3のベクトル、2つ目の要素は長さ3のリストです。2つ目の要素がベクトルでないため、<code>Dummy_list2</code>をデータフレームに変換することはできません。</p>
<div class="sourceCode" id="cb1790"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1790-1"><a href="iteration.html#cb1790-1"></a>Dummy_df2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(Dummy_list2)</span></code></pre></div>
<pre><code>## Error in (function (..., row.names = NULL, check.rows = FALSE, check.names = TRUE, :  引数に異なる列数のデータフレームが含まれています: 3, 5</code></pre>
<p>一方、<code>as_tibble()</code>を使用してtibble型に変換することは可能です。</p>
<div class="sourceCode" id="cb1792"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1792-1"><a href="iteration.html#cb1792-1"></a>Dummy_tibble <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Dummy_list2)</span>
<span id="cb1792-2"><a href="iteration.html#cb1792-2"></a></span>
<span id="cb1792-3"><a href="iteration.html#cb1792-3"></a>Dummy_tibble</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##      ID Data        
##   &lt;int&gt; &lt;list&gt;      
## 1     1 &lt;df [5 × 3]&gt;
## 2     2 &lt;df [5 × 3]&gt;
## 3     3 &lt;df [5 × 3]&gt;</code></pre>
<p>2列目の各セルには5行3列のデータフレーム（<code>df</code>）が格納されていることが分かります。たとえば、<code>Dummy_tibble</code>の<code>Data</code>列を抽出してみましょう。</p>
<div class="sourceCode" id="cb1794"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1794-1"><a href="iteration.html#cb1794-1"></a>Dummy_tibble<span class="sc">$</span>Data</span></code></pre></div>
<pre><code>## [[1]]
##   X  Y  Z
## 1 1 10  2
## 2 2 20  4
## 3 3 30  6
## 4 4 40  8
## 5 5 50 10
## 
## [[2]]
##   X  Y  Z
## 1 1 10  2
## 2 2 20  4
## 3 3 30  6
## 4 4 40  8
## 5 5 50 10
## 
## [[3]]
##   X  Y  Z
## 1 1 10  2
## 2 2 20  4
## 3 3 30  6
## 4 4 40  8
## 5 5 50 10</code></pre>
<p>長さ3のリスト出力されます。続いて、<code>Dummy_tibble$Data</code>の2番目のセルを抽出してみましょう。</p>
<div class="sourceCode" id="cb1796"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1796-1"><a href="iteration.html#cb1796-1"></a>Dummy_tibble<span class="sc">$</span>Data[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## [[1]]
##   X  Y  Z
## 1 1 10  2
## 2 2 20  4
## 3 3 30  6
## 4 4 40  8
## 5 5 50 10</code></pre>
<p>データフレームが出力されました。簡単にまとめるとtibbleはデータフレームの中にデータフレームを入れることが出来るデータ構造です。むろん、これまでの通り、データフレームのように使うことも可能です<a href="reference.html#fn104" class="footnote-ref" id="fnref104"><sup>104</sup></a>。これがtibbleの強みでもあり、{purrr}との相性も非常に高いです。たとえば、<code>Data</code>列を<code>map()</code>関数のデータとして渡せば、複数のデータセットに対して同じモデルの推定が出来るようになります。以下ではその例を紹介します。</p>
<hr />
</div>
</div>
<div id="iteration-model1" class="section level2" number="26.5">
<h2><span class="header-section-number">26.5</span> モデルの反復推定</h2>
<p>ここからは<code>map_*()</code>関数群を使って複数のモデルを素早く推定する方法について解説します。サンプルデータは第<a href="visualization2.html#visualization2">18</a>章で使いました各国の政治経済データ（<code>Countries.csv</code>）を使用します。csv形式データ読み込みの際、これまではR内蔵関数である<code>read.csv()</code>と{readr}<a href="reference.html#fn105" class="footnote-ref" id="fnref105"><sup>105</sup></a>の<code>read_csv()</code>を区別せずに使用してきました。しかし、ここからは<code>read_csv()</code>を使用します。2つの使い方はほぼ同じですが、<code>read_csv()</code>は各列のデータ型を自動的に指定してくれるだけではなく、tibble構造として読み込みます。<code>read.csv()</code>を使用する場合、<code>as.tibble(データフレーム名)</code>でデータフレームをtibbleに変換してください。</p>
<div class="sourceCode" id="cb1798"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1798-1"><a href="iteration.html#cb1798-1"></a>Country_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;Data/Countries.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 186 Columns: 18
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (4): Country, Polity_Type, FH_Status, Continent
## dbl (14): Population, Area, GDP, PPP, GDP_per_capita, PPP_per_capita, G7, G2...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div id="iteration-split1" class="section level3" number="26.5.1">
<h3><span class="header-section-number">26.5.1</span> サンプルの分割とモデル推定（<code>split()</code>利用）</h3>
<p>まずは、サンプルを分割し、それぞれの下位サンプルを使った分析を繰り返す方法について解説します。サンプルを分割する方法は2つありますが、最初はR内蔵関数である<code>split()</code>関数を使った方法について紹介します。</p>
<div class="sourceCode" id="cb1800"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1800-1"><a href="iteration.html#cb1800-1"></a><span class="co"># split()の使い方</span></span>
<span id="cb1800-2"><a href="iteration.html#cb1800-2"></a>新しいオブジェクト名 <span class="ot">&lt;-</span> <span class="fu">split</span>(データ名, 分割の基準となるベクトル)</span></code></pre></div>
<p>たとえば、<code>Country_df</code>を大陸ごとにサンプルを分けるとします。大陸を表すベクトルは<code>Country_df$Continent</code>です。したがって、以下のように入力します。</p>
<div class="sourceCode" id="cb1801"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1801-1"><a href="iteration.html#cb1801-1"></a>Split_Data <span class="ot">&lt;-</span> <span class="fu">split</span>(Country_df, Country_df<span class="sc">$</span>Continent)</span></code></pre></div>
<p>サンプルが分割された<code>Split_Data</code>のデータ構造はリスト型です。</p>
<div class="sourceCode" id="cb1802"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1802-1"><a href="iteration.html#cb1802-1"></a><span class="fu">class</span>(Split_Data)</span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<p>中身を見るとリストの各要素としてtibble（データフレーム）が格納されています。リストの中にはあらゆるデータ型、データ構造を入れることができることが分かります。</p>
<div class="sourceCode" id="cb1804"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1804-1"><a href="iteration.html#cb1804-1"></a>Split_Data</span></code></pre></div>
<pre><code>## $Africa
## # A tibble: 54 × 18
##    Country   Population   Area    GDP    PPP GDP_per_capita PPP_per_capita    G7
##    &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt;
##  1 Algeria     43851044 2.38e6 1.70e5 4.97e5          3876.         11324.     0
##  2 Angola      32866272 1.25e6 9.46e4 2.19e5          2879.          6649.     0
##  3 Benin       12123200 1.13e5 1.44e4 3.72e4          1187.          3067.     0
##  4 Botswana     2351627 5.67e5 1.83e4 4.07e4          7799.         17311.     0
##  5 Burkina …   20903273 2.74e5 1.57e4 3.76e4           753.          1800.     0
##  6 Burundi     11890784 2.57e4 3.01e3 8.72e3           253.           733.     0
##  7 Cabo Ver…     555987 4.03e3 1.98e3 3.84e3          3565.          6913.     0
##  8 Cameroon    26545863 4.73e5 3.88e4 9.31e4          1460.          3506.     0
##  9 Central …    4829767 6.23e5 2.22e3 4.46e3           460.           924.     0
## 10 Chad        16425864 1.26e6 1.13e4 2.51e4           689.          1525.     0
## # … with 44 more rows, and 10 more variables: G20 &lt;dbl&gt;, OECD &lt;dbl&gt;,
## #   HDI_2018 &lt;dbl&gt;, Polity_Score &lt;dbl&gt;, Polity_Type &lt;chr&gt;, FH_PR &lt;dbl&gt;,
## #   FH_CL &lt;dbl&gt;, FH_Total &lt;dbl&gt;, FH_Status &lt;chr&gt;, Continent &lt;chr&gt;
## 
## $America
## # A tibble: 36 × 18
##    Country   Population   Area    GDP    PPP GDP_per_capita PPP_per_capita    G7
##    &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt;
##  1 Antigua …      97929 4.4 e2 1.73e3 2.08e3         17643.         21267.     0
##  2 Argentina   45195774 2.74e6 4.50e5 1.04e6          9949.         22938.     0
##  3 Bahamas       393244 1.00e4 1.28e4 1.40e4         32618.         35662.     0
##  4 Barbados      287375 4.3 e2 5.21e3 4.62e3         18126.         16066.     0
##  5 Belize        397628 2.28e4 1.88e3 2.82e3          4727.          7091.     0
##  6 Bolivia     11673021 1.08e6 4.09e4 1.01e5          3503.          8623.     0
##  7 Brazil     212559417 8.36e6 1.84e6 3.13e6          8655.         14734.     0
##  8 Canada      37742154 9.09e6 1.74e6 1.85e6         46008.         49088.     1
##  9 Chile       19116201 7.44e5 2.82e5 4.64e5         14769.         24262.     0
## 10 Colombia    50882891 1.11e6 3.24e5 7.37e5          6364.         14475.     0
## # … with 26 more rows, and 10 more variables: G20 &lt;dbl&gt;, OECD &lt;dbl&gt;,
## #   HDI_2018 &lt;dbl&gt;, Polity_Score &lt;dbl&gt;, Polity_Type &lt;chr&gt;, FH_PR &lt;dbl&gt;,
## #   FH_CL &lt;dbl&gt;, FH_Total &lt;dbl&gt;, FH_Status &lt;chr&gt;, Continent &lt;chr&gt;
## 
## $Asia
## # A tibble: 42 × 18
##    Country   Population   Area    GDP    PPP GDP_per_capita PPP_per_capita    G7
##    &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt;
##  1 Afghanis…   38928346 6.53e5 1.91e4 8.27e4           491.          2125.     0
##  2 Bahrain      1701575 7.6 e2 3.86e4 7.42e4         22670.         43624.     0
##  3 Banglade…  164689383 1.30e5 3.03e5 7.34e5          1837.          4458.     0
##  4 Bhutan        771608 3.81e4 2.45e3 8.77e3          3171.         11363.     0
##  5 Brunei        437479 5.27e3 1.35e4 2.65e4         30789.         60656.     0
##  6 Burma       54409800 6.53e5 7.61e4 2.68e5          1398.          4932.     0
##  7 Cambodia    16718965 1.77e5 2.71e4 6.93e4          1620.          4142.     0
##  8 China     1447470092 9.39e6 1.48e7 2.20e7         10199.         15177.     0
##  9 India     1380004385 2.97e6 2.88e6 9.06e6          2083.          6564.     0
## 10 Indonesia  273523615 1.81e6 1.12e6 3.12e6          4092.         11397.     0
## # … with 32 more rows, and 10 more variables: G20 &lt;dbl&gt;, OECD &lt;dbl&gt;,
## #   HDI_2018 &lt;dbl&gt;, Polity_Score &lt;dbl&gt;, Polity_Type &lt;chr&gt;, FH_PR &lt;dbl&gt;,
## #   FH_CL &lt;dbl&gt;, FH_Total &lt;dbl&gt;, FH_Status &lt;chr&gt;, Continent &lt;chr&gt;
## 
## $Europe
## # A tibble: 50 × 18
##    Country  Population   Area    GDP     PPP GDP_per_capita PPP_per_capita    G7
##    &lt;chr&gt;         &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt;
##  1 Albania     2877797  27400 1.53e4  39658.          5309.         13781.     0
##  2 Andorra       77265    470 3.15e3     NA          40821.            NA      0
##  3 Armenia     2963243  28470 1.37e4  38446.          4614.         12974.     0
##  4 Austria     9006398  82409 4.46e5 502771.         49555.         55824.     0
##  5 Azerbai…   10139177  82658 4.80e4 144556.          4739.         14257.     0
##  6 Belarus     9449323 202910 6.31e4 183461.          6676.         19415.     0
##  7 Belgium    11589623  30280 5.30e5 597433.         45697.         51549.     0
##  8 Bosnia …    3280819  51000 2.00e4  49733.          6111.         15159.     0
##  9 Bulgaria    6948445 108560 6.79e4 156693.          9776.         22551.     0
## 10 Croatia     4105267  55960 6.04e4 114932.         14717.         27996.     0
## # … with 40 more rows, and 10 more variables: G20 &lt;dbl&gt;, OECD &lt;dbl&gt;,
## #   HDI_2018 &lt;dbl&gt;, Polity_Score &lt;dbl&gt;, Polity_Type &lt;chr&gt;, FH_PR &lt;dbl&gt;,
## #   FH_CL &lt;dbl&gt;, FH_Total &lt;dbl&gt;, FH_Status &lt;chr&gt;, Continent &lt;chr&gt;
## 
## $Oceania
## # A tibble: 4 × 18
##   Country    Population   Area    GDP    PPP GDP_per_capita PPP_per_capita    G7
##   &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt;
## 1 Australia    25499884 7.68e6 1.39e6 1.28e6         54615.         50001.     0
## 2 Fiji           896445 1.83e4 5.54e3 1.25e4          6175.         13940.     0
## 3 New Zeala…    4842780 2.64e5 2.07e5 2.04e5         42729.         42178.     0
## 4 Papua New…    8947024 4.53e5 2.50e4 3.73e4          2791.          4171.     0
## # … with 10 more variables: G20 &lt;dbl&gt;, OECD &lt;dbl&gt;, HDI_2018 &lt;dbl&gt;,
## #   Polity_Score &lt;dbl&gt;, Polity_Type &lt;chr&gt;, FH_PR &lt;dbl&gt;, FH_CL &lt;dbl&gt;,
## #   FH_Total &lt;dbl&gt;, FH_Status &lt;chr&gt;, Continent &lt;chr&gt;</code></pre>
<p>それでは分割された各サンプルに対して<code>Polity_Score</code>と<code>FH_Total</code>の相関係数を計算してみましょう。その前に相関分析の方法について調べてみましょう。Rには相関分析の関数が2つ用意されています。単純に相関係数のみを計算するなら<code>cor()</code>、係数の不確実性（標準誤差、信頼区間など）まで計算し、検定を行うなら<code>cor.test()</code>を使用します。ここではより汎用性の高い<code>cor.test()</code>の使い方について紹介します。</p>
<div class="sourceCode" id="cb1806"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1806-1"><a href="iteration.html#cb1806-1"></a><span class="co"># 相関分析: 方法1</span></span>
<span id="cb1806-2"><a href="iteration.html#cb1806-2"></a><span class="fu">cor.test</span>(<span class="sc">~</span> 変数名1 <span class="sc">+</span> 変数名2, <span class="at">data =</span> データ名)</span>
<span id="cb1806-3"><a href="iteration.html#cb1806-3"></a></span>
<span id="cb1806-4"><a href="iteration.html#cb1806-4"></a><span class="co"># 相関分析: 方法2</span></span>
<span id="cb1806-5"><a href="iteration.html#cb1806-5"></a><span class="fu">cor.test</span>(データ名<span class="sc">$</span>変数名1, データ名<span class="sc">$</span>変数名2)</span></code></pre></div>
<p>それでは全サンプルに対して相関分析をしてみましょう。</p>
<div class="sourceCode" id="cb1807"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1807-1"><a href="iteration.html#cb1807-1"></a>Cor_fit1 <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(<span class="sc">~</span> Polity_Score <span class="sc">+</span> FH_Total, <span class="at">data =</span> Country_df)</span>
<span id="cb1807-2"><a href="iteration.html#cb1807-2"></a>Cor_fit1</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  Polity_Score and FH_Total
## t = 19.494, df = 156, p-value &lt; 2.2e-16
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.7896829 0.8821647
## sample estimates:
##       cor 
## 0.8420031</code></pre>
<p>ここから相関係数（0.8420031）のみを抽出するにはどうすれば良いでしょうか。それを確認するためには<code>Cor_fit1</code>というオブジェクトの構造を調べる必要があります。ここではR内蔵関数である<code>str()</code>を使って確認してみましょう。</p>
<div class="sourceCode" id="cb1809"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1809-1"><a href="iteration.html#cb1809-1"></a><span class="fu">str</span>(Cor_fit1)</span></code></pre></div>
<pre><code>## List of 9
##  $ statistic  : Named num 19.5
##   ..- attr(*, &quot;names&quot;)= chr &quot;t&quot;
##  $ parameter  : Named int 156
##   ..- attr(*, &quot;names&quot;)= chr &quot;df&quot;
##  $ p.value    : num 1.16e-43
##  $ estimate   : Named num 0.842
##   ..- attr(*, &quot;names&quot;)= chr &quot;cor&quot;
##  $ null.value : Named num 0
##   ..- attr(*, &quot;names&quot;)= chr &quot;correlation&quot;
##  $ alternative: chr &quot;two.sided&quot;
##  $ method     : chr &quot;Pearson&#39;s product-moment correlation&quot;
##  $ data.name  : chr &quot;Polity_Score and FH_Total&quot;
##  $ conf.int   : num [1:2] 0.79 0.882
##   ..- attr(*, &quot;conf.level&quot;)= num 0.95
##  - attr(*, &quot;class&quot;)= chr &quot;htest&quot;</code></pre>
<p>相関係数は<code>$estimate</code>で抽出できそうですね。実際に<code>Cor_fit1</code>から相関係数のみ抽出してみましょう。</p>
<div class="sourceCode" id="cb1811"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1811-1"><a href="iteration.html#cb1811-1"></a>Cor_fit1<span class="sc">$</span>estimate</span></code></pre></div>
<pre><code>##       cor 
## 0.8420031</code></pre>
<p>それでは<code>map()</code>関数を利用して分割された各サンプルを対象に<code>Polity_Score</code>と<code>FH_Total</code>の相関係数を計算してみましょう。<code>map()</code>のデータは<code>Split_Data</code>とし、関数はラムダ式を書いてみましょう。<code>cor.test()</code>内<code>data</code>引数の実引数は<code>.x</code>、または<code>..1</code>となります。最後に<code>map_dbl("estimate")</code>を利用し、相関係数を抽出、numeric (double) 型ベクトルとして出力します。</p>
<div class="sourceCode" id="cb1813"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1813-1"><a href="iteration.html#cb1813-1"></a>Cor_fit2 <span class="ot">&lt;-</span> Split_Data <span class="sc">%&gt;%</span></span>
<span id="cb1813-2"><a href="iteration.html#cb1813-2"></a>  <span class="fu">map</span>(<span class="sc">~</span><span class="fu">cor.test</span>(<span class="sc">~</span> Polity_Score <span class="sc">+</span> FH_Total, <span class="at">data =</span> .x))</span></code></pre></div>
<div class="sourceCode" id="cb1814"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1814-1"><a href="iteration.html#cb1814-1"></a><span class="co"># Cor_fit2から相関係数のみ出力</span></span>
<span id="cb1814-2"><a href="iteration.html#cb1814-2"></a><span class="fu">map_dbl</span>(Cor_fit2, <span class="st">&quot;estimate&quot;</span>)</span></code></pre></div>
<pre><code>##    Africa   America      Asia    Europe   Oceania 
## 0.7612138 0.8356899 0.8338172 0.8419547 0.9960776</code></pre>
<p>もし、小数点3位までの<em>p</em>値が欲しい場合は以下のように入力します。</p>
<div class="sourceCode" id="cb1816"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1816-1"><a href="iteration.html#cb1816-1"></a><span class="co"># Cor_fit2から相関係数のp値を抽出し、小数点3位に丸める</span></span>
<span id="cb1816-2"><a href="iteration.html#cb1816-2"></a><span class="fu">map_dbl</span>(Cor_fit2, <span class="st">&quot;p.value&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##  Africa America    Asia  Europe Oceania 
##   0.000   0.000   0.000   0.000   0.004</code></pre>
</div>
<div id="iteration-split2" class="section level3" number="26.5.2">
<h3><span class="header-section-number">26.5.2</span> サンプルの分割とモデル推定（<code>nest()</code>利用）</h3>
<p>それではデータフレーム内にデータフレームが格納可能なtibble構造の長所を活かした方法について解説します。ある変数に応じてデータをグループ化する方法については第<a href="datahandling2.html#handling2-group">13.2</a>章で解説しました。{tidyr}パッケージにはグループごとにデータを分割し、分割されたデータを各セルに埋め込む<code>nest()</code>関数を提供しています。具体的な動きを見るために、とりあえず、<code>Country_df</code>を大陸（<code>Continent</code>）ごとに分割し、それぞれがデータが一つのセルに埋め込まれた新しいデータセット、<code>Nested_Data</code>を作ってみましょう。</p>
<div class="sourceCode" id="cb1818"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1818-1"><a href="iteration.html#cb1818-1"></a>Nested_Data <span class="ot">&lt;-</span> Country_df <span class="sc">%&gt;%</span> </span>
<span id="cb1818-2"><a href="iteration.html#cb1818-2"></a>  <span class="fu">group_by</span>(Continent) <span class="sc">%&gt;%</span></span>
<span id="cb1818-3"><a href="iteration.html#cb1818-3"></a>  <span class="fu">nest</span>()</span>
<span id="cb1818-4"><a href="iteration.html#cb1818-4"></a></span>
<span id="cb1818-5"><a href="iteration.html#cb1818-5"></a>Nested_Data</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
## # Groups:   Continent [5]
##   Continent data              
##   &lt;chr&gt;     &lt;list&gt;            
## 1 Asia      &lt;tibble [42 × 17]&gt;
## 2 Europe    &lt;tibble [50 × 17]&gt;
## 3 Africa    &lt;tibble [54 × 17]&gt;
## 4 America   &lt;tibble [36 × 17]&gt;
## 5 Oceania   &lt;tibble [4 × 17]&gt;</code></pre>
<p>ちなみに<code>group_by()</code>と<code>nest()</code>は<code>group_nest()</code>を使って以下のようにまとめることも可能です。</p>
<div class="sourceCode" id="cb1820"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1820-1"><a href="iteration.html#cb1820-1"></a>Nested_Data <span class="ot">&lt;-</span> Country_df <span class="sc">%&gt;%</span> </span>
<span id="cb1820-2"><a href="iteration.html#cb1820-2"></a>  <span class="fu">group_nest</span>(Continent)</span></code></pre></div>
<p>2列目の<code>data</code>変数の各セルにtibbleが埋め込まれたことがわかります。<code>Nested_Data</code>の<code>data</code>列から5つ目の要素（オセアニアのデータ）を確認してみましょう。</p>
<div class="sourceCode" id="cb1821"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1821-1"><a href="iteration.html#cb1821-1"></a><span class="co"># Nested_Data$data[5]の場合、長さ1のリストが出力される</span></span>
<span id="cb1821-2"><a href="iteration.html#cb1821-2"></a><span class="co"># tibble構造で出力する場合は[5]でなく、[[5]]で抽出</span></span>
<span id="cb1821-3"><a href="iteration.html#cb1821-3"></a>Nested_Data<span class="sc">$</span>data[[<span class="dv">5</span>]]</span></code></pre></div>
<pre><code>## # A tibble: 4 × 17
##   Country    Population   Area    GDP    PPP GDP_per_capita PPP_per_capita    G7
##   &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt;
## 1 Australia    25499884 7.68e6 1.39e6 1.28e6         54615.         50001.     0
## 2 Fiji           896445 1.83e4 5.54e3 1.25e4          6175.         13940.     0
## 3 New Zeala…    4842780 2.64e5 2.07e5 2.04e5         42729.         42178.     0
## 4 Papua New…    8947024 4.53e5 2.50e4 3.73e4          2791.          4171.     0
## # … with 9 more variables: G20 &lt;dbl&gt;, OECD &lt;dbl&gt;, HDI_2018 &lt;dbl&gt;,
## #   Polity_Score &lt;dbl&gt;, Polity_Type &lt;chr&gt;, FH_PR &lt;dbl&gt;, FH_CL &lt;dbl&gt;,
## #   FH_Total &lt;dbl&gt;, FH_Status &lt;chr&gt;</code></pre>
<p><code>Continent</code>がOceaniaの行の<code>data</code>列にオセアニアのみのデータが格納されていることが分かります。このようなデータ構造を入れ子型データ（nested data）と呼びます。この入れ子型データは<code>unnest()</code>関数を使って解除することも可能です。<code>unnest()</code>関数を使う際はどの列を解除するかを指定する必要があり、今回は<code>data</code>列となります。</p>
<div class="sourceCode" id="cb1823"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1823-1"><a href="iteration.html#cb1823-1"></a><span class="co"># 入れ子型データの解除</span></span>
<span id="cb1823-2"><a href="iteration.html#cb1823-2"></a>Nested_Data <span class="sc">%&gt;%</span></span>
<span id="cb1823-3"><a href="iteration.html#cb1823-3"></a>  <span class="fu">unnest</span>(data)</span></code></pre></div>
<pre><code>## # A tibble: 186 × 18
## # Groups:   Continent [5]
##    Continent Country     Population    Area       GDP       PPP GDP_per_capita
##    &lt;chr&gt;     &lt;chr&gt;            &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;          &lt;dbl&gt;
##  1 Asia      Afghanistan   38928346  652860    19101.    82737.           491.
##  2 Asia      Bahrain        1701575     760    38574.    74230.         22670.
##  3 Asia      Bangladesh   164689383  130170   302571.   734108.          1837.
##  4 Asia      Bhutan          771608   38117     2447.     8767.          3171.
##  5 Asia      Brunei          437479    5270    13469.    26536.         30789.
##  6 Asia      Burma         54409800  653290    76086.   268327.          1398.
##  7 Asia      Cambodia      16718965  176520    27089.    69253.          1620.
##  8 Asia      China       1447470092 9389291 14762792. 21967628.         10199.
##  9 Asia      India       1380004385 2973190  2875142.  9058692.          2083.
## 10 Asia      Indonesia    273523615 1811570  1119191.  3117334.          4092.
## # … with 176 more rows, and 11 more variables: PPP_per_capita &lt;dbl&gt;, G7 &lt;dbl&gt;,
## #   G20 &lt;dbl&gt;, OECD &lt;dbl&gt;, HDI_2018 &lt;dbl&gt;, Polity_Score &lt;dbl&gt;,
## #   Polity_Type &lt;chr&gt;, FH_PR &lt;dbl&gt;, FH_CL &lt;dbl&gt;, FH_Total &lt;dbl&gt;,
## #   FH_Status &lt;chr&gt;</code></pre>
<p>{dplyr}の<code>group_by()</code>関数と{tidyr}の<code>nest()</code>、<code>unnest()</code>関数を組み合わせることでデータを入れ子型データへ変換したり、解除することができます。以上の流れを図式化したものが以下の図<a href="iteration.html#fig:iteration-split-5">26.2</a>です。</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:iteration-split-5"></span>
<img src="figures/Iteration/nested_data.png" alt="入れ子型データの生成過程" width="100%" />
<p class="caption">
図 26.2: 入れ子型データの生成過程
</p>
</div>
<p>それではこの入れ子型データを使用して大陸ごとの<code>Polity_Score</code>と<code>FH_Total</code>の相関係数を計算してみましょう。<code>data</code>列をデータとした相関係数のラムダ式はどう書けば良いでしょうか。これまでの内容が理解できましたら、答えは難しくないでしょう。<code>cor.test()</code>関数の<code>data</code>引数の実引数として<code>.x</code>を指定するだけです。この結果を<code>Cor_test</code>という列として追加し、<code>Nested_Data2</code>という名のオブジェクトとして保存します。</p>
<div class="sourceCode" id="cb1825"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1825-1"><a href="iteration.html#cb1825-1"></a>Nested_Data2 <span class="ot">&lt;-</span> Nested_Data <span class="sc">%&gt;%</span></span>
<span id="cb1825-2"><a href="iteration.html#cb1825-2"></a>  <span class="fu">mutate</span>(<span class="at">Cor_test =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">cor.test</span>(<span class="sc">~</span> Polity_Score <span class="sc">+</span> FH_Total, <span class="at">data =</span> .x)))</span>
<span id="cb1825-3"><a href="iteration.html#cb1825-3"></a></span>
<span id="cb1825-4"><a href="iteration.html#cb1825-4"></a>Nested_Data2</span></code></pre></div>
<pre><code>## # A tibble: 5 × 3
## # Groups:   Continent [5]
##   Continent data               Cor_test
##   &lt;chr&gt;     &lt;list&gt;             &lt;list&gt;  
## 1 Asia      &lt;tibble [42 × 17]&gt; &lt;htest&gt; 
## 2 Europe    &lt;tibble [50 × 17]&gt; &lt;htest&gt; 
## 3 Africa    &lt;tibble [54 × 17]&gt; &lt;htest&gt; 
## 4 America   &lt;tibble [36 × 17]&gt; &lt;htest&gt; 
## 5 Oceania   &lt;tibble [4 × 17]&gt;  &lt;htest&gt;</code></pre>
<p><code>Cor_test</code>という列が追加され、htestというクラス（S3クラス）オブジェクトが格納されていることが分かります。ちゃんと相関分析のオブジェクトが格納されているか、確認してみましょう。</p>
<div class="sourceCode" id="cb1827"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1827-1"><a href="iteration.html#cb1827-1"></a>Nested_Data2<span class="sc">$</span>Cor_test</span></code></pre></div>
<pre><code>## [[1]]
## 
##  Pearson&#39;s product-moment correlation
## 
## data:  Polity_Score and FH_Total
## t = 9.0626, df = 36, p-value = 8.05e-11
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.7009872 0.9107368
## sample estimates:
##       cor 
## 0.8338172 
## 
## 
## [[2]]
## 
##  Pearson&#39;s product-moment correlation
## 
## data:  Polity_Score and FH_Total
## t = 9.7452, df = 39, p-value = 5.288e-12
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.7210854 0.9130896
## sample estimates:
##       cor 
## 0.8419547 
## 
## 
## [[3]]
## 
##  Pearson&#39;s product-moment correlation
## 
## data:  Polity_Score and FH_Total
## t = 7.9611, df = 46, p-value = 3.375e-10
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.6087424 0.8594586
## sample estimates:
##       cor 
## 0.7612138 
## 
## 
## [[4]]
## 
##  Pearson&#39;s product-moment correlation
## 
## data:  Polity_Score and FH_Total
## t = 7.6082, df = 25, p-value = 5.797e-08
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.6677292 0.9226837
## sample estimates:
##       cor 
## 0.8356899 
## 
## 
## [[5]]
## 
##  Pearson&#39;s product-moment correlation
## 
## data:  Polity_Score and FH_Total
## t = 15.92, df = 2, p-value = 0.003922
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.8197821 0.9999220
## sample estimates:
##       cor 
## 0.9960776</code></pre>
<p>5つの相関分析結果が格納されています。続いて、ここから相関係数のみを抽出してみましょう。相関分析オブジェクトから相関係数を抽出するには<code>オブジェクト名$estimate</code>だけで十分です。<code>mpa_*()</code>関数を使うなら第2引数として関数やラムダ式を指定せず、<code>"estimate"</code>のみ入力するだけです。</p>
<div class="sourceCode" id="cb1829"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1829-1"><a href="iteration.html#cb1829-1"></a>Nested_Data2 <span class="ot">&lt;-</span> Nested_Data2 <span class="sc">%&gt;%</span></span>
<span id="cb1829-2"><a href="iteration.html#cb1829-2"></a>  <span class="fu">mutate</span>(<span class="at">Cor_coef =</span> <span class="fu">map</span>(Cor_test, <span class="st">&quot;estimate&quot;</span>))</span>
<span id="cb1829-3"><a href="iteration.html#cb1829-3"></a></span>
<span id="cb1829-4"><a href="iteration.html#cb1829-4"></a>Nested_Data2</span></code></pre></div>
<pre><code>## # A tibble: 5 × 4
## # Groups:   Continent [5]
##   Continent data               Cor_test Cor_coef 
##   &lt;chr&gt;     &lt;list&gt;             &lt;list&gt;   &lt;list&gt;   
## 1 Asia      &lt;tibble [42 × 17]&gt; &lt;htest&gt;  &lt;dbl [1]&gt;
## 2 Europe    &lt;tibble [50 × 17]&gt; &lt;htest&gt;  &lt;dbl [1]&gt;
## 3 Africa    &lt;tibble [54 × 17]&gt; &lt;htest&gt;  &lt;dbl [1]&gt;
## 4 America   &lt;tibble [36 × 17]&gt; &lt;htest&gt;  &lt;dbl [1]&gt;
## 5 Oceania   &lt;tibble [4 × 17]&gt;  &lt;htest&gt;  &lt;dbl [1]&gt;</code></pre>
<p><code>Cor_coef</code>列が追加され、それぞれのセルにnumeric型の値が格納されていることが分かります。<code>map()</code>関数はリスト型でデータを返すため、このように出力されます。この<code>Cor_coef</code>列の入れ子構造を解除してみましょう。</p>
<div class="sourceCode" id="cb1831"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1831-1"><a href="iteration.html#cb1831-1"></a>Nested_Data2 <span class="sc">%&gt;%</span></span>
<span id="cb1831-2"><a href="iteration.html#cb1831-2"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> Cor_coef)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 4
## # Groups:   Continent [5]
##   Continent data               Cor_test Cor_coef
##   &lt;chr&gt;     &lt;list&gt;             &lt;list&gt;      &lt;dbl&gt;
## 1 Asia      &lt;tibble [42 × 17]&gt; &lt;htest&gt;     0.834
## 2 Europe    &lt;tibble [50 × 17]&gt; &lt;htest&gt;     0.842
## 3 Africa    &lt;tibble [54 × 17]&gt; &lt;htest&gt;     0.761
## 4 America   &lt;tibble [36 × 17]&gt; &lt;htest&gt;     0.836
## 5 Oceania   &lt;tibble [4 × 17]&gt;  &lt;htest&gt;     0.996</code></pre>
<div class="sourceCode" id="cb1833"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1833-1"><a href="iteration.html#cb1833-1"></a>Nested_Data2</span></code></pre></div>
<pre><code>## # A tibble: 5 × 4
## # Groups:   Continent [5]
##   Continent data               Cor_test Cor_coef 
##   &lt;chr&gt;     &lt;list&gt;             &lt;list&gt;   &lt;list&gt;   
## 1 Asia      &lt;tibble [42 × 17]&gt; &lt;htest&gt;  &lt;dbl [1]&gt;
## 2 Europe    &lt;tibble [50 × 17]&gt; &lt;htest&gt;  &lt;dbl [1]&gt;
## 3 Africa    &lt;tibble [54 × 17]&gt; &lt;htest&gt;  &lt;dbl [1]&gt;
## 4 America   &lt;tibble [36 × 17]&gt; &lt;htest&gt;  &lt;dbl [1]&gt;
## 5 Oceania   &lt;tibble [4 × 17]&gt;  &lt;htest&gt;  &lt;dbl [1]&gt;</code></pre>
<p><code>Cor_coef</code>の各列に格納された値が出力されました。以上の作業を一つのコードとしてまとめることも出来ます。また、相関係数の抽出の際に<code>map()</code>でなく、<code>map_dbl()</code>を使えば、numeric型ベクトルが返されるので<code>unnest()</code>も不要となります。</p>
<div class="sourceCode" id="cb1835"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1835-1"><a href="iteration.html#cb1835-1"></a>Country_df <span class="sc">%&gt;%</span></span>
<span id="cb1835-2"><a href="iteration.html#cb1835-2"></a>  <span class="fu">group_by</span>(Continent) <span class="sc">%&gt;%</span></span>
<span id="cb1835-3"><a href="iteration.html#cb1835-3"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1835-4"><a href="iteration.html#cb1835-4"></a>  <span class="fu">mutate</span>(<span class="at">Cor_test =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">cor.test</span>(<span class="sc">~</span> Polity_Score <span class="sc">+</span> FH_Total, <span class="at">data =</span> .x)),</span>
<span id="cb1835-5"><a href="iteration.html#cb1835-5"></a>         <span class="at">Cor_coef =</span> <span class="fu">map_dbl</span>(Cor_test, <span class="st">&quot;estimate&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 4
## # Groups:   Continent [5]
##   Continent data               Cor_test Cor_coef
##   &lt;chr&gt;     &lt;list&gt;             &lt;list&gt;      &lt;dbl&gt;
## 1 Asia      &lt;tibble [42 × 17]&gt; &lt;htest&gt;     0.834
## 2 Europe    &lt;tibble [50 × 17]&gt; &lt;htest&gt;     0.842
## 3 Africa    &lt;tibble [54 × 17]&gt; &lt;htest&gt;     0.761
## 4 America   &lt;tibble [36 × 17]&gt; &lt;htest&gt;     0.836
## 5 Oceania   &lt;tibble [4 × 17]&gt;  &lt;htest&gt;     0.996</code></pre>
<p>たった5行のコードで大陸ごとの相関分析が出来ました。これを<code>map_*()</code>を使わずに処理するなら以下のようなコードとなります<a href="reference.html#fn106" class="footnote-ref" id="fnref106"><sup>106</sup></a>。</p>
<div class="sourceCode" id="cb1837"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1837-1"><a href="iteration.html#cb1837-1"></a>Cor_Test1 <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(<span class="sc">~</span> Polity_Score <span class="sc">+</span> FH_Total, </span>
<span id="cb1837-2"><a href="iteration.html#cb1837-2"></a>                      <span class="at">data =</span> <span class="fu">subset</span>(Country_df, Country_df<span class="sc">$</span>Continent <span class="sc">==</span> <span class="st">&quot;Asia&quot;</span>))</span>
<span id="cb1837-3"><a href="iteration.html#cb1837-3"></a>Cor_Test2 <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(<span class="sc">~</span> Polity_Score <span class="sc">+</span> FH_Total, </span>
<span id="cb1837-4"><a href="iteration.html#cb1837-4"></a>                      <span class="at">data =</span> <span class="fu">subset</span>(Country_df, Country_df<span class="sc">$</span>Continent <span class="sc">==</span> <span class="st">&quot;Europe&quot;</span>))</span>
<span id="cb1837-5"><a href="iteration.html#cb1837-5"></a>Cor_Test3 <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(<span class="sc">~</span> Polity_Score <span class="sc">+</span> FH_Total, </span>
<span id="cb1837-6"><a href="iteration.html#cb1837-6"></a>                      <span class="at">data =</span> <span class="fu">subset</span>(Country_df, Country_df<span class="sc">$</span>Continent <span class="sc">==</span> <span class="st">&quot;Africa&quot;</span>))</span>
<span id="cb1837-7"><a href="iteration.html#cb1837-7"></a>Cor_Test4 <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(<span class="sc">~</span> Polity_Score <span class="sc">+</span> FH_Total, </span>
<span id="cb1837-8"><a href="iteration.html#cb1837-8"></a>                      <span class="at">data =</span> <span class="fu">subset</span>(Country_df, Country_df<span class="sc">$</span>Continent <span class="sc">==</span> <span class="st">&quot;America&quot;</span>))</span>
<span id="cb1837-9"><a href="iteration.html#cb1837-9"></a>Cor_Test5 <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(<span class="sc">~</span> Polity_Score <span class="sc">+</span> FH_Total, </span>
<span id="cb1837-10"><a href="iteration.html#cb1837-10"></a>                      <span class="at">data =</span> <span class="fu">subset</span>(Country_df, Country_df<span class="sc">$</span>Continent <span class="sc">==</span> <span class="st">&quot;Oceania&quot;</span>))</span>
<span id="cb1837-11"><a href="iteration.html#cb1837-11"></a></span>
<span id="cb1837-12"><a href="iteration.html#cb1837-12"></a>Cor_Result <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Asia&quot;</span> <span class="ot">=</span> Cor_Test1<span class="sc">$</span>estimate, <span class="st">&quot;Europe&quot;</span> <span class="ot">=</span> Cor_Test2<span class="sc">$</span>estimate,</span>
<span id="cb1837-13"><a href="iteration.html#cb1837-13"></a>                <span class="st">&quot;Africa&quot;</span> <span class="ot">=</span> Cor_Test3<span class="sc">$</span>estimate, <span class="st">&quot;America&quot;</span> <span class="ot">=</span> Cor_Test4<span class="sc">$</span>estimate,</span>
<span id="cb1837-14"><a href="iteration.html#cb1837-14"></a>                <span class="st">&quot;Oceania&quot;</span> <span class="ot">=</span> Cor_Test5<span class="sc">$</span>estimate)</span>
<span id="cb1837-15"><a href="iteration.html#cb1837-15"></a></span>
<span id="cb1837-16"><a href="iteration.html#cb1837-16"></a><span class="fu">print</span>(Cor_Result)</span></code></pre></div>
<pre><code>##    Asia.cor  Europe.cor  Africa.cor America.cor Oceania.cor 
##   0.8338172   0.8419547   0.7612138   0.8356899   0.9960776</code></pre>
<p>それでは応用例として回帰分析をしてみましょう。今回も<code>Nested_Data</code>を使用し、<code>PPP_per_capita</code>を応答変数に、<code>FH_Total</code>と<code>Population</code>を説明変数とした重回帰分析を行い、政治的自由度（<code>FH_Total</code>）の係数や標準誤差などを抽出してみましょう。まずは、ステップごとにコードを分けて説明し、最後には一つのコードとしてまとめたものをお見せします。</p>
<div class="sourceCode" id="cb1839"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1839-1"><a href="iteration.html#cb1839-1"></a>Nested_Data <span class="sc">%&gt;%</span></span>
<span id="cb1839-2"><a href="iteration.html#cb1839-2"></a>  <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">lm</span>(PPP_per_capita <span class="sc">~</span> FH_Total <span class="sc">+</span> Population, </span>
<span id="cb1839-3"><a href="iteration.html#cb1839-3"></a>                               <span class="at">data =</span> .x)))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 3
## # Groups:   Continent [5]
##   Continent data               Model 
##   &lt;chr&gt;     &lt;list&gt;             &lt;list&gt;
## 1 Asia      &lt;tibble [42 × 17]&gt; &lt;lm&gt;  
## 2 Europe    &lt;tibble [50 × 17]&gt; &lt;lm&gt;  
## 3 Africa    &lt;tibble [54 × 17]&gt; &lt;lm&gt;  
## 4 America   &lt;tibble [36 × 17]&gt; &lt;lm&gt;  
## 5 Oceania   &lt;tibble [4 × 17]&gt;  &lt;lm&gt;</code></pre>
<p><code>Model</code>列からから推定結果の要約を抽出するにはどうすれば良いでしょうか。1つ目の方法は<code>summary(lmオブジェクト名)$coefficients</code>で抽出する方法です。</p>
<div class="sourceCode" id="cb1841"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1841-1"><a href="iteration.html#cb1841-1"></a>lm_fit1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(PPP_per_capita <span class="sc">~</span> FH_Total <span class="sc">+</span> Population, <span class="at">data =</span> Country_df)</span>
<span id="cb1841-2"><a href="iteration.html#cb1841-2"></a></span>
<span id="cb1841-3"><a href="iteration.html#cb1841-3"></a><span class="fu">summary</span>(lm_fit1)<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##                  Estimate   Std. Error    t value     Pr(&gt;|t|)
## (Intercept)  1.929308e+03 3.229792e+03  0.5973473 5.510476e-01
## FH_Total     3.256660e+02 4.871626e+01  6.6849553 2.979474e-10
## Population  -2.217793e-06 9.193256e-06 -0.2412413 8.096505e-01</code></pre>
<p>もっと簡単な方法は{broom}の<code>tidy()</code>関数を使う方法です。<code>tidy()</code>関数は推定値に関する様々な情報をデータフレームとして返す便利な関数です。デフォルトだと95%信頼区間は出力されませんが、<code>conf.int = TRUE</code>を指定すると信頼区間も出力されます。<code>tidy()</code>関数を提供する{broom}パッケージは{tidyverse}の一部ですが、{tidyverse}読み込みの際に一緒に読み込まれるものではないため、予め{broom}パッケージを読み込んでおくか、<code>broom::tidy()</code>で使うことができます。</p>
<div class="sourceCode" id="cb1843"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1843-1"><a href="iteration.html#cb1843-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(lm_fit1, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 7
##   term             estimate     std.error statistic  p.value  conf.low conf.high
##   &lt;chr&gt;               &lt;dbl&gt;         &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept) 1929.         3230.             0.597 5.51e- 1  -4.45e+3   8.30e+3
## 2 FH_Total     326.           48.7            6.68  2.98e-10   2.30e+2   4.22e+2
## 3 Population    -0.00000222    0.00000919    -0.241 8.10e- 1  -2.04e-5   1.59e-5</code></pre>
<p>それでは<code>Model</code>列にあるlmオブジェクトから推定値の情報を抽出し、<code>Model2</code>という列に格納してみましょう。今回はラムダ式を使う必要がありません。なぜなら、<code>tidy()</code>の第一引数がデータだからです（<code>?tidy.lm</code>参照）。他にも必要な引数（<code>conf.int = TRUE</code>など）があれば、<code>map()</code>の第3引数以降で指定します。</p>
<div class="sourceCode" id="cb1845"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1845-1"><a href="iteration.html#cb1845-1"></a>Nested_Data <span class="sc">%&gt;%</span></span>
<span id="cb1845-2"><a href="iteration.html#cb1845-2"></a>  <span class="fu">mutate</span>(<span class="at">Model  =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">lm</span>(PPP_per_capita <span class="sc">~</span> FH_Total <span class="sc">+</span> Population, </span>
<span id="cb1845-3"><a href="iteration.html#cb1845-3"></a>                                <span class="at">data =</span> .x)),</span>
<span id="cb1845-4"><a href="iteration.html#cb1845-4"></a>         <span class="at">Model2 =</span> <span class="fu">map</span>(Model, broom<span class="sc">::</span>tidy, <span class="at">conf.int =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 4
## # Groups:   Continent [5]
##   Continent data               Model  Model2          
##   &lt;chr&gt;     &lt;list&gt;             &lt;list&gt; &lt;list&gt;          
## 1 Asia      &lt;tibble [42 × 17]&gt; &lt;lm&gt;   &lt;tibble [3 × 7]&gt;
## 2 Europe    &lt;tibble [50 × 17]&gt; &lt;lm&gt;   &lt;tibble [3 × 7]&gt;
## 3 Africa    &lt;tibble [54 × 17]&gt; &lt;lm&gt;   &lt;tibble [3 × 7]&gt;
## 4 America   &lt;tibble [36 × 17]&gt; &lt;lm&gt;   &lt;tibble [3 × 7]&gt;
## 5 Oceania   &lt;tibble [4 × 17]&gt;  &lt;lm&gt;   &lt;tibble [3 × 7]&gt;</code></pre>
<p><code>Model2</code>列の各セルに7列のtibbleが格納されているようです。ここからは<code>data</code>と<code>Model</code>列は不要ですので<code>select()</code>関数を使って除去し、<code>Model2</code>の入れ子構造を解除してみます。</p>
<div class="sourceCode" id="cb1847"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1847-1"><a href="iteration.html#cb1847-1"></a>Nested_Data <span class="sc">%&gt;%</span></span>
<span id="cb1847-2"><a href="iteration.html#cb1847-2"></a>  <span class="fu">mutate</span>(<span class="at">Model  =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">lm</span>(PPP_per_capita <span class="sc">~</span> FH_Total <span class="sc">+</span> Population, <span class="at">data =</span> .x)),</span>
<span id="cb1847-3"><a href="iteration.html#cb1847-3"></a>         <span class="at">Model2 =</span> <span class="fu">map</span>(Model, broom<span class="sc">::</span>tidy, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1847-4"><a href="iteration.html#cb1847-4"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(data, Model)) <span class="sc">%&gt;%</span></span>
<span id="cb1847-5"><a href="iteration.html#cb1847-5"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> Model2)</span></code></pre></div>
<pre><code>## # A tibble: 15 × 8
## # Groups:   Continent [5]
##    Continent term        estimate std.error statistic p.value conf.low conf.high
##    &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1 Asia      (Intercept)  2.13e+4   7.38e+3     2.89  6.32e-3  6.39e+3   3.63e+4
##  2 Asia      FH_Total     6.99e+1   1.56e+2     0.449 6.56e-1 -2.45e+2   3.85e+2
##  3 Asia      Population  -1.26e-5   1.26e-5    -1.00  3.23e-1 -3.81e-5   1.29e-5
##  4 Europe    (Intercept) -1.40e+4   9.41e+3    -1.48  1.45e-1 -3.29e+4   5.00e+3
##  5 Europe    FH_Total     6.29e+2   1.08e+2     5.80  7.07e-7  4.10e+2   8.48e+2
##  6 Europe    Population   1.17e-4   8.45e-5     1.39  1.73e-1 -5.33e-5   2.88e-4
##  7 Africa    (Intercept)  3.83e+3   1.84e+3     2.09  4.20e-2  1.44e+2   7.52e+3
##  8 Africa    FH_Total     5.11e+1   3.42e+1     1.49  1.42e-1 -1.77e+1   1.20e+2
##  9 Africa    Population  -1.43e-5   2.31e-5    -0.619 5.39e-1 -6.07e-5   3.21e-5
## 10 America   (Intercept) -7.50e+3   5.93e+3    -1.27  2.15e-1 -1.96e+4   4.57e+3
## 11 America   FH_Total     3.12e+2   7.73e+1     4.03  3.20e-4  1.54e+2   4.69e+2
## 12 America   Population   9.13e-5   2.35e-5     3.89  4.77e-4  4.35e-5   1.39e-4
## 13 Oceania   (Intercept) -5.10e+4   2.34e+4    -2.18  2.73e-1 -3.48e+5   2.46e+5
## 14 Oceania   FH_Total     9.76e+2   3.26e+2     2.99  2.05e-1 -3.17e+3   5.12e+3
## 15 Oceania   Population   1.52e-4   6.27e-4     0.242 8.49e-1 -7.81e-3   8.12e-3</code></pre>
<p>各大陸ごとの回帰分析の推定結果が一つのデータフレームとして展開されました。ここでは<code>FH_Total</code>の推定値のみがほしいので、<code>filter()</code>関数を使用し、<code>term</code>の値が<code>"FH_Total"</code>の行のみを残します。また、<code>term</code>列も必要なくなるので除外しましょう。</p>
<div class="sourceCode" id="cb1849"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1849-1"><a href="iteration.html#cb1849-1"></a>Nested_Data <span class="sc">%&gt;%</span></span>
<span id="cb1849-2"><a href="iteration.html#cb1849-2"></a>  <span class="fu">mutate</span>(<span class="at">Model  =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">lm</span>(PPP_per_capita <span class="sc">~</span> FH_Total <span class="sc">+</span> Population, <span class="at">data =</span> .x)),</span>
<span id="cb1849-3"><a href="iteration.html#cb1849-3"></a>         <span class="at">Model2 =</span> <span class="fu">map</span>(Model, broom<span class="sc">::</span>tidy, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1849-4"><a href="iteration.html#cb1849-4"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(data, Model)) <span class="sc">%&gt;%</span></span>
<span id="cb1849-5"><a href="iteration.html#cb1849-5"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> Model2) <span class="sc">%&gt;%</span></span>
<span id="cb1849-6"><a href="iteration.html#cb1849-6"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&quot;FH_Total&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1849-7"><a href="iteration.html#cb1849-7"></a>  <span class="fu">select</span>(<span class="sc">-</span>term)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 7
## # Groups:   Continent [5]
##   Continent estimate std.error statistic     p.value conf.low conf.high
##   &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 Asia          69.9     156.      0.449 0.656         -245.       385.
## 2 Europe       629.      108.      5.80  0.000000707    410.       848.
## 3 Africa        51.1      34.2     1.49  0.142          -17.7      120.
## 4 America      312.       77.3     4.03  0.000320       154.       469.
## 5 Oceania      976.      326.      2.99  0.205        -3166.      5117.</code></pre>
<p>これで終わりです。政治的自由度と所得水準の関係はアジアとアフリカでは連関の程度が小さく、統計的有意ではありません。オセアニアの場合、連関の程度は大きいと考えられますが、サンプルサイズが小さいため統計的有意な結果は得られませんでした。一方、ヨーロッパとアメリカでは連関の程度も大きく、統計的有意な連関が確認されました。</p>
<p>以上のコードをよりコンパクトにまとめると以下のようなコードとなります。</p>
<div class="sourceCode" id="cb1851"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1851-1"><a href="iteration.html#cb1851-1"></a><span class="co"># {purrr}使用</span></span>
<span id="cb1851-2"><a href="iteration.html#cb1851-2"></a>Nested_Data <span class="sc">%&gt;%</span></span>
<span id="cb1851-3"><a href="iteration.html#cb1851-3"></a>  <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">lm</span>(PPP_per_capita <span class="sc">~</span> FH_Total <span class="sc">+</span> Population, </span>
<span id="cb1851-4"><a href="iteration.html#cb1851-4"></a>                               <span class="at">data =</span> .x)),</span>
<span id="cb1851-5"><a href="iteration.html#cb1851-5"></a>         <span class="at">Model =</span> <span class="fu">map</span>(Model, broom<span class="sc">::</span>tidy, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1851-6"><a href="iteration.html#cb1851-6"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> Model) <span class="sc">%&gt;%</span></span>
<span id="cb1851-7"><a href="iteration.html#cb1851-7"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&quot;FH_Total&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1851-8"><a href="iteration.html#cb1851-8"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(data, term))</span></code></pre></div>
<p>{purrr}パッケージを使用しない例も紹介します。むろん、以下のコードは可能な限り面倒な書き方をしています。<code>for()</code>文や<code>split()</code>と<code>*apply()</code>関数を組み合わせると以下の例よりも簡潔なコードは作成できます。R上級者になるためには{tidyverse}的な書き方だけでなく、ネイティブRの書き方にも慣れる必要があります。ぜひ挑戦してみましょう。</p>
<div class="sourceCode" id="cb1852"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1852-1"><a href="iteration.html#cb1852-1"></a><span class="co"># {purrr}を使用しない場合</span></span>
<span id="cb1852-2"><a href="iteration.html#cb1852-2"></a><span class="co"># FH_Totalの係数と標準誤差のみを抽出する例</span></span>
<span id="cb1852-3"><a href="iteration.html#cb1852-3"></a>lm_fit1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(PPP_per_capita <span class="sc">~</span> FH_Total <span class="sc">+</span> Population, </span>
<span id="cb1852-4"><a href="iteration.html#cb1852-4"></a>              <span class="at">data =</span> <span class="fu">subset</span>(Country_df, Country_df<span class="sc">$</span>Continent <span class="sc">==</span> <span class="st">&quot;Asia&quot;</span>))</span>
<span id="cb1852-5"><a href="iteration.html#cb1852-5"></a>lm_fit2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(PPP_per_capita <span class="sc">~</span> FH_Total <span class="sc">+</span> Population, </span>
<span id="cb1852-6"><a href="iteration.html#cb1852-6"></a>              <span class="at">data =</span> <span class="fu">subset</span>(Country_df, Country_df<span class="sc">$</span>Continent <span class="sc">==</span> <span class="st">&quot;Europe&quot;</span>))</span>
<span id="cb1852-7"><a href="iteration.html#cb1852-7"></a>lm_fit3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(PPP_per_capita <span class="sc">~</span> FH_Total <span class="sc">+</span> Population, </span>
<span id="cb1852-8"><a href="iteration.html#cb1852-8"></a>              <span class="at">data =</span> <span class="fu">subset</span>(Country_df, Country_df<span class="sc">$</span>Continent <span class="sc">==</span> <span class="st">&quot;Africa&quot;</span>))</span>
<span id="cb1852-9"><a href="iteration.html#cb1852-9"></a>lm_fit4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(PPP_per_capita <span class="sc">~</span> FH_Total <span class="sc">+</span> Population, </span>
<span id="cb1852-10"><a href="iteration.html#cb1852-10"></a>              <span class="at">data =</span> <span class="fu">subset</span>(Country_df, Country_df<span class="sc">$</span>Continent <span class="sc">==</span> <span class="st">&quot;America&quot;</span>))</span>
<span id="cb1852-11"><a href="iteration.html#cb1852-11"></a>lm_fit5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(PPP_per_capita <span class="sc">~</span> FH_Total <span class="sc">+</span> Population, </span>
<span id="cb1852-12"><a href="iteration.html#cb1852-12"></a>              <span class="at">data =</span> <span class="fu">subset</span>(Country_df, Country_df<span class="sc">$</span>Continent <span class="sc">==</span> <span class="st">&quot;Oceania&quot;</span>))</span>
<span id="cb1852-13"><a href="iteration.html#cb1852-13"></a></span>
<span id="cb1852-14"><a href="iteration.html#cb1852-14"></a>lm_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Continent =</span> <span class="fu">c</span>(<span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Africa&quot;</span>, <span class="st">&quot;America&quot;</span>, <span class="st">&quot;Oceania&quot;</span>),</span>
<span id="cb1852-15"><a href="iteration.html#cb1852-15"></a>                    <span class="at">estimate  =</span> <span class="fu">c</span>(<span class="fu">summary</span>(lm_fit1)<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>],</span>
<span id="cb1852-16"><a href="iteration.html#cb1852-16"></a>                                  <span class="fu">summary</span>(lm_fit2)<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>],</span>
<span id="cb1852-17"><a href="iteration.html#cb1852-17"></a>                                  <span class="fu">summary</span>(lm_fit3)<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>],</span>
<span id="cb1852-18"><a href="iteration.html#cb1852-18"></a>                                  <span class="fu">summary</span>(lm_fit4)<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>],</span>
<span id="cb1852-19"><a href="iteration.html#cb1852-19"></a>                                  <span class="fu">summary</span>(lm_fit5)<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>]),</span>
<span id="cb1852-20"><a href="iteration.html#cb1852-20"></a>                    <span class="at">se        =</span> <span class="fu">c</span>(<span class="fu">summary</span>(lm_fit1)<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">2</span>],</span>
<span id="cb1852-21"><a href="iteration.html#cb1852-21"></a>                                  <span class="fu">summary</span>(lm_fit2)<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">2</span>],</span>
<span id="cb1852-22"><a href="iteration.html#cb1852-22"></a>                                  <span class="fu">summary</span>(lm_fit3)<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">2</span>],</span>
<span id="cb1852-23"><a href="iteration.html#cb1852-23"></a>                                  <span class="fu">summary</span>(lm_fit4)<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">2</span>],</span>
<span id="cb1852-24"><a href="iteration.html#cb1852-24"></a>                                  <span class="fu">summary</span>(lm_fit5)<span class="sc">$</span>coefficients[<span class="dv">2</span>, <span class="dv">2</span>]))</span></code></pre></div>
</div>
<div id="iteration-range" class="section level3" number="26.5.3">
<h3><span class="header-section-number">26.5.3</span> データの範囲を指定したモデル推定</h3>
<p>これまでの例は名目変数でグループ化を行いましたが、連続変数を使うことも可能です。たとえば、人口1千万未満の国、1千万以上5千万未満、5千万以上1億未満、1億以上でサンプルを分割することです。まず、<code>Country_df</code>から<code>PPP_per_capita</code>、<code>FH_Total</code>、<code>Population</code>列のみを抽出し、<code>Country_df2</code>に格納します。</p>
<div class="sourceCode" id="cb1853"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1853-1"><a href="iteration.html#cb1853-1"></a>Country_df2 <span class="ot">&lt;-</span> Country_df <span class="sc">%&gt;%</span></span>
<span id="cb1853-2"><a href="iteration.html#cb1853-2"></a>  <span class="fu">select</span>(PPP_per_capita, FH_Total, Population)</span></code></pre></div>
<p>続いて、<code>case_when()</code>関数を使用し、<code>Population</code>の値を基準にケースがどの範囲内に属するかを表す変数<code>Group</code>を作成します。</p>
<div class="sourceCode" id="cb1854"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1854-1"><a href="iteration.html#cb1854-1"></a>Country_df2 <span class="ot">&lt;-</span> Country_df2 <span class="sc">%&gt;%</span></span>
<span id="cb1854-2"><a href="iteration.html#cb1854-2"></a>  <span class="fu">mutate</span>(<span class="at">Group =</span> <span class="fu">case_when</span>(Population <span class="sc">&lt;</span>  <span class="dv">10000000</span>  <span class="sc">~</span> <span class="st">&quot;1千万未満&quot;</span>,</span>
<span id="cb1854-3"><a href="iteration.html#cb1854-3"></a>                           Population <span class="sc">&lt;</span>  <span class="dv">50000000</span>  <span class="sc">~</span> <span class="st">&quot;1千万以上5千万未満&quot;</span>,</span>
<span id="cb1854-4"><a href="iteration.html#cb1854-4"></a>                           Population <span class="sc">&lt;</span>  <span class="dv">100000000</span> <span class="sc">~</span> <span class="st">&quot;5千万以上1億未満&quot;</span>,</span>
<span id="cb1854-5"><a href="iteration.html#cb1854-5"></a>                           Population <span class="sc">&gt;=</span> <span class="dv">100000000</span> <span class="sc">~</span> <span class="st">&quot;1億以上&quot;</span>))</span></code></pre></div>
<p>中身を確認してみましょう。</p>
<div class="sourceCode" id="cb1855"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1855-1"><a href="iteration.html#cb1855-1"></a>Country_df2</span></code></pre></div>
<pre><code>## # A tibble: 186 × 4
##    PPP_per_capita FH_Total Population Group             
##             &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;             
##  1          2125.       27   38928346 1千万以上5千万未満
##  2         13781.       67    2877797 1千万未満         
##  3         11324.       34   43851044 1千万以上5千万未満
##  4            NA        94      77265 1千万未満         
##  5          6649.       32   32866272 1千万以上5千万未満
##  6         21267.       85      97929 1千万未満         
##  7         22938.       85   45195774 1千万以上5千万未満
##  8         12974.       53    2963243 1千万未満         
##  9         50001.       97   25499884 1千万以上5千万未満
## 10         55824.       93    9006398 1千万未満         
## # … with 176 more rows</code></pre>
<p>あとはこれまでの例と同じ手順となります。まず、データを<code>Group</code>変数でグループ化し、入れ子構造に変換します。</p>
<div class="sourceCode" id="cb1857"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1857-1"><a href="iteration.html#cb1857-1"></a>Country_df2 <span class="ot">&lt;-</span> Country_df2 <span class="sc">%&gt;%</span></span>
<span id="cb1857-2"><a href="iteration.html#cb1857-2"></a>  <span class="fu">group_nest</span>(Group)</span>
<span id="cb1857-3"><a href="iteration.html#cb1857-3"></a></span>
<span id="cb1857-4"><a href="iteration.html#cb1857-4"></a>Country_df2</span></code></pre></div>
<pre><code>## # A tibble: 4 × 2
##   Group                            data
##   &lt;chr&gt;              &lt;list&lt;tibble[,3]&gt;&gt;
## 1 1億以上                      [14 × 3]
## 2 1千万以上5千万未満           [61 × 3]
## 3 1千万未満                    [96 × 3]
## 4 5千万以上1億未満             [15 × 3]</code></pre>
<p>続いて、<code>data</code>列をデータとし、<code>map()</code>関数でモデルの推定をしてみましょう。目的変数は所得水準、説明変数は政治的自由度とします。推定後、{broom}の<code>tidy()</code>変数で推定値の情報のみを抽出し、入れ子構造を解除します。最後に<code>term</code>がFH_Totalの行のみを残します。</p>
<div class="sourceCode" id="cb1859"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1859-1"><a href="iteration.html#cb1859-1"></a>Country_df2 <span class="ot">&lt;-</span> Country_df2 <span class="sc">%&gt;%</span></span>
<span id="cb1859-2"><a href="iteration.html#cb1859-2"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">lm</span>(PPP_per_capita <span class="sc">~</span> FH_Total, <span class="at">data =</span> .x)),</span>
<span id="cb1859-3"><a href="iteration.html#cb1859-3"></a>         <span class="at">est   =</span> <span class="fu">map</span>(model, broom<span class="sc">::</span>tidy, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1859-4"><a href="iteration.html#cb1859-4"></a>  <span class="fu">unnest</span>(est) <span class="sc">%&gt;%</span></span>
<span id="cb1859-5"><a href="iteration.html#cb1859-5"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&quot;FH_Total&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1859-6"><a href="iteration.html#cb1859-6"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(term, data, model))</span>
<span id="cb1859-7"><a href="iteration.html#cb1859-7"></a></span>
<span id="cb1859-8"><a href="iteration.html#cb1859-8"></a>Country_df2</span></code></pre></div>
<pre><code>## # A tibble: 4 × 7
##   Group              estimate std.error statistic     p.value conf.low conf.high
##   &lt;chr&gt;                 &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 1億以上                325.     158.       2.06     6.23e-2    -19.5      669.
## 2 1千万以上5千万未満     366.      59.6      6.14     9.07e-8    246.       485.
## 3 1千万未満              246.      83.0      2.96     3.94e-3     80.8      411.
## 4 5千万以上1億未満       487.     101.       4.80     3.46e-4    268.       706.</code></pre>
<p>せっかくなので推定結果を可視化してみましょう。横軸は人口規模（<code>Group</code>）とし、縦軸は推定値とします。係数の点推定値と95%信頼区間を同時に出力するために、<code>geom_pointrange()</code>幾何オブジェクトを使用します。</p>
<div class="sourceCode" id="cb1861"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1861-1"><a href="iteration.html#cb1861-1"></a>Country_df2 <span class="sc">%&gt;%</span></span>
<span id="cb1861-2"><a href="iteration.html#cb1861-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1861-3"><a href="iteration.html#cb1861-3"></a>    <span class="co"># 横軸の表示順番を指定するために、Group変数をfactor化する</span></span>
<span id="cb1861-4"><a href="iteration.html#cb1861-4"></a>    <span class="at">Group =</span> <span class="fu">factor</span>(Group, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;1千万未満&quot;</span>, <span class="st">&quot;1千万以上5千万未満&quot;</span>,</span>
<span id="cb1861-5"><a href="iteration.html#cb1861-5"></a>                                     <span class="st">&quot;5千万以上1億未満&quot;</span>, <span class="st">&quot;1億以上&quot;</span>)),</span>
<span id="cb1861-6"><a href="iteration.html#cb1861-6"></a>    <span class="co"># 統計的有意か否かを表すSig変数の作成</span></span>
<span id="cb1861-7"><a href="iteration.html#cb1861-7"></a>    <span class="at">Sig   =</span> <span class="fu">if_else</span>(conf.low <span class="sc">*</span> conf.high <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">&quot;統計的有意&quot;</span>, <span class="st">&quot;統計的非有意&quot;</span>)</span>
<span id="cb1861-8"><a href="iteration.html#cb1861-8"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb1861-9"><a href="iteration.html#cb1861-9"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb1861-10"><a href="iteration.html#cb1861-10"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb1861-11"><a href="iteration.html#cb1861-11"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> Group, <span class="at">y =</span> estimate, </span>
<span id="cb1861-12"><a href="iteration.html#cb1861-12"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high, <span class="at">color =</span> Sig), </span>
<span id="cb1861-13"><a href="iteration.html#cb1861-13"></a>                  <span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb1861-14"><a href="iteration.html#cb1861-14"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;人口&quot;</span>, <span class="at">y =</span> <span class="st">&quot;政治的自由度が所得に与える影響&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb1861-15"><a href="iteration.html#cb1861-15"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;統計的有意&quot;</span> <span class="ot">=</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb1861-16"><a href="iteration.html#cb1861-16"></a>                                <span class="st">&quot;統計的非有意&quot;</span> <span class="ot">=</span> <span class="st">&quot;gray70&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1861-17"><a href="iteration.html#cb1861-17"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code></pre></div>
<p><img src="iteration_files/figure-html/iteration-range-6-1.png" width="2100" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1862"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1862-1"><a href="iteration.html#cb1862-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<pre><code>## List of 1
##  $ legend.position: chr &quot;bottom&quot;
##  - attr(*, &quot;class&quot;)= chr [1:2] &quot;theme&quot; &quot;gg&quot;
##  - attr(*, &quot;complete&quot;)= logi FALSE
##  - attr(*, &quot;validate&quot;)= logi TRUE</code></pre>
<p>政治的自由度が高くなるほど所得水準も高くなる傾向が確認されますが、人口が1億人以上の国においてはそのような傾向が見られないことが分かります。</p>
<p>上記の例は、ある行は一つのグループに属するケースです。しかし、ある行が複数のグループに属するケースもあるでしょう。たとえば、ある変数の値が一定値以上である行のみでグループ化する場合です。<code>FH_Score</code>が一定値以上のSub-sampleに対して回帰分析を行う場合、<code>FH_Score</code>が最大値（100）である国はすべてのSub-sampleに属することになります。この場合は<code>group_by()</code>でグループ化することが難しいかも知れません。しかし、{dplyr}の<code>filter()</code>を使えば簡単に処理することができます。</p>
<p>ここでは人口を説明変数に、所得水準を応答変数とした単回帰分析を行います。データは政治的自由度が一定値以上の国家のみに限定します。<code>FH_Score</code>が0以上の国（すべてのケース）、10以上の国、20以上の国、…などにサンプルを分割してみましょう。まずは<code>FH_Score</code>の最小値のみを格納した<code>Rnage_df</code>を作成します。</p>
<div class="sourceCode" id="cb1864"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1864-1"><a href="iteration.html#cb1864-1"></a>Range_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Min_FH =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">80</span>, <span class="at">by =</span> <span class="dv">10</span>))</span>
<span id="cb1864-2"><a href="iteration.html#cb1864-2"></a></span>
<span id="cb1864-3"><a href="iteration.html#cb1864-3"></a>Range_df</span></code></pre></div>
<pre><code>## # A tibble: 9 × 1
##   Min_FH
##    &lt;dbl&gt;
## 1      0
## 2     10
## 3     20
## 4     30
## 5     40
## 6     50
## 7     60
## 8     70
## 9     80</code></pre>
<p>9行1列のtibbleが出来ました。続いて、<code>Subset</code>という列を生成し、ここにデータを入れてみましょう。ある変数の値を基準にサンプルを絞るには{dplyr}の<code>filter()</code>関数を使用します。たとえば、<code>Counter_df</code>の<code>FH_Total</code>が50以上のケースに絞るには<code>filter(Country_df, FH_Total &gt;= 50)</code>となります。パイプ演算子を使った場合は<code>Country_df %&gt;% filter(FH_Total &gt;= 50)</code>になりますが、ラムダ式とパイプ演算子の相性はあまり良くありませんので、ここではパイプ演算子なしとします。重要なのは<code>Min_FH</code>の値をデータとした<code>map()</code>関数を実行し、実行内容を「<code>Country_df</code>から<code>FH_Total</code>が<code>Min_FH</code>以上のケースのみを抽出せよ」にすることです。</p>
<div class="sourceCode" id="cb1866"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1866-1"><a href="iteration.html#cb1866-1"></a>Range_df <span class="ot">&lt;-</span> Range_df <span class="sc">%&gt;%</span></span>
<span id="cb1866-2"><a href="iteration.html#cb1866-2"></a>  <span class="fu">mutate</span>(<span class="at">Subset =</span> <span class="fu">map</span>(Min_FH, <span class="sc">~</span><span class="fu">filter</span>(Country_df, FH_Total <span class="sc">&gt;=</span> .x)))</span>
<span id="cb1866-3"><a href="iteration.html#cb1866-3"></a></span>
<span id="cb1866-4"><a href="iteration.html#cb1866-4"></a>Range_df</span></code></pre></div>
<pre><code>## # A tibble: 9 × 2
##   Min_FH Subset                  
##    &lt;dbl&gt; &lt;list&gt;                  
## 1      0 &lt;spec_tbl_df [185 × 18]&gt;
## 2     10 &lt;spec_tbl_df [176 × 18]&gt;
## 3     20 &lt;spec_tbl_df [158 × 18]&gt;
## 4     30 &lt;spec_tbl_df [142 × 18]&gt;
## 5     40 &lt;spec_tbl_df [126 × 18]&gt;
## 6     50 &lt;spec_tbl_df [112 × 18]&gt;
## 7     60 &lt;spec_tbl_df [99 × 18]&gt; 
## 8     70 &lt;spec_tbl_df [76 × 18]&gt; 
## 9     80 &lt;spec_tbl_df [61 × 18]&gt;</code></pre>
<p>入れ子構造になっているのは確認できましたが、ちゃんとフィルタリングされているかどうかも確認してみましょう。たとえば、<code>Range_df$Subset[[9]]</code>だと<code>FH_Total</code>が80以上の国に絞られていると考えられます。18列の表ですから<code>Country</code>と<code>FH_Total</code>列のみを確認してみましょう。</p>
<div class="sourceCode" id="cb1868"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1868-1"><a href="iteration.html#cb1868-1"></a>Range_df<span class="sc">$</span>Subset[[<span class="dv">9</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb1868-2"><a href="iteration.html#cb1868-2"></a>  <span class="fu">select</span>(Country, FH_Total)</span></code></pre></div>
<pre><code>## # A tibble: 61 × 2
##    Country             FH_Total
##    &lt;chr&gt;                  &lt;dbl&gt;
##  1 Andorra                   94
##  2 Antigua and Barbuda       85
##  3 Argentina                 85
##  4 Australia                 97
##  5 Austria                   93
##  6 Bahamas                   91
##  7 Barbados                  95
##  8 Belgium                   96
##  9 Belize                    86
## 10 Bulgaria                  80
## # … with 51 more rows</code></pre>
<p>問題なくフィルタリングされているようですね。ここまで出来ればあとはこれまでの内容の復習でしょう。</p>
<div class="sourceCode" id="cb1870"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1870-1"><a href="iteration.html#cb1870-1"></a>Range_df <span class="ot">&lt;-</span> Range_df <span class="sc">%&gt;%</span></span>
<span id="cb1870-2"><a href="iteration.html#cb1870-2"></a>  <span class="fu">mutate</span>(<span class="at">Model  =</span> <span class="fu">map</span>(Subset, <span class="sc">~</span><span class="fu">lm</span>(PPP_per_capita <span class="sc">~</span> Population, <span class="at">data =</span> .x)),</span>
<span id="cb1870-3"><a href="iteration.html#cb1870-3"></a>         <span class="at">Model  =</span> <span class="fu">map</span>(Model,  broom<span class="sc">::</span>tidy, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1870-4"><a href="iteration.html#cb1870-4"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> Model) <span class="sc">%&gt;%</span></span>
<span id="cb1870-5"><a href="iteration.html#cb1870-5"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&quot;Population&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1870-6"><a href="iteration.html#cb1870-6"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Subset, term))</span></code></pre></div>
<p>今回も可視化してみましょう。</p>
<div class="sourceCode" id="cb1871"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1871-1"><a href="iteration.html#cb1871-1"></a>Range_df <span class="sc">%&gt;%</span></span>
<span id="cb1871-2"><a href="iteration.html#cb1871-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1871-3"><a href="iteration.html#cb1871-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb1871-4"><a href="iteration.html#cb1871-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> Min_FH, <span class="at">y =</span> estimate, </span>
<span id="cb1871-5"><a href="iteration.html#cb1871-5"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb1871-6"><a href="iteration.html#cb1871-6"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;データ内FH_Scoreの最小値&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Populationの係数&quot;</span>) <span class="sc">+</span></span>
<span id="cb1871-7"><a href="iteration.html#cb1871-7"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">80</span>, <span class="at">by =</span> <span class="dv">10</span>),</span>
<span id="cb1871-8"><a href="iteration.html#cb1871-8"></a>                     <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">80</span>, <span class="at">by =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb1871-9"><a href="iteration.html#cb1871-9"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code></pre></div>
<p><img src="iteration_files/figure-html/iteration-range-11-1.png" width="2100" style="display: block; margin: auto;" /></p>
<p>以上の例は実際の分析では多く使われる方法ではないかも知れません。しかし、ノンパラメトリック回帰不連続デザイン（Regression Discontinuity Design; RDD）の場合、感度分析を行う際、バンド幅を色々と調整しながら局所処置効果を推定します。RDDの詳細については<a href="https://yukiyanai.github.io/econometrics2/regression-discontinuity.html">矢内の授業資料</a>、および<a href="https://www.jaysong.net/post/kobe2020-qpm1/">SONGの授業資料</a>などに譲りますが、ハンド幅の調整はデータの範囲を少しずつ拡張（縮小）させながら同じ分析を繰り返すことです。以下ではアメリカ上院選挙のデータを例に、方法を紹介します。</p>
<p>使用するデータは{rdrobust}パッケージが提供する<code>rdrobust_RDsenate</code>というデータセットです。{pacman}パッケージの<code>p_load()</code>関数を使ってパッケージのインストールと読み込みを行い、<code>data()</code>関数を使って、データを読み込みます。</p>
<div class="sourceCode" id="cb1872"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1872-1"><a href="iteration.html#cb1872-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(rdrobust)  <span class="co"># {rdrobust}のインストール &amp; 読み込み</span></span>
<span id="cb1872-2"><a href="iteration.html#cb1872-2"></a><span class="fu">data</span>(<span class="st">&quot;rdrobust_RDsenate&quot;</span>) <span class="co"># rdrobust_RDsenateデータの読み込み</span></span>
<span id="cb1872-3"><a href="iteration.html#cb1872-3"></a></span>
<span id="cb1872-4"><a href="iteration.html#cb1872-4"></a><span class="co"># データをSenate_dfという名で格納</span></span>
<span id="cb1872-5"><a href="iteration.html#cb1872-5"></a>Senate_df <span class="ot">&lt;-</span> rdrobust_RDsenate</span></code></pre></div>
<p><code>Senate_df</code>の中身を確認してみます。</p>
<div class="sourceCode" id="cb1873"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1873-1"><a href="iteration.html#cb1873-1"></a><span class="fu">head</span>(Senate_df)</span></code></pre></div>
<pre><code>##        margin     vote
## 1  -7.6885610 36.09757
## 2  -3.9237082 45.46875
## 3  -6.8686604 45.59821
## 4 -27.6680565 48.47606
## 5  -8.2569685 51.74687
## 6   0.7324815 39.80264</code></pre>
<p>本データの詳細は <span class="citation">Cattaneo, Frandsen, and Titiunik (<a href="#ref-Cattaneo_Frandsen_Titiunik:2015" role="doc-biblioref">2015</a>)</span> に譲りますが、ここでは簡単に説明します。<code>margin</code>はある選挙区の民主党候補者の得票率から共和党候補者の投票率を引いたものです。100なら民主党候補者の圧勝、-100なら共和党候補者の圧勝です。これが0に近いと辛勝または惜敗となり、この辺の民主党候補者と共和党候補者は候補者としての資質や資源が近いと考えられます。<code>vote</code>は次回の選挙における民主党候補者の得票率です。ある候補者が現職であることによるアドバンテージを調べる際、「民主党が勝った選挙区における次回選挙での民主党候補者の得票率」から「民主党が負けた選挙区における次回選挙での民主党候補者の得票率」を引くだけでは不十分でしょう。圧勝できた選挙区は次回でも得票率が高いと考えられますが、これは現職というポジションによるアドバンテージ以外にも、候補者がもともと備えている高い能力・資源にも起因するからです。だから辛勝・惜敗の選挙区のみに限定することで、現職と新人の能力・資源などを出来る限り均質にし、「現職」というポジションだけが異なる状況を見つけることになります。</p>
<p>問題は辛勝と惜敗の基準をどう決めるかですが、広く使われている方法としては <span class="citation">Imbens and Kalyanaraman (<a href="#ref-Imbens_Kalyanaraman:2012" role="doc-biblioref">2012</a>)</span> の最適バンド幅（optimal bandwidth）が広く使われます。しかし、最適バンド幅を使うとしても感度分析（sensitivity analysis）を行うケースも多く、この場合、バンド幅を少しずつ変えながら現職の効果を推定することになります。推定式は以下のようになります。<span class="math inline">\(I(\text{margin} &gt; 0)\)</span>は<code>margin</code>が0より大きい場合、1となる指示関数（indicator function）であす。</p>
<p><span class="math display">\[
\hat{\text{vote}} = \beta_0 + \beta_1 \cdot \text{margin} + \tau \cdot I(\text{margin} &gt; 0) \quad \text{where} \quad -h \leq \text{margin} \leq -h
\]</span></p>
<p>それではまずは<span class="math inline">\(h\)</span>が100、つまり全データを使った分析を試しにやってみましょう。</p>
<div class="sourceCode" id="cb1875"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1875-1"><a href="iteration.html#cb1875-1"></a>RDD_Fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(vote <span class="sc">~</span> margin <span class="sc">+</span> <span class="fu">I</span>(margin <span class="sc">&gt;</span> <span class="dv">0</span>), <span class="at">data =</span> Senate_df)</span>
<span id="cb1875-2"><a href="iteration.html#cb1875-2"></a></span>
<span id="cb1875-3"><a href="iteration.html#cb1875-3"></a><span class="fu">summary</span>(RDD_Fit)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = vote ~ margin + I(margin &gt; 0), data = Senate_df)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -46.930  -6.402   0.132   7.191  46.443 
## 
## Coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)       47.33084    0.54192  87.340  &lt; 2e-16
## margin             0.34806    0.01335  26.078  &lt; 2e-16
## I(margin &gt; 0)TRUE  4.78461    0.92290   5.184 2.51e-07
## 
## Residual standard error: 11.78 on 1294 degrees of freedom
##   ( 93 個の観測値が欠損のため削除されました )
## Multiple R-squared:  0.5781, Adjusted R-squared:  0.5774 
## F-statistic: 886.4 on 2 and 1294 DF,  p-value: &lt; 2.2e-16</code></pre>
<p><code>I(margin &gt; 0)TRUE</code>の係数4.785が現職効果です。この作業を<span class="math inline">\(h = 100\)</span>から<span class="math inline">\(h = 10\)</span>まで、5ずつ変えながら分析を繰り返してみます。まずは、<code>RDD_df</code>というtibbleを作成し、<code>BW</code>列には<code>c(100, 95, 90, ... 10)</code>を入れます。続いて、<code>filter()</code>関数を利用して<code>Senate_df</code>から<code>margin</code>が<code>-BW</code>以上、<code>BW</code>以下のデータを抽出し、<code>Subset</code>という名の列として格納します。</p>
<div class="sourceCode" id="cb1877"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1877-1"><a href="iteration.html#cb1877-1"></a>RDD_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">BW =</span> <span class="fu">seq</span>(<span class="dv">100</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="sc">-</span><span class="dv">5</span>))</span>
<span id="cb1877-2"><a href="iteration.html#cb1877-2"></a></span>
<span id="cb1877-3"><a href="iteration.html#cb1877-3"></a>RDD_df <span class="ot">&lt;-</span> RDD_df <span class="sc">%&gt;%</span></span>
<span id="cb1877-4"><a href="iteration.html#cb1877-4"></a>  <span class="fu">mutate</span>(<span class="at">Subset =</span> <span class="fu">map</span>(BW, <span class="sc">~</span><span class="fu">filter</span>(Senate_df, margin <span class="sc">&gt;=</span> <span class="sc">-</span>.x <span class="sc">&amp;</span> margin <span class="sc">&lt;=</span> .x)))</span>
<span id="cb1877-5"><a href="iteration.html#cb1877-5"></a></span>
<span id="cb1877-6"><a href="iteration.html#cb1877-6"></a>RDD_df</span></code></pre></div>
<pre><code>## # A tibble: 19 × 2
##       BW Subset          
##    &lt;dbl&gt; &lt;list&gt;          
##  1   100 &lt;df [1,390 × 2]&gt;
##  2    95 &lt;df [1,327 × 2]&gt;
##  3    90 &lt;df [1,319 × 2]&gt;
##  4    85 &lt;df [1,308 × 2]&gt;
##  5    80 &lt;df [1,303 × 2]&gt;
##  6    75 &lt;df [1,294 × 2]&gt;
##  7    70 &lt;df [1,287 × 2]&gt;
##  8    65 &lt;df [1,270 × 2]&gt;
##  9    60 &lt;df [1,256 × 2]&gt;
## 10    55 &lt;df [1,237 × 2]&gt;
## 11    50 &lt;df [1,211 × 2]&gt;
## 12    45 &lt;df [1,178 × 2]&gt;
## 13    40 &lt;df [1,128 × 2]&gt;
## 14    35 &lt;df [1,077 × 2]&gt;
## 15    30 &lt;df [995 × 2]&gt;  
## 16    25 &lt;df [901 × 2]&gt;  
## 17    20 &lt;df [778 × 2]&gt;  
## 18    15 &lt;df [639 × 2]&gt;  
## 19    10 &lt;df [471 × 2]&gt;</code></pre>
<div class="sourceCode" id="cb1879"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1879-1"><a href="iteration.html#cb1879-1"></a>RDD_df <span class="ot">&lt;-</span> RDD_df <span class="sc">%&gt;%</span></span>
<span id="cb1879-2"><a href="iteration.html#cb1879-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1879-3"><a href="iteration.html#cb1879-3"></a>    <span class="co"># 各Subsetに対し、回帰分析を実施し、Model列に格納</span></span>
<span id="cb1879-4"><a href="iteration.html#cb1879-4"></a>    <span class="at">Model  =</span> <span class="fu">map</span>(Subset, <span class="sc">~</span><span class="fu">lm</span>(vote <span class="sc">~</span> margin <span class="sc">*</span> <span class="fu">I</span>(margin <span class="sc">&gt;</span> <span class="dv">0</span>), <span class="at">data =</span> .x)),</span>
<span id="cb1879-5"><a href="iteration.html#cb1879-5"></a>    <span class="co"># Model列の各セルから{broom}のtidy()で推定値のみ抽出</span></span>
<span id="cb1879-6"><a href="iteration.html#cb1879-6"></a>    <span class="at">Est    =</span> <span class="fu">map</span>(Model, broom<span class="sc">::</span>tidy, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1879-7"><a href="iteration.html#cb1879-7"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb1879-8"><a href="iteration.html#cb1879-8"></a>  <span class="co"># Est列の入れ子構造を解除</span></span>
<span id="cb1879-9"><a href="iteration.html#cb1879-9"></a>  <span class="fu">unnest</span>(Est) <span class="sc">%&gt;%</span> </span>
<span id="cb1879-10"><a href="iteration.html#cb1879-10"></a>  <span class="co"># 現職効果に該当する行のみを抽出</span></span>
<span id="cb1879-11"><a href="iteration.html#cb1879-11"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&quot;I(margin &gt; 0)TRUE&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1879-12"><a href="iteration.html#cb1879-12"></a>  <span class="co"># 不要な列を削除</span></span>
<span id="cb1879-13"><a href="iteration.html#cb1879-13"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(Subset, Model, term, statistic, p.value))</span>
<span id="cb1879-14"><a href="iteration.html#cb1879-14"></a></span>
<span id="cb1879-15"><a href="iteration.html#cb1879-15"></a>RDD_df</span></code></pre></div>
<pre><code>## # A tibble: 19 × 5
##       BW estimate std.error conf.low conf.high
##    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1   100     6.04     0.942     4.20      7.89
##  2    95     5.76     0.975     3.85      7.67
##  3    90     5.90     0.981     3.98      7.83
##  4    85     5.80     0.993     3.85      7.75
##  5    80     5.10     0.999     3.14      7.06
##  6    75     5.18     1.01      3.21      7.15
##  7    70     5.57     1.01      3.58      7.55
##  8    65     5.21     1.03      3.20      7.23
##  9    60     4.89     1.04      2.86      6.93
## 10    55     5.23     1.05      3.17      7.29
## 11    50     5.73     1.07      3.64      7.82
## 12    45     5.94     1.09      3.80      8.09
## 13    40     6.12     1.12      3.92      8.33
## 14    35     6.34     1.15      4.09      8.59
## 15    30     7.18     1.18      4.86      9.50
## 16    25     7.38     1.21      5.00      9.76
## 17    20     7.03     1.32      4.43      9.62
## 18    15     6.96     1.50      4.01      9.92
## 19    10     6.90     1.75      3.46     10.3</code></pre>
<p>19回の回帰分析が数行のコードで簡単に実施でき、必要な情報も素早く抽出することができました。</p>
<p>以上の例は、交互作用なしの線形回帰分析による局所処置効果の推定例です。しかし、ノンパラメトリックRDDでは、割当変数（running variable）処置変数の交差項や割当変数の二乗項を入れる場合が多いです。今回の割当変数は<code>margin</code>です。また、閾値（cutpoint）に近いケースには高い重みを付けることが一般的な作法であり、多く使われるのが三角（triangular）カーネルです。上記の例はすべてのケースに同じ重みを付ける矩形（rectagular）カーネルを使った例です。</p>
<p>以上の理由により、やはりRDDは専用のパッケージを使った方が良いかも知れません。既に読み込んである{rdrobust}も推定可能ですが、ここでは{rdd}パッケージを使ってみましょう。{rdd}パッケージによるRDDは<code>RDestimate()</code>関数を使います。実際の例を確認してみましょう。<code>map()</code>を使う前に、オブジェクトの構造を把握しておくことは重要です。</p>
<div class="sourceCode" id="cb1881"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1881-1"><a href="iteration.html#cb1881-1"></a><span class="co"># cutpoint引数の既定値は0であるため、今回の例では省略可能</span></span>
<span id="cb1881-2"><a href="iteration.html#cb1881-2"></a><span class="fu">RDestimate</span>(応答変数 <span class="sc">~</span> 割当変数, <span class="at">data =</span> データオブジェクト, <span class="at">cutpoint =</span> 閾値, <span class="at">bw =</span> バンド幅)</span></code></pre></div>
<div class="sourceCode" id="cb1882"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1882-1"><a href="iteration.html#cb1882-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(rdd) <span class="co"># パッケージの読み込み</span></span>
<span id="cb1882-2"><a href="iteration.html#cb1882-2"></a></span>
<span id="cb1882-3"><a href="iteration.html#cb1882-3"></a><span class="co"># バンド幅を指定したRDD推定</span></span>
<span id="cb1882-4"><a href="iteration.html#cb1882-4"></a>RDD_Fit <span class="ot">&lt;-</span> <span class="fu">RDestimate</span>(vote <span class="sc">~</span> margin, <span class="at">data =</span> Senate_df, <span class="at">bw =</span> <span class="dv">100</span>)</span>
<span id="cb1882-5"><a href="iteration.html#cb1882-5"></a></span>
<span id="cb1882-6"><a href="iteration.html#cb1882-6"></a><span class="co"># RDDの推定結果を見る</span></span>
<span id="cb1882-7"><a href="iteration.html#cb1882-7"></a><span class="fu">summary</span>(RDD_Fit)</span></code></pre></div>
<pre><code>## 
## Call:
## RDestimate(formula = vote ~ margin, data = Senate_df, bw = 100)
## 
## Type:
## sharp 
## 
## Estimates:
##            Bandwidth  Observations  Estimate  Std. Error  z value  Pr(&gt;|z|) 
## LATE       100        1258          5.637     0.8845      6.374    1.842e-10
## Half-BW     50        1127          6.480     1.0040      6.455    1.084e-10
## Double-BW  200        1297          5.842     0.8568      6.818    9.210e-12
##               
## LATE       ***
## Half-BW    ***
## Double-BW  ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## F-statistics:
##            F      Num. DoF  Denom. DoF  p
## LATE       316.0  3         1254        0
## Half-BW    179.7  3         1123        0
## Double-BW  506.0  3         1293        0</code></pre>
<p>現職効果は5.637、その標準誤差は0.884です。これらの情報はどこから抽出できるか確認してみます。</p>
<div class="sourceCode" id="cb1884"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1884-1"><a href="iteration.html#cb1884-1"></a><span class="co"># 推定値の情報がどこに格納されているかを確認</span></span>
<span id="cb1884-2"><a href="iteration.html#cb1884-2"></a><span class="fu">str</span>(RDD_Fit)</span></code></pre></div>
<pre><code>## List of 12
##  $ type     : chr &quot;sharp&quot;
##  $ call     : language RDestimate(formula = vote ~ margin, data = Senate_df, bw = 100)
##  $ est      : Named num [1:3] 5.64 6.48 5.84
##   ..- attr(*, &quot;names&quot;)= chr [1:3] &quot;LATE&quot; &quot;Half-BW&quot; &quot;Double-BW&quot;
##  $ bw       : num [1:3] 100 50 200
##  $ se       : num [1:3] 0.884 1.004 0.857
##  $ z        : num [1:3] 6.37 6.45 6.82
##  $ p        : num [1:3] 1.84e-10 1.08e-10 9.21e-12
##  $ obs      : num [1:3] 1258 1127 1297
##  $ ci       : num [1:3, 1:2] 3.9 4.51 4.16 7.37 8.45 ...
##  $ model    : list()
##  $ frame    : list()
##  $ na.action: int [1:93] 28 29 57 58 86 113 114 142 143 168 ...
##  - attr(*, &quot;class&quot;)= chr &quot;RD&quot;</code></pre>
<p><code>$est</code>と<code>$se</code>に私たちが探している数値が入っていますね。それぞれ抽出してみると長さ3のnumericベクトルが出力され、その中で1番目の要素がLATEということが分かります。</p>
<div class="sourceCode" id="cb1886"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1886-1"><a href="iteration.html#cb1886-1"></a><span class="co"># est要素の1番目の要素がLATE</span></span>
<span id="cb1886-2"><a href="iteration.html#cb1886-2"></a>RDD_Fit<span class="sc">$</span>est</span></code></pre></div>
<pre><code>##      LATE   Half-BW Double-BW 
##  5.637474  6.480344  5.842049</code></pre>
<div class="sourceCode" id="cb1888"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1888-1"><a href="iteration.html#cb1888-1"></a><span class="co"># se要素の1番目の要素がLATEの標準誤差</span></span>
<span id="cb1888-2"><a href="iteration.html#cb1888-2"></a>RDD_Fit<span class="sc">$</span>se</span></code></pre></div>
<pre><code>## [1] 0.8844541 1.0039734 0.8568150</code></pre>
<p>それでは分析に入ります。今回も<span class="math inline">\(h\)</span>を予め<code>BW</code>という名の列で格納した<code>RDD_df</code>を作成します。</p>
<div class="sourceCode" id="cb1890"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1890-1"><a href="iteration.html#cb1890-1"></a>RDD_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">BW =</span> <span class="fu">seq</span>(<span class="dv">100</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="sc">-</span><span class="dv">5</span>))</span></code></pre></div>
<p>今回はラムダ式を使わず、事前に関数を定義しておきましょう。関数の自作については第<a href="functions.html#functions">11</a>章を参照してください。</p>
<div class="sourceCode" id="cb1891"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1891-1"><a href="iteration.html#cb1891-1"></a><span class="co"># 引数をxとするRDD_Func()の定義</span></span>
<span id="cb1891-2"><a href="iteration.html#cb1891-2"></a>RDD_Func <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb1891-3"><a href="iteration.html#cb1891-3"></a>  <span class="co"># バンド幅をxにしたRDD推定</span></span>
<span id="cb1891-4"><a href="iteration.html#cb1891-4"></a>  Temp_Est <span class="ot">&lt;-</span> <span class="fu">RDestimate</span>(vote <span class="sc">~</span> margin, <span class="at">data =</span> Senate_df, <span class="at">bw =</span> x)</span>
<span id="cb1891-5"><a href="iteration.html#cb1891-5"></a>  <span class="co"># LATEとその標準誤差をtibbleとして返す</span></span>
<span id="cb1891-6"><a href="iteration.html#cb1891-6"></a>  <span class="fu">tibble</span>(<span class="at">LATE =</span> Temp_Est<span class="sc">$</span>est[<span class="dv">1</span>],</span>
<span id="cb1891-7"><a href="iteration.html#cb1891-7"></a>         <span class="at">SE   =</span> Temp_Est<span class="sc">$</span>se[<span class="dv">1</span>])</span>
<span id="cb1891-8"><a href="iteration.html#cb1891-8"></a>}</span></code></pre></div>
<p>問題なく動くかを確認してみましょう。</p>
<div class="sourceCode" id="cb1892"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1892-1"><a href="iteration.html#cb1892-1"></a><span class="fu">RDD_Func</span>(<span class="dv">100</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##    LATE    SE
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  5.64 0.884</code></pre>
<p>それでは分析をやってみましょう。今回の場合、<code>map()</code>の第二引数はラムダ式ではないため<code>~</code>で始める必要ありません。関数名だけで十分です。</p>
<div class="sourceCode" id="cb1894"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1894-1"><a href="iteration.html#cb1894-1"></a>RDD_df <span class="ot">&lt;-</span> RDD_df <span class="sc">%&gt;%</span></span>
<span id="cb1894-2"><a href="iteration.html#cb1894-2"></a>  <span class="fu">mutate</span>(<span class="at">RDD  =</span> <span class="fu">map</span>(BW, RDD_Func)) <span class="sc">%&gt;%</span></span>
<span id="cb1894-3"><a href="iteration.html#cb1894-3"></a>  <span class="fu">unnest</span>(RDD)</span>
<span id="cb1894-4"><a href="iteration.html#cb1894-4"></a></span>
<span id="cb1894-5"><a href="iteration.html#cb1894-5"></a>RDD_df</span></code></pre></div>
<pre><code>## # A tibble: 19 × 3
##       BW  LATE    SE
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1   100  5.64 0.884
##  2    95  5.64 0.890
##  3    90  5.63 0.897
##  4    85  5.61 0.905
##  5    80  5.65 0.913
##  6    75  5.75 0.922
##  7    70  5.81 0.934
##  8    65  5.91 0.949
##  9    60  6.07 0.963
## 10    55  6.29 0.982
## 11    50  6.48 1.00 
## 12    45  6.67 1.03 
## 13    40  6.91 1.07 
## 14    35  7.19 1.11 
## 15    30  7.28 1.17 
## 16    25  7.10 1.26 
## 17    20  7.27 1.38 
## 18    15  7.49 1.57 
## 19    10  7.98 1.84</code></pre>
<p>せっかくなので可視化してみましょう。今回は<code>geom_pointrange()</code>を使わず、<code>geom_line()</code>と<code>geom_ribbon()</code>を組み合わせます。<code>geom_line()</code>はLATEを、<code>geom_ribbion()</code>は95%信頼区間を表します。作図の前に95%信頼区間を計算しておきます。</p>
<div class="sourceCode" id="cb1896"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1896-1"><a href="iteration.html#cb1896-1"></a>RDD_df <span class="sc">%&gt;%</span></span>
<span id="cb1896-2"><a href="iteration.html#cb1896-2"></a>  <span class="fu">mutate</span>(<span class="at">CI_lwr =</span> LATE <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>) <span class="sc">*</span> SE,</span>
<span id="cb1896-3"><a href="iteration.html#cb1896-3"></a>         <span class="at">CI_upr =</span> LATE <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> SE) <span class="sc">%&gt;%</span></span>
<span id="cb1896-4"><a href="iteration.html#cb1896-4"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1896-5"><a href="iteration.html#cb1896-5"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb1896-6"><a href="iteration.html#cb1896-6"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> BW, <span class="at">ymin =</span> CI_lwr, <span class="at">ymax =</span> CI_upr), <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb1896-7"><a href="iteration.html#cb1896-7"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> BW, <span class="at">y =</span> LATE), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1896-8"><a href="iteration.html#cb1896-8"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Bandwidth&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Local Average Treatment Effect (%p)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1896-9"><a href="iteration.html#cb1896-9"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="iteration_files/figure-html/iteration-range-25-1.png" width="2100" style="display: block; margin: auto;" /></p>
</div>
<div id="iteration-variables" class="section level3" number="26.5.4">
<h3><span class="header-section-number">26.5.4</span> 説明・応答変数を指定したモデル推定</h3>
<p>続いて、同じデータに対して推定式のみを変えた反復推定をやってみましょう。たとえば、応答変数は固定し、グループ変数のみを変えながらt検定を繰り返すケースを考えてみましょう。たとえば、OECDに加盟しているかどうか（<code>OECD</code>）で購買力平価GDP（<code>PPP</code>）の差があるかを検定してみましょう。使用する関数は<code>t.test()</code>です。第一引数には<code>応答変数 ~ 説明変数</code>とし、<code>data</code>引数にはデータフレームやtibbleオブジェクトを指定します。</p>
<div class="sourceCode" id="cb1897"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1897-1"><a href="iteration.html#cb1897-1"></a>Diff_test <span class="ot">&lt;-</span> <span class="fu">t.test</span>(PPP <span class="sc">~</span> G20, <span class="at">data =</span> Country_df)</span>
<span id="cb1897-2"><a href="iteration.html#cb1897-2"></a></span>
<span id="cb1897-3"><a href="iteration.html#cb1897-3"></a>Diff_test</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  PPP by G20
## t = -3.4137, df = 18.012, p-value = 0.003094
## alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
## 95 percent confidence interval:
##  -7667830 -1825482
## sample estimates:
## mean in group 0 mean in group 1 
##          211287         4957943</code></pre>
<p>ここからいくつかの情報が読み取れます。まず、OECD加盟国のPPPは4957943、非加盟国は211287です。その差分は-4746656です。また、t値は-3.4136、p値は0.003です。これらの情報を効率よく抽出するには<code>broom::tidy()</code>が便利です。</p>
<div class="sourceCode" id="cb1899"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1899-1"><a href="iteration.html#cb1899-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(Diff_test)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 10
##    estimate estimate1 estimate2 statistic p.value parameter  conf.low conf.high
##       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 -4746656.   211287.  4957943.     -3.41 0.00309      18.0 -7667830. -1825482.
## # … with 2 more variables: method &lt;chr&gt;, alternative &lt;chr&gt;</code></pre>
<p>差分、t値、p値、95%信頼区間などが抽出できます。これをOECDだけでなく、G7やG20に対しても同じ検定を繰り返してみましょう。</p>
<p><code>t.test()</code>の第一引数だけを変えながら推定をすれば良いでしょう。この第一引数、たとえば<code>PPP ~ G20</code>の方はformula型と呼ばれるRにおけるデータ型の一つです。これはcharacter型でないことに注意してください。</p>
<div class="sourceCode" id="cb1901"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1901-1"><a href="iteration.html#cb1901-1"></a>Formula1 <span class="ot">&lt;-</span> <span class="st">&quot;PPP ~ G20&quot;</span></span>
<span id="cb1901-2"><a href="iteration.html#cb1901-2"></a><span class="fu">t.test</span>(Formula1, <span class="at">data =</span> Country_df)</span></code></pre></div>
<pre><code>## Warning in mean.default(x): 引数は数値でも論理値でもありません。NA 値を返します</code></pre>
<pre><code>## Warning in var(x): 強制変換により NA が生成されました</code></pre>
<pre><code>## Error in t.test.default(Formula1, data = Country_df): not enough &#39;x&#39; observations</code></pre>
<p>このようにエラーが出ます。この<code>Formula</code>を<code>as.formula()</code>関数を使ってformula型に変換し、推定をやってみると問題なく推定できることが分かります。</p>
<div class="sourceCode" id="cb1905"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1905-1"><a href="iteration.html#cb1905-1"></a>Formula2 <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(Formula1)</span>
<span id="cb1905-2"><a href="iteration.html#cb1905-2"></a><span class="fu">t.test</span>(Formula2, <span class="at">data =</span> Country_df)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  PPP by G20
## t = -3.4137, df = 18.012, p-value = 0.003094
## alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
## 95 percent confidence interval:
##  -7667830 -1825482
## sample estimates:
## mean in group 0 mean in group 1 
##          211287         4957943</code></pre>
<p>これから私たちがやるのは<code>"PPP ~ "</code>の次に<code>"G7"</code>、<code>"G20"</code>、<code>"OECD"</code>を<code>paste()</code>や<code>paste0()</code>関数を結合し、formula型に変換することです。formula型の列さえ生成できれば、あとは<code>map()</code>関数にformulaを渡し、データは<code>Country_df</code>に固定するだけです。</p>
<p>まずはどの変数を説明変数にするかを<code>Group</code>列として格納した<code>Diff_df</code>を作成します。</p>
<div class="sourceCode" id="cb1907"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1907-1"><a href="iteration.html#cb1907-1"></a>Diff_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Group =</span> <span class="fu">c</span>(<span class="st">&quot;G7&quot;</span>, <span class="st">&quot;G20&quot;</span>, <span class="st">&quot;OECD&quot;</span>))</span>
<span id="cb1907-2"><a href="iteration.html#cb1907-2"></a></span>
<span id="cb1907-3"><a href="iteration.html#cb1907-3"></a>Diff_df</span></code></pre></div>
<pre><code>## # A tibble: 3 × 1
##   Group
##   &lt;chr&gt;
## 1 G7   
## 2 G20  
## 3 OECD</code></pre>
<p>続いて、<code>Formula</code>列を作成し、<code>"PPP ~ "</code>の次に<code>Group</code>列の文字列を結合します。</p>
<div class="sourceCode" id="cb1909"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1909-1"><a href="iteration.html#cb1909-1"></a>Diff_df <span class="ot">&lt;-</span> Diff_df <span class="sc">%&gt;%</span></span>
<span id="cb1909-2"><a href="iteration.html#cb1909-2"></a>  <span class="fu">mutate</span>(<span class="at">Formula =</span> <span class="fu">paste0</span>(<span class="st">&quot;PPP ~ &quot;</span>, Group))</span>
<span id="cb1909-3"><a href="iteration.html#cb1909-3"></a></span>
<span id="cb1909-4"><a href="iteration.html#cb1909-4"></a>Diff_df</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   Group Formula   
##   &lt;chr&gt; &lt;chr&gt;     
## 1 G7    PPP ~ G7  
## 2 G20   PPP ~ G20 
## 3 OECD  PPP ~ OECD</code></pre>
<p>今の<code>Formula</code>列のデータ型を確認してみましょう。</p>
<div class="sourceCode" id="cb1911"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1911-1"><a href="iteration.html#cb1911-1"></a><span class="fu">class</span>(Diff_df<span class="sc">$</span>Formula[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>character型ですね。続いて、<code>map()</code>関数を使用してFormula列をformula型に変換します。</p>
<div class="sourceCode" id="cb1913"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1913-1"><a href="iteration.html#cb1913-1"></a>Diff_df <span class="ot">&lt;-</span> Diff_df <span class="sc">%&gt;%</span></span>
<span id="cb1913-2"><a href="iteration.html#cb1913-2"></a>  <span class="fu">mutate</span>(<span class="at">Formula =</span> <span class="fu">map</span>(Formula, as.formula))</span>
<span id="cb1913-3"><a href="iteration.html#cb1913-3"></a></span>
<span id="cb1913-4"><a href="iteration.html#cb1913-4"></a>Diff_df</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   Group Formula  
##   &lt;chr&gt; &lt;list&gt;   
## 1 G7    &lt;formula&gt;
## 2 G20   &lt;formula&gt;
## 3 OECD  &lt;formula&gt;</code></pre>
<p>データ型も確認してみましょう。</p>
<div class="sourceCode" id="cb1915"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1915-1"><a href="iteration.html#cb1915-1"></a><span class="fu">class</span>(Diff_df<span class="sc">$</span>Formula[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## [1] &quot;formula&quot;</code></pre>
<p>formula型になっていることが分かります。</p>
<p>もう一つの方法としては最初からfromula型の変数を入れても良いでしょう。推定するモデルが多くない場合は、こちらの方が簡単かも知れません。たとえば、これまでの作業を直接formula型を格納する形式で行うなら以下のようになります。</p>
<div class="sourceCode" id="cb1917"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1917-1"><a href="iteration.html#cb1917-1"></a><span class="co"># 方法1</span></span>
<span id="cb1917-2"><a href="iteration.html#cb1917-2"></a>Diff_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Group =</span> <span class="fu">c</span>(<span class="st">&quot;G7&quot;</span>, <span class="st">&quot;G20&quot;</span>, <span class="st">&quot;OECD&quot;</span>),</span>
<span id="cb1917-3"><a href="iteration.html#cb1917-3"></a>                  <span class="at">Formula =</span> <span class="fu">c</span>(PPP <span class="sc">~</span> G7, </span>
<span id="cb1917-4"><a href="iteration.html#cb1917-4"></a>                              PPP <span class="sc">~</span> G20, </span>
<span id="cb1917-5"><a href="iteration.html#cb1917-5"></a>                              PPP <span class="sc">~</span> OECD))</span>
<span id="cb1917-6"><a href="iteration.html#cb1917-6"></a><span class="co"># 方法2</span></span>
<span id="cb1917-7"><a href="iteration.html#cb1917-7"></a>Diff_df <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;G7&quot;</span>   <span class="ot">=</span> PPP <span class="sc">~</span> G7, </span>
<span id="cb1917-8"><a href="iteration.html#cb1917-8"></a>                <span class="st">&quot;G20&quot;</span>  <span class="ot">=</span> PPP <span class="sc">~</span> G20, </span>
<span id="cb1917-9"><a href="iteration.html#cb1917-9"></a>                <span class="st">&quot;OECD&quot;</span> <span class="ot">=</span> PPP <span class="sc">~</span> OECD) <span class="sc">%&gt;%</span> </span>
<span id="cb1917-10"><a href="iteration.html#cb1917-10"></a>  <span class="fu">enframe</span>(<span class="at">name =</span> <span class="st">&quot;Group&quot;</span>, <span class="at">value =</span> <span class="st">&quot;Formula&quot;</span>)</span></code></pre></div>
<p>それでは<em>t</em>検定を行います。ここでもラムダ式を使います。式が入る場所には<code>.x</code>を指定し、データは<code>Country_df</code>に固定します。</p>
<div class="sourceCode" id="cb1918"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1918-1"><a href="iteration.html#cb1918-1"></a>Diff_df <span class="ot">&lt;-</span> Diff_df <span class="sc">%&gt;%</span></span>
<span id="cb1918-2"><a href="iteration.html#cb1918-2"></a>  <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="fu">map</span>(Formula, <span class="sc">~</span><span class="fu">t.test</span>(.x, <span class="at">data =</span> Country_df)))</span>
<span id="cb1918-3"><a href="iteration.html#cb1918-3"></a></span>
<span id="cb1918-4"><a href="iteration.html#cb1918-4"></a>Diff_df</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   Group Formula   Model  
##   &lt;chr&gt; &lt;list&gt;    &lt;list&gt; 
## 1 G7    &lt;formula&gt; &lt;htest&gt;
## 2 G20   &lt;formula&gt; &lt;htest&gt;
## 3 OECD  &lt;formula&gt; &lt;htest&gt;</code></pre>
<p><code>broom::tidy()</code>で推定値の要約を抽出し、入れ子構造を解除します。</p>
<div class="sourceCode" id="cb1920"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1920-1"><a href="iteration.html#cb1920-1"></a>Diff_df <span class="ot">&lt;-</span> Diff_df <span class="sc">%&gt;%</span></span>
<span id="cb1920-2"><a href="iteration.html#cb1920-2"></a>  <span class="fu">mutate</span>(<span class="at">Tidy =</span> <span class="fu">map</span>(Model, broom<span class="sc">::</span>tidy)) <span class="sc">%&gt;%</span></span>
<span id="cb1920-3"><a href="iteration.html#cb1920-3"></a>  <span class="fu">unnest</span>(Tidy)</span>
<span id="cb1920-4"><a href="iteration.html#cb1920-4"></a></span>
<span id="cb1920-5"><a href="iteration.html#cb1920-5"></a>Diff_df</span></code></pre></div>
<pre><code>## # A tibble: 3 × 13
##   Group Formula   Model    estimate estimate1 estimate2 statistic p.value
##   &lt;chr&gt; &lt;list&gt;    &lt;list&gt;      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 G7    &lt;formula&gt; &lt;htest&gt; -5363390.   507033.  5870423.     -2.14 0.0759 
## 2 G20   &lt;formula&gt; &lt;htest&gt; -4746656.   211287.  4957943.     -3.41 0.00309
## 3 OECD  &lt;formula&gt; &lt;htest&gt; -1166591.   475459.  1642050.     -1.96 0.0564 
## # … with 5 more variables: parameter &lt;dbl&gt;, conf.low &lt;dbl&gt;, conf.high &lt;dbl&gt;,
## #   method &lt;chr&gt;, alternative &lt;chr&gt;</code></pre>
<p>いくつか使用しない情報もあるので、適宜列を削除します。</p>
<div class="sourceCode" id="cb1922"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1922-1"><a href="iteration.html#cb1922-1"></a>Diff_df <span class="ot">&lt;-</span> Diff_df <span class="sc">%&gt;%</span></span>
<span id="cb1922-2"><a href="iteration.html#cb1922-2"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Formula, Model, estimate1, estimate2, </span>
<span id="cb1922-3"><a href="iteration.html#cb1922-3"></a>            p.value, method, alternative))</span>
<span id="cb1922-4"><a href="iteration.html#cb1922-4"></a></span>
<span id="cb1922-5"><a href="iteration.html#cb1922-5"></a>Diff_df</span></code></pre></div>
<pre><code>## # A tibble: 3 × 6
##   Group  estimate statistic parameter   conf.low conf.high
##   &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
## 1 G7    -5363390.     -2.14      6.04 -11486296.   759515.
## 2 G20   -4746656.     -3.41     18.0   -7667830. -1825482.
## 3 OECD  -1166591.     -1.96     42.8   -2366187.    33005.</code></pre>
<p>以上のコードをパイプ演算子を使用し、簡潔にまとめると以下のようになります。</p>
<div class="sourceCode" id="cb1924"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1924-1"><a href="iteration.html#cb1924-1"></a>Diff_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Group =</span> <span class="fu">c</span>(<span class="st">&quot;G7&quot;</span>, <span class="st">&quot;G20&quot;</span>, <span class="st">&quot;OECD&quot;</span>))</span>
<span id="cb1924-2"><a href="iteration.html#cb1924-2"></a></span>
<span id="cb1924-3"><a href="iteration.html#cb1924-3"></a>Diff_df <span class="ot">&lt;-</span> Diff_df <span class="sc">%&gt;%</span></span>
<span id="cb1924-4"><a href="iteration.html#cb1924-4"></a>  <span class="fu">mutate</span>(<span class="at">Formula =</span> <span class="fu">paste0</span>(<span class="st">&quot;PPP ~ &quot;</span>, Group),</span>
<span id="cb1924-5"><a href="iteration.html#cb1924-5"></a>         <span class="at">Formula =</span> <span class="fu">map</span>(Formula, as.formula),</span>
<span id="cb1924-6"><a href="iteration.html#cb1924-6"></a>         <span class="at">Model   =</span> <span class="fu">map</span>(Formula, <span class="sc">~</span><span class="fu">t.test</span>(.x, <span class="at">data =</span> Country_df)),</span>
<span id="cb1924-7"><a href="iteration.html#cb1924-7"></a>         <span class="at">Tidy    =</span> <span class="fu">map</span>(Model, broom<span class="sc">::</span>tidy)) <span class="sc">%&gt;%</span></span>
<span id="cb1924-8"><a href="iteration.html#cb1924-8"></a>  <span class="fu">unnest</span>(Tidy) <span class="sc">%&gt;%</span></span>
<span id="cb1924-9"><a href="iteration.html#cb1924-9"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Formula, Model, estimate1, estimate2, </span>
<span id="cb1924-10"><a href="iteration.html#cb1924-10"></a>            p.value, method, alternative))</span></code></pre></div>
<p>推定結果を可視化してみましょう。</p>
<div class="sourceCode" id="cb1925"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1925-1"><a href="iteration.html#cb1925-1"></a>Diff_df <span class="sc">%&gt;%</span></span>
<span id="cb1925-2"><a href="iteration.html#cb1925-2"></a>  <span class="fu">mutate</span>(<span class="at">Group =</span> <span class="fu">fct_inorder</span>(Group),</span>
<span id="cb1925-3"><a href="iteration.html#cb1925-3"></a>         <span class="at">Sig   =</span> <span class="fu">if_else</span>(conf.low <span class="sc">*</span> conf.high <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">&quot;統計的有意&quot;</span>,</span>
<span id="cb1925-4"><a href="iteration.html#cb1925-4"></a>                         <span class="st">&quot;統計的非有意&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1925-5"><a href="iteration.html#cb1925-5"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1925-6"><a href="iteration.html#cb1925-6"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1925-7"><a href="iteration.html#cb1925-7"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high,</span>
<span id="cb1925-8"><a href="iteration.html#cb1925-8"></a>                      <span class="at">y =</span> Group, <span class="at">color =</span> Sig), <span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb1925-9"><a href="iteration.html#cb1925-9"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;統計的有意&quot;</span>   <span class="ot">=</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb1925-10"><a href="iteration.html#cb1925-10"></a>                                <span class="st">&quot;統計的非有意&quot;</span> <span class="ot">=</span> <span class="st">&quot;gray70&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1925-11"><a href="iteration.html#cb1925-11"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;非加盟国のPPP - 加盟国のPPP&quot;</span>, <span class="at">y =</span> <span class="st">&quot;グループ&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb1925-12"><a href="iteration.html#cb1925-12"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code></pre></div>
<p><img src="iteration_files/figure-html/iteration-vars-15-1.png" width="2100" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1926"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1926-1"><a href="iteration.html#cb1926-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<pre><code>## List of 1
##  $ legend.position: chr &quot;bottom&quot;
##  - attr(*, &quot;class&quot;)= chr [1:2] &quot;theme&quot; &quot;gg&quot;
##  - attr(*, &quot;complete&quot;)= logi FALSE
##  - attr(*, &quot;validate&quot;)= logi TRUE</code></pre>
<p>以上の方法を応用すると応答変数を変えながら分析を繰り返すこともできます。他にも説明変数が2つ以上のケースにも応用可能です。</p>

</div>
</div>
</div>
<h3>参考資料</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Cattaneo_Frandsen_Titiunik:2015" class="csl-entry">
Cattaneo, Matias D., Brigham R. Frandsen, and Rocío Titiunik. 2015. <span>“Randomization Inference in the Regression Discontinuity Design: An Application to the Study of Party Advantages in the u.s. Senate.”</span> <em>Journal of Causal Inference</em> 3: 1–24.
</div>
<div id="ref-Imbens_Kalyanaraman:2012" class="csl-entry">
Imbens, Guido, and Karthik Kalyanaraman. 2012. <span>“Optimal Bandwidth Choice for the Regression Discontinuity Estimator.”</span> <em>The Review of Economic Studies</em> 79: 933–59.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="datahandling3.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="oop.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["RN4E.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"toolbar": {
"position": "fixed"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
