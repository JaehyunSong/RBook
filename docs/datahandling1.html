<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.330">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>私たちのR - 13&nbsp; データハンドリング [抽出]</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./datahandling2.html" rel="next">
<link href="./functions.html" rel="prev">
<link href="./Figs/favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "サーチ"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-CEHS4C056W"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-CEHS4C056W', { 'anonymize_ip': false});
</script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&amp;display=swap" rel="stylesheet"> 
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Mono&amp;display=swap" rel="stylesheet"> 


<meta property="og:title" content="私たちのR: ベストプラクティスの探求">
<meta property="og:description" content="R Not for Everyone: An Esoteric Guide">
<meta property="og:image" content="https://www.jaysong.net/RBook/Figs/favicon.png">
<meta property="og:site_name" content="私たちのR">
<meta property="og:image:height" content="260">
<meta property="og:image:width" content="260">
<meta name="twitter:title" content="私たちのR: ベストプラクティスの探求">
<meta name="twitter:description" content="R Not for Everyone: An Esoteric Guide">
<meta name="twitter:image" content="https://www.jaysong.net/RBook/Figs/favicon.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:image-height" content="260">
<meta name="twitter:image-width" content="260">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="サイドバーを切り替える" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./datahandling1.html">データハンドリング</a></li><li class="breadcrumb-item"><a href="./datahandling1.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">データハンドリング [抽出]</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="サイドバーを切り替える" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">私たちのR</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/JaehyunSong/RBook/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="サーチ"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">紹介</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Rの導入</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="セクションを切り替え">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./aboutr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">R?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./installation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Rのインストール</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">IDEの導入</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r_customize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">分析環境のカスタマイズ</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Rパッケージ</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Rの基礎</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="セクションを切り替え">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">プロジェクト管理</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r_basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">基本的な操作</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./io.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">データの入出力</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datatype.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">データ型</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datastructure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">データ構造</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Rプログラミングの基礎</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">関数の自作</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">データハンドリング</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="セクションを切り替え">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datahandling1.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">データハンドリング [抽出]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datahandling2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">データハンドリング [要約]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datahandling3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">データハンドリング [拡張]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./factor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">データハンドリング [factor型]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tidydata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">整然データ構造</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./string.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">文字列の処理</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">可視化</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="セクションを切り替え">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualization1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">可視化 [理論]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualization2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">可視化 [基礎]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualization3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">可視化 [応用]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualization4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">可視化 [発展]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./table.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">表の作成</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">再現可能な研究</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="セクションを切り替え">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rmarkdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">R Markdown [基礎]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rmarkdown2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">R Markdown [応用]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Quarto入門</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./renv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">分析環境の管理</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">中級者向け</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="セクションを切り替え">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iteration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">反復処理</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./oop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">オブジェクト指向プログラミング</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./monte.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">モンテカルロ・シミュレーション</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">スクレイピング</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">付録</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="セクションを切り替え">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dataset.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">データセット</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./filesystem.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ファイルシステム</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tips.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">本書の執筆環境</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">参考文献</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目次</h2>
   
  <ul>
  <li><a href="#sec-handling1-intro" id="toc-sec-handling1-intro" class="nav-link active" data-scroll-target="#sec-handling1-intro"><span class="header-section-number">13.1</span> データハンドリングとtidyverse</a></li>
  <li><a href="#sec-handling1-pipe" id="toc-sec-handling1-pipe" class="nav-link" data-scroll-target="#sec-handling1-pipe"><span class="header-section-number">13.2</span> パイプ演算子 (<code>|&gt;</code>)</a></li>
  <li><a href="#sec-handling1-select" id="toc-sec-handling1-select" class="nav-link" data-scroll-target="#sec-handling1-select"><span class="header-section-number">13.3</span> 列の抽出</a>
  <ul class="collapse">
  <li><a href="#特定の列を抽出する" id="toc-特定の列を抽出する" class="nav-link" data-scroll-target="#特定の列を抽出する"><span class="header-section-number">13.3.1</span> 特定の列を抽出する</a></li>
  <li><a href="#特定の列を抽出し列名を変更する" id="toc-特定の列を抽出し列名を変更する" class="nav-link" data-scroll-target="#特定の列を抽出し列名を変更する"><span class="header-section-number">13.3.2</span> 特定の列を抽出し、列名を変更する</a></li>
  <li><a href="#特定の列を除外する" id="toc-特定の列を除外する" class="nav-link" data-scroll-target="#特定の列を除外する"><span class="header-section-number">13.3.3</span> 特定の列を除外する</a></li>
  <li><a href="#隣接した列を指定する" id="toc-隣接した列を指定する" class="nav-link" data-scroll-target="#隣接した列を指定する"><span class="header-section-number">13.3.4</span> 隣接した列を指定する</a></li>
  <li><a href="#一部の列の順番だけを変える" id="toc-一部の列の順番だけを変える" class="nav-link" data-scroll-target="#一部の列の順番だけを変える"><span class="header-section-number">13.3.5</span> 一部の列の順番だけを変える</a></li>
  <li><a href="#selectの便利な機能" id="toc-selectの便利な機能" class="nav-link" data-scroll-target="#selectの便利な機能"><span class="header-section-number">13.3.6</span> <code>select()</code>の便利な機能</a></li>
  </ul></li>
  <li><a href="#sec-handling1-filter" id="toc-sec-handling1-filter" class="nav-link" data-scroll-target="#sec-handling1-filter"><span class="header-section-number">13.4</span> 行の抽出</a>
  <ul class="collapse">
  <li><a href="#指定した行を抽出する" id="toc-指定した行を抽出する" class="nav-link" data-scroll-target="#指定した行を抽出する"><span class="header-section-number">13.4.1</span> 指定した行を抽出する</a></li>
  <li><a href="#条件に合致する行を抽出する" id="toc-条件に合致する行を抽出する" class="nav-link" data-scroll-target="#条件に合致する行を抽出する"><span class="header-section-number">13.4.2</span> 条件に合致する行を抽出する</a></li>
  </ul></li>
  <li><a href="#sec-handling1-arrange" id="toc-sec-handling1-arrange" class="nav-link" data-scroll-target="#sec-handling1-arrange"><span class="header-section-number">13.5</span> 行のソート</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./datahandling1.html">データハンドリング</a></li><li class="breadcrumb-item"><a href="./datahandling1.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">データハンドリング [抽出]</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-datahandling1" class="quarto-section-identifier"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">データハンドリング [抽出]</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>

<p>　ここでは比較的綺麗に整形されているデータフレームを扱う方法について考えます。ここでいう「比較的綺麗なデータ」とは、すぐに分析に使えるレベルのデータを意味します。したがって、ここではデータ内の値を変更するような作業は行いません。基本的に分析しやすくなるように列の順番を替えたり、特定の列や行のみを抽出したり、データの順番を並び替える作業に注目します。</p>
<p>　本章では以下の3つの内容を中心に解説します。</p>
<ol type="1">
<li>パイプ演算子 (<code>|&gt;</code>)に慣れる</li>
<li>特定の行と列の抽出</li>
<li>データのソート</li>
</ol>
<p>　本章で学習する内容でデータを加工した場合、得られる結果物は元のデータの一部 (subset)となります。データの中身の値を変えたり、新しい列を追加したり、平均値などの記述統計量をまとめたりする方法については次の第<a href="datahandling2.html" class="quarto-xref"><span>14</span></a>章で解説します。</p>
<section id="sec-handling1-intro" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="sec-handling1-intro"><span class="header-section-number">13.1</span> データハンドリングとtidyverse</h2>
<blockquote class="blockquote">
<p>The tidyverse is an opinionated collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures. (Tidyverseホームページから)</p>
</blockquote>
<p>　Tidyverseとはデータサイエンスのために考案された、強い信念と思想に基づいたRパッケージの集合です。Tidyverseに属するパッケージは思想、文法およびデータ構造を共有しています。Tidyverseの中核をなすパッケージは{ggplot2}(第<a href="visualization1.html" class="quarto-xref"><span>19</span></a>、<a href="visualization2.html" class="quarto-xref"><span>20</span></a>、<a href="visualization3.html" class="quarto-xref"><span>21</span></a>、<a href="visualization4.html" class="quarto-xref"><span>22</span></a>章)、{dplyr}(第<a href="#sec-datahandling1" class="quarto-xref"><span>13</span></a>、<a href="datahandling2.html" class="quarto-xref"><span>14</span></a>章)、{tidyr}(第<a href="tidydata.html" class="quarto-xref"><span>17</span></a>章)、{readr}(第<a href="io.html#sec-io-read" class="quarto-xref"><span>8.1</span></a>章)、{purrr} (第<a href="iteration.html" class="quarto-xref"><span>28</span></a>章)、{tibble}(第<a href="datastructure.html#sec-datastructure-dataframe" class="quarto-xref"><span>10.4</span></a>章)、{stringr} (第<a href="string.html" class="quarto-xref"><span>18</span></a>章)、{forcats} (第<a href="factor.html" class="quarto-xref"><span>16</span></a>章)などがあり、このパッケージを支える数十のパッケージが含まれています。これらのパッケージは個別に読み込む必要はなく、{tidyverse}パッケージを読み込むだけで十分です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　Rにおけるデータハンドリング (データ操作)の標準が{dplyr}と{tidyr}中心となり、文字列の処理は{stringr}、factor型の操作は{forcats}、大量のモデルを自動的に分析し、結果を処理するためには{tibble}と{purrr}、可視化は{ggplot2}が主に使われています。これらのパッケージ間、あるいはパッケージ内におけるオブジェクトのやり取りは全てパイプ演算子を通じて行われています。また、これらのパッケージは整然データ (tidydata)を想定するか、整然データの作成するに特化しています。</p>
<p>　Tidyverseの思想に基づいた「tidyverse流のコーディング」は現在のRそのものと言っても過言ではありません。ただし、tidyverseじゃないと出来ないデータハンドリング、可視化などはありません。tidyverseはデータサイエンスの思想に近いものであり、「異なる思想を持っているからこのような分析はできない」といったものはありません。tidyverseという概念が提唱される前にもRは存在し、tidyverse無き世界で今と同じことをやってきました。ただし、tidyverse流で書かれたRコードは可読性が優れ、コードを書く手間も短くなります。tidyverseの考え方がRのける「標準語」として定着しつつあるのは否めない事実であり、学習する誘引としては十分すぎるでしょう。</p>
</section>
<section id="sec-handling1-pipe" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="sec-handling1-pipe"><span class="header-section-number">13.2</span> パイプ演算子 (<code>|&gt;</code>)</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
旧パイプ演算子<code>%&gt;%</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>　R4.1が公開されるまでのパイプ演算子は以下で紹介する<code>|&gt;</code>でなく、{magrittr}パッケージが提供する<code>%&gt;%</code>であった。現時点においてインターネット上の記事、書籍での主流は<code>%&gt;%</code>であるが、最近の流れはR内蔵（native）パイプ演算子の<code>|&gt;</code>である。しかし、使い方はほぼ同じであるため、<code>|&gt;</code>の箇所を<code>%&gt;%</code>に置換しても問題ない。ただし、位置指定子（placeholder）の記号が<code>|&gt;</code>では<code>_</code>、<code>%&gt;%</code>では<code>.</code>であることには注意されたい。</p>
</div>
</div>
<p>　{dplyr}パッケージを利用する前にパイプ演算子について説明します。パイプ演算子は{dplyr}に含まれている演算子ではなく、{magrittr}という別のパッケージから提供される演算子ですが、{tidyverse}パッケージを読み込むと自動的に読み込まれます。パイプ演算子は<code>x |&gt; y()</code>のような書き方となりますが、これは「<code>x</code>を<code>y()</code>の第一引数として渡す」ことを意味します。<code>x</code>の部分はベクトルやデータフレームのようなオブジェクトでも、関数でも構いません。なぜなら、関数から得られた結果もまたベクトルやデータフレームといったものになるからです。つまり、<code>x() |&gt; y()</code>という使い方も可能です。そして、パイプは無限に繋ぐこともできます。「データ<code>df</code>を関数<code>x()</code>で処理をし、その結果をまた関数<code>y()</code>で処理する」ことは、パイプを使うと<code>df |&gt; x() |&gt; y()</code>のような書き方となります。</p>
<p>　たとえば、「<code>paste(3, "+", 5, "=", 8)</code>を実行し、その結果を<code>rep()</code>関数を使って3回複製し、それを<code>print()</code>を使って出力する」コードを考えてみましょう。方法としては2つ考えられます。まずは、それぞれの処理を別途のオブジェクトに格納する方法です。そして二つ目は関数の中に関数を使う方法です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># 方法1: 一関数一オブジェクト</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>Result1 <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="dv">3</span>, <span class="st">"+"</span>, <span class="dv">5</span>, <span class="st">"="</span>, <span class="dv">8</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a>Result2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(Result1, <span class="dv">3</span>)</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="fu">print</span>(Result2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "3 + 5 = 8" "3 + 5 = 8" "3 + 5 = 8"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># 方法2: 関数の中に関数の中に関数</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="fu">print</span>(<span class="fu">rep</span>(<span class="fu">paste</span>(<span class="dv">3</span>, <span class="st">"+"</span>, <span class="dv">5</span>, <span class="st">"="</span>, <span class="dv">8</span>), <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "3 + 5 = 8" "3 + 5 = 8" "3 + 5 = 8"</code></pre>
</div>
</div>
<p>　どれも結果は同じです。コードを書く手間を考えれば、後者の方が楽かも知れませんが、可読性があまりよくありません。一方、前者は可読性は良いものの、コードも長くなり、オブジェクトを2つも作ってしまうのでメモリの無駄遣いになります。</p>
<p>　コードの可読性と書く手間、両方を満足する書き方がパイプ演算子<code>|&gt;</code>です。まずは、例から見ましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># パイプを使う場合</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="fu">paste</span>(<span class="dv">3</span>, <span class="st">"+"</span>, <span class="dv">5</span>, <span class="st">"="</span>, <span class="dv">8</span>) <span class="sc">|&gt;</span> <span class="fu">rep</span>(<span class="dv">3</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "3 + 5 = 8" "3 + 5 = 8" "3 + 5 = 8"</code></pre>
</div>
</div>
<p>　まず、結果は先ほどと同じです。それではコードの説明をしましょう。まずは、<code>paste(3, "+", 5, "=", 8)</code>を実行します。そしてその結果をそのまま<code>rep()</code>関数の第一引数として渡されます。つまり、<code>rep(paste(3, "+", 5, "=", 8), 3)</code>になるわけです。ここでは<code>rep(3)</code>と書きましたが、第一引数が渡されたため、<code>3</code>は第二引数扱いになります (パイプ演算子前のオブジェクトを第二、三引数として渡す方法は適宜説明します。)。そして、これをまた<code>print()</code>関数に渡します。結果としては<code>print(rep(paste(3, "+", 5, "=", 8), 3))</code>となります。</p>
<p>　関数を重ねると読む順番は「カッコの内側から外側へ」になりますが、パイプ演算子を使うと「左 (上)から右 (下)へ」といったより自然な読み方が可能になります。また、以下のコードのように、パイプ演算子後に改行を行うことでより読みやすいコードになります。これからはパイプ演算子の後は必ず改行をします。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># 改行 (+字下げ)したらもっと読みやすくなる</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">paste</span>(<span class="dv">3</span>, <span class="st">"+"</span>, <span class="dv">5</span>, <span class="st">"="</span>, <span class="dv">8</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3"></a>    <span class="fu">rep</span>(<span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-4"><a href="#cb8-4"></a>    <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　これらの話をまとめてみましょう。あるデータを関数1に渡し、その結果を関数2に渡し、その結果を関数3に渡したものを最終結果として格納するとします。まず、パイプ演算子を使わない方法としては2つが考えられます。1つ目の方法は各処理の結果を、別途のオブジェクトとして格納する方法であり、コードで示すと以下のようになります。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>結果1 <span class="ot">&lt;-</span> 関数1(データ)</span>
<span id="cb9-2"><a href="#cb9-2"></a>結果2 <span class="ot">&lt;-</span> 関数2(結果1)</span>
<span id="cb9-3"><a href="#cb9-3"></a>結果  <span class="ot">&lt;-</span> 関数3(結果2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　これを可視化したものが <a href="#fig-handling1_pipe1" class="quarto-xref">図&nbsp;<span>13.1</span></a> です。一回の処理ごとに結果を保存し、それをまた次の処理時においてデータとして使うイメージです。</p>
<div id="fig-handling1_pipe1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Figs/Handling1/Pipeline1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">図&nbsp;13.1: パイプ演算子を使わない場合（1）</figcaption>
</figure>
</div>
<p>　こちらはコードの読みやすさはある程度確保されますが、コードが比較的長くなり、最終的には使わない<code>結果1</code>と<code>結果2</code>がメモリに残るといった短所があります<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>。</p>
<p>　次の方法は、関数から得られた結果を、そのまま別の関数の引数として渡す方法であり、コードで示すと以下のようになります。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>結果 <span class="ot">&lt;-</span> 関数3(関数2(関数1(データ)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　これを可視化したものが <a href="#fig-handling1_pipe2" class="quarto-xref">図&nbsp;<span>13.2</span></a> です。</p>
<div id="fig-handling1_pipe2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Figs/Handling1/Pipeline2.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">図&nbsp;13.2: パイプ演算子を使わない場合（2）</figcaption>
</figure>
</div>
<p>　こちらはメモリの無駄遣いもなく、コードも短くなりましたが、既に指摘したとおり、コードの可読性が低くなります（書き方と読み方が逆になる）。パイプ演算子を使うということは、コードの短くし、メモリを効率的に使い、可読性を高めるとこととなります。先ほどのコードをパイプ演算子を使って整理すると以下のようになります。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>結果 <span class="ot">&lt;-</span> データ <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2"></a>  関数1() <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a href="#cb11-3"></a>  関数2() <span class="sc">|&gt;</span> </span>
<span id="cb11-4"><a href="#cb11-4"></a>  関数3()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　このコードを可視化したものが <a href="#fig-handling1_pipe3" class="quarto-xref">図&nbsp;<span>13.3</span></a> です。</p>
<div id="fig-handling1_pipe3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Figs/Handling1/Pipeline3.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">図&nbsp;13.3: パイプ演算子を使う場合</figcaption>
</figure>
</div>
<p>　処理後の結果を保存せず、すぐに次のプロセスに渡すことで、メモリ（ <a href="#fig-handling1_pipe1" class="quarto-xref">図&nbsp;<span>13.1</span></a> のボウル）無駄を減らすことができます。またコードの書き方と読み方が一致します（格納の部分だけ逆）。パイプ演算子はたしかに便利で、「今どき」のRの書き方を象徴するようなものですが、一つの結果を出すまであまりにも多くのパイプ演算子を使うことはあ望ましくありません。</p>
<p>　データハンドリングもこれと同様に、様々な作業を順に沿って行う必要があります。例えば、「（1）列を選択して、（2）欠損値を含む列を除去して、（3）ある変数の値を100倍にして、（4）ある変数の値がが小さい行から大きい順へ並び替える」といった手順です。これらの作業はパイプ演算子を使えば、スムーズに行うことが可能です。</p>
</section>
<section id="sec-handling1-select" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="sec-handling1-select"><span class="header-section-number">13.3</span> 列の抽出</h2>
<p>　それでは今回の実習用データを読み込みましょう。<a href="Data/Ramen.csv">Ramen.csv</a>には「<a href="https://www.gnavi.co.jp">ぐるなび</a>」から取得したラーメン屋6292店舗の情報が入っています。具体的には東京、神奈川、千葉、埼玉、大阪、京都、兵庫、奈良、和歌山それぞれ都府県にあるラーメン屋の中から最大1000店舗の情報を抽出したものです。東京都は、ぐるなびに登録したラーメン屋が3000店舗以上ですが、1000店舗の基準はぐるなびの「おすすめ」の順で上位1000店舗となります。また、店側またはぐるなびが登録したカテゴリを基準に抽出したため、実際はラーメン屋ではないにもかかわらずラーメン屋としてデータ内に含まれている可能性があります。</p>
<p>　まず、このデータを読み込み、<code>df</code>という名付けます。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Ramen.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　データの中身を確認してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,292 × 14
   ID     Name  Pref  Zipcode Latitude Longitude Line  Station  Walk   Bus   Car
   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 e5396… 居酒… 東京… 1040031     35.7      140. 地下… 銀座一…     3    NA    NA
 2 gfeb6… 本格… 東京… 1100005     35.7      140. 地下… 仲御徒…     1    NA    NA
 3 ggt59… 食べ… 東京… 1250041     35.8      140. ＪＲ… 金町駅      2    NA    NA
 4 g1813… 博多… 東京… 1920904     35.7      139. ＪＲ  八王子…     1    NA    NA
 5 ggww1… まさ… 東京… 1500042     35.7      140. 地下… 渋谷駅      7    NA    NA
 6 gdzk5… 完全… 東京… 1000013     35.7      140. 地下… 虎ノ門…     3    NA    NA
 7 ga2g2… 鶏そ… 東京… 1760006     35.7      140. 西武… 江古田…     2    NA    NA
 8 gg9m1… 宴会… 東京… 1010021     35.7      140. ＪＲ  秋葉原…     4    NA    NA
 9 gdvk2… 中国… 東京… 1000006     35.7      140. ＪＲ  有楽町…     1    NA    NA
10 gggb2… 中国… 東京… 1140002     35.8      140. 地下… 王子駅      2    NA    NA
# ℹ 6,282 more rows
# ℹ 3 more variables: Budget &lt;dbl&gt;, ScoreN &lt;dbl&gt;, Score &lt;dbl&gt;</code></pre>
</div>
</div>
<p>　1行目の<code># A tibble: 2,000 x 12</code>から、ケース数 (店舗数)は2000、変数は12個あることが分かります。各変数の詳細は <a href="#tbl-handling1_dataset" class="quarto-xref">表&nbsp;<span>13.1</span></a> の通りです。</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="tbl-handling1_dataset" class="anchored">
<div id="lntzqfntzi" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#lntzqfntzi table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#lntzqfntzi thead, #lntzqfntzi tbody, #lntzqfntzi tfoot, #lntzqfntzi tr, #lntzqfntzi td, #lntzqfntzi th {
  border-style: none;
}

#lntzqfntzi p {
  margin: 0;
  padding: 0;
}

#lntzqfntzi .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lntzqfntzi .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#lntzqfntzi .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lntzqfntzi .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lntzqfntzi .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lntzqfntzi .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lntzqfntzi .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lntzqfntzi .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lntzqfntzi .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lntzqfntzi .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lntzqfntzi .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lntzqfntzi .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lntzqfntzi .gt_spanner_row {
  border-bottom-style: hidden;
}

#lntzqfntzi .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#lntzqfntzi .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lntzqfntzi .gt_from_md > :first-child {
  margin-top: 0;
}

#lntzqfntzi .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lntzqfntzi .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lntzqfntzi .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#lntzqfntzi .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#lntzqfntzi .gt_row_group_first td {
  border-top-width: 2px;
}

#lntzqfntzi .gt_row_group_first th {
  border-top-width: 2px;
}

#lntzqfntzi .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lntzqfntzi .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#lntzqfntzi .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#lntzqfntzi .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lntzqfntzi .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lntzqfntzi .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lntzqfntzi .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#lntzqfntzi .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lntzqfntzi .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lntzqfntzi .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lntzqfntzi .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lntzqfntzi .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lntzqfntzi .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lntzqfntzi .gt_left {
  text-align: left;
}

#lntzqfntzi .gt_center {
  text-align: center;
}

#lntzqfntzi .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lntzqfntzi .gt_font_normal {
  font-weight: normal;
}

#lntzqfntzi .gt_font_bold {
  font-weight: bold;
}

#lntzqfntzi .gt_font_italic {
  font-style: italic;
}

#lntzqfntzi .gt_super {
  font-size: 65%;
}

#lntzqfntzi .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#lntzqfntzi .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#lntzqfntzi .gt_indent_1 {
  text-indent: 5px;
}

#lntzqfntzi .gt_indent_2 {
  text-indent: 10px;
}

#lntzqfntzi .gt_indent_3 {
  text-indent: 15px;
}

#lntzqfntzi .gt_indent_4 {
  text-indent: 20px;
}

#lntzqfntzi .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false"><caption>表&nbsp;13.1:  <p><code>Ramen.csv</code>の詳細</p> </caption>
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="変数名">変数名</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="説明">説明</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="変数名" class="gt_row gt_left"><div class="gt_from_md"><p><code>ID</code></p>
</div></td>
<td headers="説明" class="gt_row gt_left">店舗ID</td></tr>
    <tr><td headers="変数名" class="gt_row gt_left"><div class="gt_from_md"><p><code>Name</code></p>
</div></td>
<td headers="説明" class="gt_row gt_left">店舗名</td></tr>
    <tr><td headers="変数名" class="gt_row gt_left"><div class="gt_from_md"><p><code>Pref</code></p>
</div></td>
<td headers="説明" class="gt_row gt_left">店舗の所在地 (都府県)</td></tr>
    <tr><td headers="変数名" class="gt_row gt_left"><div class="gt_from_md"><p><code>Zipcode</code></p>
</div></td>
<td headers="説明" class="gt_row gt_left">店舗の郵便番号</td></tr>
    <tr><td headers="変数名" class="gt_row gt_left"><div class="gt_from_md"><p><code>Latitude</code></p>
</div></td>
<td headers="説明" class="gt_row gt_left">緯度</td></tr>
    <tr><td headers="変数名" class="gt_row gt_left"><div class="gt_from_md"><p><code>Longitude</code></p>
</div></td>
<td headers="説明" class="gt_row gt_left">経度</td></tr>
    <tr><td headers="変数名" class="gt_row gt_left"><div class="gt_from_md"><p><code>Line</code></p>
</div></td>
<td headers="説明" class="gt_row gt_left">最寄りの駅の路線</td></tr>
    <tr><td headers="変数名" class="gt_row gt_left"><div class="gt_from_md"><p><code>Station</code></p>
</div></td>
<td headers="説明" class="gt_row gt_left">最寄りの駅</td></tr>
    <tr><td headers="変数名" class="gt_row gt_left"><div class="gt_from_md"><p><code>Walk</code></p>
</div></td>
<td headers="説明" class="gt_row gt_left">最寄りの駅からの距離 (徒歩; 分)</td></tr>
    <tr><td headers="変数名" class="gt_row gt_left"><div class="gt_from_md"><p><code>Bus</code></p>
</div></td>
<td headers="説明" class="gt_row gt_left">最寄りの駅からの距離 (バス; 分)</td></tr>
    <tr><td headers="変数名" class="gt_row gt_left"><div class="gt_from_md"><p><code>Car</code></p>
</div></td>
<td headers="説明" class="gt_row gt_left">最寄りの駅からの距離 (車; 分)</td></tr>
    <tr><td headers="変数名" class="gt_row gt_left"><div class="gt_from_md"><p><code>Budget</code></p>
</div></td>
<td headers="説明" class="gt_row gt_left">平均予算 (円)</td></tr>
    <tr><td headers="変数名" class="gt_row gt_left"><div class="gt_from_md"><p><code>ScoreN</code></p>
</div></td>
<td headers="説明" class="gt_row gt_left">口コミの数</td></tr>
    <tr><td headers="変数名" class="gt_row gt_left"><div class="gt_from_md"><p><code>Score</code></p>
</div></td>
<td headers="説明" class="gt_row gt_left">口コミ評価の平均値</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</div>
<p>　それではここからは<code>df</code>を用いた{dplyr}の様々な機能を紹介していきます。</p>
<section id="特定の列を抽出する" class="level3" data-number="13.3.1">
<h3 data-number="13.3.1" class="anchored" data-anchor-id="特定の列を抽出する"><span class="header-section-number">13.3.1</span> 特定の列を抽出する</h3>
<p>　まずは、データフレームから特定の列のみを残す、除去する方法について紹介します。たとえば、<code>df</code>から<code>ID</code>、<code>Name</code>、<code>Pref</code>、<code>Score</code>のみを残すとします。{dplyr}を使わない方法と{dplyr}の<code>select()</code>関数を使った方法を紹介します。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># dplyrを使わない方法</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>df[, <span class="fu">c</span>(<span class="st">"ID"</span>, <span class="st">"Name"</span>, <span class="st">"Pref"</span>, <span class="st">"Score"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,292 × 4
   ID      Name                                                     Pref   Score
   &lt;chr&gt;   &lt;chr&gt;                                                    &lt;chr&gt;  &lt;dbl&gt;
 1 e539604 居酒屋 龍記 京橋店                                       東京都 NA   
 2 gfeb600 本格上海料理 新錦江 上野御徒町本店                       東京都  4.5 
 3 ggt5900 食べ飲み放題×中華ビストロ NOZOMI（のぞみ）               東京都 NA   
 4 g181340 博多餃子軒 八王子店 タピオカ店 Bull Pulu（ブルプル）併設 東京都 NA   
 5 ggww100 まさ屋 渋谷店                                            東京都 NA   
 6 gdzk500 完全個室 上海レストラン 檸檬 霞ヶ関ビル内店              東京都 NA   
 7 ga2g202 鶏そば きらり                                            東京都 NA   
 8 gg9m100 宴会個室×餃子酒場 北京飯店 秋葉原本店                    東京都  3.33
 9 gdvk200 中国料理 宝龍                                            東京都  2.5 
10 gggb200 中国料理 天安門                                          東京都 NA   
# ℹ 6,282 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># dplyr::select()を使う方法</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="co"># select(df, ID, Name, Pref, Score)でもOK</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>df <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="fu">select</span>(ID, Name, Pref, Score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,292 × 4
   ID      Name                                                     Pref   Score
   &lt;chr&gt;   &lt;chr&gt;                                                    &lt;chr&gt;  &lt;dbl&gt;
 1 e539604 居酒屋 龍記 京橋店                                       東京都 NA   
 2 gfeb600 本格上海料理 新錦江 上野御徒町本店                       東京都  4.5 
 3 ggt5900 食べ飲み放題×中華ビストロ NOZOMI（のぞみ）               東京都 NA   
 4 g181340 博多餃子軒 八王子店 タピオカ店 Bull Pulu（ブルプル）併設 東京都 NA   
 5 ggww100 まさ屋 渋谷店                                            東京都 NA   
 6 gdzk500 完全個室 上海レストラン 檸檬 霞ヶ関ビル内店              東京都 NA   
 7 ga2g202 鶏そば きらり                                            東京都 NA   
 8 gg9m100 宴会個室×餃子酒場 北京飯店 秋葉原本店                    東京都  3.33
 9 gdvk200 中国料理 宝龍                                            東京都  2.5 
10 gggb200 中国料理 天安門                                          東京都 NA   
# ℹ 6,282 more rows</code></pre>
</div>
</div>
<p>　どれも結果は同じですが、<code>select()</code>関数を使った方がより読みやすいコードになっているでしょう。むろん、<code>select()</code>関数を使わない方がスッキリする方も知るかも知れません。実際、自分でパッケージなどを作成する際は<code>select()</code>を使わない場合が多いです。ただし、一般的な分析の流れでは<code>select()</code>の方がコードも意味も明確となり、パイプ演算子でつなぐのも容易です。</p>
<p>　<code>select()</code>関数の使い方は非常に簡単です。第一引数はデータフレームですが、パイプ演算子を使う場合は省略可能です。第二引数以降の引数はデータフレームの変数名です。つまり、ここには残す変数名のみを書くだけで十分です。</p>
<p>　また、<code>select()</code>関数を使って列の順番を変えることもできます。たとえば、<code>ID</code>、<code>Pref</code>、<code>Name</code>、<code>Score</code>の順で列を残すなら、この順番で引数を書くだけです。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="fu">select</span>(ID, Pref, Name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,292 × 3
   ID      Pref   Name                                                    
   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;                                                   
 1 e539604 東京都 居酒屋 龍記 京橋店                                      
 2 gfeb600 東京都 本格上海料理 新錦江 上野御徒町本店                      
 3 ggt5900 東京都 食べ飲み放題×中華ビストロ NOZOMI（のぞみ）              
 4 g181340 東京都 博多餃子軒 八王子店 タピオカ店 Bull Pulu（ブルプル）併設
 5 ggww100 東京都 まさ屋 渋谷店                                           
 6 gdzk500 東京都 完全個室 上海レストラン 檸檬 霞ヶ関ビル内店             
 7 ga2g202 東京都 鶏そば きらり                                           
 8 gg9m100 東京都 宴会個室×餃子酒場 北京飯店 秋葉原本店                   
 9 gdvk200 東京都 中国料理 宝龍                                           
10 gggb200 東京都 中国料理 天安門                                         
# ℹ 6,282 more rows</code></pre>
</div>
</div>
</section>
<section id="特定の列を抽出し列名を変更する" class="level3" data-number="13.3.2">
<h3 data-number="13.3.2" class="anchored" data-anchor-id="特定の列を抽出し列名を変更する"><span class="header-section-number">13.3.2</span> 特定の列を抽出し、列名を変更する</h3>
<p>　また、特定の列を残す際、変数名を変更することも可能です。今回も<code>ID</code>、<code>Name</code>、<code>Pref</code>、<code>Score</code>のみを残しますが、<code>Pref</code>列は<code>Prefecture</code>に変えてみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="fu">select</span>(ID, Name, <span class="at">Prefecture =</span> Pref, Score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,292 × 4
   ID      Name                                                Prefecture Score
   &lt;chr&gt;   &lt;chr&gt;                                               &lt;chr&gt;      &lt;dbl&gt;
 1 e539604 居酒屋 龍記 京橋店                                  東京都     NA   
 2 gfeb600 本格上海料理 新錦江 上野御徒町本店                  東京都      4.5 
 3 ggt5900 食べ飲み放題×中華ビストロ NOZOMI（のぞみ）          東京都     NA   
 4 g181340 博多餃子軒 八王子店 タピオカ店 Bull Pulu（ブルプル… 東京都     NA   
 5 ggww100 まさ屋 渋谷店                                       東京都     NA   
 6 gdzk500 完全個室 上海レストラン 檸檬 霞ヶ関ビル内店         東京都     NA   
 7 ga2g202 鶏そば きらり                                       東京都     NA   
 8 gg9m100 宴会個室×餃子酒場 北京飯店 秋葉原本店               東京都      3.33
 9 gdvk200 中国料理 宝龍                                       東京都      2.5 
10 gggb200 中国料理 天安門                                     東京都     NA   
# ℹ 6,282 more rows</code></pre>
</div>
</div>
<p>　抽出する際、変数を<code>新しい変数名 = 既存の変数名</code>にするだけで、変数名が簡単に変更できました。もし、特定の列は抽出しないものの、変数名を変えるにはどうすれば良いでしょうか。ここでは<code>df</code>の<code>Pref</code>を<code>Prefecture</code>に、<code>Walk</code>を<code>Distance</code>に変更してみます。{dplyr}を使わない場合と{dplyr}の<code>rename()</code>関数を使う場合を両方紹介します。</p>
<p>　まずは、<code>name()</code>関数についてですが、これはデータフレームの変数名をベクトルとして出力する関数です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="fu">names</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "ID"        "Name"      "Pref"      "Zipcode"   "Latitude"  "Longitude"
 [7] "Line"      "Station"   "Walk"      "Bus"       "Car"       "Budget"   
[13] "ScoreN"    "Score"    </code></pre>
</div>
</div>
<p>　察しの良い読者は気づいたかも知れませんが、<code>names(データフレーム名)</code>の結果はベクトルであり、上書きも可能です。つまり、<code>names(df)</code>の3番目と9番目の要素を<code>"Prefecture"</code>と<code>"Distance"</code>に上書きすることができるということです。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># dplyrを使わずに列名を変更する方法</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="fu">names</span>(df)[<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">9</span>)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Prefecture"</span>, <span class="st">"Distance"</span>)</span>
<span id="cb25-3"><a href="#cb25-3"></a></span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="co"># dfの中身を出力</span></span>
<span id="cb25-5"><a href="#cb25-5"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,292 × 14
   ID      Name     Prefecture Zipcode Latitude Longitude Line  Station Distance
   &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
 1 e539604 居酒屋 … 東京都     1040031     35.7      140. 地下… 銀座一…        3
 2 gfeb600 本格上…  東京都     1100005     35.7      140. 地下… 仲御徒…        1
 3 ggt5900 食べ飲…  東京都     1250041     35.8      140. ＪＲ… 金町駅         2
 4 g181340 博多餃…  東京都     1920904     35.7      139. ＪＲ  八王子…        1
 5 ggww100 まさ屋 … 東京都     1500042     35.7      140. 地下… 渋谷駅         7
 6 gdzk500 完全個…  東京都     1000013     35.7      140. 地下… 虎ノ門…        3
 7 ga2g202 鶏そば … 東京都     1760006     35.7      140. 西武… 江古田…        2
 8 gg9m100 宴会個…  東京都     1010021     35.7      140. ＪＲ  秋葉原…        4
 9 gdvk200 中国料…  東京都     1000006     35.7      140. ＪＲ  有楽町…        1
10 gggb200 中国料…  東京都     1140002     35.8      140. 地下… 王子駅         2
# ℹ 6,282 more rows
# ℹ 5 more variables: Bus &lt;dbl&gt;, Car &lt;dbl&gt;, Budget &lt;dbl&gt;, ScoreN &lt;dbl&gt;,
#   Score &lt;dbl&gt;</code></pre>
</div>
</div>
<p>　簡単に変数名の変更ができました。続いて、{dplyr}の<code>rename()</code>関数を使った方法です。今回は、<code>Prefecture</code>を<code>Pref</code>に、<code>Distance</code>を<code>Walk</code>に戻して見ましょう。そして、出力するだけにとどまらず、<code>df</code>に上書きしましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># dfのPrefectureをPrefに、DistanceをWalkに変更し、上書きする</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>  <span class="fu">rename</span>(<span class="at">Pref =</span> Prefecture, <span class="at">Walk =</span> Distance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　これで終わりです。実は<code>select()</code>関数と使い方がほぼ同じです。ただし、残す変数名を指定する必要がなく、名前を変更する変数名と新しい変数名を入れるだけです。変数が少ないデータなら<code>select()</code>でもあまり不便は感じないかも知れませんが、変数が多くなると<code>rename()</code>関数は非常に便利です。</p>
</section>
<section id="特定の列を除外する" class="level3" data-number="13.3.3">
<h3 data-number="13.3.3" class="anchored" data-anchor-id="特定の列を除外する"><span class="header-section-number">13.3.3</span> 特定の列を除外する</h3>
<p>　逆に、一部の変数をデータフレームから除去したい場合もあるでしょう。たとえば、緯度 (<code>Latitude</code>)と経度 (<code>Longitude</code>)はラーメン屋の情報としては不要かもしれません。この2つの変数を除外するためにはどうすれば良いでしょうか。まず考えられるのは、この2つの変数を除いた変数を指定・抽出する方法です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="fu">select</span>(ID, Name, Pref, Zipcode, </span>
<span id="cb28-3"><a href="#cb28-3"></a>         Line, Station, Walk, Bus, Car, Budget, ScoreN, Score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,292 × 12
   ID    Name  Pref  Zipcode Line  Station  Walk   Bus   Car Budget ScoreN Score
   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
 1 e539… 居酒… 東京… 1040031 地下… 銀座一…     3    NA    NA   3000      0 NA   
 2 gfeb… 本格… 東京… 1100005 地下… 仲御徒…     1    NA    NA   2000      2  4.5 
 3 ggt5… 食べ… 東京… 1250041 ＪＲ… 金町駅      2    NA    NA   2980      0 NA   
 4 g181… 博多… 東京… 1920904 ＪＲ  八王子…     1    NA    NA   2000      0 NA   
 5 ggww… まさ… 東京… 1500042 地下… 渋谷駅      7    NA    NA    380      0 NA   
 6 gdzk… 完全… 東京… 1000013 地下… 虎ノ門…     3    NA    NA   2980      0 NA   
 7 ga2g… 鶏そ… 東京… 1760006 西武… 江古田…     2    NA    NA    850      0 NA   
 8 gg9m… 宴会… 東京… 1010021 ＪＲ  秋葉原…     4    NA    NA   2000      3  3.33
 9 gdvk… 中国… 東京… 1000006 ＪＲ  有楽町…     1    NA    NA   1000      2  2.5 
10 gggb… 中国… 東京… 1140002 地下… 王子駅      2    NA    NA   2000      0 NA   
# ℹ 6,282 more rows</code></pre>
</div>
</div>
<p>　かなり長いコードになりましたね。しかし、もっと簡単な方法があります。それは<code>-</code>を使う方法です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>  <span class="fu">select</span>(<span class="sc">-</span>Latitude, <span class="sc">-</span>Longitude) <span class="co"># select(-c(Latitude, Longitude))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,292 × 12
   ID    Name  Pref  Zipcode Line  Station  Walk   Bus   Car Budget ScoreN Score
   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
 1 e539… 居酒… 東京… 1040031 地下… 銀座一…     3    NA    NA   3000      0 NA   
 2 gfeb… 本格… 東京… 1100005 地下… 仲御徒…     1    NA    NA   2000      2  4.5 
 3 ggt5… 食べ… 東京… 1250041 ＪＲ… 金町駅      2    NA    NA   2980      0 NA   
 4 g181… 博多… 東京… 1920904 ＪＲ  八王子…     1    NA    NA   2000      0 NA   
 5 ggww… まさ… 東京… 1500042 地下… 渋谷駅      7    NA    NA    380      0 NA   
 6 gdzk… 完全… 東京… 1000013 地下… 虎ノ門…     3    NA    NA   2980      0 NA   
 7 ga2g… 鶏そ… 東京… 1760006 西武… 江古田…     2    NA    NA    850      0 NA   
 8 gg9m… 宴会… 東京… 1010021 ＪＲ  秋葉原…     4    NA    NA   2000      3  3.33
 9 gdvk… 中国… 東京… 1000006 ＪＲ  有楽町…     1    NA    NA   1000      2  2.5 
10 gggb… 中国… 東京… 1140002 地下… 王子駅      2    NA    NA   2000      0 NA   
# ℹ 6,282 more rows</code></pre>
</div>
</div>
<p>　除外したい変数名の前に<code>-</code>を付けただけです。また、<code>-Latitude</code>と<code>-Longitude</code>をそれぞれ指定せず、<code>-c(Latitude, Longitude)</code>のように<code>c()</code>でまとめるのも可能です。</p>
</section>
<section id="隣接した列を指定する" class="level3" data-number="13.3.4">
<h3 data-number="13.3.4" class="anchored" data-anchor-id="隣接した列を指定する"><span class="header-section-number">13.3.4</span> 隣接した列を指定する</h3>
<p>　先ほど、<code>df</code>から緯度 (<code>Latitude</code>)と経度 (<code>Longitude</code>)を除外する例を考えてみましょう。<code>-</code>を使うと簡単ですが、場合によっては残す変数名を指定する必要もあります。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>  <span class="fu">select</span>(ID, Name, Pref, Zipcode, </span>
<span id="cb32-3"><a href="#cb32-3"></a>         Line, Station, Walk, Bus, Car, Budget, ScoreN, Score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　よく考えてみれば、<code>ID</code>から<code>Zipcode</code>は隣接した列ですし、<code>Line</code>から<code>Score</code>までもそうです。これは<code>names()</code>関数で確認できます。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="fu">names</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "ID"        "Name"      "Pref"      "Zipcode"   "Latitude"  "Longitude"
 [7] "Line"      "Station"   "Walk"      "Bus"       "Car"       "Budget"   
[13] "ScoreN"    "Score"    </code></pre>
</div>
</div>
<p>　ここで便利な演算子が<code>:</code>です。これまで、<code>x</code>から<code>y</code>までの公差1の等差数列を作成する際に<code>x:y</code>を使って来ましたが、これに非常に似ています。データフレームの「<code>x</code>列から<code>y</code>列まで」の表記も<code>select()</code>関数内では<code>:</code>と書くことができます。したがって、上記のコードは以下のように短縮化可能です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>  <span class="fu">select</span>(ID<span class="sc">:</span>Zipcode, Line<span class="sc">:</span>Score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　「<code>df</code>の<code>ID</code>から<code>Zipcode</code>まで、そして<code>Line</code>から<code>Score</code>までの列を選択する」という意味です。非常に便利な演算子ですので、<code>-</code>と合わせて覚えておきましょう。</p>
</section>
<section id="一部の列の順番だけを変える" class="level3" data-number="13.3.5">
<h3 data-number="13.3.5" class="anchored" data-anchor-id="一部の列の順番だけを変える"><span class="header-section-number">13.3.5</span> 一部の列の順番だけを変える</h3>
<p>　ある列の位置を替えたいとします。たとえば、<code>Score</code>と<code>ScoreN</code>をそれぞれ1列目、2列目にしたい場合、どうすれば良いでしょうか。これまで勉強したことを考えると、以下のようなコードで問題ないでしょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>  <span class="fu">select</span>(Score, ScoreN, ID<span class="sc">:</span>Budget)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,292 × 14
   Score ScoreN ID    Name  Pref  Zipcode Latitude Longitude Line  Station  Walk
   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;
 1 NA         0 e539… 居酒… 東京… 1040031     35.7      140. 地下… 銀座一…     3
 2  4.5       2 gfeb… 本格… 東京… 1100005     35.7      140. 地下… 仲御徒…     1
 3 NA         0 ggt5… 食べ… 東京… 1250041     35.8      140. ＪＲ… 金町駅      2
 4 NA         0 g181… 博多… 東京… 1920904     35.7      139. ＪＲ  八王子…     1
 5 NA         0 ggww… まさ… 東京… 1500042     35.7      140. 地下… 渋谷駅      7
 6 NA         0 gdzk… 完全… 東京… 1000013     35.7      140. 地下… 虎ノ門…     3
 7 NA         0 ga2g… 鶏そ… 東京… 1760006     35.7      140. 西武… 江古田…     2
 8  3.33      3 gg9m… 宴会… 東京… 1010021     35.7      140. ＪＲ  秋葉原…     4
 9  2.5       2 gdvk… 中国… 東京… 1000006     35.7      140. ＪＲ  有楽町…     1
10 NA         0 gggb… 中国… 東京… 1140002     35.8      140. 地下… 王子駅      2
# ℹ 6,282 more rows
# ℹ 3 more variables: Bus &lt;dbl&gt;, Car &lt;dbl&gt;, Budget &lt;dbl&gt;</code></pre>
</div>
</div>
<p>　しかし、{dplyr}には<code>relocate()</code>というより便利な専用関数を提供しています。<code>relocate()</code>には変数名を指定するだけですが、ここで指定した変数がデータフレームの最初列の方に移動します。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb38-2"><a href="#cb38-2"></a>  <span class="fu">relocate</span>(Score, ScoreN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,292 × 14
   Score ScoreN ID    Name  Pref  Zipcode Latitude Longitude Line  Station  Walk
   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;
 1 NA         0 e539… 居酒… 東京… 1040031     35.7      140. 地下… 銀座一…     3
 2  4.5       2 gfeb… 本格… 東京… 1100005     35.7      140. 地下… 仲御徒…     1
 3 NA         0 ggt5… 食べ… 東京… 1250041     35.8      140. ＪＲ… 金町駅      2
 4 NA         0 g181… 博多… 東京… 1920904     35.7      139. ＪＲ  八王子…     1
 5 NA         0 ggww… まさ… 東京… 1500042     35.7      140. 地下… 渋谷駅      7
 6 NA         0 gdzk… 完全… 東京… 1000013     35.7      140. 地下… 虎ノ門…     3
 7 NA         0 ga2g… 鶏そ… 東京… 1760006     35.7      140. 西武… 江古田…     2
 8  3.33      3 gg9m… 宴会… 東京… 1010021     35.7      140. ＪＲ  秋葉原…     4
 9  2.5       2 gdvk… 中国… 東京… 1000006     35.7      140. ＪＲ  有楽町…     1
10 NA         0 gggb… 中国… 東京… 1140002     35.8      140. 地下… 王子駅      2
# ℹ 6,282 more rows
# ℹ 3 more variables: Bus &lt;dbl&gt;, Car &lt;dbl&gt;, Budget &lt;dbl&gt;</code></pre>
</div>
</div>
<p>　<code>relocate()</code>を使うと<code>ID:Budget</code>が省略可能となり、より短いコードになります。もう一つの例は、最初に持ってくるのではなく、「ある変数の前」または「ある変数の後」に移動させるケースです。これも<code>relocate()</code>で可能ですが、もう一つの引数が必要です。<code>Pref</code>と<code>Zipcdoe</code>の順番を変えるなら、まずは以下のような方法が考えられます。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>  <span class="fu">select</span>(ID<span class="sc">:</span>Name, Zipcode, Pref, Latitude<span class="sc">:</span>Score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,292 × 14
   ID     Name  Zipcode Pref  Latitude Longitude Line  Station  Walk   Bus   Car
   &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 e5396… 居酒… 1040031 東京…     35.7      140. 地下… 銀座一…     3    NA    NA
 2 gfeb6… 本格… 1100005 東京…     35.7      140. 地下… 仲御徒…     1    NA    NA
 3 ggt59… 食べ… 1250041 東京…     35.8      140. ＪＲ… 金町駅      2    NA    NA
 4 g1813… 博多… 1920904 東京…     35.7      139. ＪＲ  八王子…     1    NA    NA
 5 ggww1… まさ… 1500042 東京…     35.7      140. 地下… 渋谷駅      7    NA    NA
 6 gdzk5… 完全… 1000013 東京…     35.7      140. 地下… 虎ノ門…     3    NA    NA
 7 ga2g2… 鶏そ… 1760006 東京…     35.7      140. 西武… 江古田…     2    NA    NA
 8 gg9m1… 宴会… 1010021 東京…     35.7      140. ＪＲ  秋葉原…     4    NA    NA
 9 gdvk2… 中国… 1000006 東京…     35.7      140. ＪＲ  有楽町…     1    NA    NA
10 gggb2… 中国… 1140002 東京…     35.8      140. 地下… 王子駅      2    NA    NA
# ℹ 6,282 more rows
# ℹ 3 more variables: Budget &lt;dbl&gt;, ScoreN &lt;dbl&gt;, Score &lt;dbl&gt;</code></pre>
</div>
</div>
<p>　これを<code>relocate()</code>で書き換えるなら、<code>.after</code>または<code>.before</code>引数が必要になります。<code>relocate(変数名1, .after = 変数名2)</code>は「変数1を変数2の直後に移動させる」 ことを意味します。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>  <span class="fu">relocate</span>(Pref, <span class="at">.after =</span> Zipcode)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,292 × 14
   ID     Name  Zipcode Pref  Latitude Longitude Line  Station  Walk   Bus   Car
   &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 e5396… 居酒… 1040031 東京…     35.7      140. 地下… 銀座一…     3    NA    NA
 2 gfeb6… 本格… 1100005 東京…     35.7      140. 地下… 仲御徒…     1    NA    NA
 3 ggt59… 食べ… 1250041 東京…     35.8      140. ＪＲ… 金町駅      2    NA    NA
 4 g1813… 博多… 1920904 東京…     35.7      139. ＪＲ  八王子…     1    NA    NA
 5 ggww1… まさ… 1500042 東京…     35.7      140. 地下… 渋谷駅      7    NA    NA
 6 gdzk5… 完全… 1000013 東京…     35.7      140. 地下… 虎ノ門…     3    NA    NA
 7 ga2g2… 鶏そ… 1760006 東京…     35.7      140. 西武… 江古田…     2    NA    NA
 8 gg9m1… 宴会… 1010021 東京…     35.7      140. ＪＲ  秋葉原…     4    NA    NA
 9 gdvk2… 中国… 1000006 東京…     35.7      140. ＪＲ  有楽町…     1    NA    NA
10 gggb2… 中国… 1140002 東京…     35.8      140. 地下… 王子駅      2    NA    NA
# ℹ 6,282 more rows
# ℹ 3 more variables: Budget &lt;dbl&gt;, ScoreN &lt;dbl&gt;, Score &lt;dbl&gt;</code></pre>
</div>
</div>
<p>　<code>.before</code>を使うことできます。この場合は「<code>Zipcode</code>を<code>Pref</code>の直前に移動させる」 ことを指定する必要があります。結果は省略しますが、自分でコードを走らせ、上と同じ結果が得られるかを確認してみてください。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>  <span class="fu">relocate</span>(Zipcode, <span class="at">.before =</span> Pref)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="selectの便利な機能" class="level3" data-number="13.3.6">
<h3 data-number="13.3.6" class="anchored" data-anchor-id="selectの便利な機能"><span class="header-section-number">13.3.6</span> <code>select()</code>の便利な機能</h3>
<p>　<code>select()</code>関数は他にも便利な機能がいくつかあります。ここではいくつの機能を紹介しますが、より詳しい内容は<code>?dplyr::select</code>を参照してください。</p>
<p><strong><code>starts_with()</code>と<code>ends_with()</code>、<code>contains()</code>、<code>num_range()</code>: 特定の文字を含む変数を選択する</strong></p>
<p>　まずは、特定の文字を含む変数名を指定する方法です。<code>starts_with("X")</code>、<code>ends_with("X")</code>、<code>contains("X")</code>は変数名が<code>"X"</code>で始まるか、<code>"X"</code>で終わるか、<code>"X"</code>を含むかを判断し、条件に合う変数名を返す関数です。実際の例を見ましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># ID、Nameに続いて、Scoreで始まる変数名を抽出</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>df <span class="sc">|&gt;</span></span>
<span id="cb45-3"><a href="#cb45-3"></a>  <span class="fu">select</span>(ID, Name, <span class="fu">starts_with</span>(<span class="st">"Score"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,292 × 4
   ID      Name                                                     ScoreN Score
   &lt;chr&gt;   &lt;chr&gt;                                                     &lt;dbl&gt; &lt;dbl&gt;
 1 e539604 居酒屋 龍記 京橋店                                            0 NA   
 2 gfeb600 本格上海料理 新錦江 上野御徒町本店                            2  4.5 
 3 ggt5900 食べ飲み放題×中華ビストロ NOZOMI（のぞみ）                    0 NA   
 4 g181340 博多餃子軒 八王子店 タピオカ店 Bull Pulu（ブルプル）併設      0 NA   
 5 ggww100 まさ屋 渋谷店                                                 0 NA   
 6 gdzk500 完全個室 上海レストラン 檸檬 霞ヶ関ビル内店                   0 NA   
 7 ga2g202 鶏そば きらり                                                 0 NA   
 8 gg9m100 宴会個室×餃子酒場 北京飯店 秋葉原本店                         3  3.33
 9 gdvk200 中国料理 宝龍                                                 2  2.5 
10 gggb200 中国料理 天安門                                               0 NA   
# ℹ 6,282 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="co"># eで終わる変数名を除去</span></span>
<span id="cb47-2"><a href="#cb47-2"></a>df <span class="sc">|&gt;</span></span>
<span id="cb47-3"><a href="#cb47-3"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">"e"</span>)) <span class="co"># !ends_with("e")も可能</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,292 × 8
   ID      Pref   Station       Walk   Bus   Car Budget ScoreN
   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 e539604 東京都 銀座一丁目駅     3    NA    NA   3000      0
 2 gfeb600 東京都 仲御徒町駅       1    NA    NA   2000      2
 3 ggt5900 東京都 金町駅           2    NA    NA   2980      0
 4 g181340 東京都 八王子駅         1    NA    NA   2000      0
 5 ggww100 東京都 渋谷駅           7    NA    NA    380      0
 6 gdzk500 東京都 虎ノ門駅         3    NA    NA   2980      0
 7 ga2g202 東京都 江古田駅         2    NA    NA    850      0
 8 gg9m100 東京都 秋葉原駅         4    NA    NA   2000      3
 9 gdvk200 東京都 有楽町駅         1    NA    NA   1000      2
10 gggb200 東京都 王子駅           2    NA    NA   2000      0
# ℹ 6,282 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># reを含む変数名を抽出するが、ScoreNは除去する</span></span>
<span id="cb49-2"><a href="#cb49-2"></a>df <span class="sc">|&gt;</span></span>
<span id="cb49-3"><a href="#cb49-3"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"re"</span>), <span class="sc">-</span>ScoreN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,292 × 2
   Pref   Score
   &lt;chr&gt;  &lt;dbl&gt;
 1 東京都 NA   
 2 東京都  4.5 
 3 東京都 NA   
 4 東京都 NA   
 5 東京都 NA   
 6 東京都 NA   
 7 東京都 NA   
 8 東京都  3.33
 9 東京都  2.5 
10 東京都 NA   
# ℹ 6,282 more rows</code></pre>
</div>
</div>
<p>　他の使い方としては<code>X1</code>、<code>X2</code>のような「文字+数字」の変数を選択する際、<code>starts_with()</code>が活躍します。たとえば、以下のような<code>myDF1</code>があるとします。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># tibble()でなく、data.frame()も使用可能です。</span></span>
<span id="cb51-2"><a href="#cb51-2"></a>myDF1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb51-3"><a href="#cb51-3"></a>  <span class="at">ID  =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb51-4"><a href="#cb51-4"></a>  <span class="at">X1  =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">7</span>),</span>
<span id="cb51-5"><a href="#cb51-5"></a>  <span class="at">Y1  =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb51-6"><a href="#cb51-6"></a>  <span class="at">X1D =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">9</span>),</span>
<span id="cb51-7"><a href="#cb51-7"></a>  <span class="at">X2  =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">0</span>, <span class="dv">2</span>),</span>
<span id="cb51-8"><a href="#cb51-8"></a>  <span class="at">Y2  =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>),</span>
<span id="cb51-9"><a href="#cb51-9"></a>  <span class="at">X2D =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb51-10"><a href="#cb51-10"></a>  <span class="at">X3  =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">2</span>),</span>
<span id="cb51-11"><a href="#cb51-11"></a>  <span class="at">Y3  =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb51-12"><a href="#cb51-12"></a>  <span class="at">X3D =</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">8</span>)</span>
<span id="cb51-13"><a href="#cb51-13"></a>)</span>
<span id="cb51-14"><a href="#cb51-14"></a></span>
<span id="cb51-15"><a href="#cb51-15"></a>myDF1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 10
     ID    X1    Y1   X1D    X2    Y2   X2D    X3    Y3   X3D
  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     1     2     3     4     5     3     8     3     1     9
2     2     4     5     2     5     3     9     0     5     1
3     3     6     1     1     6     2     5     3     9     3
4     4     2     1     6     0     3     0     0     1     3
5     5     7     0     9     2     1     1     2     3     8</code></pre>
</div>
</div>
<p>　この<code>myDF1</code>から<code>ID</code>、<code>Y1</code>、<code>Y2</code>、<code>Y3</code>を抽出するにはどうすれば良いでしょうか。これらの変数は隣接していないため、<code>:</code>も使えませんが、<code>starts_with()</code>を使えば簡単です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>myDF1 <span class="sc">|&gt;</span></span>
<span id="cb53-2"><a href="#cb53-2"></a>  <span class="fu">select</span>(ID, <span class="fu">starts_with</span>(<span class="st">"Y"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
     ID    Y1    Y2    Y3
  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     1     3     3     1
2     2     5     3     5
3     3     1     2     9
4     4     1     3     1
5     5     0     1     3</code></pre>
</div>
</div>
<p>　それでは、<code>ID</code>、<code>X1</code>、<code>X2</code>、<code>X3</code>はどうでしょうか。<code>starts_with("X")</code>だと、<code>X1c</code>なども選択されてしまいますね。ここで<code>-ends_with()</code>の出番です。つまり、「まずは<code>starts_with("X")</code>で<code>X</code>で始まる変数を選択し、続いて、<code>D</code>で終わるものを除外すればいいじゃん？」です。それでは、やってみましょうか。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>myDF1 <span class="sc">|&gt;</span></span>
<span id="cb55-2"><a href="#cb55-2"></a>  <span class="fu">select</span>(ID, <span class="fu">starts_with</span>(<span class="st">"X"</span>), <span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">"D"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
     X1    X2    X3
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     2     5     3
2     4     5     0
3     6     6     3
4     2     0     0
5     7     2     2</code></pre>
</div>
</div>
<p>　あらら、<code>ID</code>も同時になくなりましたね<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>。実はこのような時のために用意された関数があり、それが<code>num_range()</code>です。<code>num_range()</code>の第一引数は<code>starts_with()</code>関数と同じですが、第二引数も必要です。この第二引数にはnumeric型のベクトルが必要です。<code>1:3</code>でも、<code>c(1, 2, 3)</code>でも構いません。たとえば、<code>ID</code>、<code>X1</code>、<code>X2</code>、<code>X3</code>するには以下のように書きます。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>myDF1 <span class="sc">|&gt;</span></span>
<span id="cb57-2"><a href="#cb57-2"></a>  <span class="fu">select</span>(ID, <span class="fu">num_range</span>(<span class="st">"X"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
     ID    X1    X2    X3
  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     1     2     5     3
2     2     4     5     0
3     3     6     6     3
4     4     2     0     0
5     5     7     2     2</code></pre>
</div>
</div>
<p><strong><code>all_of()</code>と<code>any_of()</code>: 文字型ベクトルを用いた変数の選択</strong></p>
<p>　<code>all_of()</code>と<code>any_of()</code>は<code>select()</code>内の変数名として文字型ベクトルを使う際に用いる関数です。これは抽出したい列名が既にcharacter型ベクトルとして用意されている場合、便利な関数です。たとえば、以下の<code>Name_Vec</code>を考えてみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a>Name_Vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"X1"</span>, <span class="st">"X2"</span>, <span class="st">"X3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　この<code>Name_Vec</code>の要素と同じ列名を持つ列と<code>ID</code>列を<code>myDF1</code>から抽出する方法は以下の2通りです。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>myDF1[, <span class="fu">c</span>(<span class="st">"ID"</span>, Name_Vec)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
     ID    X1    X2    X3
  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     1     2     5     3
2     2     4     5     0
3     3     6     6     3
4     4     2     0     0
5     5     7     2     2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a>myDF1 <span class="sc">|&gt;</span></span>
<span id="cb62-2"><a href="#cb62-2"></a>  <span class="fu">select</span>(ID, <span class="fu">all_of</span>(Name_Vec))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
     ID    X1    X2    X3
  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     1     2     5     3
2     2     4     5     0
3     3     6     6     3
4     4     2     0     0
5     5     7     2     2</code></pre>
</div>
</div>
<p>　今の例だと、<code>select()</code>を使わない前者の方が便利かも知れませんが、<code>select()</code>内に外の変数名も指定する場合も多いので、後者の方が汎用性は高いです。私から見れば、今の例でも後者の方が読みやすく、使いやすいと思います。</p>
<p>　それでは以下のような<code>Name_Vec</code>はどうでしょう。今回は、<code>myDF1</code>に含まれていない<code>X4</code>と<code>X5</code>もあります。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a>Name_Vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"X1"</span>, <span class="st">"X2"</span>, <span class="st">"X3"</span>, <span class="st">"X4"</span>, <span class="st">"X5"</span>)</span>
<span id="cb64-2"><a href="#cb64-2"></a></span>
<span id="cb64-3"><a href="#cb64-3"></a>myDF1 <span class="sc">|&gt;</span></span>
<span id="cb64-4"><a href="#cb64-4"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(Name_Vec))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>## Error: Can't subset columns that don't exist.
##   Columns `X4` and `X5` don't exist.</code></pre>
<p>　このようにエラーが出てしまします。つまり、<code>all_of()</code>の場合、引数の要素全てがデータフレームに存在する必要があります。もし、ないものは無視して、合致する列だけ取り出したいはどうすれば良いでしょうか。そこで登場するのが<code>any_of()</code>です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a>myDF1 <span class="sc">|&gt;</span></span>
<span id="cb66-2"><a href="#cb66-2"></a>  <span class="fu">select</span>(<span class="fu">any_of</span>(Name_Vec))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
     X1    X2    X3
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     2     5     3
2     4     5     0
3     6     6     3
4     2     0     0
5     7     2     2</code></pre>
</div>
</div>
<p>　<code>any_of()</code>の方がより使いやすいと思う方も多いでしょうが、必ずしもそうとは限りません。たとえば、<code>Name_Vec</code>に誤字などが含まれる場合、<code>any_of()</code>だと誤字が含まれている変数は取り出しません。この場合はむしろちゃんとエラーを表示してくれた方が嬉しいですね。</p>
<p><strong><code>last_col()</code>: 最後の列を選択する</strong></p>
<p>　普段あまり使わない機能ですが、最後の列を選択する<code>last_col()</code>という関数もあります。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a><span class="co"># IDと最後の列のみを抽出</span></span>
<span id="cb68-2"><a href="#cb68-2"></a>df <span class="sc">|&gt;</span></span>
<span id="cb68-3"><a href="#cb68-3"></a>  <span class="fu">select</span>(ID, <span class="fu">last_col</span>(<span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,292 × 2
   ID      Score
   &lt;chr&gt;   &lt;dbl&gt;
 1 e539604 NA   
 2 gfeb600  4.5 
 3 ggt5900 NA   
 4 g181340 NA   
 5 ggww100 NA   
 6 gdzk500 NA   
 7 ga2g202 NA   
 8 gg9m100  3.33
 9 gdvk200  2.5 
10 gggb200 NA   
# ℹ 6,282 more rows</code></pre>
</div>
</div>
<p>　最後からk番目の列を指定することも可能です。最後の列の番号が0であり、その手前の列は1となります。つまり、<code>last_col()</code>の中には「最後から何番目の列か」を指定すれば良いです。最後の列は最後の列そのままなので0です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="co"># IDと最後から2列目を抽出</span></span>
<span id="cb70-2"><a href="#cb70-2"></a>df <span class="sc">|&gt;</span></span>
<span id="cb70-3"><a href="#cb70-3"></a>  <span class="fu">select</span>(ID, <span class="fu">last_col</span>(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,292 × 2
   ID      ScoreN
   &lt;chr&gt;    &lt;dbl&gt;
 1 e539604      0
 2 gfeb600      2
 3 ggt5900      0
 4 g181340      0
 5 ggww100      0
 6 gdzk500      0
 7 ga2g202      0
 8 gg9m100      3
 9 gdvk200      2
10 gggb200      0
# ℹ 6,282 more rows</code></pre>
</div>
</div>
<p>　この<code>last_col()</code>の引数を指定しないと、それは最後の列を意味します。つまり、<code>last_col()</code>と<code>last_col(0)</code>は同じです。これを利用すれば、「ある変数の最後の列へ移動させる」こともできます。たとえば、<code>ID</code>を最後の列に移動させたい場合、<code>relocate(ID, .after = last_col())</code>のように書きます。</p>
<p><strong><code>where()</code>: データ型から変数を選択する</strong></p>
<p>　最後に、「numeric型の列のみ抽出したい」、「character型の列だけほしい」場合に便利な<code>where()</code>関数を紹介します。<code>where()</code>の中に入る引数は一つだけであり、データ型を判定する関数名が入ります。たとえば、numeric型か否かを判断する関数は<code>is.numeric()</code>です。<code>df</code>からnumeric型の変数のみを抽出したい場合は以下のように書きます。ただし、<code>where()</code>の中の関数は<code>()</code>を省略します。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a><span class="co"># numeric型の列を抽出する</span></span>
<span id="cb72-2"><a href="#cb72-2"></a>df <span class="sc">|&gt;</span></span>
<span id="cb72-3"><a href="#cb72-3"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,292 × 9
   Zipcode Latitude Longitude  Walk   Bus   Car Budget ScoreN Score
     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
 1 1040031     35.7      140.     3    NA    NA   3000      0 NA   
 2 1100005     35.7      140.     1    NA    NA   2000      2  4.5 
 3 1250041     35.8      140.     2    NA    NA   2980      0 NA   
 4 1920904     35.7      139.     1    NA    NA   2000      0 NA   
 5 1500042     35.7      140.     7    NA    NA    380      0 NA   
 6 1000013     35.7      140.     3    NA    NA   2980      0 NA   
 7 1760006     35.7      140.     2    NA    NA    850      0 NA   
 8 1010021     35.7      140.     4    NA    NA   2000      3  3.33
 9 1000006     35.7      140.     1    NA    NA   1000      2  2.5 
10 1140002     35.8      140.     2    NA    NA   2000      0 NA   
# ℹ 6,282 more rows</code></pre>
</div>
</div>
<p>　<code>!</code>を使って条件に合致する列を除外することも可能です。もし、character型の列を除外する場合は以下のように<code>!where(is.character)</code>を指定します。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a><span class="co"># character型でない列を抽出する</span></span>
<span id="cb74-2"><a href="#cb74-2"></a>df <span class="sc">|&gt;</span></span>
<span id="cb74-3"><a href="#cb74-3"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">where</span>(is.character))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,292 × 9
   Zipcode Latitude Longitude  Walk   Bus   Car Budget ScoreN Score
     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
 1 1040031     35.7      140.     3    NA    NA   3000      0 NA   
 2 1100005     35.7      140.     1    NA    NA   2000      2  4.5 
 3 1250041     35.8      140.     2    NA    NA   2980      0 NA   
 4 1920904     35.7      139.     1    NA    NA   2000      0 NA   
 5 1500042     35.7      140.     7    NA    NA    380      0 NA   
 6 1000013     35.7      140.     3    NA    NA   2980      0 NA   
 7 1760006     35.7      140.     2    NA    NA    850      0 NA   
 8 1010021     35.7      140.     4    NA    NA   2000      3  3.33
 9 1000006     35.7      140.     1    NA    NA   1000      2  2.5 
10 1140002     35.8      140.     2    NA    NA   2000      0 NA   
# ℹ 6,282 more rows</code></pre>
</div>
</div>
<p>　<code>&amp;</code>を使って複数の条件を使うことも可能です。たとえば、<code>ID</code>変数に加えて「<code>"L"</code>で始まる変数の中でnumeric型の列を抽出」するコードは以下のようになります。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="co"># IDと、Lで始まるnumeric型の列を抽出する</span></span>
<span id="cb76-2"><a href="#cb76-2"></a>df <span class="sc">|&gt;</span></span>
<span id="cb76-3"><a href="#cb76-3"></a>  <span class="fu">select</span>(ID, <span class="fu">starts_with</span>(<span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">where</span>(is.numeric))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,292 × 3
   ID      Latitude Longitude
   &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;
 1 e539604     35.7      140.
 2 gfeb600     35.7      140.
 3 ggt5900     35.8      140.
 4 g181340     35.7      139.
 5 ggww100     35.7      140.
 6 gdzk500     35.7      140.
 7 ga2g202     35.7      140.
 8 gg9m100     35.7      140.
 9 gdvk200     35.7      140.
10 gggb200     35.8      140.
# ℹ 6,282 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="sec-handling1-filter" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="sec-handling1-filter"><span class="header-section-number">13.4</span> 行の抽出</h2>
<section id="指定した行を抽出する" class="level3" data-number="13.4.1">
<h3 data-number="13.4.1" class="anchored" data-anchor-id="指定した行を抽出する"><span class="header-section-number">13.4.1</span> 指定した行を抽出する</h3>
<p>　他にも特定の行を抽出する場合があります。たとえば、「<code>df</code>の最初の5行」や「<code>df</code>の8行目のケース」といった場合です。この操作には{dplyr}の<code>slice_*()</code>関数群が便利です。それではそれぞれの関数の使い方について紹介していきます。その前に、実習用データとして<code>df</code>から一部の列のみを抽出した<code>selelct.df</code>を作成します。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a>select.df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb78-2"><a href="#cb78-2"></a>  <span class="fu">select</span>(ID, Name, Pref, Budget, Score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><code>slice()</code>: 指定した番号の行のみ抽出する</strong></p>
<p>　<code>select.df</code>から2, 8, 9行目の行を抽出したいとします。このような簡単な操作はパッケージを使わず、以下のように抽出することができます。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="co"># select.dfから2, 8, 9行目の行を抽出し、出力する</span></span>
<span id="cb79-2"><a href="#cb79-2"></a>select.df[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">8</span>, <span class="dv">9</span>),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  ID      Name                                  Pref   Budget Score
  &lt;chr&gt;   &lt;chr&gt;                                 &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 gfeb600 本格上海料理 新錦江 上野御徒町本店    東京都   2000  4.5 
2 gg9m100 宴会個室×餃子酒場 北京飯店 秋葉原本店 東京都   2000  3.33
3 gdvk200 中国料理 宝龍                         東京都   1000  2.5 </code></pre>
</div>
</div>
<p>　しかし、以下の<code>slice()</code>関数を使うとパイプ演算子を前後に付けることが可能であり<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>、コードの可読性も高いです。<code>slice()</code>関数には以下のように抽出したい行の番号を入れるだけです。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a><span class="co"># select.dfから2, 8, 9行目の行を抽出し、出力する</span></span>
<span id="cb81-2"><a href="#cb81-2"></a>select.df <span class="sc">|&gt;</span> </span>
<span id="cb81-3"><a href="#cb81-3"></a>  <span class="fu">slice</span>(<span class="dv">2</span>, <span class="dv">8</span>, <span class="dv">9</span>) <span class="co"># slice(c(2, 8, 9))もOK</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  ID      Name                                  Pref   Budget Score
  &lt;chr&gt;   &lt;chr&gt;                                 &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 gfeb600 本格上海料理 新錦江 上野御徒町本店    東京都   2000  4.5 
2 gg9m100 宴会個室×餃子酒場 北京飯店 秋葉原本店 東京都   2000  3.33
3 gdvk200 中国料理 宝龍                         東京都   1000  2.5 </code></pre>
</div>
</div>
<p>　<code>slice(2, 8, 9)</code>でも<code>slice(c(2, 8, 9))</code>でも構いません。また、隣接した行でしたら<code>:</code>を使うことも可能です。たとえば、10行目から15行目まで抽出する場合は<code>slice(10:15)</code>のような書き方も出来ます。</p>
<p><strong><code>slice_head()</code>: 最初のn行を抽出する</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="co"># select.dfから最初の3行抽出し、出力する</span></span>
<span id="cb83-2"><a href="#cb83-2"></a>select.df <span class="sc">|&gt;</span> </span>
<span id="cb83-3"><a href="#cb83-3"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  ID      Name                                       Pref   Budget Score
  &lt;chr&gt;   &lt;chr&gt;                                      &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 e539604 居酒屋 龍記 京橋店                         東京都   3000  NA  
2 gfeb600 本格上海料理 新錦江 上野御徒町本店         東京都   2000   4.5
3 ggt5900 食べ飲み放題×中華ビストロ NOZOMI（のぞみ） 東京都   2980  NA  </code></pre>
</div>
</div>
<p>　これは<code>head(データ名, n = 出力する個数)</code>と同じ動きをする関数です。注意点としては引数<code>n =</code>を必ず付ける点です。たとえば、<code>slice_head(3)</code>にすると、<code>select.df</code>の3行目のみ抽出されます。</p>
<p><strong><code>slice_tail()</code>: 最後のn行を抽出する</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a><span class="co"># select.dfから最後の7行を抽出し、出力する</span></span>
<span id="cb85-2"><a href="#cb85-2"></a>select.df <span class="sc">|&gt;</span> </span>
<span id="cb85-3"><a href="#cb85-3"></a>  <span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 5
  ID      Name                    Pref     Budget Score
  &lt;chr&gt;   &lt;chr&gt;                   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;
1 5508852 場鶴                    和歌山県     NA    NA
2 7113351 来来亭 橋本店           和歌山県     NA    NA
3 6364939 ばり馬 和歌山紀三井寺店 和歌山県     NA    NA
4 7103349 ramen BIRDMAN           和歌山県     NA    NA
5 7315303 薩摩ラーメン 斗天王     和歌山県     NA    NA
6 7703472 まるしげ                和歌山県     NA    NA
7 6395035 暴豚製麺所              和歌山県     NA    NA</code></pre>
</div>
</div>
<p>　これは<code>tail(データ名, n = 出力する個数)</code>と同じ動きをする関数です。ちなみに、この<code>n</code>引数も<code>n =</code>を明記する必要があります。</p>
<p><strong><code>slice_max()</code>: 指定した変数が大きい順でn行抽出する</strong></p>
<p>　<code>slice_max()</code>は指定した変数が大きい順で<code>n</code>行抽出する関数です。たとえば、<code>Budget</code>が高い順で4店舗を抽出する場合は以下のように書きます。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a><span class="co"># select.dfからScoreの値が高い順で5行を抽出し、出力する</span></span>
<span id="cb87-2"><a href="#cb87-2"></a>select.df <span class="sc">|&gt;</span> </span>
<span id="cb87-3"><a href="#cb87-3"></a>  <span class="fu">slice_max</span>(Budget, <span class="at">n =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  ID      Name                                              Pref    Budget Score
  &lt;chr&gt;   &lt;chr&gt;                                             &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;
1 g670609 横浜ベイシェラトン ホテル＆タワーズ 中国料理 彩龍 神奈川…   8000    NA
2 g910420 JASMINE 憶江南                                    東京都    7000    NA
3 7176666 赤坂焼鳥 鳳                                       東京都    7000    NA
4 b612800 羽衣 銀座本店                                     東京都    6000    NA</code></pre>
</div>
</div>
<p><strong><code>slice_min()</code>: 指定した変数が小さい順でn行抽出する</strong></p>
<p>　一方、<code>slice_min()</code>関数が小さい順で抽出します。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a><span class="co"># select.dfからScoreの値が低い順で3行を抽出し、出力する</span></span>
<span id="cb89-2"><a href="#cb89-2"></a>select.df <span class="sc">|&gt;</span> </span>
<span id="cb89-3"><a href="#cb89-3"></a>  <span class="fu">slice_min</span>(Score, <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  ID      Name                        Pref   Budget Score
  &lt;chr&gt;   &lt;chr&gt;                       &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 6384909 葛西大勝軒                  東京都     NA     1
2 6929243 由丸 アトレヴィ大塚店       東京都     NA     1
3 5816075 ラーメン戯拉戯拉            千葉県     NA     1
4 5495086 らあめん花月嵐 坂戸わかば店 埼玉県     NA     1</code></pre>
</div>
</div>
<p>　ただし、<code>n = 3</code>と指定したはずなのに、4行が抽出されました。これは同点のケースがあるからです。実際、<code>select.df</code>には<code>Score</code>が1のケースが4つあります。もし、同点の存在により<code>n</code>に収まらない場合、<code>slice_max()</code>、<code>slice_min()</code>関数は<code>n</code>を超える行を出力します。これを強制的に<code>n</code>行に合わせるためには<code>with_ties = FALSE</code>引数を付けます。この場合、データで格納されている順で<code>n</code>個のみ出力されます。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a>select.df <span class="sc">|&gt;</span> </span>
<span id="cb91-2"><a href="#cb91-2"></a>  <span class="fu">slice_min</span>(Score, <span class="at">n =</span> <span class="dv">3</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  ID      Name                  Pref   Budget Score
  &lt;chr&gt;   &lt;chr&gt;                 &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 6384909 葛西大勝軒            東京都     NA     1
2 6929243 由丸 アトレヴィ大塚店 東京都     NA     1
3 5816075 ラーメン戯拉戯拉      千葉県     NA     1</code></pre>
</div>
</div>
<p><strong><code>slice_sample()</code>: 無作為にn行を抽出する</strong></p>
<p>　最後に無作為に<code>n</code>行を抽出する<code>slice_sample()</code>関数です。引数は<code>n</code>であり、抽出したい行数を指定します。たとえば、<code>select.df</code>から無作為に10行抽出したい場合は、</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a><span class="co"># select.dfから無作為に5行を抽出し、出力する</span></span>
<span id="cb93-2"><a href="#cb93-2"></a>select.df <span class="sc">|&gt;</span> </span>
<span id="cb93-3"><a href="#cb93-3"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   ID      Name                         Pref     Budget Score
   &lt;chr&gt;   &lt;chr&gt;                        &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1 5495608 盛壱                         千葉県       NA  NA  
 2 7500960 幸楽苑 銚子店                千葉県       NA  NA  
 3 6211385 支那麺 はしご 銀座 4丁目店   東京都       NA  NA  
 4 5508541 一姫ラーメン 福崎店          兵庫県       NA  NA  
 5 6729138 ラーメン武                   埼玉県       NA  NA  
 6 7288032 大勝軒直伝 金太郎            神奈川県     NA   3.5
 7 6950602 徳島ラーメン 麺魂 京都久世店 京都府       NA  NA  
 8 6390346 ラーメン大 蒲田店            東京都       NA  NA  
 9 5801596 らあめん花月嵐 武蔵関店      東京都       NA  NA  
10 6927335 銀麺                         兵庫県      800  NA  </code></pre>
</div>
</div>
<p>のように書きます。ブートストラップ法や機械学習における交差検証 (cross-validation)の際に有用な関数ですが、ブートストラップや機械学習のパッケージの多くはサンプル分割の関数を提供しているため、あまり使う機会はないでしょう。また、<code>slice_sample()</code>関数をブートストラップ法のために用いる場合は、ケースを反復抽出する必要があり、<code>replace = TRUE</code>を付けると反復抽出を行います。デフォルト値は<code>FALSE</code>です。</p>
</section>
<section id="条件に合致する行を抽出する" class="level3" data-number="13.4.2">
<h3 data-number="13.4.2" class="anchored" data-anchor-id="条件に合致する行を抽出する"><span class="header-section-number">13.4.2</span> 条件に合致する行を抽出する</h3>
<p>　これまで見てきた<code>slice()</code>を用いる行の抽出は、実際あまり使う機会がありません。多くの場合、「何かの条件と合致するケースのみ抽出する」または、「何かの条件と合致しないケースのみを抽出する」やこれらの組み合わせで行の抽出を行います。そこで登場するのが{dplyr}パッケージの<code>filter()</code>関数です。<code>filter()</code>関数の使い方は以下の通りです。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a><span class="co"># dplyr::filter()の使い方</span></span>
<span id="cb95-2"><a href="#cb95-2"></a><span class="fu">filter</span>(データフレーム名, 条件1, 条件2, ...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　むろん、第一引数がデータですから、<code>|&gt;</code>を使うことも可能です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1"></a><span class="co"># dplyr::filter()の使い方 (パイプを使う方法)</span></span>
<span id="cb96-2"><a href="#cb96-2"></a>データフレーム名 <span class="sc">|&gt;</span></span>
<span id="cb96-3"><a href="#cb96-3"></a>  <span class="fu">filter</span>(条件1, 条件2, ...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　まずは、条件が一つの場合を考えてみましょう。ここでは「<code>Pref</code>が<code>"京都府"</code>であるケースのみに絞り、<code>Name</code>と<code>Station</code>、<code>Score</code>列のみを出力する」ケースを考えてみましょう。まず、<code>filter()</code>関数で行を抽出し、続いて<code>select()</code>関数で抽出する列を指定します。むろん、今回の場合、<code>filter()</code>と<code>select()</code>の順番は替えても構いません。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="co"># dfからPrefが"京都府"であるケースのみ残し、df2という名で保存</span></span>
<span id="cb97-2"><a href="#cb97-2"></a>df2 <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb97-3"><a href="#cb97-3"></a>  <span class="fu">filter</span>(Pref <span class="sc">==</span> <span class="st">"京都府"</span>)</span>
<span id="cb97-4"><a href="#cb97-4"></a></span>
<span id="cb97-5"><a href="#cb97-5"></a><span class="co"># df2からName, Station, Score列を抽出</span></span>
<span id="cb97-6"><a href="#cb97-6"></a>df2 <span class="sc">|&gt;</span></span>
<span id="cb97-7"><a href="#cb97-7"></a>  <span class="fu">select</span>(Name, Station, Score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 414 × 3
   Name                                                    Station    Score
   &lt;chr&gt;                                                   &lt;chr&gt;      &lt;dbl&gt;
 1 中国料理 鳳麟                                           くいな橋駅 NA   
 2 黒毛和牛一頭買い焼肉と 炊き立て土鍋ご飯 市場小路 烏丸店 四条駅      3.19
 3 京の中華 ハマムラ みやこみち店                          京都駅     NA   
 4 焼肉処 真 桂店                                          桂駅       NA   
 5 祇園京都ラーメン                                        祇園四条駅 NA   
 6 創作料理 串カツ トンカツ jiro                           新田辺駅   NA   
 7 祇園 晩餐のあと                                         祇園四条駅 NA   
 8 DETAIL                                                  東山駅     NA   
 9 めんや龍神                                              北大路駅   NA   
10 無尽蔵 京都八条家                                       京都駅      3.5 
# ℹ 404 more rows</code></pre>
</div>
</div>
<p>　これは<code>df</code>から<code>Pref == "京都府"</code>のケースのみ残したものを<code>df2</code>として格納し、それをまた<code>select()</code>関数を使って列を抽出するコードです。これでも問題ありませんが、これだとパイプ演算子の便利さが分かりません。パイプ演算子は複数使うことが可能です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb99-2"><a href="#cb99-2"></a>  <span class="fu">filter</span>(Pref <span class="sc">==</span> <span class="st">"京都府"</span>) <span class="sc">|&gt;</span></span>
<span id="cb99-3"><a href="#cb99-3"></a>  <span class="fu">select</span>(Name, Station, Score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 414 × 3
   Name                                                    Station    Score
   &lt;chr&gt;                                                   &lt;chr&gt;      &lt;dbl&gt;
 1 中国料理 鳳麟                                           くいな橋駅 NA   
 2 黒毛和牛一頭買い焼肉と 炊き立て土鍋ご飯 市場小路 烏丸店 四条駅      3.19
 3 京の中華 ハマムラ みやこみち店                          京都駅     NA   
 4 焼肉処 真 桂店                                          桂駅       NA   
 5 祇園京都ラーメン                                        祇園四条駅 NA   
 6 創作料理 串カツ トンカツ jiro                           新田辺駅   NA   
 7 祇園 晩餐のあと                                         祇園四条駅 NA   
 8 DETAIL                                                  東山駅     NA   
 9 めんや龍神                                              北大路駅   NA   
10 無尽蔵 京都八条家                                       京都駅      3.5 
# ℹ 404 more rows</code></pre>
</div>
</div>
<p>　全く同じ結果ですが、無駄に<code>df2</code>というデータフレームを作らず済むので、メモリの観点からも嬉しいですし、何よりコードが短く、しかも可読性も上がりました。</p>
<p>　今回は<code>==</code>を使って<strong>合致する</strong>ものに絞りましたが、<code>!=</code>を使って<strong>合致しない</strong>ものに絞ることも可能です。または、比較演算子 (<code>&lt;</code>、<code>&gt;</code>、<code>&gt;=</code>、<code>&lt;=</code>など)を使うことも可能です。それでは、組み込み数 (<code>ScoreN</code>)が<em>0ではない</em>ケースを取り出し、<code>Name</code>、<code>Station</code>、<code>ScoreN</code>、<code>Score</code>列を出力させてみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb101-2"><a href="#cb101-2"></a>  <span class="fu">filter</span>(ScoreN <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb101-3"><a href="#cb101-3"></a>  <span class="fu">select</span>(Name, Station, <span class="fu">starts_with</span>(<span class="st">"Score"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,344 × 4
   Name                                              Station       ScoreN Score
   &lt;chr&gt;                                             &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt;
 1 本格上海料理 新錦江 上野御徒町本店                仲御徒町駅         2  4.5 
 2 宴会個室×餃子酒場 北京飯店 秋葉原本店             秋葉原駅           3  3.33
 3 中国料理 宝龍                                     有楽町駅           2  2.5 
 4 麺達 うま家                                       高田馬場駅         2  3   
 5 刀削麺・火鍋・西安料理 XI’AN（シーアン） 後楽園店 後楽園駅           1 NA   
 6 七志らーめん 渋谷道玄坂店                         渋谷駅             7  4.5 
 7 永楽                                              京成小岩駅         6  4.42
 8 よってこや お台場店                               お台場海浜公…      1  4   
 9 ラーメン武藤製麺所                                竹ノ塚駅           4  3.5 
10 桂花ラーメン 新宿末広店                           新宿三丁目駅       8  3   
# ℹ 1,334 more rows</code></pre>
</div>
</div>
<p>　これで口コミ数が1以上の店舗のみに絞ることができました。ただし、店によっては口コミはあっても、評価 (<code>Score</code>)が付いていないところもあります。たとえば、「刀削麺・火鍋・西安料理 XI’AN（シーアン） 後楽園店」の場合、口コミはありますが、評価はありません。したがって、今回は評価が付いている店舗に絞ってみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb103-2"><a href="#cb103-2"></a>  <span class="fu">filter</span>(Score <span class="sc">!=</span> <span class="cn">NA</span>) <span class="sc">|&gt;</span></span>
<span id="cb103-3"><a href="#cb103-3"></a>  <span class="fu">select</span>(Name, Station, <span class="fu">starts_with</span>(<span class="st">"Score"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 4
# ℹ 4 variables: Name &lt;chr&gt;, Station &lt;chr&gt;, ScoreN &lt;dbl&gt;, Score &lt;dbl&gt;</code></pre>
</div>
</div>
<p>　あらら、何の結果も表示されませんでした。これは<code>filter()</code>内の条件に合致するケースが存在しないことを意味します。しかし、先ほどの結果を見ても、評価が付いている店はいっぱいありましたね。これはなぜでしょう。</p>
<p>　察しの良い読者さんは気づいているかと思いますが、第<a href="datatype.html#sec-type-na" class="quarto-xref"><span>9.8</span></a>章で説明した通り、<code>NA</code>か否かを判定する際は<code>==</code>や<code>!=</code>は使えません。<code>is.na()</code>を使います。<code>filter(is.na(Score))</code>なら「<code>Score</code>が<code>NA</code><strong>である</strong>ケースに絞る」ことを意味しますが、今回は「<code>Score</code>が<code>NA</code><strong>でない</strong>ケースに絞る」ことが目的ですので、<code>is.na()</code>の前に<code>!</code>を付けます。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb105-2"><a href="#cb105-2"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Score)) <span class="sc">|&gt;</span></span>
<span id="cb105-3"><a href="#cb105-3"></a>  <span class="fu">select</span>(Name, Station, <span class="fu">starts_with</span>(<span class="st">"Score"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,134 × 4
   Name                                  Station          ScoreN Score
   &lt;chr&gt;                                 &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt;
 1 本格上海料理 新錦江 上野御徒町本店    仲御徒町駅            2  4.5 
 2 宴会個室×餃子酒場 北京飯店 秋葉原本店 秋葉原駅              3  3.33
 3 中国料理 宝龍                         有楽町駅              2  2.5 
 4 麺達 うま家                           高田馬場駅            2  3   
 5 七志らーめん 渋谷道玄坂店             渋谷駅                7  4.5 
 6 永楽                                  京成小岩駅            6  4.42
 7 よってこや お台場店                   お台場海浜公園駅      1  4   
 8 ラーメン武藤製麺所                    竹ノ塚駅              4  3.5 
 9 桂花ラーメン 新宿末広店               新宿三丁目駅          8  3   
10 北斗 新橋店                           新橋駅                4  2.5 
# ℹ 1,124 more rows</code></pre>
</div>
</div>
<p>　これで口コミ評価が登録された店舗に絞ることができました。</p>
<p>　続いて、複数の条件を持つケースを考えてみましょう。例えば、「京都府内の店舗で、口コミ評価が3.5以上の店舗」を出力したい場合、以下のようなコードとなります。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb107-2"><a href="#cb107-2"></a>  <span class="fu">filter</span>(Pref <span class="sc">==</span> <span class="st">"京都府"</span>, Score <span class="sc">&gt;=</span> <span class="fl">3.5</span>) <span class="sc">|&gt;</span></span>
<span id="cb107-3"><a href="#cb107-3"></a>  <span class="fu">select</span>(Name, Station, ScoreN, Score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53 × 4
   Name               Station    ScoreN Score
   &lt;chr&gt;              &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
 1 無尽蔵 京都八条家  京都駅          2  3.5 
 2 一蘭 京都河原町店  河原町駅        2  3.75
 3 ミスター・ギョーザ 西大路駅        8  4.06
 4 一蘭 京都八幡店    樟葉駅          3  4   
 5 中華料理 清華園    京都駅          3  5   
 6 まがり             &lt;NA&gt;            2  4   
 7 魁力屋 北山店      北大路駅        2  4.25
 8 大中BAL横店        &lt;NA&gt;            7  4.1 
 9 こうちゃん         西舞鶴駅        1  5   
10 大黒ラーメン       伏見桃山駅      4  4.25
# ℹ 43 more rows</code></pre>
</div>
</div>
<p>　条件を<code>filter()</code>内に追加するだけです。今回は<code>!is.na(Score)</code>は不要です。なぜなら、<code>Score &gt;= 3.5</code>という条件で既に欠損値は対象外になるからです。条件文が複数ある場合、ANDかORかを指定する必要があります。つまり、条件文AとBがある場合、「AとB両方満たすものを出力する」か「AとBどちらかを満たすものを出力するか」を指定する必要があります。今の結果ってANDでしたよね。<code>filter()</code>関数は、別途の指定がない場合、全てAND扱いになります。RのAND演算子は<code>&amp;</code>ですので、以上のコードは以下のコードと同じです。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb109-2"><a href="#cb109-2"></a>  <span class="fu">filter</span>(Pref <span class="sc">==</span> <span class="st">"京都府"</span> <span class="sc">&amp;</span> Score <span class="sc">&gt;=</span> <span class="fl">3.5</span>) <span class="sc">|&gt;</span></span>
<span id="cb109-3"><a href="#cb109-3"></a>  <span class="fu">select</span>(Name, Station, ScoreN, Score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53 × 4
   Name               Station    ScoreN Score
   &lt;chr&gt;              &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
 1 無尽蔵 京都八条家  京都駅          2  3.5 
 2 一蘭 京都河原町店  河原町駅        2  3.75
 3 ミスター・ギョーザ 西大路駅        8  4.06
 4 一蘭 京都八幡店    樟葉駅          3  4   
 5 中華料理 清華園    京都駅          3  5   
 6 まがり             &lt;NA&gt;            2  4   
 7 魁力屋 北山店      北大路駅        2  4.25
 8 大中BAL横店        &lt;NA&gt;            7  4.1 
 9 こうちゃん         西舞鶴駅        1  5   
10 大黒ラーメン       伏見桃山駅      4  4.25
# ℹ 43 more rows</code></pre>
</div>
</div>
<p>　AND演算子 (<code>&amp;</code>)が使えるということはOR演算子 (<code>|</code>)も使えることを意味します。たとえば、<code>Station</code>が<code>"高田馬場駅"</code>か<code>"三田駅"</code>の条件を指定したい場合、</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb111-2"><a href="#cb111-2"></a>  <span class="fu">filter</span>(Station <span class="sc">==</span> <span class="st">"高田馬場駅"</span> <span class="sc">|</span> Station <span class="sc">==</span> <span class="st">"三田駅"</span>) <span class="sc">|&gt;</span></span>
<span id="cb111-3"><a href="#cb111-3"></a>  <span class="fu">select</span>(Name, Station, ScoreN, Score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 4
   Name                                 Station    ScoreN Score
   &lt;chr&gt;                                &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
 1 麺達 うま家                          高田馬場駅      2  3   
 2 らぁ麺 やまぐち                      高田馬場駅      7  4.08
 3 博多一瑞亭 三田店                    三田駅          0 NA   
 4 つけ麺屋 ひまわり                    高田馬場駅      4  2.75
 5 石器ラーメン 高田馬場                高田馬場駅      0 NA   
 6 旨辛らーめん 表裏                    高田馬場駅      0 NA   
 7 三歩一                               高田馬場駅      8  4.56
 8 えぞ菊 戸塚店                        高田馬場駅      4  3.62
 9 麺屋　宗                             高田馬場駅      5  4.2 
10 とんこつラーメン 博多風龍 高田馬場店 高田馬場駅      2  3   
11 横浜家系ラーメン 馬場壱家            高田馬場駅      0 NA   
12 らーめん よし丸                      高田馬場駅      1  5   
13 札幌ラーメン どさん子 三田店         三田駅          0 NA   
14 天下一品 三田店                      三田駅          0 NA   </code></pre>
</div>
</div>
<p>のように書きます（ちなみに高田馬場の「やまぐち」は本当に美味しいです）。むろん、複数の変数を用いたORも可能です。たとえば、「<code>Pref</code>が<code>"京都府"</code>か<code>Score</code>が3以上」のような条件も可能ですが (<code>Pref == "京都府" | Score &gt;= 3</code>)、実際、このような例はあまりありません。よく使うのは「変数<code>X</code>が<code>a</code>か<code>b</code>か<code>c</code>か」のような例です。ただし、この場合は<code>|</code>を使わないもっと簡単な方法があります。それは第<a href="programming.html#sec-programming_condition" class="quarto-xref"><span>11.4</span></a>章で紹介した<code>%in%</code>演算子です。以下のコードは上のコードと同じものです。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb113-2"><a href="#cb113-2"></a>  <span class="fu">filter</span>(Station <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"高田馬場駅"</span>, <span class="st">"三田駅"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb113-3"><a href="#cb113-3"></a>  <span class="fu">select</span>(Name, Station, ScoreN, Score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 4
   Name                                 Station    ScoreN Score
   &lt;chr&gt;                                &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
 1 麺達 うま家                          高田馬場駅      2  3   
 2 らぁ麺 やまぐち                      高田馬場駅      7  4.08
 3 博多一瑞亭 三田店                    三田駅          0 NA   
 4 つけ麺屋 ひまわり                    高田馬場駅      4  2.75
 5 石器ラーメン 高田馬場                高田馬場駅      0 NA   
 6 旨辛らーめん 表裏                    高田馬場駅      0 NA   
 7 三歩一                               高田馬場駅      8  4.56
 8 えぞ菊 戸塚店                        高田馬場駅      4  3.62
 9 麺屋　宗                             高田馬場駅      5  4.2 
10 とんこつラーメン 博多風龍 高田馬場店 高田馬場駅      2  3   
11 横浜家系ラーメン 馬場壱家            高田馬場駅      0 NA   
12 らーめん よし丸                      高田馬場駅      1  5   
13 札幌ラーメン どさん子 三田店         三田駅          0 NA   
14 天下一品 三田店                      三田駅          0 NA   </code></pre>
</div>
</div>
<p>　結局、<code>|</code>が使われるケースがかなり限定されます。あるとすれば、「変数<code>X</code>が<code>a</code>以下か、<code>b</code>以上か」のようなケースですね。ただし、<code>&amp;</code>と<code>|</code>を同時に使うケースは考えられます。たとえば、大阪駅と京都駅周辺のうまいラーメン屋を調べるとします。問題は美味しさの基準ですが、3.5点以上としましょう。ただし、京都府民はラーメンに非常に厳しく、3点以上なら美味しいと仮定します。この場合、「(<code>Station</code>が<code>"大阪駅"</code>かつ<code>Score &gt;= 3.5</code>)、または(<code>Station</code>が<code>"京都駅"</code>かつ<code>Score &gt;= 3</code>)」のような条件が必要になります。<code>()</code>は「<code>()</code>の中から判定せよ」という、普通の算数での使い方と同じです。それでは、実際に検索してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb115-2"><a href="#cb115-2"></a>  <span class="fu">filter</span>((Station <span class="sc">==</span> <span class="st">"大阪駅"</span> <span class="sc">&amp;</span> Score <span class="sc">&gt;=</span> <span class="fl">3.5</span>) <span class="sc">|</span> (Station <span class="sc">==</span> <span class="st">"京都駅"</span> <span class="sc">&amp;</span> Score <span class="sc">&gt;=</span> <span class="dv">3</span>)) <span class="sc">|&gt;</span></span>
<span id="cb115-3"><a href="#cb115-3"></a>  <span class="fu">select</span>(Name, Station, Walk, ScoreN, Score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  Name                      Station  Walk ScoreN Score
  &lt;chr&gt;                     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 Lei can ting 大阪ルクア店 大阪駅      3      3  4   
2 神座 ルクア大阪店         大阪駅      1     10  3.94
3 みつか坊主 醸             大阪駅     10      4  5   
4 無尽蔵 京都八条家         京都駅      5      2  3.5 
5 中華料理 清華園           京都駅     10      3  5   
6 ますたに 京都拉麺小路店   京都駅      9      3  3.67</code></pre>
</div>
</div>
<p>　Songが大好きな神座がヒットして嬉しいです。</p>
</section>
</section>
<section id="sec-handling1-arrange" class="level2" data-number="13.5">
<h2 data-number="13.5" class="anchored" data-anchor-id="sec-handling1-arrange"><span class="header-section-number">13.5</span> 行のソート</h2>
<p>　続いて、行のソートについて解説します。「食べログ」などのレビューサービスを利用する場合、口コミ評価が高い順で見るのが一般的でしょう<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>。また、サッカーのランキングも多くは1位から下の順位で掲載されるのが一般的です。ここではこのようにある変数の値順に行を並び替える方法について説明します。</p>
<p>　ソートには{dplyr}パッケージの<code>arrange()</code>関数を使います。引数は変数名のみです。たとえば、奈良県のラーメン屋を検索してみましょう。並び替える順は駅から近い店舗を上位に、遠い店舗を下位に並べます。このような順は<strong>昇順 (ascending)</strong>と呼ばれ、ランキング表などでよく見ます。駅から近い順にソートするので、まず最寄りの駅情報が欠損でないことが必要です。また、ラーメン屋の評価も気になるので口コミが1つ以上付いている店舗に絞りましょう。表示する列は店舗名、最寄りの駅、徒歩距離、口コミ数、点数です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb117-2"><a href="#cb117-2"></a>  <span class="fu">filter</span>(Pref <span class="sc">==</span> <span class="st">"奈良県"</span>, <span class="sc">!</span><span class="fu">is.na</span>(Station), ScoreN <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb117-3"><a href="#cb117-3"></a>  <span class="fu">select</span>(Name, Station, Walk, ScoreN, Score) <span class="sc">|&gt;</span></span>
<span id="cb117-4"><a href="#cb117-4"></a>  <span class="fu">arrange</span>(Walk) <span class="sc">|&gt;</span></span>
<span id="cb117-5"><a href="#cb117-5"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 5
   Name                                  Station             Walk ScoreN Score
   &lt;chr&gt;                                 &lt;chr&gt;              &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
 1 麺屋 あまのじゃく 本店                富雄駅                 2      2  4.5 
 2 紀州和歌山らーめんきぶんや 奈良富雄店 富雄駅                 4      1  4   
 3 ラーメン家 みつ葉                     富雄駅                 4      1  3.5 
 4 天下一品 新大宮店                     新大宮駅               6      1  3   
 5 麺屋 一徳                             天理駅                 7      1  3   
 6 丸源ラーメン 橿原店                   金橋駅                 8      1  3.5 
 7 らーめん食堂 よってこや 平群店        元山上口駅            10      1  4   
 8 天理スタミナラーメン本店              櫟本駅                11      2  3.25
 9 博多長浜らーめん夢街道 奈良土橋店     真菅駅                11      1  3.5 
10 ぶ～け                                奈良駅                11      1  5   
11 つけめん らーめん元喜神 押熊店        学研奈良登美ヶ丘駅    12      4  4.12
12 彩華ラーメン 本店                     前栽駅                12      5  3.6 
13 力皇                                  天理駅                13      1  3.5 
14 らーめん きみちゃん                   京終駅                14      2  4.5 
15 無鉄砲がむしゃら                      帯解駅                15      2  4   
16 彩華ラーメン 田原本店                 石見駅                15      1  4   
17 神座 大和高田店                       大和高田駅            17      2  3.75
18 彩華ラーメン 奈良店                   尼ヶ辻駅              17      3  4.33
19 彩華ラーメン 桜井店                   大福駅                18      1  3   
20 天下一品 東生駒店                     東生駒駅              19      1  3.5 
21 まりお流ラーメン                      新大宮駅              20      1  5   
22 どうとんぼり神座 奈良柏木店           西ノ京駅              22      1  3   
23 河童ラーメン本舗 押熊店               学研奈良登美ヶ丘駅    28      1  4   
24 博多長浜らーめん 夢街道 四条大路店    新大宮駅              29      4  2.88</code></pre>
</div>
</div>
<p>　3行まではこれまで習ってきたもので、4行目がソートの関数、<code>arrange()</code>です。引数はソートの基準となる変数で、今回は最寄りの駅からの徒歩距離を表す<code>Walk</code>です。5行目は省略可能ですが、<code>tibble</code>クラスの場合、10行までしか出力されないので、<code>print(n = Inf)</code>で「すべての行を表示」させます。<code>n</code>を指定することで出力される行数が調整可能です。奈良県のラーメン屋の中で最寄りの駅から最も近い店は「<a href="https://www.menya-amanojaku.com">麺屋 あまのじゃく 本店</a>」で徒歩2分でした。京田辺店も駅から約2分ですし、近いですね。ちなみにSongはここの塩とんこつが好きです。世界一こってりなラーメンとも言われる「チョモランマ」で有名な「<a href="http://www.marioramen.com">まりお流ラーメン</a>」は新大宮駅から徒歩20分でかなり遠いことが分かります。</p>
<p>　続いて、駅からの距離ではなく、評価が高い順にしてみましょう。評価が高いほど上に来るので、今回は昇順でなく、<strong>降順 (descending)</strong>でソートする必要があります。<code>arrange()</code>関数は基本的に、指定された変数を基準に昇順でソートします。降順にするためには<code>desc()</code>関数を更に用います。たとえば、<code>arrange(desc(変数名))</code>のようにです。それでは実際にやってみましょう。上のコードの4行目を<code>arange(Walk)</code>から<code>arrange(desc(Score))</code>にちょっと修正するだけです。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb119-2"><a href="#cb119-2"></a>  <span class="fu">filter</span>(Pref <span class="sc">==</span> <span class="st">"奈良県"</span>, <span class="sc">!</span><span class="fu">is.na</span>(Station), ScoreN <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb119-3"><a href="#cb119-3"></a>  <span class="fu">select</span>(Name, Station, Walk, ScoreN, Score) <span class="sc">|&gt;</span></span>
<span id="cb119-4"><a href="#cb119-4"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Score)) <span class="sc">|&gt;</span></span>
<span id="cb119-5"><a href="#cb119-5"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 5
   Name                                  Station             Walk ScoreN Score
   &lt;chr&gt;                                 &lt;chr&gt;              &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
 1 まりお流ラーメン                      新大宮駅              20      1  5   
 2 ぶ～け                                奈良駅                11      1  5   
 3 麺屋 あまのじゃく 本店                富雄駅                 2      2  4.5 
 4 らーめん きみちゃん                   京終駅                14      2  4.5 
 5 彩華ラーメン 奈良店                   尼ヶ辻駅              17      3  4.33
 6 つけめん らーめん元喜神 押熊店        学研奈良登美ヶ丘駅    12      4  4.12
 7 河童ラーメン本舗 押熊店               学研奈良登美ヶ丘駅    28      1  4   
 8 無鉄砲がむしゃら                      帯解駅                15      2  4   
 9 紀州和歌山らーめんきぶんや 奈良富雄店 富雄駅                 4      1  4   
10 彩華ラーメン 田原本店                 石見駅                15      1  4   
11 らーめん食堂 よってこや 平群店        元山上口駅            10      1  4   
12 神座 大和高田店                       大和高田駅            17      2  3.75
13 彩華ラーメン 本店                     前栽駅                12      5  3.6 
14 天下一品 東生駒店                     東生駒駅              19      1  3.5 
15 力皇                                  天理駅                13      1  3.5 
16 博多長浜らーめん夢街道 奈良土橋店     真菅駅                11      1  3.5 
17 ラーメン家 みつ葉                     富雄駅                 4      1  3.5 
18 丸源ラーメン 橿原店                   金橋駅                 8      1  3.5 
19 天理スタミナラーメン本店              櫟本駅                11      2  3.25
20 麺屋 一徳                             天理駅                 7      1  3   
21 どうとんぼり神座 奈良柏木店           西ノ京駅              22      1  3   
22 彩華ラーメン 桜井店                   大福駅                18      1  3   
23 天下一品 新大宮店                     新大宮駅               6      1  3   
24 博多長浜らーめん 夢街道 四条大路店    新大宮駅              29      4  2.88</code></pre>
</div>
</div>
<p>　よく考えてみれば、「評価が同点の場合、どうなるの?」と疑問を抱く方がいるかも知れません。たとえば、7行目の「河童ラーメン本舗 押熊店」と8行目の「無鉄砲がむしゃら」はどれも評価が4点ですが、「河童ラーメン本舗 押熊店」が先に表示されます。そのこれは簡単です。同点の場合、データセット内で上に位置する行が先に表示されます。これを確認するには<code>which()</code>関数を使います。<code>()</code>内に条件文を指定することで、この条件に合致する要素の位置を返します。もし、条件に合致するものが複数あった場合は全ての位置を返します<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a><span class="fu">which</span>(df<span class="sc">$</span>Name <span class="sc">==</span> <span class="st">"河童ラーメン本舗 押熊店"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6021</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1"></a><span class="fu">which</span>(df<span class="sc">$</span>Name <span class="sc">==</span> <span class="st">"無鉄砲がむしゃら"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6040</code></pre>
</div>
</div>
<p>　データ内に「河童ラーメン本舗 押熊店」がより上に位置することが分かります。「もし同点なら口コミ評価数が多いところにしたい」場合はどうすれば良いでしょうか。これは<code>arrange()</code>内に変数名を足すだけで十分です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb125-2"><a href="#cb125-2"></a>  <span class="fu">filter</span>(Pref <span class="sc">==</span> <span class="st">"奈良県"</span>, <span class="sc">!</span><span class="fu">is.na</span>(Station), ScoreN <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb125-3"><a href="#cb125-3"></a>  <span class="fu">select</span>(Name, Station, Walk, ScoreN, Score) <span class="sc">|&gt;</span></span>
<span id="cb125-4"><a href="#cb125-4"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Score), <span class="fu">desc</span>(ScoreN)) <span class="sc">|&gt;</span></span>
<span id="cb125-5"><a href="#cb125-5"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 5
   Name                                  Station             Walk ScoreN Score
   &lt;chr&gt;                                 &lt;chr&gt;              &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
 1 まりお流ラーメン                      新大宮駅              20      1  5   
 2 ぶ～け                                奈良駅                11      1  5   
 3 麺屋 あまのじゃく 本店                富雄駅                 2      2  4.5 
 4 らーめん きみちゃん                   京終駅                14      2  4.5 
 5 彩華ラーメン 奈良店                   尼ヶ辻駅              17      3  4.33
 6 つけめん らーめん元喜神 押熊店        学研奈良登美ヶ丘駅    12      4  4.12
 7 無鉄砲がむしゃら                      帯解駅                15      2  4   
 8 河童ラーメン本舗 押熊店               学研奈良登美ヶ丘駅    28      1  4   
 9 紀州和歌山らーめんきぶんや 奈良富雄店 富雄駅                 4      1  4   
10 彩華ラーメン 田原本店                 石見駅                15      1  4   
11 らーめん食堂 よってこや 平群店        元山上口駅            10      1  4   
12 神座 大和高田店                       大和高田駅            17      2  3.75
13 彩華ラーメン 本店                     前栽駅                12      5  3.6 
14 天下一品 東生駒店                     東生駒駅              19      1  3.5 
15 力皇                                  天理駅                13      1  3.5 
16 博多長浜らーめん夢街道 奈良土橋店     真菅駅                11      1  3.5 
17 ラーメン家 みつ葉                     富雄駅                 4      1  3.5 
18 丸源ラーメン 橿原店                   金橋駅                 8      1  3.5 
19 天理スタミナラーメン本店              櫟本駅                11      2  3.25
20 麺屋 一徳                             天理駅                 7      1  3   
21 どうとんぼり神座 奈良柏木店           西ノ京駅              22      1  3   
22 彩華ラーメン 桜井店                   大福駅                18      1  3   
23 天下一品 新大宮店                     新大宮駅               6      1  3   
24 博多長浜らーめん 夢街道 四条大路店    新大宮駅              29      4  2.88</code></pre>
</div>
</div>
<p>　ソートの基準は<code>arrange()</code>内において先に指定された変数の順番となります。「口コミ評価も評価数も同じなら、駅から近いところにしたい」場合は変数が3つとなり、<code>Score</code>、<code>ScoreN</code>、<code>Walk</code>の順で入れます。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode numberSource r numberLines code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb127-2"><a href="#cb127-2"></a>  <span class="fu">filter</span>(Pref <span class="sc">==</span> <span class="st">"奈良県"</span>, <span class="sc">!</span><span class="fu">is.na</span>(Station), ScoreN <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb127-3"><a href="#cb127-3"></a>  <span class="fu">select</span>(Name, Station, Walk, ScoreN, Score) <span class="sc">|&gt;</span></span>
<span id="cb127-4"><a href="#cb127-4"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Score), <span class="fu">desc</span>(ScoreN), Walk) <span class="sc">|&gt;</span></span>
<span id="cb127-5"><a href="#cb127-5"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 5
   Name                                  Station             Walk ScoreN Score
   &lt;chr&gt;                                 &lt;chr&gt;              &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
 1 ぶ～け                                奈良駅                11      1  5   
 2 まりお流ラーメン                      新大宮駅              20      1  5   
 3 麺屋 あまのじゃく 本店                富雄駅                 2      2  4.5 
 4 らーめん きみちゃん                   京終駅                14      2  4.5 
 5 彩華ラーメン 奈良店                   尼ヶ辻駅              17      3  4.33
 6 つけめん らーめん元喜神 押熊店        学研奈良登美ヶ丘駅    12      4  4.12
 7 無鉄砲がむしゃら                      帯解駅                15      2  4   
 8 紀州和歌山らーめんきぶんや 奈良富雄店 富雄駅                 4      1  4   
 9 らーめん食堂 よってこや 平群店        元山上口駅            10      1  4   
10 彩華ラーメン 田原本店                 石見駅                15      1  4   
11 河童ラーメン本舗 押熊店               学研奈良登美ヶ丘駅    28      1  4   
12 神座 大和高田店                       大和高田駅            17      2  3.75
13 彩華ラーメン 本店                     前栽駅                12      5  3.6 
14 ラーメン家 みつ葉                     富雄駅                 4      1  3.5 
15 丸源ラーメン 橿原店                   金橋駅                 8      1  3.5 
16 博多長浜らーめん夢街道 奈良土橋店     真菅駅                11      1  3.5 
17 力皇                                  天理駅                13      1  3.5 
18 天下一品 東生駒店                     東生駒駅              19      1  3.5 
19 天理スタミナラーメン本店              櫟本駅                11      2  3.25
20 天下一品 新大宮店                     新大宮駅               6      1  3   
21 麺屋 一徳                             天理駅                 7      1  3   
22 彩華ラーメン 桜井店                   大福駅                18      1  3   
23 どうとんぼり神座 奈良柏木店           西ノ京駅              22      1  3   
24 博多長浜らーめん 夢街道 四条大路店    新大宮駅              29      4  2.88</code></pre>
</div>
</div>


</section>
<aside id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>逆にいうと、最終結果だけでなく、<code>結果1</code>や<code>結果2</code>も今後使うのであれば、このような書き方でも良いでしょう。<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>実は<code>select(starts_with("X"), -ends_with("D"), ID)</code>のように順番を変えると<code>ID</code>は最後の列になりますが、とりあえず残ります。なぜなら、<code>select()</code>関数は左側から右側の方へコードを実行するからです。<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>実は<code>select.df[, c(2, 8, 9)]</code>でも前後にパイプ演算子を使うことは可能ですが、コードが読みにくくなるため、推奨しません。<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>サービスによってはこの機能が有料になっていたりもしますね。<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>たとえば、データ内に「ラーメンショップ」という店舗は3店舗あり、この場合、長さ3のベクトルが返されます。<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</aside>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        console.log("RESIZE");
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp("https:\/\/www\.jaysong\.net\/RBook\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./functions.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">関数の自作</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./datahandling2.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">データハンドリング [要約]</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2023, <a href="https://www.jaysong.net">Jaehyun Song</a> and <a href="https://yukiyanai.github.io/">Yuki Yanai</a></p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>