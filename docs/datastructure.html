<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>10&nbsp; データ構造 – 私たちのR</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./programming.html" rel="next">
<link href="./datatype.html" rel="prev">
<link href="./Figs/favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-CEHS4C056W"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-CEHS4C056W', { 'anonymize_ip': false});
</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&amp;display=swap" rel="stylesheet"> 
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Mono&amp;display=swap" rel="stylesheet"> 

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="私たちのR: ベストプラクティスの探求">
<meta property="og:description" content="R Not for Everyone: An Esoteric Guide">
<meta property="og:image" content="https://www.jaysong.net/RBook/Figs/favicon.png">
<meta property="og:site_name" content="私たちのR">
<meta property="og:image:height" content="260">
<meta property="og:image:width" content="260">
<meta name="twitter:title" content="私たちのR: ベストプラクティスの探求">
<meta name="twitter:description" content="R Not for Everyone: An Esoteric Guide">
<meta name="twitter:image" content="https://www.jaysong.net/RBook/Figs/favicon.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:image-height" content="260">
<meta name="twitter:image-width" content="260">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./project.html">Rの基礎</a></li><li class="breadcrumb-item"><a href="./datastructure.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">データ構造</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">私たちのR</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/JaehyunSong/RBook/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">紹介</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Rの導入</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./aboutr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">R?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./installation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Rのインストール</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">IDEの導入</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r_customize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">分析環境のカスタマイズ</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Rパッケージ</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Rの基礎</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">プロジェクト管理</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r_basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">基本的な操作</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./io.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">データの入出力</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datatype.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">データ型</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datastructure.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">データ構造</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Rプログラミングの基礎</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">関数の自作</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">データハンドリング</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datahandling1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">データハンドリング [抽出]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datahandling2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">データハンドリング [要約]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datahandling3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">データハンドリング [拡張]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./factor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">データハンドリング [factor型]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tidydata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">整然データ構造</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./string.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">文字列の処理</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">可視化</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualization1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">可視化 [理論]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualization2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">可視化 [基礎]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualization3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">可視化 [応用]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualization4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">可視化 [発展]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./table.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">表の作成</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">再現可能な研究</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Quarto [基礎]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Quarto [文書]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Quarto [スライド]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Quarto [発展]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./renv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">分析環境の管理</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">中級者向け</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iteration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">反復処理</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./oop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">オブジェクト指向プログラミング</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./monte.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">モンテカルロ・シミュレーション</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">スクレイピング</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">付録</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dataset.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">データセット</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./filesystem.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">ファイルシステム</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tips.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">R Tips</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">本書の執筆環境</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">参考文献</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rmarkdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">R Markdown [基礎]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rmarkdown2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">R Markdown [応用]</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Quarto入門</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目次</h2>
   
  <ul>
  <li><a href="#sec-datastructure_intro" id="toc-sec-datastructure_intro" class="nav-link active" data-scroll-target="#sec-datastructure_intro"><span class="header-section-number">10.1</span> データ構造とは</a></li>
  <li><a href="#sec-datastructure_vector" id="toc-sec-datastructure_vector" class="nav-link" data-scroll-target="#sec-datastructure_vector"><span class="header-section-number">10.2</span> ベクトル (vector)</a>
  <ul class="collapse">
  <li><a href="#ベクトルの作り方" id="toc-ベクトルの作り方" class="nav-link" data-scroll-target="#ベクトルの作り方"><span class="header-section-number">10.2.1</span> ベクトルの作り方</a></li>
  <li><a href="#ベクトルの操作" id="toc-ベクトルの操作" class="nav-link" data-scroll-target="#ベクトルの操作"><span class="header-section-number">10.2.2</span> ベクトルの操作</a></li>
  </ul></li>
  <li><a href="#sec-datastructure_matrix" id="toc-sec-datastructure_matrix" class="nav-link" data-scroll-target="#sec-datastructure_matrix"><span class="header-section-number">10.3</span> 行列 (matrix)</a>
  <ul class="collapse">
  <li><a href="#行列の作り方" id="toc-行列の作り方" class="nav-link" data-scroll-target="#行列の作り方"><span class="header-section-number">10.3.1</span> 行列の作り方</a></li>
  <li><a href="#行列の操作" id="toc-行列の操作" class="nav-link" data-scroll-target="#行列の操作"><span class="header-section-number">10.3.2</span> 行列の操作</a></li>
  </ul></li>
  <li><a href="#sec-datastructure-dataframe" id="toc-sec-datastructure-dataframe" class="nav-link" data-scroll-target="#sec-datastructure-dataframe"><span class="header-section-number">10.4</span> データフレーム (data.frame)</a>
  <ul class="collapse">
  <li><a href="#データフレームの作成" id="toc-データフレームの作成" class="nav-link" data-scroll-target="#データフレームの作成"><span class="header-section-number">10.4.1</span> データフレームの作成</a></li>
  <li><a href="#データフレームの操作" id="toc-データフレームの操作" class="nav-link" data-scroll-target="#データフレームの操作"><span class="header-section-number">10.4.2</span> データフレームの操作</a></li>
  <li><a href="#tibble型" id="toc-tibble型" class="nav-link" data-scroll-target="#tibble型"><span class="header-section-number">10.4.3</span> tibble型</a></li>
  </ul></li>
  <li><a href="#sec-datastructure_list" id="toc-sec-datastructure_list" class="nav-link" data-scroll-target="#sec-datastructure_list"><span class="header-section-number">10.5</span> リスト (list)</a>
  <ul class="collapse">
  <li><a href="#リスト型データの作成" id="toc-リスト型データの作成" class="nav-link" data-scroll-target="#リスト型データの作成"><span class="header-section-number">10.5.1</span> リスト型データの作成</a></li>
  <li><a href="#リスト型データの操作" id="toc-リスト型データの操作" class="nav-link" data-scroll-target="#リスト型データの操作"><span class="header-section-number">10.5.2</span> リスト型データの操作</a></li>
  </ul></li>
  <li><a href="#sec-datastructure_array" id="toc-sec-datastructure_array" class="nav-link" data-scroll-target="#sec-datastructure_array"><span class="header-section-number">10.6</span> 配列 (array)</a>
  <ul class="collapse">
  <li><a href="#配列型データの作成" id="toc-配列型データの作成" class="nav-link" data-scroll-target="#配列型データの作成"><span class="header-section-number">10.6.1</span> 配列型データの作成</a></li>
  <li><a href="#配列型データの操作" id="toc-配列型データの操作" class="nav-link" data-scroll-target="#配列型データの操作"><span class="header-section-number">10.6.2</span> 配列型データの操作</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./project.html">Rの基礎</a></li><li class="breadcrumb-item"><a href="./datastructure.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">データ構造</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-datastructure" class="quarto-section-identifier"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">データ構造</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="sec-datastructure_intro" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="sec-datastructure_intro"><span class="header-section-number">10.1</span> データ構造とは</h2>
<p>データ構造 (data structure)とは最小単位であるベクトルを何らかの形で集めたものです。ベクトル自体もデータ構造であり、同じデータ型のベクトルを積み重ねた行列、異なるデータ型の縦ベクトルを横に並べたデータフレームなど、Rでは様々なデータ構造を提供しています。また、R内臓のデータ構造以外にも、パッケージ等で提供される独自のデータ構造もあります。ここではRが基本的に提供している代表的なデータ構造について、その作り方と操作方法について解説します。</p>
</section>
<section id="sec-datastructure_vector" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="sec-datastructure_vector"><span class="header-section-number">10.2</span> ベクトル (vector)</h2>
<section id="ベクトルの作り方" class="level3" data-number="10.2.1">
<h3 data-number="10.2.1" class="anchored" data-anchor-id="ベクトルの作り方"><span class="header-section-number">10.2.1</span> ベクトルの作り方</h3>
<p>Rにおいてベクトルとは<strong>同じデータ型が一つ以上格納されているオブジェクト</strong>を意味します。たとえば、以下の<code>myVec1</code>は長さ1のベクトルです。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>myVec1 <span class="ot">&lt;-</span> <span class="st">"R is fun!"</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>myVec1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "R is fun!"</code></pre>
</div>
</div>
<p>むろん、2つ以上の文字列、または数字を格納することも可能です。以下の<code>myVec2</code>は長さ5のベクトルです。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>myVec2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a>myVec2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 3 5 6 7</code></pre>
</div>
</div>
<p>注意すべきところは、ベクトル内の要素は必ず同じデータ型である必要があるということです。たとえば、数字と文字が混在した<code>myVec3</code>を考えてみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>myVec3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a>myVec3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "A" "B" "C" "1" "2" "3"</code></pre>
</div>
</div>
<p>数字であるはずの1, 2, 3が<code>"</code>で囲まれ、文字列に自動的に変換されていることが分かります。実際に、デーが型を確認してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">class</span>(myVec3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
</div>
<p><code>"character"</code>、つまりデータ型が文字列になっていることが分かります。これは<code>character</code>型が<code>numeric</code>型よりも優先順位が高いからです。それでは<code>numeric</code>と<code>logical</code>型はどうでしょうか。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>myVec4 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a>myVec4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 1 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">class</span>(myVec4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
</div>
<p><code>TRUE</code>が1、<code>FALSE</code>が0となり、自動的に<code>numeric</code>型になりました。一般的によく使われるデータ型は<code>logical</code>、<code>numeric</code>、<code>character</code>ですが、優先順位は<code>logical &lt; numeric &lt; character</code>の関係になります。ここで重要なのは優先順位ではなく、異なるデータ型が含まれるベクトルの場合、自動的にデータ型が統一されるということです。ベクトルを作成する際は、全ての要素が同じ型になるようにしましょう。</p>
</section>
<section id="ベクトルの操作" class="level3" data-number="10.2.2">
<h3 data-number="10.2.2" class="anchored" data-anchor-id="ベクトルの操作"><span class="header-section-number">10.2.2</span> ベクトルの操作</h3>
<p><strong>ベクトルの長さ</strong></p>
<p>ベクトルの長さはベクトルに含まれている要素の数です。ベクトルの長さは<code>length()</code>関数で調べることができます。それでは前節で作成した4つのベクトルの長さを調べてみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">length</span>(myVec1) <span class="co"># "R is fun!"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">length</span>(myVec2) <span class="co"># c(1, 3, 5, 6, 7)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">length</span>(myVec3) <span class="co"># c("A", "B", "C", "1", "2", "3")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">length</span>(myVec4) <span class="co"># c(1, 2, 3, 1, 0)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
</div>
<p>それぞれのベクトルの長さは1、5、6、5ということが分かりますね。</p>
<p><strong>要素の抽出</strong></p>
<p>これは既に説明しましたので、第<a href="r_basic.html#sec-rbasic-extract" class="quarto-xref"><span>7.3</span></a>を参照してください。</p>
<p><strong>ベクトルの加減乗除</strong></p>
<p>ここではnumeric型のベクトルを用いた加減乗除について考えたいと思います。Rにおいてベクトルは自動的に反復作業を行います。たとえば、<code>c(1, 2, 3, 4)</code>というベクトルがあり、ここに5を足すと、ベクトルの全ての要素に対して同じ計算を行います。これは引き算でも、掛け算でも、割り算でも同じです。むろん、べき乗などの様々な操作に対しても同じです。それでは<code>myVec2</code>に対して、5を足したり、引いたり、色々してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>myVec2 <span class="sc">+</span> <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  6  8 10 11 12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>myVec2 <span class="sc">-</span> <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -4 -2  0  1  2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>myVec2 <span class="sc">*</span> <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  5 15 25 30 35</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>myVec2 <span class="sc">/</span> <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2 0.6 1.0 1.2 1.4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>myVec2 <span class="sc">^</span> <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]     1   243  3125  7776 16807</code></pre>
</div>
</div>
<p>また、ベクトル同士の演算も可能です。まず、<code>myVec2</code>と同じ長さを持つ<code>myVec4</code>との計算を考えてみましょう。これは長さが同じであるため、それぞれ同じ位置の要素同士の計算となります。つまり、足し算の場合、<code>myVec2[1]</code>と<code>myVec4[1]</code>の和、<code>myVec2[2]</code>と<code>myVec4[2]</code>の和、…といった形です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>myVec2 <span class="sc">+</span> myVec4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2 5 8 7 7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>myVec2 <span class="sc">-</span> myVec4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 1 2 5 7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>myVec2 <span class="sc">*</span> myVec4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1  6 15  6  0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>myVec2 <span class="sc">/</span> myVec4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000000 1.500000 1.666667 6.000000      Inf</code></pre>
</div>
</div>
<p>もし、ベクトルの長さが異なる場合はどうなるでしょう。たとえば、長さ2のベクトル<code>myVec5</code>と<code>myVec2</code>の足し算を考えてみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>(myVec5 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1 10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>(myVec6 <span class="ot">&lt;-</span> myVec2 <span class="sc">+</span> myVec5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in myVec2 + myVec5: longer object length is not a multiple of shorter
object length</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  2 13  6 16  8</code></pre>
</div>
</div>
<p>警告メッセージは表示されますが、計算自体はできます。同じ長さのベクトル同士なら、同じ位置の要素同士の計算になりますが、この場合は、短い方のベクトルを繰り返すことにより、長さを合わせることになります。<code>myVec5</code>の例だと、<code>c(1, 10, 1, 10, 1)</code>のように扱われます。具体的には以下の表のような関係となります。</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;"><code>myVec6[1]</code></th>
<th style="text-align: center;"><code>myVec6[2]</code></th>
<th style="text-align: center;"><code>myVec6[3]</code></th>
<th style="text-align: center;"><code>myVec6[4]</code></th>
<th style="text-align: center;"><code>myVec6[5]</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>myVec2[1]</code></td>
<td style="text-align: center;"><code>myVec2[2]</code></td>
<td style="text-align: center;"><code>myVec2[3]</code></td>
<td style="text-align: center;"><code>myVec2[4]</code></td>
<td style="text-align: center;"><code>myVec2[5]</code></td>
</tr>
<tr class="even">
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
<td style="text-align: center;">+</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>myVec5[1]</code></td>
<td style="text-align: center;"><code>myVec5[2]</code></td>
<td style="text-align: center;"><code>myVec5[1]</code></td>
<td style="text-align: center;"><code>myVec5[2]</code></td>
<td style="text-align: center;"><code>myVec5[1]</code></td>
</tr>
</tbody>
</table>
<p>実際は長さが異なるベクトル同士の計算を行うことは滅多にありません。例外としては長さ1のベクトルの計算くらいですね。</p>
<p>文字列ベクトルの扱い方はより複雑ですので、第<a href="string.html" class="quarto-xref"><span>18</span></a>章で詳細に解説します。</p>
</section>
</section>
<section id="sec-datastructure_matrix" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="sec-datastructure_matrix"><span class="header-section-number">10.3</span> 行列 (matrix)</h2>
<p>行列は名前とおり、行と列で構成されたデータ構造です。ただし、我々が一般に考える「表」とは異なる点があります。それは行列内部の要素に制約がある点です。具体的に、行列の要素となり得るデータ型はnumeric、complex、NA型のみです。ここではnumeric型のみで構成された行列の作成および操作方法について解説します。</p>
<section id="行列の作り方" class="level3" data-number="10.3.1">
<h3 data-number="10.3.1" class="anchored" data-anchor-id="行列の作り方"><span class="header-section-number">10.3.1</span> 行列の作り方</h3>
<p>行列を作成するには<code>matrix()</code>関数を使います。引数として、行列に入る数値と行または列の数は必須です。数値はベクトルであり、行・列の数は整数です。以下のような行列を作るにはいくつかの方法があります。</p>
<p><span class="math display">\[
\left[
\begin{matrix}
1 &amp; 2 &amp; 3 &amp; 4 \\
5 &amp; 6 &amp; 7 &amp; 8 \\
9 &amp; 10 &amp; 11 &amp; 12
\end{matrix}
\right]
\]</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="co"># 方法1: 行数を指定する</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>Matrix1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">10</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">12</span>), <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb44-3"><a href="#cb44-3"></a>Matrix1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    1    2    3    4
[2,]    5    6    7    8
[3,]    9   10   11   12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="co"># 方法2: 列数を指定する</span></span>
<span id="cb46-2"><a href="#cb46-2"></a>Matrix2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">10</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">12</span>), <span class="at">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb46-3"><a href="#cb46-3"></a>Matrix2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    1    2    3    4
[2,]    5    6    7    8
[3,]    9   10   11   12</code></pre>
</div>
</div>
<p>いずれも同じ結果が得られます。注意してもらいたいところは、第一引数の書き方です。我々は「左から右へ、そして上から下へ」という順番で読むのになれていますが、<strong>Rの行列は「上から下へ、そして左から右へ」の順番</strong>です。もし、「左から右へ、そして上から下へ」のような、より我々にとって読みやすい書き方をするためにはもう一つの引数が必要であり、それが<code>byrow =</code>です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>), <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    1    2    3    4
[2,]    5    6    7    8
[3,]    9   10   11   12</code></pre>
</div>
</div>
<p>むろん、初項1、公差1、最大値12の等差数列ですのて、<code>1:12</code>のような書き方も可能です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    1    2    3    4
[2,]    5    6    7    8
[3,]    9   10   11   12</code></pre>
</div>
</div>
<p>データ構造も確認してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="fu">class</span>(Matrix1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "matrix" "array" </code></pre>
</div>
</div>
<p>R 4.0.0からの仕様変更により行列型はmatrix構造以外にもarrayの構造も持つようになりました。array型については第<a href="#sec-datastructure_array" class="quarto-xref"><span>10.6</span></a>章で解説します。</p>
<p><strong>単位行列</strong></p>
<p>最後にちょっと特殊な行列である単位行列 (indetity matrix)の作り方について説明します。単位行列とは行と列の数が同じである正方形の行列ですが、対角線上は全て1、その他は全て0となっている行列です。たとえば大きさが4の単位行列は、</p>
<p><span class="math display">\[
\left[
\begin{matrix}
1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1 \\
\end{matrix}
\right]
\]</span></p>
<p>です。これは<code>matrix(c(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1), nrow = 4)</code>で作成することも可能ですが、<code>diag()</code>関数を使えば簡単に出来ます。サイズが4の単位行列は<code>diag(4)</code>です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a>(<span class="fu">diag</span>(<span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1</code></pre>
</div>
</div>
</section>
<section id="行列の操作" class="level3" data-number="10.3.2">
<h3 data-number="10.3.2" class="anchored" data-anchor-id="行列の操作"><span class="header-section-number">10.3.2</span> 行列の操作</h3>
<p>まず、以下のような行列<code>A</code>を作ってみましょう。</p>
<p><span class="math display">\[
A = \left[
\begin{matrix}
1 &amp; 2 &amp; 3 &amp; 4 \\
5 &amp; 6 &amp; 7 &amp; 8 \\
9 &amp; 10 &amp; 11 &amp; 12
\end{matrix}
\right]
\]</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>), </span>
<span id="cb56-2"><a href="#cb56-2"></a>            <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>行列のサイズ</strong></p>
<p>行列の大きさ (行と列の数)を求める際は<code>dim()</code>関数を使います。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="fu">dim</span>(A)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3 4</code></pre>
</div>
</div>
<p>結果は長さ2のベクトルですが、1番目の要素が行数、2番目の要素が列数になります。もし、行列の行数のみ確認したい場合は<code>dim(A)[1]</code>、列数なら<code>dim(A)[2]</code>で確認することができます。また、全く同じ機能を持つ関数があり、それが<code>nrow()</code>と<code>ncol()</code>関数です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="fu">nrow</span>(A) <span class="co"># 行列の行数を確認: dim(A)[1]と同じ</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="fu">ncol</span>(A) <span class="co"># 列列の列数を確認: dim(A)[2]と同じ</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
</div>
<p><code>dim()</code>および<code>nrow()</code>、<code>ncol()</code>関数は第<a href="#sec-datastructure-dataframe" class="quarto-xref"><span>10.4</span></a>章で紹介するデータフレームでも使用可能です。</p>
<p><strong>要素の抽出</strong></p>
<p>ベクトルと同様、要素の抽出は<code>[]</code>を使います。ただし、行列は横と縦の2次元構成となりますので、行と列のそれぞれの位置を指定する必要があります。たとえば、<code>A</code>の2行目、3列目の要素を抽出するためには、</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a>A[<span class="dv">2</span>, <span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7</code></pre>
</div>
</div>
<p>のように書きます。行か列の位置を省略した場合、指定した列・行全てが抽出されます。2行目の要素全てを抽出するなら<code>A[2, ]</code>、3列目の要素全てを抽出するなら<code>A[, 3]</code>となります。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a>A[<span class="dv">2</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5 6 7 8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a>A[, <span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  3  7 11</code></pre>
</div>
</div>
<p>この場合、返される値のデータ構造はいずれも<strong>行列でなく、ベクトル</strong>です。確認してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="fu">is.vector</span>(A[<span class="dv">2</span>, <span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="fu">is.vector</span>(A[<span class="dv">2</span>, ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="fu">is.vector</span>(A[, <span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>例外は複数の行と複数の列を同時に抽出した場合です。たとえば、行列<code>A</code>の1・2行目と2・3列目の要素を全て抽出するとします。その場合は<code>A[1:2, 2:3]</code>のように書きます。むろん、<code>:</code>を使わずに<code>A[c(1, 2), c(2, 3)]</code>のような書き方も可能です。抽出後、返された結果のデータ構造も確認してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a>A[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    3    4
[2,]    7    8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a><span class="fu">class</span>(A[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "matrix" "array" </code></pre>
</div>
</div>
<p>この場合、返された結果のデータ構造は行列であることが分かります。</p>
<p><strong>行列の足し算と引き算</strong></p>
<p>行列の足し算 (引き算)には</p>
<ol type="1">
<li>行列内の全要素に対して同じ数字を足す (引く)</li>
<li>同じサイズの2つの行列から対応する要素を足す (引く)</li>
</ol>
<p>2パタンがあります。例えば、行列<code>A</code>の全要素に5を足す場合は以下のように入力します。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a>(A_plus_5 <span class="ot">&lt;-</span> A <span class="sc">+</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    6    7    8    9
[2,]   10   11   12   13
[3,]   14   15   16   17</code></pre>
</div>
</div>
<p>同様に、<code>A</code>から10を引く場合は<code>-</code>演算子を使います。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a>(A_minus_10 <span class="ot">&lt;-</span> A <span class="sc">-</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]   -9   -8   -7   -6
[2,]   -5   -4   -3   -2
[3,]   -1    0    1    2</code></pre>
</div>
</div>
<p>二つ目は同じサイズの行列同士の足し算と引き算です。行列<code>A</code>は3 <span class="math inline">\(\times\)</span> 4の行列ですので、同じサイズの行列<code>B</code>を作成してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a>(B <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">6</span>, <span class="dv">12</span>, <span class="dv">8</span>, <span class="dv">10</span>), </span>
<span id="cb83-2"><a href="#cb83-2"></a>             <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    3    2    1    4
[2,]    5    9    7   11
[3,]    6   12    8   10</code></pre>
</div>
</div>
<p>この行列<code>A</code>と<code>B</code>の足し算はそれぞれ同じ位置の要素同士の和を行列をして返し、これは引き算も同じです。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a>A <span class="sc">+</span> B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    4    4    4    8
[2,]   10   15   14   19
[3,]   15   22   19   22</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a>A <span class="sc">-</span> B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]   -2    0    2    0
[2,]    0   -3    0   -3
[3,]    3   -2    3    2</code></pre>
</div>
</div>
<p>注意すべき点は、2つの行列は同じ大きさでなければならない点です。たとえば、行列<code>B</code>の1列から3列までを抽出した3 <span class="math inline">\(\times\)</span> 3行列<code>C</code>を作成し、<code>A + C</code>をしてみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a>(C <span class="ot">&lt;-</span> B[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    3    2    1
[2,]    5    9    7
[3,]    6   12    8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a>A <span class="sc">+</span> C</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in A + C: non-conformable arrays</code></pre>
</div>
</div>
<p>このように足し算ができなくなり、これは引き算でも同じです。</p>
<p><strong>行列の掛け算</strong></p>
<p>やや特殊なのは行列の掛け算です。行列<code>A</code>の全要素を2倍にしたい場合、これは足し算・引き算と同じやり方で十分です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a>A <span class="sc">*</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    2    4    6    8
[2,]   10   12   14   16
[3,]   18   20   22   24</code></pre>
</div>
</div>
<p>ただし、問題は行列同士の掛け算です。行列<code>A</code>と<code>B</code>の掛け算といえば、直感的には足し算や引き算同様、同じ位置の要素の積と考えるかも知れません。実際<code>A * B</code>はそのように計算を行います。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a>A <span class="sc">*</span> B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    3    4    3   16
[2,]   25   54   49   88
[3,]   54  120   88  120</code></pre>
</div>
</div>
<p>ただし、このような掛け算は「アダマール積 (Hadamard product)」と呼ばれる計算方法であり<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>、一般的に使う掛け算ではありません。実際、数学において<span class="math inline">\(A \times B\)</span>はアダマール積を意味すのではなく、アダマール積は<span class="math inline">\(A \circ B\)</span>または<span class="math inline">\(A \odot B\)</span>と表記します。</p>
<p>それでは一般的な行列の積は何でしょう。詳しいことは線形代数の入門書に譲りますが、以下のような2つの行列<code>C</code>と<code>D</code>を考えてみましょう。</p>
<p><span class="math display">\[
C = \left[
\begin{matrix}
1 &amp; 2 &amp; 3 \\
4 &amp; 5 &amp; 6
\end{matrix}
\right],
D = \left[
\begin{matrix}
2 &amp; 7  &amp; 17 \\
3 &amp; 11 &amp; 19 \\
5 &amp; 13 &amp; 23
\end{matrix}
\right]
\]</span></p>
<p>行列の大きさが異なりますね。行列<code>C</code>の大きさは2 <span class="math inline">\(\times\)</span> 3、<code>D</code>は3 <span class="math inline">\(\times\)</span> 3です。実はこれが正しいです。行列の積は<span class="math inline">\(n \times m\)</span>の行列と<span class="math inline">\(m \times p\)</span>の行列同士でないと計算できません。<span class="math inline">\(n\)</span>と<span class="math inline">\(p\)</span>は同じでも、同じでなくても構いません。その意味で<span class="math inline">\(C \times D\)</span>は計算可能でも、<span class="math inline">\(D \times C\)</span>は計算できません。そして、2つの行列の積の大きさは<span class="math inline">\(n \times p\)</span>です。したがって、<span class="math inline">\(C \times D\)</span>の大きさは<span class="math inline">\(2 \times 3\)</span>です。</p>
<p>行列の積がどのように求められるかを確認するために、まず行列<code>C</code>と<code>D</code>を作成してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a>(C <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>), <span class="at">nrow =</span> <span class="dv">2</span>,<span class="at">byrow =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    2    3
[2,]    4    5    6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a>(D <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">7</span>, <span class="dv">17</span>, <span class="dv">3</span>, <span class="dv">11</span>, <span class="dv">19</span>, <span class="dv">5</span>, <span class="dv">13</span>, <span class="dv">23</span>), <span class="at">nrow =</span> <span class="dv">3</span>,<span class="at">byrow =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    2    7   17
[2,]    3   11   19
[3,]    5   13   23</code></pre>
</div>
</div>
<p>この2つの積は<code>%*%</code>演算子で計算されますが、まずその結果から見ましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a>(E <span class="ot">&lt;-</span> C <span class="sc">%*%</span> D)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]   23   68  124
[2,]   53  161  301</code></pre>
</div>
</div>
<p>2行2列の行列ができました。これらの数字、どうやった計算されたのでしょうか。<code>E</code>の<code>[1, 1]</code>は23であり、<code>[1, 2]</code>は68、<code>[2, 1]</code>は53、<code>[2, 2]</code>は161です。各値は以下のように求まります。</p>
<ul>
<li><code>E[1, 1]</code> = (<code>C[1, 1]</code> * <code>D[1, 1]</code>) + (<code>C[1, 2]</code> * <code>D[2, 1]</code>) + (<code>C[1, 3]</code> * <code>D[3, 1]</code>) = 23</li>
<li><code>E[1, 2]</code> = (<code>C[1, 1]</code> * <code>D[1, 2]</code>) + (<code>C[1, 2]</code> * <code>D[2, 2]</code>) + (<code>C[1, 3]</code> * <code>D[3, 2]</code>) = 68</li>
<li><code>E[1, 3]</code> = (<code>C[1, 1]</code> * <code>D[1, 3]</code>) + (<code>C[1, 2]</code> * <code>D[2, 3]</code>) + (<code>C[1, 3]</code> * <code>D[3, 3]</code>) = 124</li>
<li><code>E[2, 1]</code> = (<code>C[2, 1]</code> * <code>D[1, 1]</code>) + (<code>C[2, 2]</code> * <code>D[2, 1]</code>) + (<code>C[2, 3]</code> * <code>D[3, 1]</code>) = 53</li>
<li><code>E[2, 2]</code> = (<code>C[2, 1]</code> * <code>D[1, 2]</code>) + (<code>C[2, 2]</code> * <code>D[2, 2]</code>) + (<code>C[2, 3]</code> * <code>D[3, 2]</code>) = 161</li>
<li><code>E[2, 3]</code> = (<code>C[2, 1]</code> * <code>D[1, 3]</code>) + (<code>C[2, 2]</code> * <code>D[2, 3]</code>) + (<code>C[2, 3]</code> * <code>D[3, 3]</code>) = 301</li>
</ul>
<p>大きさ<span class="math inline">\(n \times m\)</span>行列<code>C</code>の<code>i</code>行目<code>j</code>列目の要素を<span class="math inline">\(C_{i,j}\)</span>と表記し、大きさ<span class="math inline">\(n \times p\)</span>行列<code>D</code>の<code>i</code>行目<code>j</code>列目の要素を<span class="math inline">\(D_{i,j}\)</span>と表記した場合、以下のような関係が成り立ちます。</p>
<p>行列<code>E</code>の<code>i</code>行目<code>j</code>列目の要素を<span class="math inline">\(e_{i,j}\)</span>と表記した場合、以下のような関係が成り立ちます。</p>
<p><span class="math display">\[
e_{i, j} = \sum_{k = 1}^m C_{i, k} \cdot D_{k, j}.
\]</span></p>
<p>したがって、行列<span class="math inline">\(C\)</span>と<span class="math inline">\(D\)</span>の積は</p>
<p><span class="math display">\[\begin{align}
CD = E &amp; = \left[
\begin{matrix}
e_{1, 1} &amp; e_{1, 2} &amp; e_{1, 3} \\
e_{2, 1} &amp; e_{2, 2} &amp; e_{2, 3}
\end{matrix}
\right] \\
&amp; = \left[
\begin{matrix}
\sum_{k = 1}^m C_{1, k} \cdot D_{k, 1} &amp; \sum_{k = 1}^m C_{1, k} \cdot D_{k, 2} &amp; \sum_{k = 1}^m C_{1, k} \cdot D_{k, 3} \\
\sum_{k = 1}^m C_{2, k} \cdot D_{k, 1} &amp; \sum_{k = 1}^m C_{2, k} \cdot D_{k, 2} &amp; \sum_{k = 1}^m C_{2, k} \cdot D_{k, 3}
\end{matrix}
\right].
\end{align}\]</span></p>
<p>このように業績同士の積はかなり求めるのが面倒ですが、Rを使えば一瞬で終わります。</p>
<p><strong>行列式</strong></p>
<p>行列式 (determinant)は<span class="math inline">\(n \times n\)</span>の正方行列のみに対して定義される値の一つです。主に一次方程式において解が存在するか否かを判断するために用いられる数値ですが<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>、その詳しい意味や求め方については線形代数の入門書を参照してください。</p>
<p>行列<span class="math inline">\(A\)</span>の行列式は一般的に<span class="math inline">\(\text{det}(A)\)</span>、または<span class="math inline">\(|A|\)</span>と表記されます。行列式を求めるRの関数は<code>det()</code>です。それでは適当に正方行列<code>F</code>を作成し、その行列を求めてみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a>(F <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="sc">-</span><span class="dv">6</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    2   -6    4
[2,]    7    2    3
[3,]    8    5   -1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a><span class="fu">det</span>(F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -144</code></pre>
</div>
</div>
<p>行列<code>F</code>の行列式は-144です。この場合、以下の一次方程式に何らかの一組の解が存在することを意味します (<span class="math inline">\(p\)</span>, <span class="math inline">\(q\)</span>, <span class="math inline">\(r\)</span>は任意の実数)。</p>
<p><span class="math display">\[\begin{align}
2x - 6y + 4z = &amp; p, \\
7x + 2y + 3z = &amp; q, \\
8x + 5y - 1z = &amp; r.
\end{align}\]</span></p>
<p>しかし、以下のような連立方程式はいかがでしょう。これは二組以上の解が存在する方程式です<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>。</p>
<p><span class="math display">\[\begin{align}
2x - 6y + 4z = &amp; p, \\
1x - 3y + 2z = &amp; q, \\
5x + 9y + 3z = &amp; r.
\end{align}\]</span></p>
<p>実際に行列<code>G</code>を作成し、<code>det(G)</code>を計算してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a>(G <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="sc">-</span><span class="dv">6</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">3</span>), <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    2   -6    4
[2,]    1   -3    2
[3,]    5    9    3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1"></a><span class="fu">det</span>(G)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p><span class="math inline">\(|G|\)</span>は0であることが分かりますね。</p>
<p><strong>階数</strong></p>
<p>行列の特徴を表す代表的な数値の一つが階数 (rank)です。詳しい説明は省きますが、一次方程式の例だと、階数が行列の行数と一致する場合、一組の解が存在することを意味します。階数を求める方法は<code>qr(行列)$rank</code>であり、行列<code>F</code>と<code>G</code>の階数を確認してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1"></a><span class="fu">qr</span>(F)<span class="sc">$</span>rank</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1"></a><span class="fu">qr</span>(G)<span class="sc">$</span>rank</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
<p>どれも3行の行列ですが、行列<code>F</code>の階数は3、行列<code>G</code>の階数は2です。<code>G</code>の階数は<code>G</code>の行数より小さいため、連立方程式に一組の解がないことが分かります。</p>
<p>階数の活用先は様々であり、行列式とは違って、正方行列でなくても計算可能です。</p>
<p><strong>逆行列</strong></p>
<p>逆行列とは掛け算すると単位行列となる行列を意味します。行列<span class="math inline">\(A\)</span>の逆行列は一般的に<span class="math inline">\(A^{\prime}\)</span>と表記し、<span class="math inline">\(A \times A^{\prime} = I\)</span>となります。この逆行列の求め方は非常に複雑であり、一定以上の大きさの行列になると手計算で解くのはほぼ不可能です。しかし、Rでは逆行列を計算する<code>solve()</code>関数が内蔵されております。</p>
<p>以下の行列<span class="math inline">\(A\)</span> (<code>A</code>)の逆行列、<span class="math inline">\(A^{\prime}\)</span> (<code>Ap</code>)を求めてみましょう。そして<span class="math inline">\(A \times A^{\prime}\)</span>が単位行列になるかまで確認してみます。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1"></a><span class="co"># 行列Aの作成</span></span>
<span id="cb115-2"><a href="#cb115-2"></a>(A  <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    0    1
[2,]   -2    1    0
[3,]    2   -1    1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1"></a><span class="co"># 行列Aの逆行列を計算し、Apに格納</span></span>
<span id="cb117-2"><a href="#cb117-2"></a>(Ap <span class="ot">&lt;-</span> <span class="fu">solve</span>(A))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1   -1   -1
[2,]    2   -1   -2
[3,]    0    1    1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1"></a><span class="co"># AとApの積が単位行列であることを確認</span></span>
<span id="cb119-2"><a href="#cb119-2"></a>A <span class="sc">%*%</span> Ap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1</code></pre>
</div>
</div>
<p>ちゃんと単位行列ができましたね。</p>
<p><strong>転置</strong></p>
<p>行列<span class="math inline">\(A\)</span>の転置行列は<span class="math inline">\(A^T\)</span>と表記され、以下のような関係となります。</p>
<p><span class="math display">\[
A = \left[
\begin{matrix}
1 &amp; 2 &amp; 3 \\
4 &amp; 5 &amp; 6 \\
7 &amp; 8 &amp; 9
\end{matrix}
\right],
A^T = \left[
\begin{matrix}
1 &amp; 4 &amp; 7 \\
2 &amp; 5 &amp; 8 \\
3 &amp; 6 &amp; 9
\end{matrix}
\right]
\]</span></p>
<p>正方行列の場合、対角成分を除き、全ての要素が対角成分を中心に反転していることが分かりますね。このような転置行列の作成には<code>t()</code>関数を使います。それでは行列<code>A</code>とその転置行列<code>At</code>を作ってみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a>A  <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>, <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb121-2"><a href="#cb121-2"></a>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    2    3
[2,]    4    5    6
[3,]    7    8    9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1"></a>At <span class="ot">&lt;-</span> <span class="fu">t</span>(A)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ちなみに転置行列は正方行列でなくても作成できます。</p>
</section>
</section>
<section id="sec-datastructure-dataframe" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="sec-datastructure-dataframe"><span class="header-section-number">10.4</span> データフレーム (data.frame)</h2>
<p>データフレームはデータ分析の際に最もよく見るデータ構造です。我々が一般的に考える表形式のデータはデータフレームです。行列も見た目は表に近いですが、行列は中身の要素がnumericまたはcomplex型に限定されるに対して<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>、データフレームはcharacterやfactor、Dateなど様々なデータ型が許容されます。</p>
<section id="データフレームの作成" class="level3" data-number="10.4.1">
<h3 data-number="10.4.1" class="anchored" data-anchor-id="データフレームの作成"><span class="header-section-number">10.4.1</span> データフレームの作成</h3>
<p>まずは、 <a href="#tbl-dataframe_example1" class="quarto-xref">表&nbsp;<span>10.1</span></a> のようなデータフレームを作成して見ましょう。データフレームを作成する際は<code>data.frame()</code>関数を使います。</p>
<div class="cell" data-layout-align="center">
<div id="tbl-dataframe_example1" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-dataframe_example1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
表&nbsp;10.1: myDFの中身
</figcaption>
<div aria-describedby="tbl-dataframe_example1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table table-striped do-not-create-environment cell caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">ID</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Name</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Math</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Stat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Yanai</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Song</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Shigemura</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Tani</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">85</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1"></a>myDF <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb124-2"><a href="#cb124-2"></a>    <span class="at">ID   =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb124-3"><a href="#cb124-3"></a>    <span class="at">Name =</span> <span class="fu">c</span>(<span class="st">"Yanai"</span>, <span class="st">"Song"</span>, <span class="st">"Shigemura"</span>, <span class="st">"Tani"</span>),</span>
<span id="cb124-4"><a href="#cb124-4"></a>    <span class="at">Math =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">90</span>, <span class="dv">100</span>, <span class="dv">80</span>),</span>
<span id="cb124-5"><a href="#cb124-5"></a>    <span class="at">Stat =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">5</span>, <span class="dv">100</span>, <span class="dv">85</span>)</span>
<span id="cb124-6"><a href="#cb124-6"></a>    )</span>
<span id="cb124-7"><a href="#cb124-7"></a></span>
<span id="cb124-8"><a href="#cb124-8"></a>myDF</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID      Name Math Stat
1  1     Yanai   50   25
2  2      Song   90    5
3  3 Shigemura  100  100
4  4      Tani   80   85</code></pre>
</div>
</div>
<p>データ構造を確認してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1"></a><span class="fu">class</span>(myDF)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
</div>
<p>データフレームを作成する際、事前にベクトルを用意してから作成することも可能です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1"></a>myDF_ID   <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span></span>
<span id="cb128-2"><a href="#cb128-2"></a>myDF_Name <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Yanai"</span>, <span class="st">"Song"</span>, <span class="st">"Shigemura"</span>, <span class="st">"Tani"</span>)</span>
<span id="cb128-3"><a href="#cb128-3"></a>myDF_Math <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">90</span>, <span class="dv">100</span>, <span class="dv">80</span>)</span>
<span id="cb128-4"><a href="#cb128-4"></a>myDF_Stat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">5</span>, <span class="dv">100</span>, <span class="dv">85</span>)</span>
<span id="cb128-5"><a href="#cb128-5"></a></span>
<span id="cb128-6"><a href="#cb128-6"></a>myDF2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(myDF_ID, myDF_Name, myDF_Math, myDF_Stat)</span>
<span id="cb128-7"><a href="#cb128-7"></a></span>
<span id="cb128-8"><a href="#cb128-8"></a>myDF2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  myDF_ID myDF_Name myDF_Math myDF_Stat
1       1     Yanai        50        25
2       2      Song        90         5
3       3 Shigemura       100       100
4       4      Tani        80        85</code></pre>
</div>
</div>
<p>この場合、列の名前はベクトル名そのままになります。もし、列名を指定したい場合は以下のように作成します。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1"></a>myDF3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb130-2"><a href="#cb130-2"></a>    <span class="at">ID   =</span> myDF_ID, </span>
<span id="cb130-3"><a href="#cb130-3"></a>    <span class="at">Name =</span> myDF_Name, </span>
<span id="cb130-4"><a href="#cb130-4"></a>    <span class="at">Math =</span> myDF_Math, </span>
<span id="cb130-5"><a href="#cb130-5"></a>    <span class="at">Stat =</span> myDF_Stat</span>
<span id="cb130-6"><a href="#cb130-6"></a>    )</span>
<span id="cb130-7"><a href="#cb130-7"></a></span>
<span id="cb130-8"><a href="#cb130-8"></a>myDF3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID      Name Math Stat
1  1     Yanai   50   25
2  2      Song   90    5
3  3 Shigemura  100  100
4  4      Tani   80   85</code></pre>
</div>
</div>
<p>以上をコードを考えてみると、データフレームは複数のベクトルを横方向にくっつけたものになります。注意すべき点としては各ベクトルの長さが一致している点です。<code>myDF</code>の場合、4つのベクトルで構成されていますが、全てのベクトルの長さは4です。むろん、長さが異なる場合もデータフレームは作成できます。この場合、長さが足りないベクトルは最も長さが長いベクトルに合わせて繰り返されます。例として<code>myDF4</code>を作ってみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1"></a>myDF4 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb132-2"><a href="#cb132-2"></a>    <span class="at">ID   =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb132-3"><a href="#cb132-3"></a>    <span class="at">Name =</span> <span class="fu">c</span>(<span class="st">"Yanai"</span>, <span class="st">"Song"</span>, <span class="st">"Shigemura"</span>, <span class="st">"Tani"</span>),</span>
<span id="cb132-4"><a href="#cb132-4"></a>    <span class="at">Math =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">90</span>, <span class="dv">100</span>, <span class="dv">80</span>),</span>
<span id="cb132-5"><a href="#cb132-5"></a>    <span class="at">Stat =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">5</span>, <span class="dv">100</span>, <span class="dv">85</span>),</span>
<span id="cb132-6"><a href="#cb132-6"></a>    <span class="at">City =</span> <span class="st">"Kobe"</span>,</span>
<span id="cb132-7"><a href="#cb132-7"></a>    <span class="at">Food =</span> <span class="fu">c</span>(<span class="st">"Ramen"</span>, <span class="st">"Udon"</span>)</span>
<span id="cb132-8"><a href="#cb132-8"></a>    )</span>
<span id="cb132-9"><a href="#cb132-9"></a></span>
<span id="cb132-10"><a href="#cb132-10"></a>myDF4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID      Name Math Stat City  Food
1  1     Yanai   50   25 Kobe Ramen
2  2      Song   90    5 Kobe  Udon
3  3 Shigemura  100  100 Kobe Ramen
4  4      Tani   80   85 Kobe  Udon</code></pre>
</div>
</div>
<p><code>City</code>列はすべて<code>"Kobe"</code>が入り、<code>Food</code>列は長さが足りない3, 4番目の要素に1, 2番目の要素が代入されます。実際はあまり使わない使い方ですが、ある列の要素が全て同じ場合、このような使い方をすることがあります。</p>
</section>
<section id="データフレームの操作" class="level3" data-number="10.4.2">
<h3 data-number="10.4.2" class="anchored" data-anchor-id="データフレームの操作"><span class="header-section-number">10.4.2</span> データフレームの操作</h3>
<p><strong>データフレームの大きさ</strong></p>
<p>行列と同様、<code>dim()</code>から行と列の数を、<code>nrow()</code>からは行数を、<code>ncol()</code>から列数を計算することができます。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1"></a><span class="fu">dim</span>(myDF4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1"></a><span class="fu">nrow</span>(myDF4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1"></a><span class="fu">ncol</span>(myDF4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
</div>
<p><strong>要素の抽出</strong></p>
<p>まず、データフレーム内要素の抽出についてですが、行列型と同じやり方で問題ありません。つまり、<code>[行番号, 列番号]</code>で要素の抽出が可能です。これに加え、データフレームには<code>$</code>を使った抽出方法があります。</p>
<p>まず、行列と同じやり方で<code>myDF4</code>の2行目、6列目の要素を抽出してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1"></a>myDF4[<span class="dv">2</span>, <span class="dv">6</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Udon"</code></pre>
</div>
</div>
<p>行を丸ごと抽出したい場合は、列を指定しません。<code>myDF4</code>の3, 4行目を抽出してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1"></a>myDF4[<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>, ] <span class="co"># myDF4[c(3, 4), ]も同じ</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID      Name Math Stat City  Food
3  3 Shigemura  100  100 Kobe Ramen
4  4      Tani   80   85 Kobe  Udon</code></pre>
</div>
</div>
<p>同じやり方で列を抽出すことも可能です。好きな食べ物 (<code>Food</code>)列を抽出してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1"></a>myDF4[, <span class="dv">6</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Ramen" "Udon"  "Ramen" "Udon" </code></pre>
</div>
</div>
<p>列を抽出する場合は、列名を指定することも可能です。やり方は<code>[, "列名"]</code>による方法、<code>$列名</code>による方法があります。<code>Name</code>列を抽出してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1"></a>myDF4[, <span class="st">"Name"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Yanai"     "Song"      "Shigemura" "Tani"     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1"></a>myDF4<span class="sc">$</span>Name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Yanai"     "Song"      "Shigemura" "Tani"     </code></pre>
</div>
</div>
<p>どれも同じ結果が返されます。後者の方が簡単ですが、一つの列しか抽出できない限界があります。それに比べ、前者は<code>c()</code>を使うことで複数の列を同時に抽出することも可能です。それぞれの場面に応じて使い分けていきましょう。</p>
<p>また、<code>$</code>で列を抽出した場合、抽出されたものはベクトル扱いになるため、<code>[]</code>を使った要素の抽出が可能です。例えば<code>myDF4</code>の<code>Name</code>列の2番目の要素を抽出してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1"></a>myDF4<span class="sc">$</span>Name[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Song"</code></pre>
</div>
</div>
<p>あまり意識する必要はありませんが、抽出後のデータ構造について簡単に説明します。データフレームから一部の要素を抽出した結果物は必ずしもデータフレームにはなりません。</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>操作</th>
<th>返されるデータ型</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1行を抽出する</td>
<td>データフレーム</td>
</tr>
<tr class="even">
<td>2</td>
<td>複数の行を抽出する</td>
<td>データフレーム</td>
</tr>
<tr class="odd">
<td>3</td>
<td>1列を抽出する</td>
<td><strong>ベクトル</strong></td>
</tr>
<tr class="even">
<td>4</td>
<td>複数の列を抽出する</td>
<td>データフレーム</td>
</tr>
</tbody>
</table>
<p>注目するのは3番目の例ですが、これはRの最小単位がベクトルであり、データフレームもベクトルの集めだからです。データフレームは「縦」ベクトルを横に並べたものです。もし、行を抽出した場合、その要素は全て同じデータ型だとは限りません。実際、<code>myDF4</code>の3行目を抽出しても、中にはcharacter型とnumeric型と混在しています。しかし、一つの列のみを抽出した場合、全ての要素は必ず同じデータ型となるため、ベクトルとして扱うことが可能です。同様に、行列型の一列を抽出した場合も結果はベクトルとなります。ただし、行列は全ての要素がNAを除き、同じであるため、一行を抽出しても結果はベクトル型となります。</p>
<p><strong>セルの修正</strong></p>
<p>特定のセルの修正する方法は簡単です。先ほど、データフレームから一つのセルを取り出すには<code>データフレーム名[行番号, 列番号]</code>だけでした。そのセルを修正するにはベクトルと同様、<code>データフレーム名[行番号, 列番号] &lt;- 新しい値</code>のように入力します。</p>
<p>たとえば、重村さんが数学試験で不正が発覚し、0点になるとします。そのためには、<code>myDF4</code>の3行・3列目の要素を<code>0</code>に修正する必要がありますが、以下のようなコマンドで修正可能です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1"></a>myDF4[<span class="dv">3</span>, <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb152-2"><a href="#cb152-2"></a>myDF4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID      Name Math Stat City  Food
1  1     Yanai   50   25 Kobe Ramen
2  2      Song   90    5 Kobe  Udon
3  3 Shigemura    0  100 Kobe Ramen
4  4      Tani   80   85 Kobe  Udon</code></pre>
</div>
</div>
<p>ちゃんと重村さんの数学点数が0点になりました。ざまあみろですね！</p>
<p>もう一つのやり方としては、一旦、列を取り出し、ベクトルにおける要素の置換操作を行う方法です。矢内大先生が神戸から離れ、高知県へ移住し、小物の宋は京都へ移住したとします。<code>myDF4</code>の<code>City</code>列の1・2番目要素を<code>c("Kochi", "Kyoto")</code>に修正する必要があります。そのためには以下のように入力します。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1"></a>myDF4<span class="sc">$</span>City[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Kochi"</span>, <span class="st">"Kyoto"</span>)</span>
<span id="cb154-2"><a href="#cb154-2"></a>myDF4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID      Name Math Stat  City  Food
1  1     Yanai   50   25 Kochi Ramen
2  2      Song   90    5 Kyoto  Udon
3  3 Shigemura    0  100  Kobe Ramen
4  4      Tani   80   85  Kobe  Udon</code></pre>
</div>
</div>
<p>修正した要素が反映されました。</p>
<p><strong>列の追加・修正</strong></p>
<p>まずは、データフレームに列を追加する方法について紹介します。方法は</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1"></a>データフレーム名<span class="sc">$</span>新しい列名 <span class="ot">&lt;-</span> ベクトル</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>のように入力するだけです。たとえば、4人を対象に英語試験を行い、それぞれの点数が95点、50点、80点、5点だとします。この英語試験の成績を<code>myDF4</code>の<code>English</code>列として追加してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1"></a>myDF4<span class="sc">$</span>English <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">95</span>, <span class="dv">50</span>, <span class="dv">80</span>, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>むろん、以下のように予めベクトルを作成してから代入することも可能です。</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1"></a>English_Score <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">95</span>, <span class="dv">50</span>, <span class="dv">80</span>, <span class="dv">5</span>)</span>
<span id="cb158-2"><a href="#cb158-2"></a>myDF4<span class="sc">$</span>English <span class="ot">&lt;-</span> English_Score</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>どれも同じ結果になりますが、結果を見てみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1"></a>myDF4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID      Name Math Stat  City  Food English
1  1     Yanai   50   25 Kochi Ramen      95
2  2      Song   90    5 Kyoto  Udon      50
3  3 Shigemura    0  100  Kobe Ramen      80
4  4      Tani   80   85  Kobe  Udon       5</code></pre>
</div>
</div>
<p>「<code>English</code>が<code>Stat</code>の次じゃなくて気持ち悪い！」と思う方もいるかも知れませんが、列順番の変更については第<a href="datahandling1.html" class="quarto-xref"><span>13</span></a>章で解説します。まずは、これで我慢しましょう。</p>
<p>次は、列の置換についてです。実はよく考えてみるとこれは列の追加と全く同じです。たとえば、英語試験において配点が5点の問題にミスが見つかり、全生徒の英語成績に5点を上乗せるとします。そのためにはベクトル<code>myDF4$English</code>の全ての要素に5を足し、それをもう一回<code>myDf4$English</code>に代入すれば良いです。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1"></a>myDF4<span class="sc">$</span>English <span class="ot">&lt;-</span> myDF4<span class="sc">$</span>English <span class="sc">+</span> <span class="dv">5</span></span>
<span id="cb161-2"><a href="#cb161-2"></a>myDF4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID      Name Math Stat  City  Food English
1  1     Yanai   50   25 Kochi Ramen     100
2  2      Song   90    5 Kyoto  Udon      55
3  3 Shigemura    0  100  Kobe Ramen      85
4  4      Tani   80   85  Kobe  Udon      10</code></pre>
</div>
</div>
<p>これで<code>English</code>列の修正ができました。</p>
<p><strong>行の追加・修正はなるべくしない</strong></p>
<p>行の追加はなるべくしない方が良いです。その理由について考えてみましょう。今は4人の生徒のデータがありますが、ここにもう一人の生徒のデータを追加するとします。そのためには<code>myDF4</code>の5行目に生徒のID、名前、数学・統計学の成績、居住地域、好きな食べ物、英語の成績を入れれば良いでしょう。新しい学生、吐合さんの数学・統計学・英語成績は50, 50, 50点、居住地域は芦屋、好きな食べ物は二郎だとします。早速追加してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1"></a>myDF4[<span class="dv">5</span>, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="st">"Hakiai"</span>, <span class="dv">50</span>, <span class="dv">50</span>, <span class="st">"Ashiya"</span>, <span class="st">"Jiro"</span>, <span class="dv">50</span>)</span>
<span id="cb163-2"><a href="#cb163-2"></a>myDF4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID      Name Math Stat   City  Food English
1  1     Yanai   50   25  Kochi Ramen     100
2  2      Song   90    5  Kyoto  Udon      55
3  3 Shigemura    0  100   Kobe Ramen      85
4  4      Tani   80   85   Kobe  Udon      10
5  5    Hakiai   50   50 Ashiya  Jiro      50</code></pre>
</div>
</div>
<p>問題なく吐合さんのデータが追加されたように見えますが、実は問題があります。<code>myDF4</code>の<code>Stat</code>列を取り出して見ましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1"></a>myDF4<span class="sc">$</span>Stat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "25"  "5"   "100" "85"  "50" </code></pre>
</div>
</div>
<p>異常に気づきましたか。それではこのベクトルのデータ型を確認してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1"></a><span class="fu">class</span>(myDF4<span class="sc">$</span>Stat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
</div>
<p>元々はnumeric型であるはずの<code>Stat</code>列がcharacter型になりました。その理由は明白です。ベクトルの要素は全て同じデータ型だからです。そして、numericとcharacter型が混在している場合は、自動的に（優先順位の高い）character型になります。以下の2つのコマンドが同じであることは理解できるでしょう。</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1"></a><span class="co"># Case 1</span></span>
<span id="cb169-2"><a href="#cb169-2"></a>myDF4[<span class="dv">5</span>, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="st">"Hakiai"</span>, <span class="dv">50</span>, <span class="dv">50</span>, <span class="st">"Ashiya"</span>, <span class="st">"Jiro"</span>, <span class="dv">50</span>)</span>
<span id="cb169-3"><a href="#cb169-3"></a></span>
<span id="cb169-4"><a href="#cb169-4"></a><span class="co"># Case 2</span></span>
<span id="cb169-5"><a href="#cb169-5"></a>Hakiai_Data <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="st">"Hakiai"</span>, <span class="dv">50</span>, <span class="dv">50</span>, <span class="st">"Ashiya"</span>, <span class="st">"Jiro"</span>, <span class="dv">50</span>)</span>
<span id="cb169-6"><a href="#cb169-6"></a>myDF4[<span class="dv">5</span>, ]  <span class="ot">&lt;-</span> Hakiai_Data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ここのベクトル<code>Hakiai_Data</code>が強制的にcharacter型になるため、<code>myDF4</code>の5行目の要素は全てcharacter型になります。また、データフレームは縦ベクトルを横に並べたものであるなら、<code>myDF4$Math</code>列にcharacter型の要素が追加されることによって、列も全てcharacter型になってしまいます。したがって、データフレームにcharacter型とnumeric型が混在している状況において新しい行の追加は全ての要素をcharacter型に変えてしまうのです。むろん、データフレームの全要素がnumeric型であれば、このような問題は生じますが、numeric型のみで構成されたデータフレームはなかなかないでしょう。</p>
<p>5行目を消しても問題は解決しないので、結局は列のデータ型を強制的に変更する必要があります。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1"></a>myDF4<span class="sc">$</span>ID      <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(myDF4<span class="sc">$</span>ID)</span>
<span id="cb170-2"><a href="#cb170-2"></a>myDF4<span class="sc">$</span>Math    <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(myDF4<span class="sc">$</span>Math)</span>
<span id="cb170-3"><a href="#cb170-3"></a>myDF4<span class="sc">$</span>Stat    <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(myDF4<span class="sc">$</span>Stat)</span>
<span id="cb170-4"><a href="#cb170-4"></a>myDF4<span class="sc">$</span>English <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(myDF4<span class="sc">$</span>English)</span>
<span id="cb170-5"><a href="#cb170-5"></a></span>
<span id="cb170-6"><a href="#cb170-6"></a><span class="fu">class</span>(myDF4<span class="sc">$</span>Math)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
</div>
<p>これでやっと元通りになりましたね。</p>
<p>どうしても行を追加したい場合は、以下のようなやり方もありますが、おすすめはできません。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1"></a>myDF4[<span class="dv">6</span>, ] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">7</span>) <span class="co"># myDF4の6行目を追加し、7つの欠損値を代入</span></span>
<span id="cb172-2"><a href="#cb172-2"></a></span>
<span id="cb172-3"><a href="#cb172-3"></a>myDF4<span class="sc">$</span>ID[<span class="dv">6</span>]      <span class="ot">&lt;-</span> <span class="dv">6</span>           <span class="co"># myDF4$IDの6番目の要素に6を代入</span></span>
<span id="cb172-4"><a href="#cb172-4"></a>myDF4<span class="sc">$</span>Name[<span class="dv">6</span>]    <span class="ot">&lt;-</span> <span class="st">"Yukawa"</span>    <span class="co"># myDF4$Nameの6番目の要素にYukawaを代入</span></span>
<span id="cb172-5"><a href="#cb172-5"></a>myDF4<span class="sc">$</span>Math[<span class="dv">6</span>]    <span class="ot">&lt;-</span> <span class="dv">80</span>          <span class="co"># 以下、省略</span></span>
<span id="cb172-6"><a href="#cb172-6"></a>myDF4<span class="sc">$</span>Stat[<span class="dv">6</span>]    <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb172-7"><a href="#cb172-7"></a>myDF4<span class="sc">$</span>City[<span class="dv">6</span>]    <span class="ot">&lt;-</span> <span class="st">"Hiroshima"</span></span>
<span id="cb172-8"><a href="#cb172-8"></a>myDF4<span class="sc">$</span>Food[<span class="dv">6</span>]    <span class="ot">&lt;-</span> <span class="st">"Ramen"</span></span>
<span id="cb172-9"><a href="#cb172-9"></a>myDF4<span class="sc">$</span>English[<span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="dv">90</span></span>
<span id="cb172-10"><a href="#cb172-10"></a></span>
<span id="cb172-11"><a href="#cb172-11"></a>myDF4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID      Name Math Stat      City  Food English
1  1     Yanai   50   25     Kochi Ramen     100
2  2      Song   90    5     Kyoto  Udon      55
3  3 Shigemura    0  100      Kobe Ramen      85
4  4      Tani   80   85      Kobe  Udon      10
5  5    Hakiai   50   50    Ashiya  Jiro      50
6  6    Yukawa   80   30 Hiroshima Ramen      90</code></pre>
</div>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1"></a><span class="fu">class</span>(myDF4<span class="sc">$</span>English)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
</div>
<p>欠損値 (<code>NA</code>)はどのようなデータ型にも対応できる特徴を利用すれば、このような操作も可能ですが、かなり面倒です。そもそも実際の分析において任意の行を追加することは滅多にないはずです。</p>
</section>
<section id="tibble型" class="level3" data-number="10.4.3">
<h3 data-number="10.4.3" class="anchored" data-anchor-id="tibble型"><span class="header-section-number">10.4.3</span> tibble型</h3>
<p><code>data.frame</code>に似ているデータ型として<code>tibble</code>があります。これはR内蔵のデータ型ではありませんが、Rの必須パッケージとも言えるtidyverse内に含まれているデータ型であり、これからもどんどん普及していくでしょう。<code>tibble</code>と<code>data.frame</code>の違いを説明するために、同じデータをそれぞれのデータ型で読み込んでみましょう。</p>
<p>とりあえず<code>read.csv()</code>で読み込み、<code>VoteDF1</code>と名付けましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1"></a>VoteDF1 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"Data/Vote.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>続いて<code>VoteDF1</code>を<code>as_tibble()</code>関数を使って<code>tibble</code>型にし、<code>VoteDF2</code>と名付けます。そして、それぞれのデータ構造を確認してみます。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1"></a>VoteDF2 <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(VoteDF1)</span>
<span id="cb177-2"><a href="#cb177-2"></a></span>
<span id="cb177-3"><a href="#cb177-3"></a><span class="fu">class</span>(VoteDF1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1"></a><span class="fu">class</span>(VoteDF2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<p>全く同じデータですが、<code>VoteDF2</code>には<code>tbl</code>と<code>tbl_df</code>というクラスが追加されていることが分かります。それではデータの中身を覗いてみましょう。まずは、<code>data.frame</code>型から</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1"></a>VoteDF1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ID     Pref  Zaisei Over65 Under30   LDP   DPJ Komei Ishin   JCP   SDP
1   1   北海道 0.41903  29.09   24.70 32.82 30.62 13.41  3.43 11.44  1.68
2   2   青森県 0.33190  30.14   23.92 40.44 24.61 12.76  3.82  8.92  3.41
3   3   岩手県 0.34116  30.38   24.48 34.90 22.44  8.61  5.16 11.24  5.29
4   4   宮城県 0.59597  25.75   27.29 36.68 25.40 13.42  3.97  9.99  3.62
5   5   秋田県 0.29862  33.84   21.35 43.46 22.72 11.19  5.17  7.56  5.12
6   6   山形県 0.34237  30.76   24.75 42.49 21.47 11.78  4.30  7.60  5.20
7   7   福島県 0.50947  28.68   25.23 33.82 28.31 10.96  3.43 10.45  3.24
8   8   茨城県 0.63309  26.76   26.60 40.64 18.95 15.05  6.67 10.07  2.88
9   9   栃木県 0.62166  25.87   26.78 38.78 21.63 12.42 10.88  7.00  2.05
10 10   群馬県 0.60277  27.60   26.59 42.06 19.31 13.85  5.61 10.00  2.44
11 11   埼玉県 0.76548  24.82   27.66 32.30 20.40 16.00  7.23 13.94  1.91
12 12   千葉県 0.77694  25.86   26.71 37.79 21.70 13.98  5.46 11.34  2.01
13 13   東京都 1.00321  22.67   27.39 34.37 19.76 11.44  7.34 14.21  2.82
14 14 神奈川県 0.91745  23.86   27.84 34.92 21.49 12.18  7.77 12.46  2.79
15 15   新潟県 0.43519  29.86   25.23 43.66 25.25  8.27  4.39  8.00  3.76
16 16   富山県 0.45307  30.54   24.88 44.16 24.22  9.81  5.06  5.79  5.02
17 17   石川県 0.46812  27.87   27.25 48.09 18.54 11.00  6.36  7.07  2.36
18 18   福井県 0.37820  28.63   26.70 45.29 17.52 10.91 13.09  5.66  2.09
19 19   山梨県 0.37876  28.41   26.37 37.36 28.04 12.83  4.32  9.20  1.67
20 20   長野県 0.47586  30.06   25.52 35.27 27.69 10.70  4.23 12.61  3.59
21 21   岐阜県 0.52358  28.10   27.22 39.71 23.62 12.33  5.51  9.41  1.98
22 22   静岡県 0.70999  27.79   26.28 37.47 24.13 12.68  7.99  9.59  2.22
23 23   愛知県 0.92052  23.79   29.44 34.32 29.27 11.67  6.41  9.55  2.14
24 24   三重県 0.57544  27.90   26.74 33.67 34.23 13.07  5.09  7.59  1.76
25 25   滋賀県 0.53932  24.15   29.96 37.85 22.25  9.57 12.82 11.44  1.41
26 26   京都府 0.56713  27.51   27.76 31.18 19.93 12.25 11.16 18.50  1.55
27 27   大阪府 0.74980  26.15   27.55 22.12  9.30 16.39 34.86 11.37  1.25
28 28   兵庫県 0.62062  27.09   26.94 31.71 15.84 15.37 19.50 10.30  2.01
29 29   奈良県 0.41269  28.70   26.86 33.51 18.41 13.44 18.94  9.17  1.66
30 30 和歌山県 0.31955  30.89   25.08 39.61 12.10 18.00 13.51 10.43  1.23
31 31   鳥取県 0.25486  29.71   25.86 41.62 20.93 16.71  5.98  7.14  2.56
32 32   島根県 0.24170  32.48   24.59 48.24 19.14 13.43  4.75  7.50  2.51
33 33   岡山県 0.50096  28.66   27.44 37.87 19.91 17.18 10.67  7.87  1.60
34 34   広島県 0.58581  27.53   27.46 39.93 18.53 15.20  9.69  8.52  2.35
35 35   山口県 0.42560  32.07   24.91 46.75 17.27 16.50  5.31  7.39  1.78
36 36   徳島県 0.32018  30.95   24.31 38.44 17.72 16.87  9.46  9.10  1.81
37 37   香川県 0.46060  29.93   25.29 44.07 16.60 15.14  6.20  7.56  5.07
38 38   愛媛県 0.41181  30.62   24.75 43.57 19.28 14.82  6.77  6.97  2.40
39 39   高知県 0.24472  32.85   23.60 37.01 16.95 15.83  3.93 17.41  2.91
40 40   福岡県 0.61836  25.90   28.21 36.52 19.08 17.15  7.03 10.78  3.33
41 41   佐賀県 0.32938  27.68   27.97 43.53 21.10 15.48  4.85  5.67  4.16
42 42   長崎県 0.31562  29.60   25.84 41.70 20.68 16.86  5.12  6.27  3.48
43 43   熊本県 0.38688  28.78   27.18 46.54 19.29 15.27  4.53  6.32  2.60
44 44   大分県 0.35828  30.45   25.65 39.44 18.37 13.26  4.42  6.85 13.05
45 45   宮崎県 0.32034  29.49   26.26 40.11 14.50 17.11  5.74  7.27  6.81
46 46 鹿児島県 0.32140  29.43   26.04 45.97 16.19 14.49  6.47  6.52  3.62
47 47   沖縄県 0.31535  19.63   33.37 27.82 13.29 15.09  7.66 15.64 12.13</code></pre>
</div>
</div>
<p>つづいて、<code>tibble</code>型</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1"></a>VoteDF2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 47 × 11
      ID Pref   Zaisei Over65 Under30   LDP   DPJ Komei Ishin   JCP   SDP
   &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     1 北海道  0.419   29.1    24.7  32.8  30.6 13.4   3.43 11.4   1.68
 2     2 青森県  0.332   30.1    23.9  40.4  24.6 12.8   3.82  8.92  3.41
 3     3 岩手県  0.341   30.4    24.5  34.9  22.4  8.61  5.16 11.2   5.29
 4     4 宮城県  0.596   25.8    27.3  36.7  25.4 13.4   3.97  9.99  3.62
 5     5 秋田県  0.299   33.8    21.4  43.5  22.7 11.2   5.17  7.56  5.12
 6     6 山形県  0.342   30.8    24.8  42.5  21.5 11.8   4.3   7.6   5.2 
 7     7 福島県  0.509   28.7    25.2  33.8  28.3 11.0   3.43 10.4   3.24
 8     8 茨城県  0.633   26.8    26.6  40.6  19.0 15.0   6.67 10.1   2.88
 9     9 栃木県  0.622   25.9    26.8  38.8  21.6 12.4  10.9   7     2.05
10    10 群馬県  0.603   27.6    26.6  42.1  19.3 13.8   5.61 10     2.44
# ℹ 37 more rows</code></pre>
</div>
</div>
<p>同じデータですが、表示画面がやや異なります。<code>data.frame</code>は全ての列と行が表示されましたが、<code>tibble</code>の場合、「画面に収まる」程度しか表示されません。表示されなかった行や列に関しては最後に表示されています。たとえば、<code>VoteDF2</code>の場合、下段にこのように書かれていますね (画面の大きさによって変わります)。</p>
<pre><code>## # … with 37 more rows, and 1 more variable: SDP &lt;dbl&gt;</code></pre>
<p>これは表示されなかった行が37行あり、<code>SDP</code>という変数も表示されていないということです。他の違いとしては、<code>tibble</code>の場合、最初にデータのサイズ (47行11列)が、各変数名の下にデータ型 (<code>&lt;int&gt;</code>、<code>&lt;chr&gt;</code>、<code>&lt;dbl&gt;</code>など)が表示されるという点です。</p>
<p>本書は<code>tibble</code>と<code>data.frame</code>を区別して解説はしませんが、一部の章・節においては<code>tibble</code>を念頭において解説をします。<code>tibble</code>型の作り方は先ほどのように<code>as_tibble()</code>使う方法もありますが、<code>readr::read_csv()</code>を使う方法もあります<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>。<code>read_csv()</code>を使うと各列がどのようなデータ型として読み込まれたかも表示されるので便利です。<code>readr</code>パッケージはtidyverseに含まれているため、普段では以下のような使い方で十分です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1"></a>VoteDF3 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Vote.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 47 Columns: 11
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (1): Pref
dbl (10): ID, Zaisei, Over65, Under30, LDP, DPJ, Komei, Ishin, JCP, SDP

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1"></a><span class="fu">class</span>(VoteDF3) <span class="co"># VoteDF3の構造</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "spec_tbl_df" "tbl_df"      "tbl"         "data.frame" </code></pre>
</div>
</div>
<p><code>tibble</code>と<code>data.frame</code>の最も大きな違いは、<code>data.frame</code>の一つのセルには長さ1のベクトルしか入らない一方、<code>tibble</code>は何でも入るという点です。つまり、<code>tibble</code>なら一つのセルに数字や文字列だけでなく、長さ2以上のベクトル、後述するリスト型、行列、さらには<code>tibble</code>も入れることが出来ます。これについては本書の中盤以降に解説します。</p>
<p>本書で「データフレーム」と書いた場合、それはtibbleでも適用可能です。ただし、tibbleと明示した場合、データフレームでは適用不可能です。</p>
</section>
</section>
<section id="sec-datastructure_list" class="level2" data-number="10.5">
<h2 data-number="10.5" class="anchored" data-anchor-id="sec-datastructure_list"><span class="header-section-number">10.5</span> リスト (list)</h2>
<p>リスト型は「様々なデータ構造を集めたもの」です。これは複数のデータフレームが格納されたオブジェクト、複数のベクトルが格納されたオブジェクト、行列とデータフレームが混在したオブジェクトなどを意味します。また、リスト型データはリスト型データを含むことも可能であり、非常に柔軟なデータ構造です。</p>
<section id="リスト型データの作成" class="level3" data-number="10.5.1">
<h3 data-number="10.5.1" class="anchored" data-anchor-id="リスト型データの作成"><span class="header-section-number">10.5.1</span> リスト型データの作成</h3>
<p>ここではまず、2つのデータフレームを含むリストを作成してみます。それぞれのデータフレームはFIFA国別サッカーランキングであり<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>、本書のサンプルデータの<code>FIFA_Women.csv</code>と<code>FIFA_Men.csv</code>です。まずは、2つのデータを読み込み、<code>Soccer_W</code>と<code>Soccer_M</code>という名のオブジェクトに格納しましょう。また、ここでは単に例を見せるだけなので、全データを利用するのではなく、最初の10行のみを利用します。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1"></a>Soccer_W <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"Data/FIFA_Women.csv"</span>)</span>
<span id="cb190-2"><a href="#cb190-2"></a>Soccer_M <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"Data/FIFA_Men.csv"</span>)</span>
<span id="cb190-3"><a href="#cb190-3"></a></span>
<span id="cb190-4"><a href="#cb190-4"></a>Soccer_W <span class="ot">&lt;-</span> Soccer_W[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ]</span>
<span id="cb190-5"><a href="#cb190-5"></a>Soccer_M <span class="ot">&lt;-</span> Soccer_M[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>リストの作成には<code>list()</code>関数に入れたいオブジェクト名を指定するだけです。それでは<code>List1</code>という名前で<code>Soccer_W</code>と<code>Soccer_M</code>データフレームを入れてみましょう。格納後は<code>List1</code>のデータ構造を<code>class()</code>で確認します</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1"></a>List1 <span class="ot">&lt;-</span> <span class="fu">list</span>(Soccer_W, Soccer_M)</span>
<span id="cb191-2"><a href="#cb191-2"></a><span class="fu">class</span>(List1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1"></a>List1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
   ID                Team Rank Points Prev_Points Confederation
1   1             Albania   75   1325        1316          UEFA
2   2             Algeria   85   1271        1271           CAF
3   3      American Samoa  133   1030        1030           OFC
4   4             Andorra  155    749         749          UEFA
5   5              Angola  121   1117        1117           CAF
6   6 Antigua and Barbuda  153    787         787      CONCACAF
7   7           Argentina   32   1659        1659      CONMEBOL
8   8             Armenia  126   1103        1104          UEFA
9   9               Aruba  157    724         724      CONCACAF
10 10           Australia    7   1963        1963           AFC

[[2]]
   ID                Team Rank Points Prev_Points Confederation
1   1         Afghanistan  149   1052        1052           AFC
2   2             Albania   66   1356        1356          UEFA
3   3             Algeria   35   1482        1482           CAF
4   4      American Samoa  192    900         900           OFC
5   5             Andorra  135   1082        1082          UEFA
6   6              Angola  124   1136        1136           CAF
7   7            Anguilla  210    821         821      CONCACAF
8   8 Antigua and Barbuda  126   1127        1127      CONCACAF
9   9           Argentina    9   1623        1623      CONMEBOL
10 10             Armenia  102   1213        1213          UEFA</code></pre>
</div>
</div>
<p>一つのオブジェクトに2つのデータフレームが入っていますね。これは2つのデータフレームで構成された長さ2のリストです。ただし、どちらが女性ランキングで、どちらが男子ランキングか区別が難しいです。この場合、各データフレームに名前を付けることも可能です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1"></a>List2 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">Women =</span> Soccer_W, <span class="at">Men =</span> Soccer_M)</span>
<span id="cb195-2"><a href="#cb195-2"></a>List2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Women
   ID                Team Rank Points Prev_Points Confederation
1   1             Albania   75   1325        1316          UEFA
2   2             Algeria   85   1271        1271           CAF
3   3      American Samoa  133   1030        1030           OFC
4   4             Andorra  155    749         749          UEFA
5   5              Angola  121   1117        1117           CAF
6   6 Antigua and Barbuda  153    787         787      CONCACAF
7   7           Argentina   32   1659        1659      CONMEBOL
8   8             Armenia  126   1103        1104          UEFA
9   9               Aruba  157    724         724      CONCACAF
10 10           Australia    7   1963        1963           AFC

$Men
   ID                Team Rank Points Prev_Points Confederation
1   1         Afghanistan  149   1052        1052           AFC
2   2             Albania   66   1356        1356          UEFA
3   3             Algeria   35   1482        1482           CAF
4   4      American Samoa  192    900         900           OFC
5   5             Andorra  135   1082        1082          UEFA
6   6              Angola  124   1136        1136           CAF
7   7            Anguilla  210    821         821      CONCACAF
8   8 Antigua and Barbuda  126   1127        1127      CONCACAF
9   9           Argentina    9   1623        1623      CONMEBOL
10 10             Armenia  102   1213        1213          UEFA</code></pre>
</div>
</div>
<p>これでどれが女性ランキングか、男性ランキングかが区別しやすくなりました。ここでは2つのデータフレームを入れましたが、様々なデータ構造が混在したリストも可能です。様々なデータ構造が混在したリストを自分で作成する場面はあまりありません。自分で作成した独自クラスを利用するパッケージを開発する際はよく使いますが、ここでは省略します。ただし、様々なデータ構造が含まれたリスト型を見ることはよくあります。たとえば、<code>lm()</code>関数で回帰分析を行った際、その結果はリスト型であり、中にはベクトル、データフレーム、リストなどが混在しています。これについては今後詳細に解説していきたいと思います。</p>
</section>
<section id="リスト型データの操作" class="level3" data-number="10.5.2">
<h3 data-number="10.5.2" class="anchored" data-anchor-id="リスト型データの操作"><span class="header-section-number">10.5.2</span> リスト型データの操作</h3>
<p>リスト型の中身は何でもあり得るので、なんらかの操作方法があるわけではありません。リスト型の操作というのはリスト内の要素をどのように抽出するかであり、各要素 (データフレーム、行列、ベクトルなど)の操作はこれまで説明してきた方法と同じです。したがって、ここではリストを構成する要素を抽出する方法についてのみ解説します。</p>
<p><strong>要素の番号を利用する方法</strong></p>
<p><code>List1</code>は各要素に名前が付いていないため、番号で抽出します。たとえば、あるリストの<code>i</code>番目の要素を抽出するには<code>リスト名[[i]]</code>で抽出します。<code>[]</code>ではなく、<code>[[]]</code>であることに注意してください。それでは<code>List1</code>の1番目の要素を抽出してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1"></a>List1[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ID                Team Rank Points Prev_Points Confederation
1   1             Albania   75   1325        1316          UEFA
2   2             Algeria   85   1271        1271           CAF
3   3      American Samoa  133   1030        1030           OFC
4   4             Andorra  155    749         749          UEFA
5   5              Angola  121   1117        1117           CAF
6   6 Antigua and Barbuda  153    787         787      CONCACAF
7   7           Argentina   32   1659        1659      CONMEBOL
8   8             Armenia  126   1103        1104          UEFA
9   9               Aruba  157    724         724      CONCACAF
10 10           Australia    7   1963        1963           AFC</code></pre>
</div>
</div>
<p>このように<code>List1</code>内の1番目のデータが抽出されました。こちらのデータ構造は何でしょうか。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1"></a><span class="fu">class</span>(List1[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
</div>
<p>既に予想したかと思いますが、データフレームとして抽出されました。ここから更に、3行目のデータを抽出するには、<code>[[]]</code>の後に<code>[3, ]</code>を付けます。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1"></a>List1[[<span class="dv">1</span>]][<span class="dv">3</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID           Team Rank Points Prev_Points Confederation
3  3 American Samoa  133   1030        1030           OFC</code></pre>
</div>
</div>
<p>先ほどリストの要素の抽出には「<code>[]</code>でなく、<code>[[]]</code>です」と申しましたが、実は<code>[]</code>も使用可能です。やってみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1"></a>List1[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
   ID                Team Rank Points Prev_Points Confederation
1   1             Albania   75   1325        1316          UEFA
2   2             Algeria   85   1271        1271           CAF
3   3      American Samoa  133   1030        1030           OFC
4   4             Andorra  155    749         749          UEFA
5   5              Angola  121   1117        1117           CAF
6   6 Antigua and Barbuda  153    787         787      CONCACAF
7   7           Argentina   32   1659        1659      CONMEBOL
8   8             Armenia  126   1103        1104          UEFA
9   9               Aruba  157    724         724      CONCACAF
10 10           Australia    7   1963        1963           AFC</code></pre>
</div>
</div>
<p><code>[[]]</code>を使った抽出とあまり変わらないですね。しかし、重要な違いが一つあります。それはデータ構造です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1"></a><span class="fu">class</span>(List1[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
</div>
<p><code>[]</code>で抽出したリストの要素のデータ構造もまたリスト型です。この場合、先ほどのように<code>[x, ]</code>を使って、<code>x</code>行目のデータを抽出することはできません。なぜなら、<code>[行, 列]</code>による要素の抽出はデータフレームのためのものであって、リスト型のためのものではないからです。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1"></a>List1[<span class="dv">1</span>][<span class="dv">3</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in List1[1][3, ]: incorrect number of dimensions</code></pre>
</div>
</div>
<p>このようにエラーが表示されます。</p>
<p><strong>要素の名前を利用する方法</strong></p>
<p><code>List2</code>のようにリストの要素に名前を付けた場合、これまでの方法に加え<code>[["要素名"]]</code>と<code>$要素名</code>を使った操作が可能です<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>。<code>List2</code>から男子ランキング (<code>Men</code>)を抽出してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1"></a>List2[[<span class="st">"Men"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ID                Team Rank Points Prev_Points Confederation
1   1         Afghanistan  149   1052        1052           AFC
2   2             Albania   66   1356        1356          UEFA
3   3             Algeria   35   1482        1482           CAF
4   4      American Samoa  192    900         900           OFC
5   5             Andorra  135   1082        1082          UEFA
6   6              Angola  124   1136        1136           CAF
7   7            Anguilla  210    821         821      CONCACAF
8   8 Antigua and Barbuda  126   1127        1127      CONCACAF
9   9           Argentina    9   1623        1623      CONMEBOL
10 10             Armenia  102   1213        1213          UEFA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1"></a>List2<span class="sc">$</span>Men</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ID                Team Rank Points Prev_Points Confederation
1   1         Afghanistan  149   1052        1052           AFC
2   2             Albania   66   1356        1356          UEFA
3   3             Algeria   35   1482        1482           CAF
4   4      American Samoa  192    900         900           OFC
5   5             Andorra  135   1082        1082          UEFA
6   6              Angola  124   1136        1136           CAF
7   7            Anguilla  210    821         821      CONCACAF
8   8 Antigua and Barbuda  126   1127        1127      CONCACAF
9   9           Argentina    9   1623        1623      CONMEBOL
10 10             Armenia  102   1213        1213          UEFA</code></pre>
</div>
</div>
<p>どれも結果は同じです。また、それぞれのデータ構造もデータフレームです。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1"></a><span class="fu">class</span>(List2[[<span class="st">"Men"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1"></a><span class="fu">class</span>(List2<span class="sc">$</span>Men)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
</div>
<p>したがって、<code>[行番号, 列番号]</code>のようにデータフレームの操作が可能です。<code>Men</code>要素から10行目のデータを抽出してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1"></a>List2[[<span class="st">"Men"</span>]][<span class="dv">10</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ID    Team Rank Points Prev_Points Confederation
10 10 Armenia  102   1213        1213          UEFA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1"></a>List2<span class="sc">$</span>Men[<span class="dv">10</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ID    Team Rank Points Prev_Points Confederation
10 10 Armenia  102   1213        1213          UEFA</code></pre>
</div>
</div>
<p>もちろん、名前を付けた場合であっても、要素の番号を利用した操作も可能です。自分でリスト型を作成する際には各要素に名前を付けた方が分かりやすくて良いでしょう。</p>
</section>
</section>
<section id="sec-datastructure_array" class="level2" data-number="10.6">
<h2 data-number="10.6" class="anchored" data-anchor-id="sec-datastructure_array"><span class="header-section-number">10.6</span> 配列 (array)</h2>
<p>配列は行列の拡張版であり、行列は配列の特殊な形です。これまでのRでは行列と配列は区別されてきましたが、R 4.0.0以降、行列は配列の属するデータ構造となりました。</p>
<p>配列型は簡単にいうと、同じサイズの行列を数枚重ねたものです。 <a href="#fig-structure_array" class="quarto-xref">図&nbsp;<span>10.1</span></a> は配列型のイメージを表したものです。</p>
<div id="fig-structure_array" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-structure_array-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figs/DataStructure/array.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-structure_array-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
図&nbsp;10.1: 配列型データのイメージ
</figcaption>
</figure>
</div>
<p>したがって、配列型は行と列以外にも、層の要素も持つことになります。複数の行列で構成されている点では、リスト型と類似していますが、配列型は<strong>同じサイズ</strong>の<strong>行列</strong>のみで構成されている点が特徴です。</p>
<p>配列型は普段、扱う機会があまりありませんが、マルコフ連鎖モンテカルロ法 (MCMC)でベイジアン推定を行った後の事後分布データは配列型で格納される場合があります。</p>
<section id="配列型データの作成" class="level3" data-number="10.6.1">
<h3 data-number="10.6.1" class="anchored" data-anchor-id="配列型データの作成"><span class="header-section-number">10.6.1</span> 配列型データの作成</h3>
<p>各行列は3行4列とし、4層構造とします。まずは、同じサイズの行列を作成し、それぞれ<code>Mat1</code>、<code>Mat2</code>、<code>Mat3</code>、<code>Mat4</code>と名付けます。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1"></a>Mat1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">12</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>), <span class="at">byrow =</span> <span class="cn">TRUE</span>, <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb221-2"><a href="#cb221-2"></a>Mat2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">12</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>), <span class="at">byrow =</span> <span class="cn">TRUE</span>, <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb221-3"><a href="#cb221-3"></a>Mat3 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">12</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>), <span class="at">byrow =</span> <span class="cn">TRUE</span>, <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb221-4"><a href="#cb221-4"></a>Mat4 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">12</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>), <span class="at">byrow =</span> <span class="cn">TRUE</span>, <span class="at">nrow =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>sample()</code>関数は初めてですね。これは与えられたベクトルの要素から無作為に要素を抽出する関数です。<code>sample(1:12, n)</code>なら<code>c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11,1 2)</code>から無作為に<code>n</code>個の要素を抽出するという意味です。<code>replace = TRUE</code>を指定すると、反復抽出、つまり、一回抽出された要素であっても抽出される可能性があることを意味します。デフォルトは<code>FALSE</code>ですが、この場合、一旦抽出された要素は二度と抽出されません。それではそれぞれの行列の中身を見てみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1"></a>Mat1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]   11    3    7   10
[2,]    1   12   10    6
[3,]    6    1    1    4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1"></a>Mat2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    4    8   11   12
[2,]    1    4   11    1
[3,]    8    1    6    7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1"></a>Mat3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    1   12    6    2
[2,]    1    4    7    7
[3,]    4    6    4    2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1"></a>Mat4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]   10    7    8    2
[2,]    2    3   10    2
[3,]   12    4    3    1</code></pre>
</div>
</div>
<p>配列型データを作成するには<code>array()</code>関数を使います。引数としては行列名を<code>c()</code>で繋ぎ<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a>、<code>dim =</code>でarrayの大きさを指定するだけです。配列を作成した後はそのデータ構造も確認してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1"></a>Array1 <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(Mat1, Mat2, Mat3, Mat4), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb230-2"><a href="#cb230-2"></a><span class="fu">class</span>(Array1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "array"</code></pre>
</div>
</div>
<p><code>dim = c(m, n, z)</code>の部分ですが、これは「<code>m</code>行<code>n</code>列の行列が<code>z</code>枚重ねる」という意味です。今回は3行4列の行列を4枚重ねるので<code>dim = c(3, 4, 4)</code>です。それでは<code>Array1</code>の中身を見てみます。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1"></a>Array1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , 1

     [,1] [,2] [,3] [,4]
[1,]   11    3    7   10
[2,]    1   12   10    6
[3,]    6    1    1    4

, , 2

     [,1] [,2] [,3] [,4]
[1,]    4    8   11   12
[2,]    1    4   11    1
[3,]    8    1    6    7

, , 3

     [,1] [,2] [,3] [,4]
[1,]    1   12    6    2
[2,]    1    4    7    7
[3,]    4    6    4    2

, , 4

     [,1] [,2] [,3] [,4]
[1,]   10    7    8    2
[2,]    2    3   10    2
[3,]   12    4    3    1</code></pre>
</div>
</div>
<p>このように一つのオブジェクト内に複数の行列が格納されたオブジェクトが生成されます。</p>
</section>
<section id="配列型データの操作" class="level3" data-number="10.6.2">
<h3 data-number="10.6.2" class="anchored" data-anchor-id="配列型データの操作"><span class="header-section-number">10.6.2</span> 配列型データの操作</h3>
<p>配列型データの操作は行列型に似ていますが、層というもう一つの次元があるため、<code>行列名[行番号, 列番号]</code>ではなく、<code>配列名[行番号, 列番号, 層番号]</code>を使います。たとえば、<code>Array1</code>の3番目の行列を抽出したい場合、<code>Array1[, , 3]</code>と入力します。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1"></a>Array1[, , <span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    1   12    6    2
[2,]    1    4    7    7
[3,]    4    6    4    2</code></pre>
</div>
</div>
<p>また、2番目の行列の3行目・1列目の要素を抽出するなら<code>Array1[3, 1, 2]</code>と入力します。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1"></a>Array1[<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8</code></pre>
</div>
</div>
<p>配列型における操作の特徴の一つは全ての行列が同じ大きさを持つため、層を貫通した操作ができるという点です。たとえば、全ての層の2行目を抽出するなら、層番号を指定せず、行番号のみで抽出します。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1"></a>Array1[<span class="dv">2</span>, , ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    1    1    1    2
[2,]   12    4    4    3
[3,]   10   11    7   10
[4,]    6    1    7    2</code></pre>
</div>
</div>
<p>ただ、返された結果は配列型でなく行列型であることに注意しましょう。たとえば、1番目の行列の2行目の要素は1, 12, 10, 6ですが、これは先ほど抽出された行列の1列目に該当します。また、2番目の行列の2行目の要素は1, 4, 11, 1であり、これは先ほどの抽出された行列の2列目となります。全層において特定の一列を抽出しても同じです。これは各層において抽出されたデータが行列でなく、ベクトルだからです。</p>
<p>一方、<strong>複数</strong>の行または列を抽出した場合、結果は配列型です。<code>Array1</code>の各層から1・2行目と1・2列目の要素、つまり大きさが2 <span class="math inline">\(\times\)</span> 2の行列を抽出してみましょう。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1"></a>Array1[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , 1

     [,1] [,2]
[1,]   11    3
[2,]    1   12

, , 2

     [,1] [,2]
[1,]    4    8
[2,]    1    4

, , 3

     [,1] [,2]
[1,]    1   12
[2,]    1    4

, , 4

     [,1] [,2]
[1,]   10    7
[2,]    2    3</code></pre>
</div>
</div>
<p>このように各層において抽出されたデータが行列だからです。自分の操作から得られた結果がどのようなデータ型・データ構造かを予め知っておくことで分析の効率が上がるでしょう。</p>
<p><strong>行列に名前を付けたい</strong></p>
<p>今回は各行列に1, 2, 3, 4という番号のみ割り当てましたが、実は行列に名前を付けることも可能です。そのためには配列データ作成時、<code>dimnames =</code>引数を指定する必要があります。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1"></a>Array2 <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(Mat1, Mat2, Mat3, Mat4), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb242-2"><a href="#cb242-2"></a>                <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="cn">NULL</span>, </span>
<span id="cb242-3"><a href="#cb242-3"></a>                                <span class="cn">NULL</span>, </span>
<span id="cb242-4"><a href="#cb242-4"></a>                                <span class="fu">c</span>(<span class="st">"M1"</span>, <span class="st">"M2"</span>, <span class="st">"M3"</span>, <span class="st">"M4"</span>))</span>
<span id="cb242-5"><a href="#cb242-5"></a>                )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>dimnames =</code>引数は必ず長さ3のリスト型である必要があります。1番目と2番目の要素は行名と列名ですが、行列において一般的に使われないため、ここでは<code>NULL</code>にし、3番目の要素、つまり各層の名前だけを指定します。ここではそれぞれの層を<code>M1</code>、<code>M2</code>、<code>M3</code>、<code>M4</code>と名付けました。ここで<code>M4</code>のみを抽出する場合は、以下のように操作します。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1"></a>Array2[, , <span class="st">"M4"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]   10    7    8    2
[2,]    2    3   10    2
[3,]   12    4    3    1</code></pre>
</div>
</div>
<p>むろん、これまでと同様、番号で抽出することも可能です。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode numberSource r numberLines number-lines code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1"></a>Array2[, , <span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]   10    7    8    2
[2,]    2    3   10    2
[3,]   12    4    3    1</code></pre>
</div>
</div>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>他にも要素ごとの積 (element-wise product)、シューア積 (Schur product)と呼ばれたりします。<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>行列式が0でない場合において一次方程式には一組の解があります。<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>なぜなら2行目が1行目の0.5倍になっているからです。<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p><code>NA</code>も可能です。<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p><code>tibble</code>型を直接作成するには<code>tibble()</code>関数を使いますが、<code>data.frame()</code>と同じ使い方で問題ありません。他にも<code>tribble()</code>関数を使った方法もありますが、詳細は<code>?tribble</code>で確認してください。<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>厳密には国別ではありません。イギリスの場合、イングランド、スコットランド、北アイルランド、ウェールズがそれぞれ独立したチームとしてFIFAに加盟しています。<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p><code>["要素名"]</code>で抽出することも可能ですが、この場合、返される結果はリスト型になります。<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>元々はベクトルを入力しますが、行列を<code>c()</code>で繋ぐと自動的にベクトルに変換されます。<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.jaysong\.net\/RBook\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./datatype.html" class="pagination-link" aria-label="データ型">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">データ型</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./programming.html" class="pagination-link" aria-label="Rプログラミングの基礎">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Rプログラミングの基礎</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2024, <a href="https://www.jaysong.net">Jaehyun Song</a> and <a href="https://yukiyanai.github.io/">Yuki Yanai</a></p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>