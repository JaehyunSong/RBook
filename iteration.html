<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>24. 反復処理 | 私たちのR: ベストプラクティスの探究</title>
  <meta name="description" content="R Not for Everyone: An Esoteric Guide." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="24. 反復処理 | 私たちのR: ベストプラクティスの探究" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="R Not for Everyone: An Esoteric Guide." />
  <meta name="github-repo" content="JaehyunSong/RBook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="24. 反復処理 | 私たちのR: ベストプラクティスの探究" />
  
  <meta name="twitter:description" content="R Not for Everyone: An Esoteric Guide." />
  

<meta name="author" content="宋財泫 (Jaehyun Song)・矢内勇生 (Yuki Yanai)" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="HTML/apple-favicon.png" />
  <link rel="shortcut icon" href="HTML/favicon.png" type="image/x-icon" />
<link rel="prev" href="scraping.html"/>
<link rel="next" href="rmarkdown.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-165592410-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-165592410-1');
  gtag('set', {'user_id': 'USER_ID'}); 
</script>

<meta name="google-site-verification" content="QJouPRaPKBPU1jDp6VaBuFbVV5imTI-Aazl_ScJwVgU" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="HTML/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">私たちのR</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> 紹介</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#progress"><i class="fa fa-check"></i><b>1.1</b> 進捗状況</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#purpose"><i class="fa fa-check"></i><b>1.2</b> 本書の目的と対象</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#about-author"><i class="fa fa-check"></i><b>1.3</b> 著者紹介</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#about-toc"><i class="fa fa-check"></i><b>1.4</b> 本書の構成</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#about-download"><i class="fa fa-check"></i><b>1.5</b> データのダウンロード</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#about-howtoread"><i class="fa fa-check"></i><b>1.6</b> 本書における表記法</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#about-copyright"><i class="fa fa-check"></i><b>1.7</b> 著作権</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="aboutR.html"><a href="aboutR.html"><i class="fa fa-check"></i><b>2</b> R?</a>
<ul>
<li class="chapter" data-level="2.1" data-path="aboutR.html"><a href="aboutR.html#WhatIsR"><i class="fa fa-check"></i><b>2.1</b> Rとは</a></li>
<li class="chapter" data-level="2.2" data-path="aboutR.html"><a href="aboutR.html#WhyR"><i class="fa fa-check"></i><b>2.2</b> Why R?</a></li>
<li class="chapter" data-level="2.3" data-path="aboutR.html"><a href="aboutR.html#GUI_IDE"><i class="fa fa-check"></i><b>2.3</b> GUIとIDE</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="aboutR.html"><a href="aboutR.html#gui"><i class="fa fa-check"></i><b>2.3.1</b> GUI</a></li>
<li class="chapter" data-level="2.3.2" data-path="aboutR.html"><a href="aboutR.html#aboutR-IDE"><i class="fa fa-check"></i><b>2.3.2</b> IDE</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>3</b> Rのインストール</a>
<ul>
<li class="chapter" data-level="3.1" data-path="installation.html"><a href="installation.html#install-R"><i class="fa fa-check"></i><b>3.1</b> Rのインストール</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="installation.html"><a href="installation.html#macosの場合"><i class="fa fa-check"></i><b>3.1.1</b> macOSの場合</a></li>
<li class="chapter" data-level="3.1.2" data-path="installation.html"><a href="installation.html#linuxの場合"><i class="fa fa-check"></i><b>3.1.2</b> Linuxの場合</a></li>
<li class="chapter" data-level="3.1.3" data-path="installation.html"><a href="installation.html#windowsの場合"><i class="fa fa-check"></i><b>3.1.3</b> Windowsの場合</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="installation.html"><a href="installation.html#rbasic-profile"><i class="fa fa-check"></i><b>3.2</b> .Rprofileの設定</a></li>
<li class="chapter" data-level="3.3" data-path="installation.html"><a href="installation.html#install-rstudio"><i class="fa fa-check"></i><b>3.3</b> RStudio</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="installation.html"><a href="installation.html#rstudioのインストール"><i class="fa fa-check"></i><b>3.3.1</b> RStudioのインストール</a></li>
<li class="chapter" data-level="3.3.2" data-path="installation.html"><a href="installation.html#rstudioの起動と設定"><i class="fa fa-check"></i><b>3.3.2</b> RStudioの起動と設定</a></li>
<li class="chapter" data-level="3.3.3" data-path="installation.html"><a href="installation.html#rstudioの設定"><i class="fa fa-check"></i><b>3.3.3</b> RStudioの設定</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="installation.html"><a href="installation.html#install-package"><i class="fa fa-check"></i><b>3.4</b> パッケージのインストール</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="installation.html"><a href="installation.html#パッケージのインストール"><i class="fa fa-check"></i><b>3.4.1</b> パッケージのインストール</a></li>
<li class="chapter" data-level="3.4.2" data-path="installation.html"><a href="installation.html#パッケージの読み込み"><i class="fa fa-check"></i><b>3.4.2</b> パッケージの読み込み</a></li>
<li class="chapter" data-level="3.4.3" data-path="installation.html"><a href="installation.html#必須パッケージのインストール"><i class="fa fa-check"></i><b>3.4.3</b> 必須パッケージのインストール</a></li>
<li class="chapter" data-level="3.4.4" data-path="installation.html"><a href="installation.html#パッケージのインストールが出来ない場合-ubuntu"><i class="fa fa-check"></i><b>3.4.4</b> パッケージのインストールが出来ない場合 (Ubuntu)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ide.html"><a href="ide.html"><i class="fa fa-check"></i><b>4</b> IDEの導入</a>
<ul>
<li class="chapter" data-level="4.1" data-path="ide.html"><a href="ide.html#ide-install"><i class="fa fa-check"></i><b>4.1</b> RStudioのインストールと起動</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="ide.html"><a href="ide.html#macosの場合-1"><i class="fa fa-check"></i><b>4.1.1</b> macOSの場合</a></li>
<li class="chapter" data-level="4.1.2" data-path="ide.html"><a href="ide.html#linux-ubuntuの場合"><i class="fa fa-check"></i><b>4.1.2</b> Linux (Ubuntu)の場合</a></li>
<li class="chapter" data-level="4.1.3" data-path="ide.html"><a href="ide.html#windowsの場合-1"><i class="fa fa-check"></i><b>4.1.3</b> Windowsの場合</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="ide.html"><a href="ide.html#ide-setting"><i class="fa fa-check"></i><b>4.2</b> RStudioの設定</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="ide.html"><a href="ide.html#設定画面の開き方"><i class="fa fa-check"></i><b>4.2.1</b> 設定画面の開き方</a></li>
<li class="chapter" data-level="4.2.2" data-path="ide.html"><a href="ide.html#私たちのrstudio"><i class="fa fa-check"></i><b>4.2.2</b> 私たちのRStudio</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="ide.html"><a href="ide.html#rstudio-cloudについて"><i class="fa fa-check"></i><b>4.3</b> RStudio Cloudについて</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="R-Customize.html"><a href="R-Customize.html"><i class="fa fa-check"></i><b>5</b> 分析環境のカスタマイズ</a></li>
<li class="chapter" data-level="6" data-path="process.html"><a href="process.html"><i class="fa fa-check"></i><b>6</b> 分析の手順</a></li>
<li class="chapter" data-level="7" data-path="rbasic.html"><a href="rbasic.html"><i class="fa fa-check"></i><b>7</b> 基本的な操作</a>
<ul>
<li class="chapter" data-level="" data-path="rbasic.html"><a href="rbasic.html#目次"><i class="fa fa-check"></i>目次</a></li>
<li class="chapter" data-level="7.1" data-path="rbasic.html"><a href="rbasic.html#rbasic-compbasic"><i class="fa fa-check"></i><b>7.1</b> コンピュータの基礎知識</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="rbasic.html"><a href="rbasic.html#ファイル名"><i class="fa fa-check"></i><b>7.1.1</b> ファイル名</a></li>
<li class="chapter" data-level="7.1.2" data-path="rbasic.html"><a href="rbasic.html#ファイルシステムとパス"><i class="fa fa-check"></i><b>7.1.2</b> ファイルシステムとパス</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="rbasic.html"><a href="rbasic.html#rbasic-project"><i class="fa fa-check"></i><b>7.2</b> 「プロジェクト」のすゝめ</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="rbasic.html"><a href="rbasic.html#プロジェクト"><i class="fa fa-check"></i><b>7.2.1</b> プロジェクト</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="rbasic.html"><a href="rbasic.html#rbasic-calc"><i class="fa fa-check"></i><b>7.3</b> 電卓としてのR</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="rbasic.html"><a href="rbasic.html#算術演算子"><i class="fa fa-check"></i><b>7.3.1</b> 算術演算子</a></li>
<li class="chapter" data-level="7.3.2" data-path="rbasic.html"><a href="rbasic.html#論理演算子"><i class="fa fa-check"></i><b>7.3.2</b> 論理演算子</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="rbasic.html"><a href="rbasic.html#rbasic-input"><i class="fa fa-check"></i><b>7.4</b> 格納とオブジェクトの作成</a></li>
<li class="chapter" data-level="7.5" data-path="rbasic.html"><a href="rbasic.html#rbasic-extract"><i class="fa fa-check"></i><b>7.5</b> 要素の抽出</a></li>
<li class="chapter" data-level="7.6" data-path="rbasic.html"><a href="rbasic.html#rbasic-exercise"><i class="fa fa-check"></i><b>7.6</b> 演習問題</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="io.html"><a href="io.html"><i class="fa fa-check"></i><b>8</b> データの入出力</a>
<ul>
<li class="chapter" data-level="" data-path="io.html"><a href="io.html#目次-1"><i class="fa fa-check"></i>目次</a></li>
<li class="chapter" data-level="8.1" data-path="io.html"><a href="io.html#io-read"><i class="fa fa-check"></i><b>8.1</b> データの読み込み</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="io.html"><a href="io.html#csvファイルの場合"><i class="fa fa-check"></i><b>8.1.1</b> csvファイルの場合</a></li>
<li class="chapter" data-level="8.1.2" data-path="io.html"><a href="io.html#その他のフォーマット"><i class="fa fa-check"></i><b>8.1.2</b> その他のフォーマット</a></li>
<li class="chapter" data-level="8.1.3" data-path="io.html"><a href="io.html#rdataファイルの場合"><i class="fa fa-check"></i><b>8.1.3</b> RDataファイルの場合</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="io.html"><a href="io.html#io-export"><i class="fa fa-check"></i><b>8.2</b> データの書き出し</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="io.html"><a href="io.html#csvファイル"><i class="fa fa-check"></i><b>8.2.1</b> csvファイル</a></li>
<li class="chapter" data-level="8.2.2" data-path="io.html"><a href="io.html#rdataファイル"><i class="fa fa-check"></i><b>8.2.2</b> RDataファイル</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="datatype.html"><a href="datatype.html"><i class="fa fa-check"></i><b>9</b> データの型</a>
<ul>
<li class="chapter" data-level="9.1" data-path="datatype.html"><a href="datatype.html#WhatIsDatatype"><i class="fa fa-check"></i><b>9.1</b> データ型とは</a></li>
<li class="chapter" data-level="9.2" data-path="datatype.html"><a href="datatype.html#type-logical"><i class="fa fa-check"></i><b>9.2</b> Logical</a></li>
<li class="chapter" data-level="9.3" data-path="datatype.html"><a href="datatype.html#type-numeric"><i class="fa fa-check"></i><b>9.3</b> Numeric</a></li>
<li class="chapter" data-level="9.4" data-path="datatype.html"><a href="datatype.html#type-complex"><i class="fa fa-check"></i><b>9.4</b> Complex</a></li>
<li class="chapter" data-level="9.5" data-path="datatype.html"><a href="datatype.html#type-character"><i class="fa fa-check"></i><b>9.5</b> Character</a></li>
<li class="chapter" data-level="9.6" data-path="datatype.html"><a href="datatype.html#type-factor"><i class="fa fa-check"></i><b>9.6</b> Factor</a></li>
<li class="chapter" data-level="9.7" data-path="datatype.html"><a href="datatype.html#type-date"><i class="fa fa-check"></i><b>9.7</b> Date</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="datatype.html"><a href="datatype.html#なぜdate型があるのか"><i class="fa fa-check"></i><b>9.7.1</b> なぜDate型があるのか</a></li>
<li class="chapter" data-level="9.7.2" data-path="datatype.html"><a href="datatype.html#date型の作り方"><i class="fa fa-check"></i><b>9.7.2</b> Date型の作り方</a></li>
<li class="chapter" data-level="9.7.3" data-path="datatype.html"><a href="datatype.html#posixctposixlt型について"><i class="fa fa-check"></i><b>9.7.3</b> POSIXct、POSIXlt型について</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="datatype.html"><a href="datatype.html#type-na"><i class="fa fa-check"></i><b>9.8</b> NA</a></li>
<li class="chapter" data-level="9.9" data-path="datatype.html"><a href="datatype.html#type-null"><i class="fa fa-check"></i><b>9.9</b> NULL</a></li>
<li class="chapter" data-level="9.10" data-path="datatype.html"><a href="datatype.html#type-nan"><i class="fa fa-check"></i><b>9.10</b> NaN</a></li>
<li class="chapter" data-level="9.11" data-path="datatype.html"><a href="datatype.html#type-inf"><i class="fa fa-check"></i><b>9.11</b> Inf</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="datastructure.html"><a href="datastructure.html"><i class="fa fa-check"></i><b>10</b> データの構造</a>
<ul>
<li class="chapter" data-level="10.1" data-path="datastructure.html"><a href="datastructure.html#WhatIsDatastructure"><i class="fa fa-check"></i><b>10.1</b> データ構造とは</a></li>
<li class="chapter" data-level="10.2" data-path="datastructure.html"><a href="datastructure.html#structure-vector"><i class="fa fa-check"></i><b>10.2</b> ベクトル (vector)</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="datastructure.html"><a href="datastructure.html#ベクトルの作り方"><i class="fa fa-check"></i><b>10.2.1</b> ベクトルの作り方</a></li>
<li class="chapter" data-level="10.2.2" data-path="datastructure.html"><a href="datastructure.html#ベクトルの操作"><i class="fa fa-check"></i><b>10.2.2</b> ベクトルの操作</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="datastructure.html"><a href="datastructure.html#structure-matrix"><i class="fa fa-check"></i><b>10.3</b> 行列 (matrix)</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="datastructure.html"><a href="datastructure.html#行列の作り方"><i class="fa fa-check"></i><b>10.3.1</b> 行列の作り方</a></li>
<li class="chapter" data-level="10.3.2" data-path="datastructure.html"><a href="datastructure.html#行列の操作"><i class="fa fa-check"></i><b>10.3.2</b> 行列の操作</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="datastructure.html"><a href="datastructure.html#structure-dataframe"><i class="fa fa-check"></i><b>10.4</b> データフレーム (data.frame)</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="datastructure.html"><a href="datastructure.html#データフレームの作成"><i class="fa fa-check"></i><b>10.4.1</b> データフレームの作成</a></li>
<li class="chapter" data-level="10.4.2" data-path="datastructure.html"><a href="datastructure.html#データフレームの操作"><i class="fa fa-check"></i><b>10.4.2</b> データフレームの操作</a></li>
<li class="chapter" data-level="10.4.3" data-path="datastructure.html"><a href="datastructure.html#tibble型"><i class="fa fa-check"></i><b>10.4.3</b> tibble型</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="datastructure.html"><a href="datastructure.html#structure-list"><i class="fa fa-check"></i><b>10.5</b> リスト (list)</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="datastructure.html"><a href="datastructure.html#リスト型データの作成"><i class="fa fa-check"></i><b>10.5.1</b> リスト型データの作成</a></li>
<li class="chapter" data-level="10.5.2" data-path="datastructure.html"><a href="datastructure.html#リスト型データの操作"><i class="fa fa-check"></i><b>10.5.2</b> リスト型データの操作</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="datastructure.html"><a href="datastructure.html#structure-array"><i class="fa fa-check"></i><b>10.6</b> 配列 (array)</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="datastructure.html"><a href="datastructure.html#配列型データの作成"><i class="fa fa-check"></i><b>10.6.1</b> 配列型データの作成</a></li>
<li class="chapter" data-level="10.6.2" data-path="datastructure.html"><a href="datastructure.html#配列型データの操作"><i class="fa fa-check"></i><b>10.6.2</b> 配列型データの操作</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="datastructure.html"><a href="datastructure.html#structure-exercise"><i class="fa fa-check"></i><b>10.7</b> 練習問題</a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="datastructure.html"><a href="datastructure.html#ベクトル"><i class="fa fa-check"></i><b>10.7.1</b> ベクトル</a></li>
<li class="chapter" data-level="10.7.2" data-path="datastructure.html"><a href="datastructure.html#行列"><i class="fa fa-check"></i><b>10.7.2</b> 行列</a></li>
<li class="chapter" data-level="10.7.3" data-path="datastructure.html"><a href="datastructure.html#データフレーム"><i class="fa fa-check"></i><b>10.7.3</b> データフレーム</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="programming.html"><a href="programming.html"><i class="fa fa-check"></i><b>11</b> Rプログラミングの基礎</a>
<ul>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#目次-2"><i class="fa fa-check"></i>目次</a></li>
<li class="chapter" data-level="11.1" data-path="programming.html"><a href="programming.html#programming-intro"><i class="fa fa-check"></i><b>11.1</b> R言語の基礎概念</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="programming.html"><a href="programming.html#オブジェクト"><i class="fa fa-check"></i><b>11.1.1</b> オブジェクト</a></li>
<li class="chapter" data-level="11.1.2" data-path="programming.html"><a href="programming.html#クラス"><i class="fa fa-check"></i><b>11.1.2</b> クラス</a></li>
<li class="chapter" data-level="11.1.3" data-path="programming.html"><a href="programming.html#関数と引数"><i class="fa fa-check"></i><b>11.1.3</b> 関数と引数</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="programming.html"><a href="programming.html#programming-style"><i class="fa fa-check"></i><b>11.2</b> Rのコーディングスタイル</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="programming.html"><a href="programming.html#オブジェクト名"><i class="fa fa-check"></i><b>11.2.1</b> オブジェクト名</a></li>
<li class="chapter" data-level="11.2.2" data-path="programming.html"><a href="programming.html#改行"><i class="fa fa-check"></i><b>11.2.2</b> 改行</a></li>
<li class="chapter" data-level="11.2.3" data-path="programming.html"><a href="programming.html#スペースとインデント"><i class="fa fa-check"></i><b>11.2.3</b> スペースとインデント</a></li>
<li class="chapter" data-level="11.2.4" data-path="programming.html"><a href="programming.html#代入"><i class="fa fa-check"></i><b>11.2.4</b> 代入</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="programming.html"><a href="programming.html#programming-iteration"><i class="fa fa-check"></i><b>11.3</b> 反復</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="programming.html"><a href="programming.html#for-による反復"><i class="fa fa-check"></i><b>11.3.1</b> <code>for</code> による反復</a></li>
<li class="chapter" data-level="11.3.2" data-path="programming.html"><a href="programming.html#whileによる反復"><i class="fa fa-check"></i><b>11.3.2</b> <code>while</code>による反復</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="programming.html"><a href="programming.html#programming-condition"><i class="fa fa-check"></i><b>11.4</b> 条件分岐</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="programming.html"><a href="programming.html#ifelse-ifelse-による条件分岐"><i class="fa fa-check"></i><b>11.4.1</b> <code>if</code>、<code>else if</code>、<code>else</code> による条件分岐</a></li>
<li class="chapter" data-level="11.4.2" data-path="programming.html"><a href="programming.html#ifelseによる条件分岐"><i class="fa fa-check"></i><b>11.4.2</b> <code>ifelse()</code>による条件分岐</a></li>
<li class="chapter" data-level="11.4.3" data-path="programming.html"><a href="programming.html#switchによる条件分岐"><i class="fa fa-check"></i><b>11.4.3</b> <code>switch()</code>による条件分岐</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="programming.html"><a href="programming.html#programming-exercise"><i class="fa fa-check"></i><b>11.5</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>12</b> 関数の自作</a>
<ul>
<li class="chapter" data-level="12.1" data-path="functions.html"><a href="functions.html#func-intro"><i class="fa fa-check"></i><b>12.1</b> 関数の作成</a></li>
<li class="chapter" data-level="12.2" data-path="functions.html"><a href="functions.html#func-adv"><i class="fa fa-check"></i><b>12.2</b> ちょっと複雑な関数</a></li>
<li class="chapter" data-level="12.3" data-path="functions.html"><a href="functions.html#func-in-func"><i class="fa fa-check"></i><b>12.3</b> 関数 in 関数</a></li>
<li class="chapter" data-level="12.4" data-path="functions.html"><a href="functions.html#func-exercise"><i class="fa fa-check"></i><b>12.4</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="datahandling1.html"><a href="datahandling1.html"><i class="fa fa-check"></i><b>13</b> データハンドリング [基礎編: 抽出]</a>
<ul>
<li class="chapter" data-level="13.1" data-path="datahandling1.html"><a href="datahandling1.html#handling1-intro"><i class="fa fa-check"></i><b>13.1</b> データハンドリングとtidyverse</a></li>
<li class="chapter" data-level="13.2" data-path="datahandling1.html"><a href="datahandling1.html#handling1-pipe"><i class="fa fa-check"></i><b>13.2</b> パイプ演算子 (<code>%&gt;%</code>)</a></li>
<li class="chapter" data-level="13.3" data-path="datahandling1.html"><a href="datahandling1.html#handling1-select"><i class="fa fa-check"></i><b>13.3</b> 列の抽出</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="datahandling1.html"><a href="datahandling1.html#特定の列を抽出する"><i class="fa fa-check"></i><b>13.3.1</b> 特定の列を抽出する</a></li>
<li class="chapter" data-level="13.3.2" data-path="datahandling1.html"><a href="datahandling1.html#特定の列を抽出し列名を変更する"><i class="fa fa-check"></i><b>13.3.2</b> 特定の列を抽出し、列名を変更する</a></li>
<li class="chapter" data-level="13.3.3" data-path="datahandling1.html"><a href="datahandling1.html#特定の列を除外する"><i class="fa fa-check"></i><b>13.3.3</b> 特定の列を除外する</a></li>
<li class="chapter" data-level="13.3.4" data-path="datahandling1.html"><a href="datahandling1.html#隣接した列を指定する"><i class="fa fa-check"></i><b>13.3.4</b> 隣接した列を指定する</a></li>
<li class="chapter" data-level="13.3.5" data-path="datahandling1.html"><a href="datahandling1.html#一部の列の順番だけを変える"><i class="fa fa-check"></i><b>13.3.5</b> 一部の列の順番だけを変える</a></li>
<li class="chapter" data-level="13.3.6" data-path="datahandling1.html"><a href="datahandling1.html#selectの便利な機能"><i class="fa fa-check"></i><b>13.3.6</b> <code>select()</code>の便利な機能</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="datahandling1.html"><a href="datahandling1.html#handling1-filter"><i class="fa fa-check"></i><b>13.4</b> 行の抽出</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="datahandling1.html"><a href="datahandling1.html#指定した行を抽出する"><i class="fa fa-check"></i><b>13.4.1</b> 指定した行を抽出する</a></li>
<li class="chapter" data-level="13.4.2" data-path="datahandling1.html"><a href="datahandling1.html#条件に合致する行を抽出する"><i class="fa fa-check"></i><b>13.4.2</b> 条件に合致する行を抽出する</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="datahandling1.html"><a href="datahandling1.html#handling1-arrange"><i class="fa fa-check"></i><b>13.5</b> 行のソート</a></li>
<li class="chapter" data-level="13.6" data-path="datahandling1.html"><a href="datahandling1.html#handling1-exercise"><i class="fa fa-check"></i><b>13.6</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="datahandling2.html"><a href="datahandling2.html"><i class="fa fa-check"></i><b>14</b> データハンドリング [基礎編: 拡張]</a>
<ul>
<li class="chapter" data-level="14.1" data-path="datahandling2.html"><a href="datahandling2.html#handling2-summarise"><i class="fa fa-check"></i><b>14.1</b> 記述統計量の計算</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="datahandling2.html"><a href="datahandling2.html#summariseによる記述統計量の計算"><i class="fa fa-check"></i><b>14.1.1</b> <code>summarise()</code>による記述統計量の計算</a></li>
<li class="chapter" data-level="14.1.2" data-path="datahandling2.html"><a href="datahandling2.html#summariseに使える便利な関数"><i class="fa fa-check"></i><b>14.1.2</b> <code>summarise()</code>に使える便利な関数</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="datahandling2.html"><a href="datahandling2.html#handling2-group"><i class="fa fa-check"></i><b>14.2</b> グルーピング</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="datahandling2.html"><a href="datahandling2.html#group_byによるグループ化"><i class="fa fa-check"></i><b>14.2.1</b> <code>group_by()</code>によるグループ化</a></li>
<li class="chapter" data-level="14.2.2" data-path="datahandling2.html"><a href="datahandling2.html#複数の変数を用いたグループ化"><i class="fa fa-check"></i><b>14.2.2</b> 複数の変数を用いたグループ化</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="datahandling2.html"><a href="datahandling2.html#handling2-mutate"><i class="fa fa-check"></i><b>14.3</b> 変数の計算</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="datahandling2.html"><a href="datahandling2.html#mutate関数の使い方"><i class="fa fa-check"></i><b>14.3.1</b> <code>mutate()</code>関数の使い方</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="datahandling2.html"><a href="datahandling2.html#handling2-rowwise"><i class="fa fa-check"></i><b>14.4</b> 行単位の操作</a></li>
<li class="chapter" data-level="14.5" data-path="datahandling2.html"><a href="datahandling2.html#handling2-merge"><i class="fa fa-check"></i><b>14.5</b> データの結合</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="datahandling2.html"><a href="datahandling2.html#行の結合"><i class="fa fa-check"></i><b>14.5.1</b> 行の結合</a></li>
<li class="chapter" data-level="14.5.2" data-path="datahandling2.html"><a href="datahandling2.html#列の結合"><i class="fa fa-check"></i><b>14.5.2</b> 列の結合</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="datahandling2.html"><a href="datahandling2.html#handling2-exercise"><i class="fa fa-check"></i><b>14.6</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="factor.html"><a href="factor.html"><i class="fa fa-check"></i><b>15</b> データハンドリング [基礎編: factor型]</a>
<ul>
<li class="chapter" data-level="15.1" data-path="factor.html"><a href="factor.html#名目変数を含むグラフを作成する際の注意点"><i class="fa fa-check"></i><b>15.1</b> 名目変数を含むグラフを作成する際の注意点</a></li>
<li class="chapter" data-level="15.2" data-path="factor.html"><a href="factor.html#forcatsパッケージについて"><i class="fa fa-check"></i><b>15.2</b> <code>forcats</code>パッケージについて</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="factor.html"><a href="factor.html#fct_relevel-水準の順番を変更する"><i class="fa fa-check"></i><b>15.2.1</b> <code>fct_relevel()</code>: 水準の順番を変更する</a></li>
<li class="chapter" data-level="15.2.2" data-path="factor.html"><a href="factor.html#fct_recode-水準のラベルを変更する"><i class="fa fa-check"></i><b>15.2.2</b> <code>fct_recode()</code>: 水準のラベルを変更する</a></li>
<li class="chapter" data-level="15.2.3" data-path="factor.html"><a href="factor.html#fct_rev-水準の順番を反転させる"><i class="fa fa-check"></i><b>15.2.3</b> <code>fct_rev()</code>: 水準の順番を反転させる</a></li>
<li class="chapter" data-level="15.2.4" data-path="factor.html"><a href="factor.html#fct_infreq-頻度順に順番を変更する"><i class="fa fa-check"></i><b>15.2.4</b> <code>fct_infreq()</code>: 頻度順に順番を変更する</a></li>
<li class="chapter" data-level="15.2.5" data-path="factor.html"><a href="factor.html#fct_inorder-データ内の出現順番に順番を変更する"><i class="fa fa-check"></i><b>15.2.5</b> <code>fct_inorder()</code>: データ内の出現順番に順番を変更する</a></li>
<li class="chapter" data-level="15.2.6" data-path="factor.html"><a href="factor.html#fct_shift-水準の順番をずらす"><i class="fa fa-check"></i><b>15.2.6</b> <code>fct_shift()</code>: 水準の順番をずらす</a></li>
<li class="chapter" data-level="15.2.7" data-path="factor.html"><a href="factor.html#fct_shuffle-水準の順番をランダム化する"><i class="fa fa-check"></i><b>15.2.7</b> <code>fct_shuffle()</code>: 水準の順番をランダム化する</a></li>
<li class="chapter" data-level="15.2.8" data-path="factor.html"><a href="factor.html#fct_reorder-別の1変数の値を基準に水準の順番を変更する"><i class="fa fa-check"></i><b>15.2.8</b> <code>fct_reorder()</code>: 別の1変数の値を基準に水準の順番を変更する</a></li>
<li class="chapter" data-level="15.2.9" data-path="factor.html"><a href="factor.html#fct_reorder2-別の2変数の値を基準に水準の順番を変更する"><i class="fa fa-check"></i><b>15.2.9</b> <code>fct_reorder2()</code>: 別の2変数の値を基準に水準の順番を変更する</a></li>
<li class="chapter" data-level="15.2.10" data-path="factor.html"><a href="factor.html#fct_collapse-水準を統合する"><i class="fa fa-check"></i><b>15.2.10</b> <code>fct_collapse()</code>: 水準を統合する</a></li>
<li class="chapter" data-level="15.2.11" data-path="factor.html"><a href="factor.html#fct_drop-使われていない水準を除去する"><i class="fa fa-check"></i><b>15.2.11</b> <code>fct_drop()</code>: 使われていない水準を除去する</a></li>
<li class="chapter" data-level="15.2.12" data-path="factor.html"><a href="factor.html#fct_expand-水準を追加する"><i class="fa fa-check"></i><b>15.2.12</b> <code>fct_expand()</code>: 水準を追加する</a></li>
<li class="chapter" data-level="15.2.13" data-path="factor.html"><a href="factor.html#fct_explicit_na-欠損値に水準を与える"><i class="fa fa-check"></i><b>15.2.13</b> <code>fct_explicit_na()</code>: 欠損値に水準を与える</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="factor.html"><a href="factor.html#factor-excersie"><i class="fa fa-check"></i><b>15.3</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="tidydata.html"><a href="tidydata.html"><i class="fa fa-check"></i><b>16</b> 整然データ構造</a>
<ul>
<li class="chapter" data-level="16.1" data-path="tidydata.html"><a href="tidydata.html#tidydata-intro"><i class="fa fa-check"></i><b>16.1</b> 整然データ (tidy data)とは</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="tidydata.html"><a href="tidydata.html#つの列は1つの変数を表す"><i class="fa fa-check"></i><b>16.1.1</b> 1つの列は、1つの変数を表す</a></li>
<li class="chapter" data-level="16.1.2" data-path="tidydata.html"><a href="tidydata.html#つの行は1つの観測を表す"><i class="fa fa-check"></i><b>16.1.2</b> 1つの行は、1つの観測を表す</a></li>
<li class="chapter" data-level="16.1.3" data-path="tidydata.html"><a href="tidydata.html#つのセルは1つの値を表す"><i class="fa fa-check"></i><b>16.1.3</b> 1つのセルは、1つの値を表す</a></li>
<li class="chapter" data-level="16.1.4" data-path="tidydata.html"><a href="tidydata.html#つの表は1つの観測単位をもつ"><i class="fa fa-check"></i><b>16.1.4</b> 1つの表は、1つの観測単位をもつ</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="tidydata.html"><a href="tidydata.html#tidydata-gather"><i class="fa fa-check"></i><b>16.2</b> Wide型からLong型へ</a></li>
<li class="chapter" data-level="16.3" data-path="tidydata.html"><a href="tidydata.html#tidydata-spread"><i class="fa fa-check"></i><b>16.3</b> Long型からWide型へ</a></li>
<li class="chapter" data-level="16.4" data-path="tidydata.html"><a href="tidydata.html#tidydata-separate"><i class="fa fa-check"></i><b>16.4</b> 列の操作</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="visualization1.html"><a href="visualization1.html"><i class="fa fa-check"></i><b>17</b> 可視化[理論]</a>
<ul>
<li class="chapter" data-level="17.1" data-path="visualization1.html"><a href="visualization1.html#visual-packages"><i class="fa fa-check"></i><b>17.1</b> 可視化のためのパッケージ</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="visualization1.html"><a href="visualization1.html#base-r"><i class="fa fa-check"></i><b>17.1.1</b> Base R</a></li>
<li class="chapter" data-level="17.1.2" data-path="visualization1.html"><a href="visualization1.html#latticeパッケージ"><i class="fa fa-check"></i><b>17.1.2</b> {lattice}パッケージ</a></li>
<li class="chapter" data-level="17.1.3" data-path="visualization1.html"><a href="visualization1.html#ggplot2パッケージ"><i class="fa fa-check"></i><b>17.1.3</b> {ggplot2}パッケージ</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="visualization1.html"><a href="visualization1.html#visual-ggplot"><i class="fa fa-check"></i><b>17.2</b> グラフィックの文法</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="visualization1.html"><a href="visualization1.html#グラフィックの文法"><i class="fa fa-check"></i><b>17.2.1</b> グラフィックの文法</a></li>
<li class="chapter" data-level="17.2.2" data-path="visualization1.html"><a href="visualization1.html#ggplot2のイメージ"><i class="fa fa-check"></i><b>17.2.2</b> ggplot2のイメージ</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="visualization1.html"><a href="visualization1.html#グラフィックの構成要素"><i class="fa fa-check"></i><b>17.3</b> グラフィックの構成要素</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="visualization1.html"><a href="visualization1.html#データ"><i class="fa fa-check"></i><b>17.3.1</b> データ</a></li>
<li class="chapter" data-level="17.3.2" data-path="visualization1.html"><a href="visualization1.html#幾何オブジェクト"><i class="fa fa-check"></i><b>17.3.2</b> 幾何オブジェクト</a></li>
<li class="chapter" data-level="17.3.3" data-path="visualization1.html"><a href="visualization1.html#マッピング"><i class="fa fa-check"></i><b>17.3.3</b> マッピング</a></li>
<li class="chapter" data-level="17.3.4" data-path="visualization1.html"><a href="visualization1.html#マッピング-その他"><i class="fa fa-check"></i><b>17.3.4</b> マッピング: その他</a></li>
<li class="chapter" data-level="17.3.5" data-path="visualization1.html"><a href="visualization1.html#座標系"><i class="fa fa-check"></i><b>17.3.5</b> 座標系</a></li>
<li class="chapter" data-level="17.3.6" data-path="visualization1.html"><a href="visualization1.html#スケール"><i class="fa fa-check"></i><b>17.3.6</b> スケール</a></li>
<li class="chapter" data-level="17.3.7" data-path="visualization1.html"><a href="visualization1.html#ファセット"><i class="fa fa-check"></i><b>17.3.7</b> ファセット</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="visualization1.html"><a href="visualization1.html#visual-principal"><i class="fa fa-check"></i><b>17.4</b> 良いグラフとは</a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="visualization1.html"><a href="visualization1.html#データインク比"><i class="fa fa-check"></i><b>17.4.1</b> データ・インク比</a></li>
<li class="chapter" data-level="17.4.2" data-path="visualization1.html"><a href="visualization1.html#次元プロット"><i class="fa fa-check"></i><b>17.4.2</b> 3次元プロット</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="visualization2.html"><a href="visualization2.html"><i class="fa fa-check"></i><b>18</b> 可視化[基礎]</a>
<ul>
<li class="chapter" data-level="18.1" data-path="visualization2.html"><a href="visualization2.html#本章の内容"><i class="fa fa-check"></i><b>18.1</b> 本章の内容</a></li>
<li class="chapter" data-level="18.2" data-path="visualization2.html"><a href="visualization2.html#visual2-data"><i class="fa fa-check"></i><b>18.2</b> 実習用データ</a></li>
<li class="chapter" data-level="18.3" data-path="visualization2.html"><a href="visualization2.html#visual2-barplot"><i class="fa fa-check"></i><b>18.3</b> 棒グラフ</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="visualization2.html"><a href="visualization2.html#ケース数のグラフ"><i class="fa fa-check"></i><b>18.3.1</b> ケース数のグラフ</a></li>
<li class="chapter" data-level="18.3.2" data-path="visualization2.html"><a href="visualization2.html#記述統計量のグラフ"><i class="fa fa-check"></i><b>18.3.2</b> 記述統計量のグラフ</a></li>
<li class="chapter" data-level="18.3.3" data-path="visualization2.html"><a href="visualization2.html#次元を追加する"><i class="fa fa-check"></i><b>18.3.3</b> 次元を追加する</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="visualization2.html"><a href="visualization2.html#visual2-histogram"><i class="fa fa-check"></i><b>18.4</b> ヒストグラム</a>
<ul>
<li class="chapter" data-level="18.4.1" data-path="visualization2.html"><a href="visualization2.html#ヒストグラムの棒の大きさを調整する"><i class="fa fa-check"></i><b>18.4.1</b> ヒストグラムの棒の大きさを調整する</a></li>
<li class="chapter" data-level="18.4.2" data-path="visualization2.html"><a href="visualization2.html#密度を追加する"><i class="fa fa-check"></i><b>18.4.2</b> 密度を追加する</a></li>
<li class="chapter" data-level="18.4.3" data-path="visualization2.html"><a href="visualization2.html#次元を追加する-1"><i class="fa fa-check"></i><b>18.4.3</b> 次元を追加する</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="visualization2.html"><a href="visualization2.html#visual2-box"><i class="fa fa-check"></i><b>18.5</b> 箱ひげ図</a>
<ul>
<li class="chapter" data-level="18.5.1" data-path="visualization2.html"><a href="visualization2.html#個別のデータを表示する"><i class="fa fa-check"></i><b>18.5.1</b> 個別のデータを表示する</a></li>
<li class="chapter" data-level="18.5.2" data-path="visualization2.html"><a href="visualization2.html#次元を追加する-2"><i class="fa fa-check"></i><b>18.5.2</b> 次元を追加する</a></li>
<li class="chapter" data-level="18.5.3" data-path="visualization2.html"><a href="visualization2.html#複数の変数の場合"><i class="fa fa-check"></i><b>18.5.3</b> 複数の変数の場合</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="visualization2.html"><a href="visualization2.html#visual2-scatter"><i class="fa fa-check"></i><b>18.6</b> 散布図</a>
<ul>
<li class="chapter" data-level="18.6.1" data-path="visualization2.html"><a href="visualization2.html#次元を追加する-3"><i class="fa fa-check"></i><b>18.6.1</b> 次元を追加する</a></li>
<li class="chapter" data-level="18.6.2" data-path="visualization2.html"><a href="visualization2.html#一部の点をハイライトする"><i class="fa fa-check"></i><b>18.6.2</b> 一部の点をハイライトする</a></li>
</ul></li>
<li class="chapter" data-level="18.7" data-path="visualization2.html"><a href="visualization2.html#visual2-line"><i class="fa fa-check"></i><b>18.7</b> 折れ線グラフ</a>
<ul>
<li class="chapter" data-level="18.7.1" data-path="visualization2.html"><a href="visualization2.html#一部の線をハイライトする"><i class="fa fa-check"></i><b>18.7.1</b> 一部の線をハイライトする</a></li>
</ul></li>
<li class="chapter" data-level="18.8" data-path="visualization2.html"><a href="visualization2.html#図の保存"><i class="fa fa-check"></i><b>18.8</b> 図の保存</a>
<ul>
<li class="chapter" data-level="18.8.1" data-path="visualization2.html"><a href="visualization2.html#ggsaveを利用した図の保存"><i class="fa fa-check"></i><b>18.8.1</b> <code>ggsave()</code>を利用した図の保存</a></li>
<li class="chapter" data-level="18.8.2" data-path="visualization2.html"><a href="visualization2.html#quartzを利用した図の保存"><i class="fa fa-check"></i><b>18.8.2</b> <code>quartz()</code>を利用した図の保存</a></li>
</ul></li>
<li class="chapter" data-level="18.9" data-path="visualization2.html"><a href="visualization2.html#まとめ"><i class="fa fa-check"></i><b>18.9</b> まとめ</a></li>
<li class="chapter" data-level="18.10" data-path="visualization2.html"><a href="visualization2.html#visual2-excersie"><i class="fa fa-check"></i><b>18.10</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="visualization3.html"><a href="visualization3.html"><i class="fa fa-check"></i><b>19</b> 可視化[応用]</a>
<ul>
<li class="chapter" data-level="19.1" data-path="visualization3.html"><a href="visualization3.html#visual3-labs"><i class="fa fa-check"></i><b>19.1</b> <code>labs()</code>: ラベルの修正</a></li>
<li class="chapter" data-level="19.2" data-path="visualization3.html"><a href="visualization3.html#guides"><i class="fa fa-check"></i><b>19.2</b> <code>guides()</code>:</a></li>
<li class="chapter" data-level="19.3" data-path="visualization3.html"><a href="visualization3.html#visual3-coordinate"><i class="fa fa-check"></i><b>19.3</b> <code>coord_*()</code>: 座標系の調整</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="visualization3.html"><a href="visualization3.html#直交座標系の操作"><i class="fa fa-check"></i><b>19.3.1</b> 直交座標系の操作</a></li>
<li class="chapter" data-level="19.3.2" data-path="visualization3.html"><a href="visualization3.html#座標系の変換"><i class="fa fa-check"></i><b>19.3.2</b> 座標系の変換</a></li>
<li class="chapter" data-level="19.3.3" data-path="visualization3.html"><a href="visualization3.html#座標系の回転"><i class="fa fa-check"></i><b>19.3.3</b> 座標系の回転</a></li>
<li class="chapter" data-level="19.3.4" data-path="visualization3.html"><a href="visualization3.html#座標系の固定"><i class="fa fa-check"></i><b>19.3.4</b> 座標系の固定</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="visualization3.html"><a href="visualization3.html#visual3-scale"><i class="fa fa-check"></i><b>19.4</b> <code>scale_*_*()</code>: スケールの調整</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="visualization3.html"><a href="visualization3.html#横軸縦軸スケールの調整"><i class="fa fa-check"></i><b>19.4.1</b> 横軸・縦軸スケールの調整</a></li>
<li class="chapter" data-level="19.4.2" data-path="visualization3.html"><a href="visualization3.html#colorスケールの調整"><i class="fa fa-check"></i><b>19.4.2</b> <code>color</code>スケールの調整</a></li>
<li class="chapter" data-level="19.4.3" data-path="visualization3.html"><a href="visualization3.html#alphaスケールの調整"><i class="fa fa-check"></i><b>19.4.3</b> <code>alpha</code>スケールの調整</a></li>
<li class="chapter" data-level="19.4.4" data-path="visualization3.html"><a href="visualization3.html#sizeスケールの調整"><i class="fa fa-check"></i><b>19.4.4</b> <code>size</code>スケールの調整</a></li>
<li class="chapter" data-level="19.4.5" data-path="visualization3.html"><a href="visualization3.html#shapelinetypeスケールの調整"><i class="fa fa-check"></i><b>19.4.5</b> <code>shape</code>、<code>linetype</code>スケールの調整</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="visualization3.html"><a href="visualization3.html#visual3-theme"><i class="fa fa-check"></i><b>19.5</b> <code>theme_*()</code>と<code>theme()</code>: テーマの指定</a></li>
<li class="chapter" data-level="19.6" data-path="visualization3.html"><a href="visualization3.html#visual3-merge"><i class="fa fa-check"></i><b>19.6</b> 図の結合</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="visualization4.html"><a href="visualization4.html"><i class="fa fa-check"></i><b>20</b> 可視化[発展]</a>
<ul>
<li class="chapter" data-level="20.1" data-path="visualization4.html"><a href="visualization4.html#visual4-violin"><i class="fa fa-check"></i><b>20.1</b> バイオリンプロット</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="datahandling3.html"><a href="datahandling3.html"><i class="fa fa-check"></i><b>21</b> データハンドリング[応用編]</a></li>
<li class="chapter" data-level="22" data-path="string.html"><a href="string.html"><i class="fa fa-check"></i><b>22</b> 文字列の処理</a></li>
<li class="chapter" data-level="23" data-path="scraping.html"><a href="scraping.html"><i class="fa fa-check"></i><b>23</b> スクレイピング</a></li>
<li class="chapter" data-level="24" data-path="iteration.html"><a href="iteration.html"><i class="fa fa-check"></i><b>24</b> 反復処理</a>
<ul>
<li class="chapter" data-level="24.1" data-path="iteration.html"><a href="iteration.html#iteration-abstract"><i class="fa fa-check"></i><b>24.1</b> 概要</a></li>
<li class="chapter" data-level="24.2" data-path="iteration.html"><a href="iteration.html#iteration-intro"><i class="fa fa-check"></i><b>24.2</b> <code>*apply()</code>関数群と<code>map_*()</code>関数群</a></li>
<li class="chapter" data-level="24.3" data-path="iteration.html"><a href="iteration.html#iteration-two-arguments"><i class="fa fa-check"></i><b>24.3</b> 引数が2つ以上の場合</a></li>
<li class="chapter" data-level="24.4" data-path="iteration.html"><a href="iteration.html#iteration-df"><i class="fa fa-check"></i><b>24.4</b> データフレームと{purrr}</a>
<ul>
<li class="chapter" data-level="24.4.1" data-path="iteration.html"><a href="iteration.html#iteration-tibble"><i class="fa fa-check"></i><b>24.4.1</b> tibbleの話</a></li>
</ul></li>
<li class="chapter" data-level="24.5" data-path="iteration.html"><a href="iteration.html#iteration-model1"><i class="fa fa-check"></i><b>24.5</b> モデルの反復推定</a>
<ul>
<li class="chapter" data-level="24.5.1" data-path="iteration.html"><a href="iteration.html#iteration-split1"><i class="fa fa-check"></i><b>24.5.1</b> サンプルの分割とモデル推定（<code>split()</code>利用）</a></li>
<li class="chapter" data-level="24.5.2" data-path="iteration.html"><a href="iteration.html#iteration-split2"><i class="fa fa-check"></i><b>24.5.2</b> サンプルの分割とモデル推定（<code>nest()</code>利用）</a></li>
<li class="chapter" data-level="24.5.3" data-path="iteration.html"><a href="iteration.html#iteration-range"><i class="fa fa-check"></i><b>24.5.3</b> データの範囲を指定したモデル推定</a></li>
<li class="chapter" data-level="24.5.4" data-path="iteration.html"><a href="iteration.html#iteration-variables"><i class="fa fa-check"></i><b>24.5.4</b> 説明・応答変数を指定したモデル推定</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="25" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>25</b> R Markdown [基礎]</a>
<ul>
<li class="chapter" data-level="25.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-intro"><i class="fa fa-check"></i><b>25.1</b> R Markdownとは</a></li>
<li class="chapter" data-level="25.2" data-path="rmarkdown.html"><a href="rmarkdown.html#とりあえずknit"><i class="fa fa-check"></i><b>25.2</b> とりあえずKnit</a></li>
<li class="chapter" data-level="25.3" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-grammar"><i class="fa fa-check"></i><b>25.3</b> Markdown文法の基本</a>
<ul>
<li class="chapter" data-level="25.3.1" data-path="rmarkdown.html"><a href="rmarkdown.html#改行-1"><i class="fa fa-check"></i><b>25.3.1</b> 改行</a></li>
<li class="chapter" data-level="25.3.2" data-path="rmarkdown.html"><a href="rmarkdown.html#強調"><i class="fa fa-check"></i><b>25.3.2</b> 強調</a></li>
<li class="chapter" data-level="25.3.3" data-path="rmarkdown.html"><a href="rmarkdown.html#箇条書き"><i class="fa fa-check"></i><b>25.3.3</b> 箇条書き</a></li>
<li class="chapter" data-level="25.3.4" data-path="rmarkdown.html"><a href="rmarkdown.html#見出し"><i class="fa fa-check"></i><b>25.3.4</b> 見出し</a></li>
</ul></li>
<li class="chapter" data-level="25.4" data-path="rmarkdown.html"><a href="rmarkdown.html#見出し2"><i class="fa fa-check"></i><b>25.4</b> 見出し2</a>
<ul>
<li class="chapter" data-level="25.4.1" data-path="rmarkdown.html"><a href="rmarkdown.html#見出し3"><i class="fa fa-check"></i><b>25.4.1</b> 見出し3</a></li>
<li class="chapter" data-level="25.4.2" data-path="rmarkdown.html"><a href="rmarkdown.html#区切り線"><i class="fa fa-check"></i><b>25.4.2</b> 区切り線</a></li>
<li class="chapter" data-level="25.4.3" data-path="rmarkdown.html"><a href="rmarkdown.html#表"><i class="fa fa-check"></i><b>25.4.3</b> 表</a></li>
<li class="chapter" data-level="25.4.4" data-path="rmarkdown.html"><a href="rmarkdown.html#画像"><i class="fa fa-check"></i><b>25.4.4</b> 画像</a></li>
<li class="chapter" data-level="25.4.5" data-path="rmarkdown.html"><a href="rmarkdown.html#リンク"><i class="fa fa-check"></i><b>25.4.5</b> リンク</a></li>
<li class="chapter" data-level="25.4.6" data-path="rmarkdown.html"><a href="rmarkdown.html#脚注"><i class="fa fa-check"></i><b>25.4.6</b> 脚注</a></li>
<li class="chapter" data-level="25.4.7" data-path="rmarkdown.html"><a href="rmarkdown.html#数式"><i class="fa fa-check"></i><b>25.4.7</b> 数式</a></li>
<li class="chapter" data-level="25.4.8" data-path="rmarkdown.html"><a href="rmarkdown.html#引用"><i class="fa fa-check"></i><b>25.4.8</b> 引用</a></li>
<li class="chapter" data-level="25.4.9" data-path="rmarkdown.html"><a href="rmarkdown.html#コメント"><i class="fa fa-check"></i><b>25.4.9</b> コメント</a></li>
<li class="chapter" data-level="25.4.10" data-path="rmarkdown.html"><a href="rmarkdown.html#コード"><i class="fa fa-check"></i><b>25.4.10</b> コード</a></li>
</ul></li>
<li class="chapter" data-level="25.5" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-chunk"><i class="fa fa-check"></i><b>25.5</b> チャンクのオプション</a>
<ul>
<li class="chapter" data-level="25.5.1" data-path="rmarkdown.html"><a href="rmarkdown.html#チャンク名とチャンク間依存関係"><i class="fa fa-check"></i><b>25.5.1</b> チャンク名とチャンク間依存関係</a></li>
<li class="chapter" data-level="25.5.2" data-path="rmarkdown.html"><a href="rmarkdown.html#コードまたは結果の表示非常時"><i class="fa fa-check"></i><b>25.5.2</b> コードまたは結果の表示/非常時</a></li>
<li class="chapter" data-level="25.5.3" data-path="rmarkdown.html"><a href="rmarkdown.html#プロット"><i class="fa fa-check"></i><b>25.5.3</b> プロット</a></li>
<li class="chapter" data-level="25.5.4" data-path="rmarkdown.html"><a href="rmarkdown.html#コードの見栄"><i class="fa fa-check"></i><b>25.5.4</b> コードの見栄</a></li>
</ul></li>
<li class="chapter" data-level="25.6" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-header"><i class="fa fa-check"></i><b>25.6</b> ヘッダーのオプション</a>
<ul>
<li class="chapter" data-level="25.6.1" data-path="rmarkdown.html"><a href="rmarkdown.html#目次の追加"><i class="fa fa-check"></i><b>25.6.1</b> 目次の追加</a></li>
<li class="chapter" data-level="25.6.2" data-path="rmarkdown.html"><a href="rmarkdown.html#コードのハイライト"><i class="fa fa-check"></i><b>25.6.2</b> コードのハイライト</a></li>
</ul></li>
<li class="chapter" data-level="25.7" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-japanese"><i class="fa fa-check"></i><b>25.7</b> 日本語が含まれているPDFの出力</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="rmarkdown2.html"><a href="rmarkdown2.html"><i class="fa fa-check"></i><b>26</b> R Markdown [応用]</a>
<ul>
<li class="chapter" data-level="26.1" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmarkdown2-table"><i class="fa fa-check"></i><b>26.1</b> 表の作成</a></li>
<li class="chapter" data-level="26.2" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-slide"><i class="fa fa-check"></i><b>26.2</b> R Markdownを用いたスライド作成</a>
<ul>
<li class="chapter" data-level="26.2.1" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-brak"><i class="fa fa-check"></i><b>26.2.1</b> スライド区分</a></li>
<li class="chapter" data-level="26.2.2" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-chunk"><i class="fa fa-check"></i><b>26.2.2</b> コード</a></li>
<li class="chapter" data-level="26.2.3" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-highlight"><i class="fa fa-check"></i><b>26.2.3</b> ハイライト</a></li>
<li class="chapter" data-level="26.2.4" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-operation"><i class="fa fa-check"></i><b>26.2.4</b> Xaringanスライドの操作</a></li>
<li class="chapter" data-level="26.2.5" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-japanese"><i class="fa fa-check"></i><b>26.2.5</b> 日本語フォントの指定</a></li>
<li class="chapter" data-level="26.2.6" data-path="rmarkdown2.html"><a href="rmarkdown2.html#スライドのpdf出力"><i class="fa fa-check"></i><b>26.2.6</b> スライドのPDF出力</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="27" data-path="solution.html"><a href="solution.html"><i class="fa fa-check"></i><b>27</b> 演習問題の回答</a>
<ul>
<li class="chapter" data-level="27.1" data-path="solution.html"><a href="solution.html#solution-rbasic"><i class="fa fa-check"></i><b>27.1</b> 基本的な操作</a></li>
<li class="chapter" data-level="27.2" data-path="solution.html"><a href="solution.html#solution-datastructure"><i class="fa fa-check"></i><b>27.2</b> データの構造</a>
<ul>
<li class="chapter" data-level="27.2.1" data-path="solution.html"><a href="solution.html#ベクトル-1"><i class="fa fa-check"></i><b>27.2.1</b> ベクトル</a></li>
<li class="chapter" data-level="27.2.2" data-path="solution.html"><a href="solution.html#行列-1"><i class="fa fa-check"></i><b>27.2.2</b> 行列</a></li>
<li class="chapter" data-level="27.2.3" data-path="solution.html"><a href="solution.html#データフレーム-1"><i class="fa fa-check"></i><b>27.2.3</b> データフレーム</a></li>
</ul></li>
<li class="chapter" data-level="27.3" data-path="solution.html"><a href="solution.html#rプログラミングの基礎"><i class="fa fa-check"></i><b>27.3</b> Rプログラミングの基礎</a></li>
<li class="chapter" data-level="27.4" data-path="solution.html"><a href="solution.html#関数の自作"><i class="fa fa-check"></i><b>27.4</b> 関数の自作</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="sessioninfo.html"><a href="sessioninfo.html"><i class="fa fa-check"></i><b>28</b> 本書の執筆環境</a></li>
<li class="chapter" data-level="29" data-path="reference.html"><a href="reference.html"><i class="fa fa-check"></i><b>29</b> 参考資料</a></li>
<li class="divider"></li>
<p style = "text-align:center;"><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="クリエイティブ・コモンズ・ライセンス" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a></p>
<p style = "text-align:center;"><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></p>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">私たちのR: ベストプラクティスの探究</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="iteration" class="section level1" number="24">
<h1><span class="header-section-number">24.</span> 反復処理</h1>
<div id="iteration-abstract" class="section level2" number="24.1">
<h2><span class="header-section-number">24.1</span> 概要</h2>
<ul>
<li><a href="iteration.html#iteration-intro"><code>*apply()</code>関数群と<code>map_*()</code>関数群</a></li>
<li><a href="iteration.html#iteration-two-arguments">引数が2つ以上の場合</a></li>
<li><a href="iteration.html#iteration-df">データフレームと{purrr}</a></li>
<li><a href="iteration.html#iteration-model1">モデルの反復推定</a>
<ul>
<li><a href="iteration.html#iteration-split1">サンプルの分割とモデル推定（<code>split()</code>利用）</a></li>
<li><a href="iteration.html#iteration-split2">サンプルの分割とモデル推定（<code>nest()</code>利用）</a></li>
</ul></li>
</ul>
<hr />
</div>
<div id="iteration-intro" class="section level2" number="24.2">
<h2><span class="header-section-number">24.2</span> <code>*apply()</code>関数群と<code>map_*()</code>関数群</h2>
<p>まず、我らの盟友、{tidyverse}を読み込んでおきましょう。</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="iteration.html#cb1-1"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<p>それでは、<code>*apply()</code>関数群と<code>map_*()</code>関数群の動きとその仕組について調べてみましょう。まず、実習用データとして長さ5のnumericベクトル<code>num_vec</code>を用意します。</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb2-1"><a href="iteration.html#cb2-1"></a>num_vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">7</span>)</span></code></pre></div>
<p>この<code>num_vec</code>の個々の要素に2を足す場合はどうすれば良いでしょうか。Rはベクトル単位での演算が行われるため、<code>num_vec + 2</code>だけで十分です。<code>+</code>の右側にある2は長さ1のベクトルですが、<code>num_vec</code>の長さに合わせてリサイクルされます（第<a href="datastructure.html#structure-vector">10.2</a>章を参照）。</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb3-1"><a href="iteration.html#cb3-1"></a>num_vec <span class="op">+</span><span class="st"> </span><span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 5 4 7 6 9</code></pre>
<p>賢明なRユーザーなら上のコードが正解でしょう。しかし、これからの練習のために<code>+</code>を使わずに、<code>for()</code>文を使用してみましょう（第<a href="programming.html#programming-iteration">11.3</a>章を参照）。</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb5-1"><a href="iteration.html#cb5-1"></a><span class="cf">for</span> (i <span class="cf">in</span> num_vec) {</span>
<span id="cb5-2"><a href="iteration.html#cb5-2"></a>    <span class="kw">print</span>(i <span class="op">+</span><span class="st"> </span><span class="dv">2</span>)</span>
<span id="cb5-3"><a href="iteration.html#cb5-3"></a>}</span></code></pre></div>
<pre><code>## [1] 5
## [1] 4
## [1] 7
## [1] 6
## [1] 9</code></pre>
<p>実はこれと同じ役割をする関数がRには内蔵されており、それが<code>lapply()</code>関数です。</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb7-1"><a href="iteration.html#cb7-1"></a><span class="kw">lapply</span>(オブジェクト名, 関数名, 関数の引数)</span></code></pre></div>
<p>以下のコードからも確認出来ますが、足し算を意味する<code>+</code>も関数です。ただし、演算子を関数として使う場合は演算子を<code>`</code>で囲む必要があり、<code>+</code>だと<code>`+`</code>と表記します。</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb8-1"><a href="iteration.html#cb8-1"></a><span class="st">`</span><span class="dt">+</span><span class="st">`</span>(num_vec, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 5 4 7 6 9</code></pre>
<p>したがって、<code>lapply()</code>関数を使用して<code>num_vec</code>の全要素に2を足す場合、以下のようなコードとなります。</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb10-1"><a href="iteration.html#cb10-1"></a><span class="kw">lapply</span>(num_vec, <span class="st">`</span><span class="dt">+</span><span class="st">`</span>, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 5
## 
## [[2]]
## [1] 4
## 
## [[3]]
## [1] 7
## 
## [[4]]
## [1] 6
## 
## [[5]]
## [1] 9</code></pre>
<p>これと同じ動きをする関数が{purrr}パッケージの<code>map()</code>です。{purrr}は{tidyverse}を読み込むと自動的に読み込まれます。</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb12-1"><a href="iteration.html#cb12-1"></a><span class="kw">map</span>(num_vec, <span class="st">`</span><span class="dt">+</span><span class="st">`</span>, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 5
## 
## [[2]]
## [1] 4
## 
## [[3]]
## [1] 7
## 
## [[4]]
## [1] 6
## 
## [[5]]
## [1] 9</code></pre>
<p>ただし、<code>lapply()</code>と<code>map()</code>の場合、戻り値はリスト型となります。もし、ベクトル型の戻り値が必要な場合は更に<code>unlist()</code>関数を使うか、<code>sapply()</code>を使います。</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb14-1"><a href="iteration.html#cb14-1"></a><span class="co"># unlist()を利用し、リストを解除する</span></span>
<span id="cb14-2"><a href="iteration.html#cb14-2"></a><span class="kw">lapply</span>(num_vec, <span class="st">`</span><span class="dt">+</span><span class="st">`</span>, <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unlist</span>()</span></code></pre></div>
<pre><code>## [1] 5 4 7 6 9</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb16-1"><a href="iteration.html#cb16-1"></a><span class="co"># sapply()を利用すると戻り値はベクトルとなる</span></span>
<span id="cb16-2"><a href="iteration.html#cb16-2"></a><span class="kw">sapply</span>(num_vec, <span class="st">`</span><span class="dt">+</span><span class="st">`</span>, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 5 4 7 6 9</code></pre>
<p><code>map()</code>関数なら<code>unlist()</code>でも良いですが、<code>sapply()</code>と同じ動きをする<code>map_dbl()</code>があります。これは戻り値がdoubleのnumericベクトルになる<code>map()</code>関数です。</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb18-1"><a href="iteration.html#cb18-1"></a><span class="co"># map_dbl()を利用するとnumeric (double)のベクトルが返される</span></span>
<span id="cb18-2"><a href="iteration.html#cb18-2"></a><span class="kw">map_dbl</span>(num_vec, <span class="st">`</span><span class="dt">+</span><span class="st">`</span>, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 5 4 7 6 9</code></pre>
<p>もし、2を足すだけでなく、更に3で割るためにはどうすれば良いでしょうか。まず考えられるのは更に<code>sapply()</code>や<code>map_dbl</code>を使うことです。</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb20-1"><a href="iteration.html#cb20-1"></a><span class="kw">map_dbl</span>(num_vec, <span class="st">`</span><span class="dt">+</span><span class="st">`</span>, <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-2"><a href="iteration.html#cb20-2"></a><span class="st">    </span><span class="kw">map_dbl</span>(<span class="st">`</span><span class="dt">/</span><span class="st">`</span>, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 1.666667 1.333333 2.333333 2.000000 3.000000</code></pre>
<p>もう一つの方法は<code>sapply()</code>や<code>map_dbl()</code>の第二引数に直接関数を指定する方法です。</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb22-1"><a href="iteration.html#cb22-1"></a><span class="kw">sapply</span>(num_vec, <span class="cf">function</span>(x){(x <span class="op">+</span><span class="st"> </span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span><span class="dv">3</span>})</span></code></pre></div>
<pre><code>## [1] 1.666667 1.333333 2.333333 2.000000 3.000000</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb24-1"><a href="iteration.html#cb24-1"></a><span class="kw">map_dbl</span>(num_vec, <span class="cf">function</span>(x){(x <span class="op">+</span><span class="st"> </span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span><span class="dv">3</span>})</span></code></pre></div>
<pre><code>## [1] 1.666667 1.333333 2.333333 2.000000 3.000000</code></pre>
<p>上のコードだと、<code>num_vec</code>の要素が第二引数で指定した関数の引数（<code>x</code>）として用いられます。関数が長くなる場合は、<code>sapply()</code>や<code>map()</code>の外側に関数を予め指定して置くことも可能です。</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb26-1"><a href="iteration.html#cb26-1"></a>add_two_divide_three &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb26-2"><a href="iteration.html#cb26-2"></a>    (x <span class="op">+</span><span class="st"> </span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span><span class="dv">3</span> </span>
<span id="cb26-3"><a href="iteration.html#cb26-3"></a>}</span>
<span id="cb26-4"><a href="iteration.html#cb26-4"></a><span class="kw">sapply</span>(num_vec, add_two_divide_three)</span></code></pre></div>
<pre><code>## [1] 1.666667 1.333333 2.333333 2.000000 3.000000</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb28-1"><a href="iteration.html#cb28-1"></a><span class="kw">map_dbl</span>(num_vec, add_two_divide_three)</span></code></pre></div>
<pre><code>## [1] 1.666667 1.333333 2.333333 2.000000 3.000000</code></pre>
<p>ここまでの例だと<code>sapply()</code>と<code>map_dbl()</code>はほぼ同じ関数です。なぜわざわざ{purrr}パッケージを読み込んでまで<code>map_dbl()</code>関数を使う必要があるでしょうか。それは<code>map_dbl()</code>の内部にはラムダ（lambda）式、あるいは無名関数（anonymous function）と呼ばれるものが使用可能だからです。ラムダ式は第<a href="datahandling2.html#handling2-summarise">14.1</a>章でも説明しましたが、もう一回解説します。ラムダ式は使い捨ての関数で、<code>map_dbl()</code>内部での処理が終わるとメモリ上から削除される関数です。使い捨てですので、関数の名前（オブジェクト名）も与えられておりません。</p>
<p>このラムダ式の作り方ですが、<code>~</code>で始まり、引数の部分には<code>.x</code>が入ります<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>。したがって、<code>~(.x + 2) / 3</code>は<code>function(x){(x + 2) / 3}</code>の簡略したものとなります。ただし、後者だと無名関数の引数に該当する<code>x</code>を<code>y</code>や<code>j</code>などに書き換えても問題ありませんが、ラムダ式では必ず<code>.x</code>と表記する必要があります。</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb30-1"><a href="iteration.html#cb30-1"></a><span class="kw">map_dbl</span>(num_vec, <span class="op">~</span>(.x <span class="op">+</span><span class="st"> </span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 1.666667 1.333333 2.333333 2.000000 3.000000</code></pre>
<p>かなり短めなコードで「<code>num_vec</code>の全要素に2を足して3で割る」処理ができました。一方、<code>sapply()</code>や<code>lapply()</code>のような<code>*apply()</code>関数群だとラムダ式を使うことはできません。現在のメモリ上にある関数のみしか使うことができません。</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb32-1"><a href="iteration.html#cb32-1"></a><span class="kw">sapply</span>(num_vec, <span class="op">~</span>(.x <span class="op">+</span><span class="st"> </span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Error in match.fun(FUN): &#39;~(.x + 2)/3&#39; is not a function, character or symbol</code></pre>
<p>これまでの例は<strong>正しい</strong>コードではありますが、<strong>良い</strong>コードとは言えないでしょう。なぜなら<code>num_vec + 2</code>という最適解が存在するからです。<code>*apply()</code>と<code>map_*()</code>はより複雑な処理に特化しています。たとえば、リスト型データの処理です。以下の例を考えてみましょう。</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb34-1"><a href="iteration.html#cb34-1"></a>num_list &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">List1 =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>),</span>
<span id="cb34-2"><a href="iteration.html#cb34-2"></a>                 <span class="dt">List2 =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">3</span>),</span>
<span id="cb34-3"><a href="iteration.html#cb34-3"></a>                 <span class="dt">List3 =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="ot">NA</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><code>num_list</code>は3つのnumeric型ベクトルで構成されたリスト型オブジェクトです。それぞれのベクトルの平均値を求めてみましょう。これを普通に<code>mean()</code>関数のみで済まそうとすると、リストからベクトルを一つずつ抽出し、3回の<code>mean()</code>関数を使用する必要があります、</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb35-1"><a href="iteration.html#cb35-1"></a><span class="kw">mean</span>(num_list[[<span class="st">&quot;List1&quot;</span>]], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb37-1"><a href="iteration.html#cb37-1"></a><span class="kw">mean</span>(num_list[[<span class="st">&quot;List2&quot;</span>]], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 6.571429</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb39-1"><a href="iteration.html#cb39-1"></a><span class="kw">mean</span>(num_list[[<span class="st">&quot;List3&quot;</span>]], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 4.666667</code></pre>
<p>もしリストの長さが大きくなると、以下のように<code>for()</code>文の方が効率的でしょう。</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb41-1"><a href="iteration.html#cb41-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">names</span>(num_list)) {</span>
<span id="cb41-2"><a href="iteration.html#cb41-2"></a>    <span class="kw">print</span>(<span class="kw">mean</span>(num_list[[i]], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb41-3"><a href="iteration.html#cb41-3"></a>}</span></code></pre></div>
<pre><code>## [1] 5
## [1] 6.571429
## [1] 4.666667</code></pre>
<p>計算結果をベクトルとして出力/保存する場合は予めベクトルを用意しておく必要があります。</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb43-1"><a href="iteration.html#cb43-1"></a><span class="co"># num_listの長さと同じ長さの空ベクトルを生成</span></span>
<span id="cb43-2"><a href="iteration.html#cb43-2"></a>Return_vec &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, <span class="kw">length</span>(num_list))</span>
<span id="cb43-3"><a href="iteration.html#cb43-3"></a></span>
<span id="cb43-4"><a href="iteration.html#cb43-4"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(num_list)) {</span>
<span id="cb43-5"><a href="iteration.html#cb43-5"></a>    Return_vec[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(num_list[[i]], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb43-6"><a href="iteration.html#cb43-6"></a>}</span>
<span id="cb43-7"><a href="iteration.html#cb43-7"></a></span>
<span id="cb43-8"><a href="iteration.html#cb43-8"></a>Return_vec</span></code></pre></div>
<pre><code>## [1] 5.000000 6.571429 4.666667</code></pre>
<p>以上の例は<code>sapply()</code>、または<code>map_dbl</code>関数を使うとより短くすることができます。</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb45-1"><a href="iteration.html#cb45-1"></a><span class="kw">sapply</span>(num_list, mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>##    List1    List2    List3 
## 5.000000 6.571429 4.666667</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb47-1"><a href="iteration.html#cb47-1"></a><span class="kw">map_dbl</span>(num_list, mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>##    List1    List2    List3 
## 5.000000 6.571429 4.666667</code></pre>
<p><code>*apply()</code>も<code>map_*()</code>も、それぞれの要素に対して同じ処理を行うことを得意とする関数です。他の応用としては、各ベクトルからn番目の要素を抽出することもできます。ベクトルからn番目の要素を抽出するには<code>ベクトル名[n]</code>と入力しますが、実はこの<code>[</code>も関数です。関数として使う場合は<code>+</code>と同様、<code>`[`</code>と表記します。<code>num_list</code>内の3つのベクトルから3番目の要素を抽出してみましょう<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>。</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb49-1"><a href="iteration.html#cb49-1"></a><span class="kw">map_dbl</span>(num_list, <span class="st">`</span><span class="dt">[</span><span class="st">`</span>, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## List1 List2 List3 
##     5     6    NA</code></pre>
<p>ここまで来たら<code>map_*()</code>関数群の仕組みについてイメージが出来たかと思います。<code>map_*()</code>関数群の動きは図<a href="iteration.html#fig:map-inside">24.1</a>のように表すことができます。第一引数はデータであり、そのデータの各要素に対して第二引数で指定された関数を適用します。この関数に必要な（データを除く）引数は第三引数以降に指定します。この関数部（第二引数）はRやパッケージなどで予め提供されている関数でも、内部に直接無名関数を作成することもできます。この無名関数は<code>function(x){}</code>のような従来の書き方も可能ですが、<code>map_*()</code>関数群の場合<code>~</code>で始まるラムダ式を使うことも可能です。</p>
<div class="figure" style="text-align: center"><span id="fig:map-inside"></span>
<img src="figures/Iteration/map_inside.png" alt="`map_*()`関数群のイメージ" width="100%" />
<p class="caption">
図 24.1: <code>map_*()</code>関数群のイメージ
</p>
</div>
<p><code>map()</code>の場合、返り値はリストとなり、<code>map_dbl()</code>の返り値はnumeric (double)型のベクトルとなります。他にも<code>map_*()</code>関数群には<code>map_int()</code>、<code>map_lgl()</code>、<code>map_chr()</code>、<code>map_df()</code>などがあり、それぞれ返り値のデータ型/データ構造を表しています。例えば、返り値がcharacter型のベクトルであれば、<code>map_chr()</code>を使います。<code>c(1, 2, 3, 4, 5)</code>のベクトルの各要素の前に<code>"ID: "</code>を付ける例だと以下のように書きます。</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb51-1"><a href="iteration.html#cb51-1"></a><span class="co"># 以下のコードでもOK</span></span>
<span id="cb51-2"><a href="iteration.html#cb51-2"></a><span class="co"># map_chr(c(1, 2, 3, 4, 5), ~paste0(&quot;ID: &quot;, .x))</span></span>
<span id="cb51-3"><a href="iteration.html#cb51-3"></a><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) <span class="op">%&gt;%</span></span>
<span id="cb51-4"><a href="iteration.html#cb51-4"></a><span class="st">  </span><span class="kw">map_chr</span>(<span class="op">~</span><span class="kw">paste0</span>(<span class="st">&quot;ID: &quot;</span>, .x))</span></code></pre></div>
<pre><code>## [1] &quot;ID: 1&quot; &quot;ID: 2&quot; &quot;ID: 3&quot; &quot;ID: 4&quot; &quot;ID: 5&quot;</code></pre>
<hr />
</div>
<div id="iteration-two-arguments" class="section level2" number="24.3">
<h2><span class="header-section-number">24.3</span> 引数が2つ以上の場合</h2>
<p>{purrr}を使った本格的な例を紹介する前に、引数が2つ以上の場合を考えたいと思います。まずは引数が2つの場合です。この場合、<code>map2_*()</code>関数群を使用します。例えば、<code>num_vec</code>に長さ5のnumeric型ベクトル<code>num_vec2</code>をかける例を考えてみましょう。</p>
<p>この場合、データとして<code>num_vec</code>と<code>num_vec2</code>が必要となり、ラムダ式にも2つの引数が必要です。まず、<code>num_vec2</code>を用意します。</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb53-1"><a href="iteration.html#cb53-1"></a>num_vec2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span></code></pre></div>
<p>続いて<code>map2_dbl()</code>関数を使用し<code>num_vec</code>と<code>num_vec2</code>の掛け算を行います。<code>map2_*()</code>の使い方は<code>map_*()</code>とほぼ同様です。</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb54-1"><a href="iteration.html#cb54-1"></a><span class="kw">map2_dbl</span>(データ1, データ2, 関数 or ラムダ式, 追加の引数)</span></code></pre></div>
<p><code>map_*()</code>との違いとしては、(1) データが2つである、(2) 関数、またはラムダ式に2つの引数が必要である点です。この2点目の引数ですが、データ2は<code>.y</code>と表記します。したがって、データ1とデータ2の掛け算を意味するラムダ式は<code>~.x * .y</code>です。</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb55-1"><a href="iteration.html#cb55-1"></a><span class="kw">map2_dbl</span>(num_vec, num_vec2, <span class="op">~</span>.x <span class="op">*</span><span class="st"> </span>.y)</span></code></pre></div>
<pre><code>## [1] 3 0 5 0 7</code></pre>
<p><code>num_vec</code>と<code>num_vec2</code>が必ずしも同じデータ構造、データ型、同じ長さである必要がありません。数字の前に<code>"ID:"</code>を付ける先ほどの例を<code>map2_chr()</code>で書いてみましょう。</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb57-1"><a href="iteration.html#cb57-1"></a><span class="kw">map2_chr</span>(num_vec, <span class="st">&quot;ID:&quot;</span>, <span class="op">~</span><span class="kw">paste0</span>(.y, .x))</span></code></pre></div>
<pre><code>## [1] &quot;ID:3&quot; &quot;ID:2&quot; &quot;ID:5&quot; &quot;ID:4&quot; &quot;ID:7&quot;</code></pre>
<p>それでは3つ以上の引数について考えてみましょう。たとえば、<code>num_vec</code>の前に<code>"ID"</code>を付けるとします。そして<code>"ID"</code>と<code>num_vec</code>の間に<code>":"</code>を入れたい場合はどうすればい良いでしょう。むろん、賢い解決方法は単純に<code>paste()</code>関数を使うだけです。</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb59-1"><a href="iteration.html#cb59-1"></a><span class="kw">paste</span>(<span class="st">&quot;ID&quot;</span>, num_vec, <span class="dt">sep =</span> <span class="st">&quot;:&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;ID:3&quot; &quot;ID:2&quot; &quot;ID:5&quot; &quot;ID:4&quot; &quot;ID:7&quot;</code></pre>
<p>この場合、引数は3つです<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>。この場合の書き方はどうなるでしょうか。<code>map2_*()</code>はデータを2つまでしか指定できません。3つ目以降は関数/ラムダ式の後ろに書くこととなります。ただし、関数/ラムダ式の後ろに指定される引数は長さ1のベクトルでなければなりません。また、ラムダ式内の引数は<code>.x</code>と<code>.y</code>でなく、<code>..1</code>、<code>..2</code>、<code>..3</code>、…となります。</p>
<p>今回の例だと<code>map2_chr()</code>内に<code>num_vec</code>がデータ1、<code>"ID"</code>がデータ2です。そして、期待される結果は、「“ID” + <code>sep</code>の実引数 + <code>num_vec</code>の値」となります。したがって、ラムダ式は<code>paste(..2, ..1, sep = ..3)</code>となります。</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb61-1"><a href="iteration.html#cb61-1"></a><span class="kw">map2_chr</span>(num_vec, <span class="st">&quot;ID&quot;</span>, <span class="op">~</span><span class="kw">paste</span>(..<span class="dv">2</span>, ..<span class="dv">1</span>, <span class="dt">sep =</span> ..<span class="dv">3</span>), <span class="st">&quot;-&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;ID-3&quot; &quot;ID-2&quot; &quot;ID-5&quot; &quot;ID-4&quot; &quot;ID-7&quot;</code></pre>
<p>データ2である<code>"ID"</code>は長さ1のcharacter型ベクトルであるため、以下のように<code>map_chr()</code>を使うことも可能です。</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb63-1"><a href="iteration.html#cb63-1"></a><span class="co"># データ2も長さ1なのでmap_chr()もOK</span></span>
<span id="cb63-2"><a href="iteration.html#cb63-2"></a><span class="kw">map_chr</span>(num_vec, <span class="op">~</span><span class="kw">paste</span>(..<span class="dv">2</span>, ..<span class="dv">1</span>, <span class="dt">sep =</span> ..<span class="dv">3</span>), <span class="st">&quot;ID&quot;</span>, <span class="st">&quot;-&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;ID-3&quot; &quot;ID-2&quot; &quot;ID-5&quot; &quot;ID-4&quot; &quot;ID-7&quot;</code></pre>
<p>それではデータを3つ以上使うにはどうすれば良いでしょうか。そこで登場するのが<code>pmap_*()</code>関数です。以下の3つのベクトルを利用し、「名前:数学成績」を出力してみましょう。ただし、不正行為がある場合（<code>cheat_vec</code>の値が1）は成績が0点になるようにしましょう。</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb65-1"><a href="iteration.html#cb65-1"></a>name_vec  &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Hadley&quot;</span>, <span class="st">&quot;Song&quot;</span>, <span class="st">&quot;Yanai&quot;</span>)</span>
<span id="cb65-2"><a href="iteration.html#cb65-2"></a>math_vec  &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">70</span>, <span class="dv">55</span>, <span class="dv">80</span>)</span>
<span id="cb65-3"><a href="iteration.html#cb65-3"></a>cheat_vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code></pre></div>
<p>賢い解決法は普通に<code>paste0()</code>関数を使う方法です。</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb66-1"><a href="iteration.html#cb66-1"></a><span class="kw">paste0</span>(name_vec, <span class="st">&quot;:&quot;</span>, math_vec <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>cheat_vec))</span></code></pre></div>
<pre><code>## [1] &quot;Hadley:70&quot; &quot;Song:0&quot;    &quot;Yanai:80&quot;</code></pre>
<p>今回はあえて<code>pmap_*()</code>関数を使ってみましょう。<code>pmap_*()</code>の場合、第一引数であるデータはリスト型で渡す必要があります。したがって、3つのベクトルを<code>list()</code>関数を用いてリスト化します。第二引数には既存の関数やラムダ式を入力し、各引数は<code>..1</code>、<code>..2</code>、…といった形で表記します。</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb68-1"><a href="iteration.html#cb68-1"></a><span class="kw">pmap_chr</span>(<span class="kw">list</span>(name_vec, math_vec, cheat_vec), </span>
<span id="cb68-2"><a href="iteration.html#cb68-2"></a>         <span class="op">~</span><span class="kw">paste0</span>(..<span class="dv">1</span>, <span class="st">&quot;:&quot;</span>, ..<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>..<span class="dv">3</span>)))</span></code></pre></div>
<pre><code>## [1] &quot;Hadley:70&quot; &quot;Song:0&quot;    &quot;Yanai:80&quot;</code></pre>
<p>第一引数はデータであるため、まずリストを作成し、パイプ演算子（<code>%&gt;%</code>）で<code>pmap_*()</code>に渡すことも可能です。</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb70-1"><a href="iteration.html#cb70-1"></a><span class="kw">list</span>(name_vec, math_vec, cheat_vec) <span class="op">%&gt;%</span></span>
<span id="cb70-2"><a href="iteration.html#cb70-2"></a><span class="st">  </span><span class="kw">pmap_chr</span>(<span class="op">~</span><span class="kw">paste0</span>(..<span class="dv">1</span>, <span class="st">&quot;:&quot;</span>, ..<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>..<span class="dv">3</span>)))</span></code></pre></div>
<pre><code>## [1] &quot;Hadley:70&quot; &quot;Song:0&quot;    &quot;Yanai:80&quot;</code></pre>
<hr />
</div>
<div id="iteration-df" class="section level2" number="24.4">
<h2><span class="header-section-number">24.4</span> データフレームと{purrr}</h2>
<p><code>map_*()</code>関数のデータとしてデータフレームを渡すことも可能です。ここでは5行3列のデータフレームを作成してみましょう。</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb72-1"><a href="iteration.html#cb72-1"></a>Dummy_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">X =</span> <span class="kw">seq</span>(<span class="dv">1</span>,  <span class="dv">5</span>,  <span class="dt">by =</span> <span class="dv">1</span>),</span>
<span id="cb72-2"><a href="iteration.html#cb72-2"></a>                       <span class="dt">Y =</span> <span class="kw">seq</span>(<span class="dv">10</span>, <span class="dv">50</span>, <span class="dt">by =</span> <span class="dv">10</span>),</span>
<span id="cb72-3"><a href="iteration.html#cb72-3"></a>                       <span class="dt">Z =</span> <span class="kw">seq</span>(<span class="dv">2</span>,  <span class="dv">10</span>, <span class="dt">by =</span> <span class="dv">2</span>))</span></code></pre></div>
<p>各行の<code>X</code>、<code>Y</code>、<code>Z</code>の合計を計算するには{dplyr}の<code>rowwise()</code>と<code>mutate()</code>を組み合わせることで計算出来ることを第<a href="datahandling2.html#handling2-rowwise">14.4</a>章で紹介しました。</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb73-1"><a href="iteration.html#cb73-1"></a>Dummy_df <span class="op">%&gt;%</span></span>
<span id="cb73-2"><a href="iteration.html#cb73-2"></a><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></span>
<span id="cb73-3"><a href="iteration.html#cb73-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Sum =</span> <span class="kw">sum</span>(X, Y, Z)) <span class="op">%&gt;%</span></span>
<span id="cb73-4"><a href="iteration.html#cb73-4"></a><span class="st">  </span><span class="co"># rowwise()は1行を1グループとする関数であるため、最後にグループ化を解除</span></span>
<span id="cb73-5"><a href="iteration.html#cb73-5"></a><span class="st">  </span><span class="kw">ungroup</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##       X     Y     Z   Sum
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1    10     2    13
## 2     2    20     4    26
## 3     3    30     6    39
## 4     4    40     8    52
## 5     5    50    10    65</code></pre>
<p>それでは各列の平均値を計算するにはどうすれば良いでしょうか。ここではR内蔵関数である<code>colMeans()</code>を使わないことにしましょう。</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb75-1"><a href="iteration.html#cb75-1"></a><span class="kw">colMeans</span>(Dummy_df)</span></code></pre></div>
<pre><code>##  X  Y  Z 
##  3 30  6</code></pre>
<p>まず、<code>mean(Dummy_df$X)</code>を3回実行する方法や、{dplyr}の<code>summarise()</code>関数を使う方法があります。</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb77-1"><a href="iteration.html#cb77-1"></a>Dummy_df <span class="op">%&gt;%</span></span>
<span id="cb77-2"><a href="iteration.html#cb77-2"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">X =</span> <span class="kw">mean</span>(X), </span>
<span id="cb77-3"><a href="iteration.html#cb77-3"></a>            <span class="dt">Y =</span> <span class="kw">mean</span>(Y),</span>
<span id="cb77-4"><a href="iteration.html#cb77-4"></a>            <span class="dt">Z =</span> <span class="kw">mean</span>(Z))</span></code></pre></div>
<pre><code>##   X  Y Z
## 1 3 30 6</code></pre>
<p>実はこの操作、<code>map_dbl()</code>関数を使えば、より簡単です。</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb79-1"><a href="iteration.html#cb79-1"></a><span class="kw">map_dbl</span>(Dummy_df, mean)</span></code></pre></div>
<pre><code>##  X  Y  Z 
##  3 30  6</code></pre>
<p><code>map_dbl()</code>はnumeric (double) 型ベクトルを返しますが、データフレーム（具体的にはtibble）に返すなら<code>map_df()</code>を使います。</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb81-1"><a href="iteration.html#cb81-1"></a><span class="kw">map_df</span>(Dummy_df, mean)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##       X     Y     Z
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     3    30     6</code></pre>
<p>なぜこれが出来るでしょうか。これを理解するためにはデータフレームとtibbleが本質的にはリスト型と同じであることを理解する必要があります。たとえば、以下のようなリストについて考えてみましょう。</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb83-1"><a href="iteration.html#cb83-1"></a>Dummy_list &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">X =</span> <span class="kw">seq</span>(<span class="dv">1</span>,  <span class="dv">5</span>,  <span class="dt">by =</span> <span class="dv">1</span>),</span>
<span id="cb83-2"><a href="iteration.html#cb83-2"></a>                   <span class="dt">Y =</span> <span class="kw">seq</span>(<span class="dv">10</span>, <span class="dv">50</span>, <span class="dt">by =</span> <span class="dv">10</span>),</span>
<span id="cb83-3"><a href="iteration.html#cb83-3"></a>                   <span class="dt">Z =</span> <span class="kw">seq</span>(<span class="dv">2</span>,  <span class="dv">10</span>, <span class="dt">by =</span> <span class="dv">2</span>))</span>
<span id="cb83-4"><a href="iteration.html#cb83-4"></a></span>
<span id="cb83-5"><a href="iteration.html#cb83-5"></a>Dummy_list</span></code></pre></div>
<pre><code>## $X
## [1] 1 2 3 4 5
## 
## $Y
## [1] 10 20 30 40 50
## 
## $Z
## [1]  2  4  6  8 10</code></pre>
<p>この<code>Dummy_list</code>を<code>as.data.frame()</code>関数を使用して強制的にデータフレームに変換してみましょう。</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb85-1"><a href="iteration.html#cb85-1"></a><span class="kw">as.data.frame</span>(Dummy_list)</span></code></pre></div>
<pre><code>##   X  Y  Z
## 1 1 10  2
## 2 2 20  4
## 3 3 30  6
## 4 4 40  8
## 5 5 50 10</code></pre>
<p><code>Dummy_df</code>と同じものが出てきました。逆に<code>Dummy_df</code>を、<code>as.list()</code>を使用してリストに変換すると<code>Dummy_list</code>と同じものが返されます。</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb87-1"><a href="iteration.html#cb87-1"></a><span class="kw">as.list</span>(Dummy_df)</span></code></pre></div>
<pre><code>## $X
## [1] 1 2 3 4 5
## 
## $Y
## [1] 10 20 30 40 50
## 
## $Z
## [1]  2  4  6  8 10</code></pre>
<p>ここまで理解できれば、<code>map_*()</code>関数のデータがデータフレームの場合、内部ではリストとして扱われることが分かるでしょう。実際、<code>Dummy_list</code>をデータとして入れても<code>Dummy_df</code>を入れた結果と同じものが得られます。</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb89-1"><a href="iteration.html#cb89-1"></a><span class="kw">map_df</span>(Dummy_list, mean)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##       X     Y     Z
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     3    30     6</code></pre>
<div id="iteration-tibble" class="section level3" number="24.4.1">
<h3><span class="header-section-number">24.4.1</span> tibbleの話</h3>
<p>ここまで「データフレーム」と「tibble」を区別せずに説明してきましたが、これからの話しではこの2つを区別する必要があります。tibbleは{tidyverse}のコアパッケージの一つである{tibble}が提供するデータ構造であり、データフレームの上位互換です。tibbleもデータフレーム同様、本質的にはリストですが、リストの構造をより的確に表すことが出来ます。</p>
<p>データフレームをリストとして考える場合、リストの各要素は<strong>必ずベクトル</strong>である必要があります。たとえば、<code>Dummy_list</code>には3つの要素があり、それぞれ長さ5のベクトルです。一方、リストの中にはリストを入れることも出来ます。たとえば、以下のような<code>Dummy_list2</code>について考えてみましょう。</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb91-1"><a href="iteration.html#cb91-1"></a>Dummy_list2 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">ID   =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, </span>
<span id="cb91-2"><a href="iteration.html#cb91-2"></a>                    <span class="dt">Data =</span> <span class="kw">list</span>(Dummy_df, Dummy_df, Dummy_df))</span>
<span id="cb91-3"><a href="iteration.html#cb91-3"></a></span>
<span id="cb91-4"><a href="iteration.html#cb91-4"></a>Dummy_list2</span></code></pre></div>
<pre><code>## $ID
## [1] 1 2 3
## 
## $Data
## $Data[[1]]
##   X  Y  Z
## 1 1 10  2
## 2 2 20  4
## 3 3 30  6
## 4 4 40  8
## 5 5 50 10
## 
## $Data[[2]]
##   X  Y  Z
## 1 1 10  2
## 2 2 20  4
## 3 3 30  6
## 4 4 40  8
## 5 5 50 10
## 
## $Data[[3]]
##   X  Y  Z
## 1 1 10  2
## 2 2 20  4
## 3 3 30  6
## 4 4 40  8
## 5 5 50 10</code></pre>
<p><code>Dummy_list2</code>には2つの要素があり、最初の要素は長さ3のベクトル、2つ目の要素は長さ3のリストです。2つ目の要素がベクトルでないため、<code>Dummy_list2</code>をデータフレームに変換することはできません。</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb93-1"><a href="iteration.html#cb93-1"></a>Dummy_df2 &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(Dummy_list2)</span></code></pre></div>
<pre><code>## Error in (function (..., row.names = NULL, check.rows = FALSE, check.names = TRUE, : arguments imply differing number of rows: 3, 5</code></pre>
<p>一方、<code>as_tibble()</code>を使用してtibble型に変換することは可能です。</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb95-1"><a href="iteration.html#cb95-1"></a>Dummy_tibble &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(Dummy_list2)</span>
<span id="cb95-2"><a href="iteration.html#cb95-2"></a></span>
<span id="cb95-3"><a href="iteration.html#cb95-3"></a>Dummy_tibble</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##      ID Data            
##   &lt;int&gt; &lt;list&gt;          
## 1     1 &lt;df[,3] [5 × 3]&gt;
## 2     2 &lt;df[,3] [5 × 3]&gt;
## 3     3 &lt;df[,3] [5 × 3]&gt;</code></pre>
<p>2列目の各セルには5行3列のデータフレーム（<code>df</code>）が格納されていることが分かります。たとえば、<code>Dummy_tibble</code>の<code>Data</code>列を抽出してみましょう。</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb97-1"><a href="iteration.html#cb97-1"></a>Dummy_tibble<span class="op">$</span>Data</span></code></pre></div>
<pre><code>## [[1]]
##   X  Y  Z
## 1 1 10  2
## 2 2 20  4
## 3 3 30  6
## 4 4 40  8
## 5 5 50 10
## 
## [[2]]
##   X  Y  Z
## 1 1 10  2
## 2 2 20  4
## 3 3 30  6
## 4 4 40  8
## 5 5 50 10
## 
## [[3]]
##   X  Y  Z
## 1 1 10  2
## 2 2 20  4
## 3 3 30  6
## 4 4 40  8
## 5 5 50 10</code></pre>
<p>長さ3のリスト出力されます。続いて、<code>Dummy_tibble$Data</code>の2番目のセルを抽出してみましょう。</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb99-1"><a href="iteration.html#cb99-1"></a>Dummy_tibble<span class="op">$</span>Data[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## [[1]]
##   X  Y  Z
## 1 1 10  2
## 2 2 20  4
## 3 3 30  6
## 4 4 40  8
## 5 5 50 10</code></pre>
<p>データフレームが出力されました。簡単にまとめるとtibbleはデータフレームの中にデータフレームを入れることが出来るデータ構造です。むろん、これまでの通り、データフレームのように使うことも可能です<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>。これがtibbleの強みでもあり、{purrr}との相性も非常に高いです。たとえば、<code>Data</code>列を<code>map()</code>関数のデータとして渡せば、複数のデータセットに対して同じモデルの推定が出来るようになります。以下ではその例を紹介します。</p>
<hr />
</div>
</div>
<div id="iteration-model1" class="section level2" number="24.5">
<h2><span class="header-section-number">24.5</span> モデルの反復推定</h2>
<p>ここからは<code>map_*()</code>関数群を使って複数のモデルを素早く推定する方法について解説します。サンプルデータは第<a href="visualization2.html#visualization2">18</a>章で使いました各国の政治経済データ（<code>Countries.csv</code>）を使用します。csv形式データ読み込みの際、これまではR内蔵関数である<code>read.csv()</code>と{readr}<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>の<code>read_csv()</code>を区別せずに使用してきました。しかし、ここからは<code>read_csv()</code>を使用します。2つの使い方はほぼ同じですが、<code>read_csv()</code>は各列のデータ型を自動的に指定してくれるだけではなく、tibble構造として読み込みます。<code>read.csv()</code>を使用する場合、<code>as.tibble(データフレーム名)</code>でデータフレームをtibbleに変換してください。</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb101-1"><a href="iteration.html#cb101-1"></a>Country_df &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;Data/Countries.csv&quot;</span>)</span></code></pre></div>
<div id="iteration-split1" class="section level3" number="24.5.1">
<h3><span class="header-section-number">24.5.1</span> サンプルの分割とモデル推定（<code>split()</code>利用）</h3>
<p>まずは、サンプルを分割し、それぞれの下位サンプルを使った分析を繰り返す方法について解説します。サンプルを分割する方法は2つありますが、最初はR内蔵関数である<code>split()</code>関数を使った方法について紹介します。</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb102-1"><a href="iteration.html#cb102-1"></a><span class="co"># split()の使い方</span></span>
<span id="cb102-2"><a href="iteration.html#cb102-2"></a>新しいオブジェクト名 &lt;-<span class="st"> </span><span class="kw">split</span>(データ名, 分割の基準となるベクトル)</span></code></pre></div>
<p>たとえば、<code>Country_df</code>を大陸ごとにサンプルを分けるとします。大陸を表すベクトルは<code>Country_df$Continent</code>です。したがって、以下のように入力します。</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb103-1"><a href="iteration.html#cb103-1"></a>Split_Data &lt;-<span class="st"> </span><span class="kw">split</span>(Country_df, Country_df<span class="op">$</span>Continent)</span></code></pre></div>
<p>サンプルが分割された<code>Split_Data</code>のデータ構造はリスト型です。</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb104-1"><a href="iteration.html#cb104-1"></a><span class="kw">class</span>(Split_Data)</span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<p>中身を見るとリストの各要素としてtibble（データフレーム）が格納されています。リストの中にはあらゆるデータ型、データ構造を入れることができることが分かります。</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb106-1"><a href="iteration.html#cb106-1"></a>Split_Data</span></code></pre></div>
<pre><code>## $Africa
## # A tibble: 54 x 18
##    Country Population   Area    GDP    PPP GDP_per_capita PPP_per_capita    G7
##    &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt;
##  1 Algeria   43851044 2.38e6 1.70e5 4.97e5          3876.         11324.     0
##  2 Angola    32866272 1.25e6 9.46e4 2.19e5          2879.          6649.     0
##  3 Benin     12123200 1.13e5 1.44e4 3.72e4          1187.          3067.     0
##  4 Botswa…    2351627 5.67e5 1.83e4 4.07e4          7799.         17311.     0
##  5 Burkin…   20903273 2.74e5 1.57e4 3.76e4           753.          1800.     0
##  6 Burundi   11890784 2.57e4 3.01e3 8.72e3           253.           733.     0
##  7 Cabo V…     555987 4.03e3 1.98e3 3.84e3          3565.          6913.     0
##  8 Camero…   26545863 4.73e5 3.88e4 9.31e4          1460.          3506.     0
##  9 Centra…    4829767 6.23e5 2.22e3 4.46e3           460.           924.     0
## 10 Chad      16425864 1.26e6 1.13e4 2.51e4           689.          1525.     0
## # … with 44 more rows, and 10 more variables: G20 &lt;dbl&gt;, OECD &lt;dbl&gt;,
## #   HDI_2018 &lt;dbl&gt;, Polity_Score &lt;dbl&gt;, Polity_Type &lt;chr&gt;, FH_PR &lt;dbl&gt;,
## #   FH_CL &lt;dbl&gt;, FH_Total &lt;dbl&gt;, FH_Status &lt;chr&gt;, Continent &lt;chr&gt;
## 
## $America
## # A tibble: 36 x 18
##    Country Population   Area    GDP    PPP GDP_per_capita PPP_per_capita    G7
##    &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt;
##  1 Antigu…      97929 4.40e2 1.73e3 2.08e3         17643.         21267.     0
##  2 Argent…   45195774 2.74e6 4.50e5 1.04e6          9949.         22938.     0
##  3 Bahamas     393244 1.00e4 1.28e4 1.40e4         32618.         35662.     0
##  4 Barbad…     287375 4.30e2 5.21e3 4.62e3         18126.         16066.     0
##  5 Belize      397628 2.28e4 1.88e3 2.82e3          4727.          7091.     0
##  6 Bolivia   11673021 1.08e6 4.09e4 1.01e5          3503.          8623.     0
##  7 Brazil   212559417 8.36e6 1.84e6 3.13e6          8655.         14734.     0
##  8 Canada    37742154 9.09e6 1.74e6 1.85e6         46008.         49088.     1
##  9 Chile     19116201 7.44e5 2.82e5 4.64e5         14769.         24262.     0
## 10 Colomb…   50882891 1.11e6 3.24e5 7.37e5          6364.         14475.     0
## # … with 26 more rows, and 10 more variables: G20 &lt;dbl&gt;, OECD &lt;dbl&gt;,
## #   HDI_2018 &lt;dbl&gt;, Polity_Score &lt;dbl&gt;, Polity_Type &lt;chr&gt;, FH_PR &lt;dbl&gt;,
## #   FH_CL &lt;dbl&gt;, FH_Total &lt;dbl&gt;, FH_Status &lt;chr&gt;, Continent &lt;chr&gt;
## 
## $Asia
## # A tibble: 42 x 18
##    Country Population   Area    GDP    PPP GDP_per_capita PPP_per_capita    G7
##    &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt;
##  1 Afghan…   38928346 6.53e5 1.91e4 8.27e4           491.          2125.     0
##  2 Bahrain    1701575 7.60e2 3.86e4 7.42e4         22670.         43624.     0
##  3 Bangla…  164689383 1.30e5 3.03e5 7.34e5          1837.          4458.     0
##  4 Bhutan      771608 3.81e4 2.45e3 8.77e3          3171.         11363.     0
##  5 Brunei      437479 5.27e3 1.35e4 2.65e4         30789.         60656.     0
##  6 Burma     54409800 6.53e5 7.61e4 2.68e5          1398.          4932.     0
##  7 Cambod…   16718965 1.77e5 2.71e4 6.93e4          1620.          4142.     0
##  8 China   1447470092 9.39e6 1.48e7 2.20e7         10199.         15177.     0
##  9 India   1380004385 2.97e6 2.88e6 9.06e6          2083.          6564.     0
## 10 Indone…  273523615 1.81e6 1.12e6 3.12e6          4092.         11397.     0
## # … with 32 more rows, and 10 more variables: G20 &lt;dbl&gt;, OECD &lt;dbl&gt;,
## #   HDI_2018 &lt;dbl&gt;, Polity_Score &lt;dbl&gt;, Polity_Type &lt;chr&gt;, FH_PR &lt;dbl&gt;,
## #   FH_CL &lt;dbl&gt;, FH_Total &lt;dbl&gt;, FH_Status &lt;chr&gt;, Continent &lt;chr&gt;
## 
## $Europe
## # A tibble: 50 x 18
##    Country Population   Area    GDP     PPP GDP_per_capita PPP_per_capita    G7
##    &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt;
##  1 Albania    2877797  27400 1.53e4  39658.          5309.         13781.     0
##  2 Andorra      77265    470 3.15e3     NA          40821.            NA      0
##  3 Armenia    2963243  28470 1.37e4  38446.          4614.         12974.     0
##  4 Austria    9006398  82409 4.46e5 502771.         49555.         55824.     0
##  5 Azerba…   10139177  82658 4.80e4 144556.          4739.         14257.     0
##  6 Belarus    9449323 202910 6.31e4 183461.          6676.         19415.     0
##  7 Belgium   11589623  30280 5.30e5 597433.         45697.         51549.     0
##  8 Bosnia…    3280819  51000 2.00e4  49733.          6111.         15159.     0
##  9 Bulgar…    6948445 108560 6.79e4 156693.          9776.         22551.     0
## 10 Croatia    4105267  55960 6.04e4 114932.         14717.         27996.     0
## # … with 40 more rows, and 10 more variables: G20 &lt;dbl&gt;, OECD &lt;dbl&gt;,
## #   HDI_2018 &lt;dbl&gt;, Polity_Score &lt;dbl&gt;, Polity_Type &lt;chr&gt;, FH_PR &lt;dbl&gt;,
## #   FH_CL &lt;dbl&gt;, FH_Total &lt;dbl&gt;, FH_Status &lt;chr&gt;, Continent &lt;chr&gt;
## 
## $Oceania
## # A tibble: 4 x 18
##   Country Population   Area    GDP    PPP GDP_per_capita PPP_per_capita    G7
##   &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt;
## 1 Austra…   25499884 7.68e6 1.39e6 1.28e6         54615.         50001.     0
## 2 Fiji        896445 1.83e4 5.54e3 1.25e4          6175.         13940.     0
## 3 New Ze…    4842780 2.64e5 2.07e5 2.04e5         42729.         42178.     0
## 4 Papua …    8947024 4.53e5 2.50e4 3.73e4          2791.          4171.     0
## # … with 10 more variables: G20 &lt;dbl&gt;, OECD &lt;dbl&gt;, HDI_2018 &lt;dbl&gt;,
## #   Polity_Score &lt;dbl&gt;, Polity_Type &lt;chr&gt;, FH_PR &lt;dbl&gt;, FH_CL &lt;dbl&gt;,
## #   FH_Total &lt;dbl&gt;, FH_Status &lt;chr&gt;, Continent &lt;chr&gt;</code></pre>
<p>それでは分割された各サンプルに対して<code>Polity_Score</code>と<code>FH_Total</code>の相関係数を計算してみましょう。その前に相関分析の方法について調べてみましょう。Rには相関分析の関数が2つ用意されています。単純に相関係数のみを計算するなら<code>cor()</code>、係数の不確実性（標準誤差、信頼区間など）まで計算し、検定を行うなら<code>cor.test()</code>を使用します。ここではより汎用性の高い<code>cor.test()</code>の使い方について紹介します。</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb108-1"><a href="iteration.html#cb108-1"></a><span class="co"># 相関分析: 方法1</span></span>
<span id="cb108-2"><a href="iteration.html#cb108-2"></a><span class="kw">cor.test</span>(<span class="op">~</span><span class="st"> </span>変数名1 <span class="op">+</span><span class="st"> </span>変数名2, <span class="dt">data =</span> データ名)</span>
<span id="cb108-3"><a href="iteration.html#cb108-3"></a></span>
<span id="cb108-4"><a href="iteration.html#cb108-4"></a><span class="co"># 相関分析: 方法2</span></span>
<span id="cb108-5"><a href="iteration.html#cb108-5"></a><span class="kw">cor.test</span>(データ名<span class="op">$</span>変数名1, データ名<span class="op">$</span>変数名2)</span></code></pre></div>
<p>それでは全サンプルに対して相関分析をしてみましょう。</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb109-1"><a href="iteration.html#cb109-1"></a>Cor_fit1 &lt;-<span class="st"> </span><span class="kw">cor.test</span>(<span class="op">~</span><span class="st"> </span>Polity_Score <span class="op">+</span><span class="st"> </span>FH_Total, <span class="dt">data =</span> Country_df)</span>
<span id="cb109-2"><a href="iteration.html#cb109-2"></a>Cor_fit1</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  Polity_Score and FH_Total
## t = 19.494, df = 156, p-value &lt; 2.2e-16
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.7896829 0.8821647
## sample estimates:
##       cor 
## 0.8420031</code></pre>
<p>ここから相関係数（0.8420031）のみを抽出するにはどうすれば良いでしょうか。それを確認するためには<code>Cor_fit1</code>というオブジェクトの構造を調べる必要があります。ここではR内蔵関数である<code>str()</code>を使って確認してみましょう。</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb111-1"><a href="iteration.html#cb111-1"></a><span class="kw">str</span>(Cor_fit1)</span></code></pre></div>
<pre><code>## List of 9
##  $ statistic  : Named num 19.5
##   ..- attr(*, &quot;names&quot;)= chr &quot;t&quot;
##  $ parameter  : Named int 156
##   ..- attr(*, &quot;names&quot;)= chr &quot;df&quot;
##  $ p.value    : num 1.16e-43
##  $ estimate   : Named num 0.842
##   ..- attr(*, &quot;names&quot;)= chr &quot;cor&quot;
##  $ null.value : Named num 0
##   ..- attr(*, &quot;names&quot;)= chr &quot;correlation&quot;
##  $ alternative: chr &quot;two.sided&quot;
##  $ method     : chr &quot;Pearson&#39;s product-moment correlation&quot;
##  $ data.name  : chr &quot;Polity_Score and FH_Total&quot;
##  $ conf.int   : num [1:2] 0.79 0.882
##   ..- attr(*, &quot;conf.level&quot;)= num 0.95
##  - attr(*, &quot;class&quot;)= chr &quot;htest&quot;</code></pre>
<p>相関係数は<code>$estimate</code>で抽出できそうですね。実際に<code>Cor_fit1</code>から相関係数のみ抽出してみましょう。</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb113-1"><a href="iteration.html#cb113-1"></a>Cor_fit1<span class="op">$</span>estimate</span></code></pre></div>
<pre><code>##       cor 
## 0.8420031</code></pre>
<p>それでは<code>map()</code>関数を利用して分割された各サンプルを対象に<code>Polity_Score</code>と<code>FH_Total</code>の相関係数を計算してみましょう。<code>map()</code>のデータは<code>Split_Data</code>とし、関数はラムダ式を書いてみましょう。<code>cor.test()</code>内<code>data</code>引数の実引数は<code>.x</code>、または<code>..1</code>となります。最後に<code>map_dbl("estimate")</code>を利用し、相関係数を抽出、numeric (double) 型ベクトルとして出力します。</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb115-1"><a href="iteration.html#cb115-1"></a>Cor_fit2 &lt;-<span class="st"> </span>Split_Data <span class="op">%&gt;%</span></span>
<span id="cb115-2"><a href="iteration.html#cb115-2"></a><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">cor.test</span>(<span class="op">~</span><span class="st"> </span>Polity_Score <span class="op">+</span><span class="st"> </span>FH_Total, <span class="dt">data =</span> .x))</span></code></pre></div>
<div class="sourceCode" id="cb116"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb116-1"><a href="iteration.html#cb116-1"></a><span class="co"># Cor_fit2から相関係数のみ出力</span></span>
<span id="cb116-2"><a href="iteration.html#cb116-2"></a><span class="kw">map_dbl</span>(Cor_fit2, <span class="st">&quot;estimate&quot;</span>)</span></code></pre></div>
<pre><code>##    Africa   America      Asia    Europe   Oceania 
## 0.7612138 0.8356899 0.8338172 0.8419547 0.9960776</code></pre>
<p>もし、小数点3位までの<em>p</em>値が欲しい場合は以下のように入力します。</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb118-1"><a href="iteration.html#cb118-1"></a><span class="co"># Cor_fit2から相関係数のp値を抽出し、小数点3位に丸める</span></span>
<span id="cb118-2"><a href="iteration.html#cb118-2"></a><span class="kw">map_dbl</span>(Cor_fit2, <span class="st">&quot;p.value&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##  Africa America    Asia  Europe Oceania 
##   0.000   0.000   0.000   0.000   0.004</code></pre>
</div>
<div id="iteration-split2" class="section level3" number="24.5.2">
<h3><span class="header-section-number">24.5.2</span> サンプルの分割とモデル推定（<code>nest()</code>利用）</h3>
<p>それではデータフレーム内にデータフレームが格納可能なtibble構造の長所を活かした方法について解説します。ある変数に応じてデータをグループ化する方法については第<a href="datahandling2.html#handling2-group">14.2</a>章で解説しました。{tidyr}パッケージにはグループごとにデータを分割し、分割されたデータを各セルに埋め込む<code>nest()</code>関数を提供しています。具体的な動きを見るために、とりあえず、<code>Country_df</code>を大陸（<code>Continent</code>）ごとに分割し、それぞれがデータが一つのセルに埋め込まれた新しいデータセット、<code>Nested_Data</code>を作ってみましょう。</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb120-1"><a href="iteration.html#cb120-1"></a>Nested_Data &lt;-<span class="st"> </span>Country_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb120-2"><a href="iteration.html#cb120-2"></a><span class="st">  </span><span class="kw">group_by</span>(Continent) <span class="op">%&gt;%</span></span>
<span id="cb120-3"><a href="iteration.html#cb120-3"></a><span class="st">  </span><span class="kw">nest</span>()</span></code></pre></div>
<div class="sourceCode" id="cb121"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb121-1"><a href="iteration.html#cb121-1"></a>Nested_Data</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Continent"],"name":[1],"type":["chr"],"align":["left"]},{"label":["data"],"name":[2],"type":["list"],"align":["right"]}],"data":[{"1":"Asia","2":"<tbl_df[,17]>"},{"1":"Europe","2":"<tbl_df[,17]>"},{"1":"Africa","2":"<tbl_df[,17]>"},{"1":"America","2":"<tbl_df[,17]>"},{"1":"Oceania","2":"<tbl_df[,17]>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>2列目の<code>data</code>変数の各セルにtibbleが埋め込まれたことがわかります。<code>Nested_Data</code>の<code>data</code>列から5つ目の要素（オセアニアのデータ）を確認してみましょう。</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb122-1"><a href="iteration.html#cb122-1"></a><span class="co"># Nested_Data$data[5]の場合、長さ1のリストが出力される</span></span>
<span id="cb122-2"><a href="iteration.html#cb122-2"></a><span class="co"># tibble構造で出力する場合は[5]でなく、[[5]]で抽出</span></span>
<span id="cb122-3"><a href="iteration.html#cb122-3"></a>Nested_Data<span class="op">$</span>data[[<span class="dv">5</span>]]</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Country"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Population"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Area"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["GDP"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["PPP"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["GDP_per_capita"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["PPP_per_capita"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["G7"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["G20"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["OECD"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["HDI_2018"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["Polity_Score"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["Polity_Type"],"name":[13],"type":["chr"],"align":["left"]},{"label":["FH_PR"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["FH_CL"],"name":[15],"type":["dbl"],"align":["right"]},{"label":["FH_Total"],"name":[16],"type":["dbl"],"align":["right"]},{"label":["FH_Status"],"name":[17],"type":["chr"],"align":["left"]}],"data":[{"1":"Australia","2":"25499884","3":"7682300","4":"1392680.59","5":"1275026.60","6":"54615.174","7":"50001.271","8":"0","9":"1","10":"1","11":"0.938","12":"10","13":"Full Democracy","14":"40","15":"57","16":"97","17":"F"},{"1":"Fiji","2":"896445","3":"18270","4":"5535.55","5":"12496.36","6":"6175.002","7":"13939.907","8":"0","9":"0","10":"0","11":"0.724","12":"4","13":"Open Anocracy","14":"24","15":"36","16":"60","17":"PF"},{"1":"New Zealand","2":"4842780","3":"263820","4":"206928.77","5":"204260.27","6":"42729.335","7":"42178.309","8":"0","9":"0","10":"1","11":"0.921","12":"10","13":"Full Democracy","14":"40","15":"57","16":"97","17":"F"},{"1":"Papua New Guinea","2":"8947024","3":"452860","4":"24969.61","5":"37319.09","6":"2790.829","7":"4171.118","8":"0","9":"0","10":"0","11":"0.543","12":"5","13":"Open Anocracy","14":"23","15":"39","16":"62","17":"PF"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><code>Continent</code>がOceaniaの行の<code>data</code>列にオセアニアのみのデータが格納されていることが分かります。このようなデータ構造を入れ子型データ（nested data）と呼びます。この入れ子型データは<code>unnest()</code>関数を使って解除することも可能です。<code>unnest()</code>関数を使う際はどの列を解除するかを指定する必要があり、今回は<code>data</code>列となります。</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb123-1"><a href="iteration.html#cb123-1"></a><span class="co"># 入れ子型データの解除</span></span>
<span id="cb123-2"><a href="iteration.html#cb123-2"></a>Nested_Data <span class="op">%&gt;%</span></span>
<span id="cb123-3"><a href="iteration.html#cb123-3"></a><span class="st">  </span><span class="kw">unnest</span>(data)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Continent"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Country"],"name":[2],"type":["chr"],"align":["left"]},{"label":["Population"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Area"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["GDP"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["PPP"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["GDP_per_capita"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["PPP_per_capita"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["G7"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["G20"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["OECD"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["HDI_2018"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["Polity_Score"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["Polity_Type"],"name":[14],"type":["chr"],"align":["left"]},{"label":["FH_PR"],"name":[15],"type":["dbl"],"align":["right"]},{"label":["FH_CL"],"name":[16],"type":["dbl"],"align":["right"]},{"label":["FH_Total"],"name":[17],"type":["dbl"],"align":["right"]},{"label":["FH_Status"],"name":[18],"type":["chr"],"align":["left"]}],"data":[{"1":"Asia","2":"Afghanistan","3":"38928346","4":"652860","5":"19101.35","6":"82736.86","7":"490.67972","8":"2125.3628","9":"0","10":"0","11":"0","12":"0.496","13":"-1","14":"Closed Anocracy","15":"13","16":"14","17":"27","18":"NF"},{"1":"Asia","2":"Bahrain","3":"1701575","4":"760","5":"38574.07","6":"74229.74","7":"22669.62667","8":"43624.1365","9":"0","10":"0","11":"0","12":"0.838","13":"-10","14":"Autocracy","15":"1","16":"10","17":"11","18":"NF"},{"1":"Asia","2":"Bangladesh","3":"164689383","4":"130170","5":"302571.25","6":"734107.68","7":"1837.22377","8":"4457.5289","9":"0","10":"0","11":"0","12":"0.614","13":"-6","14":"Autocracy","15":"15","16":"24","17":"39","18":"PF"},{"1":"Asia","2":"Bhutan","3":"771608","4":"38117","5":"2446.67","6":"8767.43","7":"3170.87174","8":"11362.5442","9":"0","10":"0","11":"0","12":"0.617","13":"7","14":"Democracy","15":"29","16":"30","17":"59","18":"PF"},{"1":"Asia","2":"Brunei","3":"437479","4":"5270","5":"13469.42","6":"26535.57","7":"30788.72357","8":"60655.6429","9":"0","10":"0","11":"0","12":"0.845","13":"NA","14":"NA","15":"7","16":"21","17":"28","18":"NF"},{"1":"Asia","2":"Burma","3":"54409800","4":"653290","5":"76085.85","6":"268326.55","7":"1398.38503","8":"4931.5849","9":"0","10":"0","11":"0","12":"0.584","13":"8","14":"Democracy","15":"14","16":"16","17":"30","18":"NF"},{"1":"Asia","2":"Cambodia","3":"16718965","4":"176520","5":"27089.39","6":"69253.36","7":"1620.27913","8":"4142.2038","9":"0","10":"0","11":"0","12":"0.581","13":"-4","14":"Closed Anocracy","15":"5","16":"20","17":"25","18":"NF"},{"1":"Asia","2":"China","3":"1447470092","4":"9389291","5":"14762791.84","6":"21967627.68","7":"10199.03065","8":"15176.5676","9":"0","10":"1","11":"0","12":"0.758","13":"-7","14":"Autocracy","15":"-1","16":"11","17":"10","18":"NF"},{"1":"Asia","2":"India","3":"1380004385","4":"2973190","5":"2875142.31","6":"9058691.69","7":"2083.42984","8":"6564.2485","9":"0","10":"1","11":"0","12":"0.647","13":"9","14":"Democracy","15":"34","16":"37","17":"71","18":"F"},{"1":"Asia","2":"Indonesia","3":"273523615","4":"1811570","5":"1119190.78","6":"3117334.24","7":"4091.75193","8":"11396.9474","9":"0","10":"1","11":"0","12":"0.707","13":"9","14":"Democracy","15":"30","16":"31","17":"61","18":"PF"},{"1":"Asia","2":"Iran","3":"83992949","4":"1628550","5":"445345.28","6":"1172665.50","7":"5302.17459","8":"13961.4755","9":"0","10":"0","11":"0","12":"0.797","13":"-7","14":"Autocracy","15":"7","16":"10","17":"17","18":"NF"},{"1":"Asia","2":"Iraq","3":"40222493","4":"434320","5":"234094.04","6":"419689.63","7":"5819.97839","8":"10434.2023","9":"0","10":"0","11":"0","12":"0.689","13":"6","14":"Democracy","15":"17","16":"14","17":"31","18":"NF"},{"1":"Asia","2":"Israel","3":"8655535","4":"21640","5":"395098.67","6":"357633.41","7":"45646.93806","8":"41318.4639","9":"0","10":"0","11":"1","12":"0.906","13":"6","14":"Democracy","15":"33","16":"43","17":"76","18":"F"},{"1":"Asia","2":"Japan","3":"126476461","4":"364555","5":"5081769.54","6":"5247580.84","7":"40179.56780","8":"41490.5730","9":"1","10":"1","11":"1","12":"0.915","13":"10","14":"Full Democracy","15":"40","16":"56","17":"96","18":"F"},{"1":"Asia","2":"Jordan","3":"10203134","4":"88780","5":"43743.66","6":"100495.62","7":"4287.27683","8":"9849.4855","9":"0","10":"0","11":"0","12":"0.723","13":"-3","14":"Closed Anocracy","15":"12","16":"25","17":"37","18":"PF"},{"1":"Asia","2":"Kazakhstan","3":"18776707","4":"2699700","5":"180161.74","6":"478232.47","7":"9594.95933","8":"25469.4537","9":"0","10":"0","11":"0","12":"0.817","13":"-6","14":"Autocracy","15":"5","16":"18","17":"23","18":"NF"},{"1":"Asia","2":"South Korea","3":"51269185","4":"97230","5":"1642383.22","6":"2046766.34","7":"32034.51001","8":"39921.9598","9":"0","10":"1","11":"1","12":"0.906","13":"8","14":"Democracy","15":"33","16":"50","17":"83","18":"F"},{"1":"Asia","2":"Kuwait","3":"4270571","4":"17820","5":"134761.20","6":"213933.11","7":"31555.78025","8":"50094.7321","9":"0","10":"0","11":"0","12":"0.808","13":"-7","14":"Autocracy","15":"13","16":"23","17":"36","18":"PF"},{"1":"Asia","2":"Kyrgyzstan","3":"6524195","4":"191800","5":"8454.62","6":"33163.86","7":"1295.88708","8":"5083.2110","9":"0","10":"0","11":"0","12":"0.674","13":"8","14":"Democracy","15":"12","16":"27","17":"39","18":"PF"},{"1":"Asia","2":"Laos","3":"7275560","4":"230800","5":"18173.84","6":"54922.83","7":"2497.93006","8":"7548.9488","9":"0","10":"0","11":"0","12":"0.604","13":"-7","14":"Autocracy","15":"2","16":"12","17":"14","18":"NF"},{"1":"Asia","2":"Lebanon","3":"6825445","4":"10230","5":"53367.04","6":"112438.06","7":"7818.83672","8":"16473.3669","9":"0","10":"0","11":"0","12":"0.730","13":"6","14":"Democracy","15":"14","16":"30","17":"44","18":"PF"},{"1":"Asia","2":"Malaysia","3":"32365999","4":"328550","5":"364701.52","6":"889349.00","7":"11268.04459","8":"27477.8789","9":"0","10":"0","11":"0","12":"0.804","13":"7","14":"Democracy","15":"21","16":"31","17":"52","18":"PF"},{"1":"Asia","2":"Maldives","3":"540544","4":"300","5":"5729.25","6":"9777.27","7":"10599.04467","8":"18087.8337","9":"0","10":"0","11":"0","12":"0.719","13":"NA","14":"NA","15":"18","16":"22","17":"40","18":"PF"},{"1":"Asia","2":"Mongolia","3":"3278290","4":"1553560","5":"13852.85","6":"38687.54","7":"4225.63288","8":"11801.1341","9":"0","10":"0","11":"0","12":"0.735","13":"10","14":"Full Democracy","15":"36","16":"48","17":"84","18":"F"},{"1":"Asia","2":"Nepal","3":"29136808","4":"143350","5":"30641.38","6":"93550.06","7":"1051.63819","8":"3210.7175","9":"0","10":"0","11":"0","12":"0.579","13":"7","14":"Democracy","15":"25","16":"31","17":"56","18":"PF"},{"1":"Asia","2":"Oman","3":"5106626","4":"309500","5":"76983.09","6":"141454.11","7":"15075.13767","8":"27700.1116","9":"0","10":"0","11":"0","12":"0.834","13":"-8","14":"Autocracy","15":"6","16":"17","17":"23","18":"NF"},{"1":"Asia","2":"Pakistan","3":"220892340","4":"770880","5":"278221.91","6":"1030292.07","7":"1259.53625","8":"4664.2272","9":"0","10":"0","11":"0","12":"0.560","13":"7","14":"Democracy","15":"16","16":"22","17":"38","18":"PF"},{"1":"Asia","2":"Philippines","3":"109581078","4":"298170","5":"376795.51","6":"887473.71","7":"3438.50888","8":"8098.7861","9":"0","10":"0","11":"0","12":"0.712","13":"8","14":"Democracy","15":"25","16":"34","17":"59","18":"PF"},{"1":"Asia","2":"Qatar","3":"2881053","4":"11610","5":"183466.21","6":"269279.49","7":"63680.26204","8":"93465.6495","9":"0","10":"0","11":"0","12":"0.848","13":"-10","14":"Autocracy","15":"7","16":"18","17":"25","18":"NF"},{"1":"Asia","2":"Saudi Arabia","3":"34813871","4":"2149690","5":"792966.84","6":"1643080.03","7":"22777.32459","8":"47196.1314","9":"0","10":"1","11":"0","12":"0.857","13":"-10","14":"Autocracy","15":"1","16":"6","17":"7","18":"NF"},{"1":"Asia","2":"Singapore","3":"5850342","4":"700","5":"372062.53","6":"557255.42","7":"63596.71452","8":"95251.7682","9":"0","10":"0","11":"0","12":"0.935","13":"-2","14":"Closed Anocracy","15":"19","16":"31","17":"50","18":"PF"},{"1":"Asia","2":"Sri Lanka","3":"21413249","4":"62710","5":"84008.78","6":"287228.40","7":"3923.21502","8":"13413.5833","9":"0","10":"0","11":"0","12":"0.780","13":"6","14":"Democracy","15":"23","16":"33","17":"56","18":"PF"},{"1":"Asia","2":"Syria","3":"17500658","4":"183630","5":"40405.01","6":"NA","7":"2308.77090","8":"NA","9":"0","10":"0","11":"0","12":"0.549","13":"-9","14":"Autocracy","15":"-3","16":"3","17":"0","18":"NF"},{"1":"Asia","2":"Taiwan","3":"23816775","4":"35410","5":"589391.00","6":"1099030.00","7":"24746.88534","8":"46145.2065","9":"0","10":"0","11":"0","12":"NA","13":"10","14":"Full Democracy","15":"37","16":"56","17":"93","18":"F"},{"1":"Asia","2":"Tajikistan","3":"9537645","4":"139960","5":"8116.63","6":"30155.79","7":"851.00987","8":"3161.7648","9":"0","10":"0","11":"0","12":"0.656","13":"-3","14":"Closed Anocracy","15":"0","16":"9","17":"9","18":"NF"},{"1":"Asia","2":"Thailand","3":"69799978","4":"510890","5":"543649.98","6":"1283169.74","7":"7788.68412","8":"18383.5264","9":"0","10":"0","11":"0","12":"0.765","13":"-3","14":"Closed Anocracy","15":"6","16":"26","17":"32","18":"PF"},{"1":"Asia","2":"Timor-Leste","3":"1318445","4":"14870","5":"1673.54","6":"4000.35","7":"1269.32864","8":"3034.1425","9":"0","10":"0","11":"0","12":"0.626","13":"8","14":"Democracy","15":"32","16":"39","17":"71","18":"F"},{"1":"Asia","2":"United Arab Emirates","3":"9890402","4":"83600","5":"421142.27","6":"650567.67","7":"42580.90520","8":"65777.6772","9":"0","10":"0","11":"0","12":"0.866","13":"-8","14":"Autocracy","15":"5","16":"12","17":"17","18":"NF"},{"1":"Asia","2":"Uzbekistan","3":"33469203","4":"425400","5":"57921.29","6":"227356.12","7":"1730.58468","8":"6792.9947","9":"0","10":"0","11":"0","12":"0.710","13":"-9","14":"Autocracy","15":"2","16":"8","17":"10","18":"NF"},{"1":"Asia","2":"Vietnam","3":"97338579","4":"310070","5":"261921.24","6":"742462.14","7":"2690.82663","8":"7627.6246","9":"0","10":"0","11":"0","12":"0.693","13":"-7","14":"Autocracy","15":"3","16":"17","17":"20","18":"NF"},{"1":"Asia","2":"West Bank and Gaza","3":"5101414","4":"6020","5":"14615.90","6":"7122.11","7":"2865.06839","8":"1396.1051","9":"0","10":"0","11":"0","12":"0.690","13":"NA","14":"NA","15":"4","16":"21","17":"25","18":"NF"},{"1":"Asia","2":"Yemen","3":"29825964","4":"527970","5":"27591.26","6":"91982.00","7":"925.07521","8":"3083.9573","9":"0","10":"0","11":"0","12":"0.463","13":"NA","14":"NA","15":"1","16":"10","17":"11","18":"NF"},{"1":"Europe","2":"Albania","3":"2877797","4":"27400","5":"15278.08","6":"39657.88","7":"5308.94987","8":"13780.6385","9":"0","10":"0","11":"0","12":"0.791","13":"9","14":"Democracy","15":"27","16":"40","17":"67","18":"PF"},{"1":"Europe","2":"Andorra","3":"77265","4":"470","5":"3154.06","6":"NA","7":"40821.32919","8":"NA","9":"0","10":"0","11":"0","12":"0.857","13":"NA","14":"NA","15":"39","16":"55","17":"94","18":"F"},{"1":"Europe","2":"Armenia","3":"2963243","4":"28470","5":"13672.80","6":"38445.96","7":"4614.13391","8":"12974.2853","9":"0","10":"0","11":"0","12":"0.760","13":"7","14":"Democracy","15":"21","16":"32","17":"53","18":"PF"},{"1":"Europe","2":"Austria","3":"9006398","4":"82409","5":"446314.74","6":"502771.14","7":"49555.29836","8":"55823.7755","9":"0","10":"0","11":"1","12":"0.914","13":"10","14":"Full Democracy","15":"37","16":"56","17":"93","18":"F"},{"1":"Europe","2":"Azerbaijan","3":"10139177","4":"82658","5":"48047.65","6":"144556.45","7":"4738.81164","8":"14257.2173","9":"0","10":"0","11":"0","12":"0.754","13":"-7","14":"Autocracy","15":"2","16":"8","17":"10","18":"NF"},{"1":"Europe","2":"Belarus","3":"9449323","4":"202910","5":"63080.46","6":"183460.85","7":"6675.65920","8":"19415.2375","9":"0","10":"0","11":"0","12":"0.817","13":"-7","14":"Autocracy","15":"5","16":"14","17":"19","18":"NF"},{"1":"Europe","2":"Belgium","3":"11589623","4":"30280","5":"529606.71","6":"597433.15","7":"45696.62965","8":"51548.9719","9":"0","10":"0","11":"1","12":"0.919","13":"8","14":"Democracy","15":"39","16":"57","17":"96","18":"F"},{"1":"Europe","2":"Bosnia and Herzegovina","3":"3280819","4":"51000","5":"20047.85","6":"49732.75","7":"6110.62360","8":"15158.6387","9":"0","10":"0","11":"0","12":"0.769","13":"NA","14":"NA","15":"19","16":"34","17":"53","18":"PF"},{"1":"Europe","2":"Bulgaria","3":"6948445","4":"108560","5":"67927.18","6":"156693.06","7":"9775.88223","8":"22550.8096","9":"0","10":"0","11":"0","12":"0.816","13":"9","14":"Democracy","15":"34","16":"46","17":"80","18":"F"},{"1":"Europe","2":"Croatia","3":"4105267","4":"55960","5":"60415.55","6":"114931.60","7":"14716.59456","8":"27996.1328","9":"0","10":"0","11":"0","12":"0.837","13":"9","14":"Democracy","15":"36","16":"49","17":"85","18":"F"},{"1":"Europe","2":"Cyprus","3":"1207359","4":"9240","5":"24564.65","6":"34680.05","7":"20345.77122","8":"28723.8924","9":"0","10":"0","11":"0","12":"0.873","13":"10","14":"Full Democracy","15":"38","16":"56","17":"94","18":"F"},{"1":"Europe","2":"Czechia","3":"10708981","4":"77240","5":"246489.25","6":"429753.88","7":"23017.05923","8":"40130.2309","9":"0","10":"0","11":"1","12":"0.891","13":"9","14":"Democracy","15":"36","16":"55","17":"91","18":"F"},{"1":"Europe","2":"Denmark","3":"5841065","4":"43826","5":"350911.02","6":"331502.62","7":"60076.54768","8":"56753.7975","9":"0","10":"0","11":"1","12":"0.930","13":"10","14":"Full Democracy","15":"40","16":"57","17":"97","18":"F"},{"1":"Europe","2":"Estonia","3":"1326535","4":"42390","5":"31386.95","6":"48064.48","7":"23660.85328","8":"36233.1035","9":"0","10":"0","11":"1","12":"0.882","13":"9","14":"Democracy","15":"38","16":"56","17":"94","18":"F"},{"1":"Europe","2":"Finland","3":"5540720","4":"303890","5":"268761.20","6":"273290.92","7":"48506.54789","8":"49324.0806","9":"0","10":"0","11":"1","12":"0.925","13":"10","14":"Full Democracy","15":"40","16":"60","17":"100","18":"F"},{"1":"Europe","2":"France","3":"68147691","4":"657766","5":"2721648.27","6":"3110915.15","7":"39937.49796","8":"45649.6046","9":"1","10":"1","11":"1","12":"0.891","13":"9","14":"Democracy","15":"38","16":"52","17":"90","18":"F"},{"1":"Europe","2":"Georgia","3":"3989167","4":"69490","5":"17743.20","6":"54387.77","7":"4447.84588","8":"13633.8664","9":"0","10":"0","11":"0","12":"0.786","13":"7","14":"Democracy","15":"24","16":"37","17":"61","18":"PF"},{"1":"Europe","2":"Germany","3":"83783942","4":"348560","5":"3845630.03","6":"4514794.31","7":"45899.36852","8":"53886.1529","9":"1","10":"1","11":"1","12":"0.939","13":"10","14":"Full Democracy","15":"39","16":"55","17":"94","18":"F"},{"1":"Europe","2":"Greece","3":"10423054","4":"128900","5":"209852.76","6":"325789.65","7":"20133.51941","8":"31256.6403","9":"0","10":"0","11":"1","12":"0.872","13":"10","14":"Full Democracy","15":"37","16":"51","17":"88","18":"F"},{"1":"Europe","2":"Holy See","3":"801","4":"0","5":"NA","6":"NA","7":"NA","8":"NA","9":"0","10":"0","11":"0","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA"},{"1":"Europe","2":"Hungary","3":"9660351","4":"90530","5":"160967.16","6":"308700.19","7":"16662.66164","8":"31955.3803","9":"0","10":"0","11":"1","12":"0.845","13":"10","14":"Full Democracy","15":"27","16":"43","17":"70","18":"PF"},{"1":"Europe","2":"Iceland","3":"341243","4":"100250","5":"24188.04","6":"20478.35","7":"70882.15729","8":"60011.0479","9":"0","10":"0","11":"1","12":"0.938","13":"NA","14":"NA","15":"37","16":"57","17":"94","18":"F"},{"1":"Europe","2":"Ireland","3":"4937786","4":"68890","5":"388698.71","6":"411091.81","7":"78719.22963","8":"83254.2783","9":"0","10":"0","11":"1","12":"0.942","13":"10","14":"Full Democracy","15":"39","16":"58","17":"97","18":"F"},{"1":"Europe","2":"Italy","3":"60461826","4":"294140","5":"2001244.39","6":"2585936.45","7":"33099.30451","8":"42769.7379","9":"1","10":"1","11":"1","12":"0.883","13":"10","14":"Full Democracy","15":"36","16":"53","17":"89","18":"F"},{"1":"Europe","2":"Kosovo","3":"1810463","4":"10887","5":"7926.11","6":"20056.14","7":"4377.94642","8":"11077.9066","9":"0","10":"0","11":"0","12":"NA","13":"8","14":"Democracy","15":"25","16":"31","17":"56","18":"PF"},{"1":"Europe","2":"Latvia","3":"1886198","4":"62200","5":"34117.20","6":"59250.54","7":"18087.81475","8":"31412.6831","9":"0","10":"0","11":"1","12":"0.854","13":"8","14":"Democracy","15":"37","16":"52","17":"89","18":"F"},{"1":"Europe","2":"Liechtenstein","3":"38128","4":"160","5":"6552.86","6":"NA","7":"171864.77130","8":"NA","9":"0","10":"0","11":"0","12":"0.917","13":"NA","14":"NA","15":"33","16":"57","17":"90","18":"F"},{"1":"Europe","2":"Lithuania","3":"2722289","4":"62674","5":"54219.32","6":"100384.50","7":"19916.81265","8":"36875.0342","9":"0","10":"0","11":"1","12":"0.869","13":"10","14":"Full Democracy","15":"38","16":"53","17":"91","18":"F"},{"1":"Europe","2":"Luxembourg","3":"625978","4":"2590","5":"71104.92","6":"71000.34","7":"113590.12620","8":"113423.0596","9":"0","10":"0","11":"1","12":"0.909","13":"10","14":"Full Democracy","15":"38","16":"60","17":"98","18":"F"},{"1":"Europe","2":"Malta","3":"441543","4":"320","5":"14786.16","6":"21100.07","7":"33487.47461","8":"47787.1238","9":"0","10":"0","11":"0","12":"0.885","13":"NA","14":"NA","15":"35","16":"55","17":"90","18":"F"},{"1":"Europe","2":"Moldova","3":"4033963","4":"32850","5":"11955.44","6":"34001.22","7":"2963.69600","8":"8428.7387","9":"0","10":"0","11":"0","12":"0.711","13":"9","14":"Democracy","15":"26","16":"34","17":"60","18":"PF"},{"1":"Europe","2":"Monaco","3":"39242","4":"1","5":"7188.24","6":"NA","7":"183177.20810","8":"NA","9":"0","10":"0","11":"0","12":"NA","13":"NA","14":"NA","15":"26","16":"57","17":"83","18":"F"},{"1":"Europe","2":"Montenegro","3":"628066","4":"13450","5":"5494.74","6":"13254.36","7":"8748.66654","8":"21103.4509","9":"0","10":"0","11":"0","12":"0.816","13":"9","14":"Democracy","15":"22","16":"40","17":"62","18":"PF"},{"1":"Europe","2":"Netherlands","3":"17474830","4":"34706","5":"915254.40","6":"1000918.84","7":"52375.58248","8":"57277.7441","9":"0","10":"0","11":"1","12":"0.934","13":"10","14":"Full Democracy","15":"40","16":"59","17":"99","18":"F"},{"1":"Europe","2":"North Macedonia","3":"2083374","4":"25220","5":"12694.82","6":"34628.88","7":"6093.39466","8":"16621.5380","9":"0","10":"0","11":"0","12":"0.759","13":"NA","14":"NA","15":"24","16":"39","17":"63","18":"PF"},{"1":"Europe","2":"Norway","3":"5421241","4":"365268","5":"403336.36","6":"359298.96","7":"74399.26762","8":"66276.1460","9":"0","10":"0","11":"1","12":"0.954","13":"10","14":"Full Democracy","15":"40","16":"60","17":"100","18":"F"},{"1":"Europe","2":"Poland","3":"37846611","4":"306230","5":"592164.40","6":"1205917.50","7":"15646.43133","8":"31863.2889","9":"0","10":"0","11":"1","12":"0.872","13":"10","14":"Full Democracy","15":"35","16":"49","17":"84","18":"F"},{"1":"Europe","2":"Portugal","3":"10196709","4":"91590","5":"237686.08","6":"352447.52","7":"23310.07779","8":"34564.8307","9":"0","10":"0","11":"1","12":"0.850","13":"10","14":"Full Democracy","15":"39","16":"57","17":"96","18":"F"},{"1":"Europe","2":"Romania","3":"19237691","4":"230170","5":"250077.44","6":"565710.79","7":"12999.34800","8":"29406.3768","9":"0","10":"0","11":"0","12":"0.816","13":"9","14":"Democracy","15":"35","16":"48","17":"83","18":"F"},{"1":"Europe","2":"Russia","3":"145934462","4":"16376870","5":"1699876.58","6":"4192936.67","7":"11648.21905","8":"28731.6417","9":"0","10":"1","11":"0","12":"0.824","13":"4","14":"Open Anocracy","15":"5","16":"15","17":"20","18":"NF"},{"1":"Europe","2":"San Marino","3":"33931","4":"60","5":"1637.93","6":"2122.52","7":"48272.37629","8":"62554.0067","9":"0","10":"0","11":"0","12":"NA","13":"NA","14":"NA","15":"38","16":"57","17":"95","18":"F"},{"1":"Europe","2":"Serbia","3":"8737371","4":"87460","5":"51409.17","6":"123012.23","7":"5883.82592","8":"14078.8608","9":"0","10":"0","11":"0","12":"0.799","13":"8","14":"Democracy","15":"23","16":"43","17":"66","18":"PF"},{"1":"Europe","2":"Slovakia","3":"5459642","4":"48088","5":"105422.30","6":"177655.42","7":"19309.37963","8":"32539.7563","9":"0","10":"0","11":"1","12":"0.857","13":"10","14":"Full Democracy","15":"36","16":"52","17":"88","18":"F"},{"1":"Europe","2":"Slovenia","3":"2078938","4":"20140","5":"53742.16","6":"80361.84","7":"25850.77573","8":"38655.2365","9":"0","10":"0","11":"1","12":"0.902","13":"10","14":"Full Democracy","15":"39","16":"55","17":"94","18":"F"},{"1":"Europe","2":"Spain","3":"46754778","4":"498800","5":"1394116.31","6":"1894494.24","7":"29817.62228","8":"40519.7997","9":"0","10":"0","11":"1","12":"0.893","13":"10","14":"Full Democracy","15":"38","16":"54","17":"92","18":"F"},{"1":"Europe","2":"Sweden","3":"10099265","4":"410340","5":"530832.91","6":"547506.56","7":"52561.53888","8":"54212.5155","9":"0","10":"0","11":"1","12":"0.937","13":"10","14":"Full Democracy","15":"40","16":"60","17":"100","18":"F"},{"1":"Europe","2":"Switzerland","3":"8654622","4":"39516","5":"703082.44","6":"590532.23","7":"81237.79872","8":"68233.1626","9":"0","10":"0","11":"1","12":"0.946","13":"10","14":"Full Democracy","15":"39","16":"57","17":"96","18":"F"},{"1":"Europe","2":"Turkey","3":"84339067","4":"769630","5":"754411.71","6":"2316406.55","7":"8944.98525","8":"27465.4040","9":"0","10":"1","11":"1","12":"0.807","13":"-4","14":"Closed Anocracy","15":"16","16":"16","17":"32","18":"NF"},{"1":"Europe","2":"Ukraine","3":"43733762","4":"579320","5":"153781.07","6":"533868.37","7":"3516.30098","8":"12207.2364","9":"0","10":"0","11":"0","12":"0.750","13":"4","14":"Open Anocracy","15":"27","16":"35","17":"62","18":"PF"},{"1":"Europe","2":"United Kingdom","3":"68517621","4":"257180","5":"2857480.18","6":"3124143.83","7":"41704.31107","8":"45596.2099","9":"1","10":"1","11":"1","12":"0.920","13":"8","14":"Democracy","15":"39","16":"55","17":"94","18":"F"},{"1":"Africa","2":"Algeria","3":"43851044","4":"2381740","5":"169988.24","6":"496572.40","7":"3876.49243","8":"11324.0725","9":"0","10":"0","11":"0","12":"0.759","13":"2","14":"Open Anocracy","15":"10","16":"24","17":"34","18":"NF"},{"1":"Africa","2":"Angola","3":"32866272","4":"1246700","5":"94635.42","6":"218533.34","7":"2879.40841","8":"6649.1673","9":"0","10":"0","11":"0","12":"0.574","13":"-2","14":"Closed Anocracy","15":"11","16":"21","17":"32","18":"NF"},{"1":"Africa","2":"Benin","3":"12123200","4":"112760","5":"14390.71","6":"37185.97","7":"1187.03890","8":"3067.3395","9":"0","10":"0","11":"0","12":"0.520","13":"7","14":"Democracy","15":"21","16":"45","17":"66","18":"PF"},{"1":"Africa","2":"Botswana","3":"2351627","4":"566730","5":"18340.51","6":"40708.02","7":"7799.07273","8":"17310.5769","9":"0","10":"0","11":"0","12":"0.728","13":"8","14":"Democracy","15":"28","16":"44","17":"72","18":"F"},{"1":"Africa","2":"Burkina Faso","3":"20903273","4":"273600","5":"15745.81","6":"37625.51","7":"753.27007","8":"1799.9818","9":"0","10":"0","11":"0","12":"0.434","13":"6","14":"Democracy","15":"23","16":"33","17":"56","18":"PF"},{"1":"Africa","2":"Burundi","3":"11890784","4":"25680","5":"3012.33","6":"8717.63","7":"253.33317","8":"733.1417","9":"0","10":"0","11":"0","12":"0.423","13":"-1","14":"Closed Anocracy","15":"3","16":"10","17":"13","18":"NF"},{"1":"Africa","2":"Cabo Verde","3":"555987","4":"4030","5":"1981.85","6":"3843.40","7":"3564.56176","8":"6912.7516","9":"0","10":"0","11":"0","12":"0.651","13":"NA","14":"NA","15":"38","16":"54","17":"92","18":"F"},{"1":"Africa","2":"Cameroon","3":"26545863","4":"472710","5":"38760.47","6":"93081.44","7":"1460.13223","8":"3506.4386","9":"0","10":"0","11":"0","12":"0.563","13":"-4","14":"Closed Anocracy","15":"7","16":"11","17":"18","18":"NF"},{"1":"Africa","2":"Central African Republic","3":"4829767","4":"622980","5":"2220.31","6":"4460.31","7":"459.71369","8":"923.5042","9":"0","10":"0","11":"0","12":"0.381","13":"6","14":"Democracy","15":"4","16":"6","17":"10","18":"NF"},{"1":"Africa","2":"Chad","3":"16425864","4":"1259200","5":"11314.95","6":"25057.44","7":"688.84961","8":"1525.4869","9":"0","10":"0","11":"0","12":"0.401","13":"-2","14":"Closed Anocracy","15":"3","16":"14","17":"17","18":"NF"},{"1":"Africa","2":"Comoros","3":"869601","4":"1861","5":"1185.73","6":"2614.78","7":"1363.53339","8":"3006.8733","9":"0","10":"0","11":"0","12":"0.538","13":"-3","14":"Closed Anocracy","15":"18","16":"26","17":"44","18":"PF"},{"1":"Africa","2":"Congo (Brazzaville)","3":"5518087","4":"341500","5":"10820.59","6":"17608.49","7":"1960.93139","8":"3191.0497","9":"0","10":"0","11":"0","12":"0.609","13":"-4","14":"Closed Anocracy","15":"2","16":"18","17":"20","18":"NF"},{"1":"Africa","2":"Congo (Kinshasa)","3":"89561403","4":"2267050","5":"47319.62","6":"93456.93","7":"528.34836","8":"1043.4956","9":"0","10":"0","11":"0","12":"0.459","13":"-3","14":"Closed Anocracy","15":"4","16":"14","17":"18","18":"NF"},{"1":"Africa","2":"Cote d'Ivoire","3":"26378274","4":"318000","5":"58792.21","6":"96068.56","7":"2228.81186","8":"3641.9578","9":"0","10":"0","11":"0","12":"0.516","13":"4","14":"Open Anocracy","15":"19","16":"32","17":"51","18":"PF"},{"1":"Africa","2":"Djibouti","3":"988000","4":"23180","5":"3318.72","6":"5010.34","7":"3359.02834","8":"5071.1943","9":"0","10":"0","11":"0","12":"0.495","13":"3","14":"Open Anocracy","15":"5","16":"19","17":"24","18":"NF"},{"1":"Africa","2":"Egypt","3":"102334404","4":"995450","5":"303175.13","6":"1145967.04","7":"2962.59242","8":"11198.2578","9":"0","10":"0","11":"0","12":"0.700","13":"-4","14":"Closed Anocracy","15":"7","16":"14","17":"21","18":"NF"},{"1":"Africa","2":"Equatorial Guinea","3":"1402985","4":"28050","5":"11026.77","6":"27299.70","7":"7859.50670","8":"19458.2978","9":"0","10":"0","11":"0","12":"0.588","13":"-6","14":"Autocracy","15":"0","16":"6","17":"6","18":"NF"},{"1":"Africa","2":"Eritrea","3":"3546421","4":"101000","5":"2065.00","6":"6597.43","7":"582.27717","8":"1860.3065","9":"0","10":"0","11":"0","12":"0.434","13":"-7","14":"Autocracy","15":"1","16":"1","17":"2","18":"NF"},{"1":"Africa","2":"Eswatini","3":"1160164","4":"17200","5":"4405.41","6":"10016.34","7":"3797.23039","8":"8633.5553","9":"0","10":"0","11":"0","12":"0.608","13":"-9","14":"Autocracy","15":"1","16":"18","17":"19","18":"NF"},{"1":"Africa","2":"Ethiopia","3":"114963588","4":"1000000","5":"96107.66","6":"235309.04","7":"835.98348","8":"2046.8136","9":"0","10":"0","11":"0","12":"0.470","13":"1","14":"Open Anocracy","15":"10","16":"14","17":"24","18":"NF"},{"1":"Africa","2":"Gabon","3":"2225734","4":"257670","5":"16657.96","6":"32006.42","7":"7484.25463","8":"14380.1640","9":"0","10":"0","11":"0","12":"0.702","13":"3","14":"Open Anocracy","15":"3","16":"19","17":"22","18":"NF"},{"1":"Africa","2":"Gambia","3":"2416668","4":"10120","5":"1763.82","6":"5008.15","7":"729.85615","8":"2072.3368","9":"0","10":"0","11":"0","12":"0.466","13":"4","14":"Open Anocracy","15":"20","16":"26","17":"46","18":"PF"},{"1":"Africa","2":"Ghana","3":"31072940","4":"227540","5":"66983.63","6":"158389.98","7":"2155.69013","8":"5097.3606","9":"0","10":"0","11":"0","12":"0.596","13":"8","14":"Democracy","15":"35","16":"47","17":"82","18":"F"},{"1":"Africa","2":"Guinea-Bissau","3":"1968001","4":"28120","5":"1340.39","6":"3742.36","7":"681.09213","8":"1901.6047","9":"0","10":"0","11":"0","12":"0.461","13":"6","14":"Democracy","15":"17","16":"29","17":"46","18":"PF"},{"1":"Africa","2":"Kenya","3":"53771296","4":"569140","5":"95503.09","6":"220729.73","7":"1776.09798","8":"4104.9732","9":"0","10":"0","11":"0","12":"0.579","13":"9","14":"Democracy","15":"19","16":"29","17":"48","18":"PF"},{"1":"Africa","2":"Lesotho","3":"2142249","4":"30360","5":"2460.07","6":"6468.11","7":"1148.35857","8":"3019.3082","9":"0","10":"0","11":"0","12":"0.518","13":"8","14":"Democracy","15":"27","16":"36","17":"63","18":"PF"},{"1":"Africa","2":"Liberia","3":"5057681","4":"96320","5":"3070.52","6":"7389.76","7":"607.10037","8":"1461.0965","9":"0","10":"0","11":"0","12":"0.465","13":"7","14":"Democracy","15":"27","16":"33","17":"60","18":"PF"},{"1":"Africa","2":"Libya","3":"6871292","4":"1759540","5":"52076.25","6":"96327.26","7":"7578.81487","8":"14018.7988","9":"0","10":"0","11":"0","12":"0.708","13":"NA","14":"NA","15":"1","16":"8","17":"9","18":"NF"},{"1":"Africa","2":"Madagascar","3":"27691018","4":"581795","5":"14083.91","6":"43395.91","7":"508.60933","8":"1567.1475","9":"0","10":"0","11":"0","12":"0.521","13":"6","14":"Democracy","15":"26","16":"35","17":"61","18":"PF"},{"1":"Africa","2":"Malawi","3":"19129952","4":"94280","5":"7666.70","6":"19437.62","7":"400.76943","8":"1016.0831","9":"0","10":"0","11":"0","12":"0.485","13":"6","14":"Democracy","15":"26","16":"36","17":"62","18":"PF"},{"1":"Africa","2":"Mali","3":"20250833","4":"1220190","5":"17510.14","6":"44723.72","7":"864.66270","8":"2208.4879","9":"0","10":"0","11":"0","12":"0.427","13":"5","14":"Open Anocracy","15":"17","16":"24","17":"41","18":"PF"},{"1":"Africa","2":"Mauritania","3":"4649658","4":"1030700","5":"7593.75","6":"16745.26","7":"1633.18463","8":"3601.3961","9":"0","10":"0","11":"0","12":"0.527","13":"-2","14":"Closed Anocracy","15":"13","16":"21","17":"34","18":"PF"},{"1":"Africa","2":"Mauritius","3":"1271768","4":"2030","5":"14180.44","6":"28788.45","7":"11150.17833","8":"22636.5579","9":"0","10":"0","11":"0","12":"0.796","13":"10","14":"Full Democracy","15":"37","16":"52","17":"89","18":"F"},{"1":"Africa","2":"Morocco","3":"36910560","4":"446300","5":"118725.28","6":"278822.26","7":"3216.56675","8":"7553.9970","9":"0","10":"0","11":"0","12":"0.676","13":"-4","14":"Closed Anocracy","15":"13","16":"24","17":"37","18":"PF"},{"1":"Africa","2":"Mozambique","3":"31255435","4":"786380","5":"14934.16","6":"38962.86","7":"477.81002","8":"1246.5947","9":"0","10":"0","11":"0","12":"0.446","13":"5","14":"Open Anocracy","15":"14","16":"31","17":"45","18":"PF"},{"1":"Africa","2":"Namibia","3":"2540905","4":"823290","5":"12366.53","6":"26207.75","7":"4866.97850","8":"10314.3368","9":"0","10":"0","11":"0","12":"0.645","13":"6","14":"Democracy","15":"31","16":"46","17":"77","18":"F"},{"1":"Africa","2":"Niger","3":"24206644","4":"1266700","5":"12928.15","6":"19946.82","7":"534.07445","8":"824.0225","9":"0","10":"0","11":"0","12":"0.377","13":"5","14":"Open Anocracy","15":"20","16":"28","17":"48","18":"PF"},{"1":"Africa","2":"Nigeria","3":"206139589","4":"910770","5":"448120.43","6":"1034493.13","7":"2173.86884","8":"5018.4108","9":"0","10":"0","11":"0","12":"0.534","13":"7","14":"Democracy","15":"22","16":"25","17":"47","18":"PF"},{"1":"Africa","2":"Rwanda","3":"12952218","4":"24670","5":"10122.47","6":"26007.35","7":"781.52406","8":"2007.9457","9":"0","10":"0","11":"0","12":"0.536","13":"-3","14":"Closed Anocracy","15":"8","16":"14","17":"22","18":"NF"},{"1":"Africa","2":"Sao Tome and Principe","3":"219159","4":"960","5":"429.02","6":"852.73","7":"1957.57418","8":"3890.9194","9":"0","10":"0","11":"0","12":"0.609","13":"NA","14":"NA","15":"35","16":"49","17":"84","18":"F"},{"1":"Africa","2":"Senegal","3":"16743927","4":"192530","5":"23578.08","6":"54383.04","7":"1408.15712","8":"3247.9262","9":"0","10":"0","11":"0","12":"0.514","13":"7","14":"Democracy","15":"29","16":"42","17":"71","18":"PF"},{"1":"Africa","2":"Seychelles","3":"98347","4":"460","5":"1698.84","6":"2732.88","7":"17273.93820","8":"27788.1379","9":"0","10":"0","11":"0","12":"0.801","13":"NA","14":"NA","15":"29","16":"43","17":"72","18":"PF"},{"1":"Africa","2":"Sierra Leone","3":"7976983","4":"72180","5":"3941.47","6":"13034.40","7":"494.10535","8":"1634.0012","9":"0","10":"0","11":"0","12":"0.438","13":"7","14":"Democracy","15":"28","16":"37","17":"65","18":"PF"},{"1":"Africa","2":"Somalia","3":"15893222","4":"627340","5":"917.04","6":"NA","7":"57.70007","8":"NA","9":"0","10":"0","11":"0","12":"0.557","13":"5","14":"Open Anocracy","15":"1","16":"6","17":"7","18":"NF"},{"1":"Africa","2":"South Africa","3":"59308690","4":"1213090","5":"351431.65","6":"747577.38","7":"5925.46640","8":"12604.8540","9":"0","10":"1","11":"0","12":"0.705","13":"9","14":"Democracy","15":"33","16":"46","17":"79","18":"F"},{"1":"Africa","2":"South Sudan","3":"11193725","4":"610952","5":"11997.80","6":"15784.93","7":"1071.83266","8":"1410.1588","9":"0","10":"0","11":"0","12":"0.413","13":"NA","14":"NA","15":"-2","16":"4","17":"2","18":"NF"},{"1":"Africa","2":"Sudan","3":"43849260","4":"1765048","5":"18902.28","6":"178155.96","7":"431.07409","8":"4062.9183","9":"0","10":"0","11":"0","12":"0.508","13":"-4","14":"Closed Anocracy","15":"2","16":"10","17":"12","18":"NF"},{"1":"Africa","2":"Tanzania","3":"59734218","4":"885800","5":"63177.07","6":"145034.69","7":"1057.63618","8":"2428.0001","9":"0","10":"0","11":"0","12":"0.528","13":"3","14":"Open Anocracy","15":"17","16":"23","17":"40","18":"PF"},{"1":"Africa","2":"Togo","3":"8278724","4":"54390","5":"5459.98","6":"12546.55","7":"659.51951","8":"1515.5174","9":"0","10":"0","11":"0","12":"0.513","13":"-2","14":"Closed Anocracy","15":"16","16":"28","17":"44","18":"PF"},{"1":"Africa","2":"Tunisia","3":"11818619","4":"155360","5":"38797.71","6":"127327.21","7":"3282.76172","8":"10773.4423","9":"0","10":"0","11":"0","12":"0.739","13":"7","14":"Democracy","15":"32","16":"38","17":"70","18":"F"},{"1":"Africa","2":"Uganda","3":"45741007","4":"199810","5":"34387.23","6":"78492.14","7":"751.78122","8":"1716.0125","9":"0","10":"0","11":"0","12":"0.528","13":"-1","14":"Closed Anocracy","15":"11","16":"23","17":"34","18":"NF"},{"1":"Africa","2":"Western Sahara","3":"597339","4":"266000","5":"908.90","6":"NA","7":"1521.58155","8":"NA","9":"0","10":"0","11":"0","12":"NA","13":"NA","14":"NA","15":"-3","16":"7","17":"4","18":"NF"},{"1":"Africa","2":"Zambia","3":"18383955","4":"743390","5":"23064.72","6":"62449.13","7":"1254.61143","8":"3396.9366","9":"0","10":"0","11":"0","12":"0.591","13":"6","14":"Democracy","15":"22","16":"32","17":"54","18":"PF"},{"1":"Africa","2":"Zimbabwe","3":"14862924","4":"386850","5":"21440.76","6":"48524.95","7":"1442.56675","8":"3264.8320","9":"0","10":"0","11":"0","12":"0.563","13":"4","14":"Open Anocracy","15":"12","16":"17","17":"29","18":"PF"},{"1":"America","2":"Antigua and Barbuda","3":"97929","4":"440","5":"1727.76","6":"2082.68","7":"17642.98625","8":"21267.2446","9":"0","10":"0","11":"0","12":"0.776","13":"NA","14":"NA","15":"33","16":"52","17":"85","18":"F"},{"1":"America","2":"Argentina","3":"45195774","4":"2736690","5":"449663.45","6":"1036721.13","7":"9949.23663","8":"22938.4528","9":"0","10":"1","11":"0","12":"0.830","13":"9","14":"Democracy","15":"35","16":"50","17":"85","18":"F"},{"1":"America","2":"Bahamas","3":"393244","4":"10010","5":"12827.00","6":"14023.92","7":"32618.42520","8":"35662.1334","9":"0","10":"0","11":"0","12":"0.805","13":"NA","14":"NA","15":"38","16":"53","17":"91","18":"F"},{"1":"America","2":"Barbados","3":"287375","4":"430","5":"5209.00","6":"4616.94","7":"18126.14180","8":"16065.9069","9":"0","10":"0","11":"0","12":"0.813","13":"NA","14":"NA","15":"38","16":"57","17":"95","18":"F"},{"1":"America","2":"Belize","3":"397628","4":"22810","5":"1879.61","6":"2819.41","7":"4727.05645","8":"7090.5721","9":"0","10":"0","11":"0","12":"0.720","13":"NA","14":"NA","15":"35","16":"51","17":"86","18":"F"},{"1":"America","2":"Bolivia","3":"11673021","4":"1083300","5":"40895.32","6":"100661.21","7":"3503.40499","8":"8623.4069","9":"0","10":"0","11":"0","12":"0.703","13":"7","14":"Democracy","15":"25","16":"38","17":"63","18":"PF"},{"1":"America","2":"Brazil","3":"212559417","4":"8358140","5":"1839758.04","6":"3131944.31","7":"8655.26480","8":"14734.4416","9":"0","10":"1","11":"0","12":"0.761","13":"8","14":"Democracy","15":"31","16":"44","17":"75","18":"F"},{"1":"America","2":"Canada","3":"37742154","4":"9093510","5":"1736425.63","6":"1852669.16","7":"46007.59220","8":"49087.5312","9":"1","10":"1","11":"1","12":"0.922","13":"10","14":"Full Democracy","15":"40","16":"58","17":"98","18":"F"},{"1":"America","2":"Chile","3":"19116201","4":"743532","5":"282318.16","6":"463790.23","7":"14768.52854","8":"24261.6318","9":"0","10":"0","11":"1","12":"0.847","13":"10","14":"Full Democracy","15":"38","16":"52","17":"90","18":"F"},{"1":"America","2":"Colombia","3":"50882891","4":"1109500","5":"323802.81","6":"736510.90","7":"6363.68735","8":"14474.6276","9":"0","10":"0","11":"1","12":"0.761","13":"7","14":"Democracy","15":"29","16":"37","17":"66","18":"PF"},{"1":"America","2":"Costa Rica","3":"5094118","4":"51060","5":"61773.94","6":"98801.20","7":"12126.52318","8":"19395.1534","9":"0","10":"0","11":"0","12":"0.794","13":"10","14":"Full Democracy","15":"38","16":"53","17":"91","18":"F"},{"1":"America","2":"Cuba","3":"11326616","4":"106440","5":"100023.00","6":"NA","7":"8830.79289","8":"NA","9":"0","10":"0","11":"0","12":"0.778","13":"-5","14":"Closed Anocracy","15":"1","16":"13","17":"14","18":"NF"},{"1":"America","2":"Dominica","3":"71986","4":"750","5":"596.03","6":"846.20","7":"8279.80441","8":"11755.0635","9":"0","10":"0","11":"0","12":"0.724","13":"NA","14":"NA","15":"37","16":"56","17":"93","18":"F"},{"1":"America","2":"Dominican Republic","3":"10847910","4":"48320","5":"88941.30","6":"192810.94","7":"8198.93417","8":"17774.0173","9":"0","10":"0","11":"0","12":"0.745","13":"7","14":"Democracy","15":"26","16":"41","17":"67","18":"PF"},{"1":"America","2":"Ecuador","3":"17643054","4":"248360","5":"107435.66","6":"202512.12","7":"6089.40266","8":"11478.2917","9":"0","10":"0","11":"0","12":"0.758","13":"5","14":"Open Anocracy","15":"27","16":"38","17":"65","18":"PF"},{"1":"America","2":"El Salvador","3":"6486205","4":"20720","5":"27022.64","6":"56609.41","7":"4166.17113","8":"8727.6628","9":"0","10":"0","11":"0","12":"0.667","13":"8","14":"Democracy","15":"32","16":"34","17":"66","18":"PF"},{"1":"America","2":"Grenada","3":"56770","4":"410450","5":"1228.17","6":"1920.88","7":"21634.13775","8":"33836.1811","9":"0","10":"0","11":"0","12":"0.763","13":"NA","14":"NA","15":"37","16":"52","17":"89","18":"F"},{"1":"America","2":"Guatemala","3":"17915568","4":"107160","5":"76710.39","6":"149287.01","7":"4281.77270","8":"8332.8092","9":"0","10":"0","11":"0","12":"0.651","13":"8","14":"Democracy","15":"21","16":"31","17":"52","18":"PF"},{"1":"America","2":"Guinea","3":"13132795","4":"245720","5":"13590.28","6":"31729.85","7":"1034.83531","8":"2416.0775","9":"0","10":"0","11":"0","12":"0.466","13":"4","14":"Open Anocracy","15":"15","16":"25","17":"40","18":"PF"},{"1":"America","2":"Guyana","3":"786552","4":"196850","5":"4280.44","6":"7430.91","7":"5442.03053","8":"9447.4491","9":"0","10":"0","11":"0","12":"0.670","13":"7","14":"Democracy","15":"31","16":"43","17":"74","18":"F"},{"1":"America","2":"Haiti","3":"11402528","4":"27560","5":"8498.98","6":"20135.44","7":"745.35927","8":"1765.8751","9":"0","10":"0","11":"0","12":"0.503","13":"5","14":"Open Anocracy","15":"16","16":"22","17":"38","18":"PF"},{"1":"America","2":"Honduras","3":"9904607","4":"111890","5":"25095.40","6":"55707.59","7":"2533.70982","8":"5624.4120","9":"0","10":"0","11":"0","12":"0.623","13":"7","14":"Democracy","15":"19","16":"26","17":"45","18":"PF"},{"1":"America","2":"Jamaica","3":"2961167","4":"10830","5":"16458.07","6":"29275.75","7":"5557.96752","8":"9886.5582","9":"0","10":"0","11":"0","12":"0.726","13":"9","14":"Democracy","15":"34","16":"44","17":"78","18":"F"},{"1":"America","2":"Mexico","3":"128932753","4":"1943950","5":"1258286.72","6":"2573847.60","7":"9759.24806","8":"19962.7134","9":"0","10":"1","11":"1","12":"0.767","13":"8","14":"Democracy","15":"27","16":"35","17":"62","18":"PF"},{"1":"America","2":"Nicaragua","3":"6624554","4":"120340","5":"12520.92","6":"37717.22","7":"1890.07743","8":"5693.5486","9":"0","10":"0","11":"0","12":"0.651","13":"6","14":"Democracy","15":"10","16":"21","17":"31","18":"NF"},{"1":"America","2":"Panama","3":"4314767","4":"74340","5":"66800.80","6":"132966.63","7":"15481.90204","8":"30816.6420","9":"0","10":"0","11":"0","12":"0.795","13":"9","14":"Democracy","15":"36","16":"48","17":"84","18":"F"},{"1":"America","2":"Paraguay","3":"7132538","4":"397300","5":"38145.29","6":"91850.11","7":"5348.06685","8":"12877.6194","9":"0","10":"0","11":"0","12":"0.724","13":"9","14":"Democracy","15":"28","16":"37","17":"65","18":"PF"},{"1":"America","2":"Peru","3":"32971854","4":"1280000","5":"226848.05","6":"418859.28","7":"6880.05139","8":"12703.5404","9":"0","10":"0","11":"0","12":"0.759","13":"9","14":"Democracy","15":"30","16":"42","17":"72","18":"F"},{"1":"America","2":"Saint Kitts and Nevis","3":"53199","4":"260","5":"1050.99","6":"1391.31","7":"19755.82248","8":"26152.9352","9":"0","10":"0","11":"0","12":"0.777","13":"NA","14":"NA","15":"36","16":"53","17":"89","18":"F"},{"1":"America","2":"Saint Lucia","3":"183627","4":"610","5":"2122.45","6":"2539.24","7":"11558.48541","8":"13828.2497","9":"0","10":"0","11":"0","12":"0.745","13":"NA","14":"NA","15":"38","16":"54","17":"92","18":"F"},{"1":"America","2":"Saint Vincent and the Grenadines","3":"110940","4":"390","5":"825.39","6":"1407.39","7":"7439.96755","8":"12686.0465","9":"0","10":"0","11":"0","12":"0.728","13":"NA","14":"NA","15":"36","16":"55","17":"91","18":"F"},{"1":"America","2":"Suriname","3":"586632","4":"156000","5":"3985.25","6":"9302.93","7":"6793.44120","8":"15858.2041","9":"0","10":"0","11":"0","12":"0.724","13":"5","14":"Open Anocracy","15":"32","16":"43","17":"75","18":"F"},{"1":"America","2":"Trinidad and Tobago","3":"1399488","4":"5130","5":"24100.20","6":"37405.11","7":"17220.72644","8":"26727.7104","9":"0","10":"0","11":"0","12":"0.799","13":"10","14":"Full Democracy","15":"33","16":"49","17":"82","18":"F"},{"1":"America","2":"United States","3":"334308644","4":"9158020","5":"21544825.00","6":"20656920.46","7":"64445.91065","8":"61789.9681","9":"1","10":"1","11":"1","12":"0.920","13":"8","14":"Democracy","15":"33","16":"53","17":"86","18":"F"},{"1":"America","2":"Uruguay","3":"3473730","4":"175020","5":"56045.91","6":"76287.37","7":"16134.21596","8":"21961.2261","9":"0","10":"0","11":"0","12":"0.808","13":"10","14":"Full Democracy","15":"40","16":"58","17":"98","18":"F"},{"1":"America","2":"Venezuela","3":"28435940","4":"882050","5":"482359.32","6":"506339.38","7":"16963.01652","8":"17806.3176","9":"0","10":"0","11":"0","12":"0.726","13":"-3","14":"Closed Anocracy","15":"2","16":"14","17":"16","18":"NF"},{"1":"Oceania","2":"Australia","3":"25499884","4":"7682300","5":"1392680.59","6":"1275026.60","7":"54615.17354","8":"50001.2706","9":"0","10":"1","11":"1","12":"0.938","13":"10","14":"Full Democracy","15":"40","16":"57","17":"97","18":"F"},{"1":"Oceania","2":"Fiji","3":"896445","4":"18270","5":"5535.55","6":"12496.36","7":"6175.00237","8":"13939.9071","9":"0","10":"0","11":"0","12":"0.724","13":"4","14":"Open Anocracy","15":"24","16":"36","17":"60","18":"PF"},{"1":"Oceania","2":"New Zealand","3":"4842780","4":"263820","5":"206928.77","6":"204260.27","7":"42729.33522","8":"42178.3087","9":"0","10":"0","11":"1","12":"0.921","13":"10","14":"Full Democracy","15":"40","16":"57","17":"97","18":"F"},{"1":"Oceania","2":"Papua New Guinea","3":"8947024","4":"452860","5":"24969.61","6":"37319.09","7":"2790.82855","8":"4171.1177","9":"0","10":"0","11":"0","12":"0.543","13":"5","14":"Open Anocracy","15":"23","16":"39","17":"62","18":"PF"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>{dplyr}の<code>group_by()</code>関数と{tidyr}の<code>nest()</code>、<code>unnest()</code>関数を組み合わせることでデータを入れ子型データへ変換したり、解除することができます。以上の流れを図式化したものが以下の図<a href="iteration.html#fig:nested-data">24.2</a>です。</p>
<div class="figure" style="text-align: center"><span id="fig:nested-data"></span>
<img src="figures/Iteration/nested_data.png" alt="入れ子型データの生成過程" width="100%" />
<p class="caption">
図 24.2: 入れ子型データの生成過程
</p>
</div>
<p>それではこの入れ子型データを使用して大陸ごとの<code>Polity_Score</code>と<code>FH_Total</code>の相関係数を計算してみましょう。<code>data</code>列をデータとした相関係数のラムダ式はどう書けば良いでしょうか。これまでの内容が理解できましたら、答えは難しくないでしょう。<code>cor.test()</code>関数の<code>data</code>引数の実引数として<code>.x</code>を指定するだけです。この結果を<code>Cor_test</code>という列として追加し、<code>Nested_Data2</code>という名のオブジェクトとして保存します。</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb124-1"><a href="iteration.html#cb124-1"></a>Nested_Data2 &lt;-<span class="st"> </span>Nested_Data <span class="op">%&gt;%</span></span>
<span id="cb124-2"><a href="iteration.html#cb124-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Cor_test =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="kw">cor.test</span>(<span class="op">~</span><span class="st"> </span>Polity_Score <span class="op">+</span><span class="st"> </span>FH_Total, <span class="dt">data =</span> .x)))</span></code></pre></div>
<div class="sourceCode" id="cb125"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb125-1"><a href="iteration.html#cb125-1"></a>Nested_Data2</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Continent"],"name":[1],"type":["chr"],"align":["left"]},{"label":["data"],"name":[2],"type":["list"],"align":["right"]},{"label":["Cor_test"],"name":[3],"type":["list"],"align":["right"]}],"data":[{"1":"Asia","2":"<tbl_df[,17]>","3":"<S3: htest>"},{"1":"Europe","2":"<tbl_df[,17]>","3":"<S3: htest>"},{"1":"Africa","2":"<tbl_df[,17]>","3":"<S3: htest>"},{"1":"America","2":"<tbl_df[,17]>","3":"<S3: htest>"},{"1":"Oceania","2":"<tbl_df[,17]>","3":"<S3: htest>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><code>Cor_test</code>という列が追加され、htestというクラス（S3クラス）オブジェクトが格納されていることが分かります。ちゃんと相関分析のオブジェクトが格納されているか、確認してみましょう。</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb126-1"><a href="iteration.html#cb126-1"></a>Nested_Data2<span class="op">$</span>Cor_test</span></code></pre></div>
<pre><code>## [[1]]
## 
##  Pearson&#39;s product-moment correlation
## 
## data:  Polity_Score and FH_Total
## t = 9.0626, df = 36, p-value = 8.05e-11
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.7009872 0.9107368
## sample estimates:
##       cor 
## 0.8338172 
## 
## 
## [[2]]
## 
##  Pearson&#39;s product-moment correlation
## 
## data:  Polity_Score and FH_Total
## t = 9.7452, df = 39, p-value = 5.288e-12
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.7210854 0.9130896
## sample estimates:
##       cor 
## 0.8419547 
## 
## 
## [[3]]
## 
##  Pearson&#39;s product-moment correlation
## 
## data:  Polity_Score and FH_Total
## t = 7.9611, df = 46, p-value = 3.375e-10
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.6087424 0.8594586
## sample estimates:
##       cor 
## 0.7612138 
## 
## 
## [[4]]
## 
##  Pearson&#39;s product-moment correlation
## 
## data:  Polity_Score and FH_Total
## t = 7.6082, df = 25, p-value = 5.797e-08
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.6677292 0.9226837
## sample estimates:
##       cor 
## 0.8356899 
## 
## 
## [[5]]
## 
##  Pearson&#39;s product-moment correlation
## 
## data:  Polity_Score and FH_Total
## t = 15.92, df = 2, p-value = 0.003922
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.8197821 0.9999220
## sample estimates:
##       cor 
## 0.9960776</code></pre>
<p>5つの相関分析結果が格納されています。続いて、ここから相関係数のみを抽出してみましょう。相関分析オブジェクトから相関係数を抽出するには<code>オブジェクト名$estimate</code>だけで十分です。<code>mpa_*()</code>関数を使うなら第2引数として関数やラムダ式を指定せず、<code>"estimate"</code>のみ入力するだけです。</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb128-1"><a href="iteration.html#cb128-1"></a>Nested_Data2 &lt;-<span class="st"> </span>Nested_Data2 <span class="op">%&gt;%</span></span>
<span id="cb128-2"><a href="iteration.html#cb128-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Cor_coef =</span> <span class="kw">map</span>(Cor_test, <span class="st">&quot;estimate&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb129"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb129-1"><a href="iteration.html#cb129-1"></a>Nested_Data2</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Continent"],"name":[1],"type":["chr"],"align":["left"]},{"label":["data"],"name":[2],"type":["list"],"align":["right"]},{"label":["Cor_test"],"name":[3],"type":["list"],"align":["right"]},{"label":["Cor_coef"],"name":[4],"type":["list"],"align":["right"]}],"data":[{"1":"Asia","2":"<tbl_df[,17]>","3":"<S3: htest>","4":"<dbl [1]>"},{"1":"Europe","2":"<tbl_df[,17]>","3":"<S3: htest>","4":"<dbl [1]>"},{"1":"Africa","2":"<tbl_df[,17]>","3":"<S3: htest>","4":"<dbl [1]>"},{"1":"America","2":"<tbl_df[,17]>","3":"<S3: htest>","4":"<dbl [1]>"},{"1":"Oceania","2":"<tbl_df[,17]>","3":"<S3: htest>","4":"<dbl [1]>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><code>Cor_coef</code>列が追加され、それぞれのセルにnumeric型の値が格納されていることが分かります。<code>map()</code>関数はリスト型でデータを返すため、このように出力されます。この<code>Cor_coef</code>列の入れ子構造を解除してみましょう。</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb130-1"><a href="iteration.html#cb130-1"></a>Nested_Data2 <span class="op">%&gt;%</span></span>
<span id="cb130-2"><a href="iteration.html#cb130-2"></a><span class="st">  </span><span class="kw">unnest</span>(<span class="dt">cols =</span> Cor_coef)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
## # Groups:   Continent [5]
##   Continent data               Cor_test Cor_coef
##   &lt;chr&gt;     &lt;list&gt;             &lt;list&gt;      &lt;dbl&gt;
## 1 Asia      &lt;tibble [42 × 17]&gt; &lt;htest&gt;     0.834
## 2 Europe    &lt;tibble [50 × 17]&gt; &lt;htest&gt;     0.842
## 3 Africa    &lt;tibble [54 × 17]&gt; &lt;htest&gt;     0.761
## 4 America   &lt;tibble [36 × 17]&gt; &lt;htest&gt;     0.836
## 5 Oceania   &lt;tibble [4 × 17]&gt;  &lt;htest&gt;     0.996</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb132-1"><a href="iteration.html#cb132-1"></a>Nested_Data2</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Continent"],"name":[1],"type":["chr"],"align":["left"]},{"label":["data"],"name":[2],"type":["list"],"align":["right"]},{"label":["Cor_test"],"name":[3],"type":["list"],"align":["right"]},{"label":["Cor_coef"],"name":[4],"type":["list"],"align":["right"]}],"data":[{"1":"Asia","2":"<tbl_df[,17]>","3":"<S3: htest>","4":"<dbl [1]>"},{"1":"Europe","2":"<tbl_df[,17]>","3":"<S3: htest>","4":"<dbl [1]>"},{"1":"Africa","2":"<tbl_df[,17]>","3":"<S3: htest>","4":"<dbl [1]>"},{"1":"America","2":"<tbl_df[,17]>","3":"<S3: htest>","4":"<dbl [1]>"},{"1":"Oceania","2":"<tbl_df[,17]>","3":"<S3: htest>","4":"<dbl [1]>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><code>Cor_coef</code>の各列に格納された値が出力されました。以上の作業を一つのコードとしてまとめることも出来ます。また、相関係数の抽出の際に<code>map()</code>でなく、<code>map_dbl()</code>を使えば、numeric型ベクトルが返されるので<code>unnest()</code>も不要となります。</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb133-1"><a href="iteration.html#cb133-1"></a>Country_df <span class="op">%&gt;%</span></span>
<span id="cb133-2"><a href="iteration.html#cb133-2"></a><span class="st">  </span><span class="kw">group_by</span>(Continent) <span class="op">%&gt;%</span></span>
<span id="cb133-3"><a href="iteration.html#cb133-3"></a><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></span>
<span id="cb133-4"><a href="iteration.html#cb133-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Cor_test =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="kw">cor.test</span>(<span class="op">~</span><span class="st"> </span>Polity_Score <span class="op">+</span><span class="st"> </span>FH_Total, <span class="dt">data =</span> .x)),</span>
<span id="cb133-5"><a href="iteration.html#cb133-5"></a>         <span class="dt">Cor_coef =</span> <span class="kw">map_dbl</span>(Cor_test, <span class="st">&quot;estimate&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
## # Groups:   Continent [5]
##   Continent data               Cor_test Cor_coef
##   &lt;chr&gt;     &lt;list&gt;             &lt;list&gt;      &lt;dbl&gt;
## 1 Asia      &lt;tibble [42 × 17]&gt; &lt;htest&gt;     0.834
## 2 Europe    &lt;tibble [50 × 17]&gt; &lt;htest&gt;     0.842
## 3 Africa    &lt;tibble [54 × 17]&gt; &lt;htest&gt;     0.761
## 4 America   &lt;tibble [36 × 17]&gt; &lt;htest&gt;     0.836
## 5 Oceania   &lt;tibble [4 × 17]&gt;  &lt;htest&gt;     0.996</code></pre>
<p>たった5行のコードで大陸ごとの相関分析が出来ました。これを<code>map_*()</code>を使わずに処理するなら以下のようなコードとなります<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>。</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb135-1"><a href="iteration.html#cb135-1"></a>Cor_Test1 &lt;-<span class="st"> </span><span class="kw">cor.test</span>(<span class="op">~</span><span class="st"> </span>Polity_Score <span class="op">+</span><span class="st"> </span>FH_Total, </span>
<span id="cb135-2"><a href="iteration.html#cb135-2"></a>                      <span class="dt">data =</span> <span class="kw">subset</span>(Country_df, Country_df<span class="op">$</span>Continent <span class="op">==</span><span class="st"> &quot;Asia&quot;</span>))</span>
<span id="cb135-3"><a href="iteration.html#cb135-3"></a>Cor_Test2 &lt;-<span class="st"> </span><span class="kw">cor.test</span>(<span class="op">~</span><span class="st"> </span>Polity_Score <span class="op">+</span><span class="st"> </span>FH_Total, </span>
<span id="cb135-4"><a href="iteration.html#cb135-4"></a>                      <span class="dt">data =</span> <span class="kw">subset</span>(Country_df, Country_df<span class="op">$</span>Continent <span class="op">==</span><span class="st"> &quot;Europe&quot;</span>))</span>
<span id="cb135-5"><a href="iteration.html#cb135-5"></a>Cor_Test3 &lt;-<span class="st"> </span><span class="kw">cor.test</span>(<span class="op">~</span><span class="st"> </span>Polity_Score <span class="op">+</span><span class="st"> </span>FH_Total, </span>
<span id="cb135-6"><a href="iteration.html#cb135-6"></a>                      <span class="dt">data =</span> <span class="kw">subset</span>(Country_df, Country_df<span class="op">$</span>Continent <span class="op">==</span><span class="st"> &quot;Africa&quot;</span>))</span>
<span id="cb135-7"><a href="iteration.html#cb135-7"></a>Cor_Test4 &lt;-<span class="st"> </span><span class="kw">cor.test</span>(<span class="op">~</span><span class="st"> </span>Polity_Score <span class="op">+</span><span class="st"> </span>FH_Total, </span>
<span id="cb135-8"><a href="iteration.html#cb135-8"></a>                      <span class="dt">data =</span> <span class="kw">subset</span>(Country_df, Country_df<span class="op">$</span>Continent <span class="op">==</span><span class="st"> &quot;America&quot;</span>))</span>
<span id="cb135-9"><a href="iteration.html#cb135-9"></a>Cor_Test5 &lt;-<span class="st"> </span><span class="kw">cor.test</span>(<span class="op">~</span><span class="st"> </span>Polity_Score <span class="op">+</span><span class="st"> </span>FH_Total, </span>
<span id="cb135-10"><a href="iteration.html#cb135-10"></a>                      <span class="dt">data =</span> <span class="kw">subset</span>(Country_df, Country_df<span class="op">$</span>Continent <span class="op">==</span><span class="st"> &quot;Oceania&quot;</span>))</span>
<span id="cb135-11"><a href="iteration.html#cb135-11"></a></span>
<span id="cb135-12"><a href="iteration.html#cb135-12"></a>Cor_Result &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Asia&quot;</span> =<span class="st"> </span>Cor_Test1<span class="op">$</span>estimate, <span class="st">&quot;Europe&quot;</span> =<span class="st"> </span>Cor_Test2<span class="op">$</span>estimate,</span>
<span id="cb135-13"><a href="iteration.html#cb135-13"></a>                <span class="st">&quot;Africa&quot;</span> =<span class="st"> </span>Cor_Test3<span class="op">$</span>estimate, <span class="st">&quot;America&quot;</span> =<span class="st"> </span>Cor_Test4<span class="op">$</span>estimate,</span>
<span id="cb135-14"><a href="iteration.html#cb135-14"></a>                <span class="st">&quot;Oceania&quot;</span> =<span class="st"> </span>Cor_Test5<span class="op">$</span>estimate)</span>
<span id="cb135-15"><a href="iteration.html#cb135-15"></a></span>
<span id="cb135-16"><a href="iteration.html#cb135-16"></a><span class="kw">print</span>(Cor_Result)</span></code></pre></div>
<pre><code>##    Asia.cor  Europe.cor  Africa.cor America.cor Oceania.cor 
##   0.8338172   0.8419547   0.7612138   0.8356899   0.9960776</code></pre>
<p>それでは応用例として回帰分析をしてみましょう。今回も<code>Nested_Data</code>を使用し、<code>PPP_per_capita</code>を応答変数に、<code>FH_Total</code>と<code>Population</code>を説明変数とした重回帰分析を行い、政治的自由度（<code>FH_Total</code>）の係数や標準誤差などを抽出してみましょう。まずは、ステップごとにコードを分けて説明し、最後には一つのコードとしてまとめたものをお見せします。</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb137-1"><a href="iteration.html#cb137-1"></a>Nested_Data <span class="op">%&gt;%</span></span>
<span id="cb137-2"><a href="iteration.html#cb137-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Model =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="kw">lm</span>(PPP_per_capita <span class="op">~</span><span class="st"> </span>FH_Total <span class="op">+</span><span class="st"> </span>Population, <span class="dt">data =</span> .x)))</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Continent"],"name":[1],"type":["chr"],"align":["left"]},{"label":["data"],"name":[2],"type":["list"],"align":["right"]},{"label":["Model"],"name":[3],"type":["list"],"align":["right"]}],"data":[{"1":"Asia","2":"<tbl_df[,17]>","3":"<S3: lm>"},{"1":"Europe","2":"<tbl_df[,17]>","3":"<S3: lm>"},{"1":"Africa","2":"<tbl_df[,17]>","3":"<S3: lm>"},{"1":"America","2":"<tbl_df[,17]>","3":"<S3: lm>"},{"1":"Oceania","2":"<tbl_df[,17]>","3":"<S3: lm>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><code>Model</code>列からから推定結果の要約を抽出するにはどうすれば良いでしょうか。1つ目の方法は<code>summary(lmオブジェクト名)$coefficients</code>で抽出する方法です。</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb138-1"><a href="iteration.html#cb138-1"></a>lm_fit1 &lt;-<span class="st"> </span><span class="kw">lm</span>(PPP_per_capita <span class="op">~</span><span class="st"> </span>FH_Total <span class="op">+</span><span class="st"> </span>Population, <span class="dt">data =</span> Country_df)</span>
<span id="cb138-2"><a href="iteration.html#cb138-2"></a></span>
<span id="cb138-3"><a href="iteration.html#cb138-3"></a><span class="kw">summary</span>(lm_fit1)<span class="op">$</span>coefficients</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Estimate"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Std. Error"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["t value"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Pr(>|t|)"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"1.929308e+03","2":"3.229792e+03","3":"0.5973473","4":"5.510476e-01","_rn_":"(Intercept)"},{"1":"3.256660e+02","2":"4.871626e+01","3":"6.6849553","4":"2.979474e-10","_rn_":"FH_Total"},{"1":"-2.217793e-06","2":"9.193256e-06","3":"-0.2412413","4":"8.096505e-01","_rn_":"Population"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>もっと簡単な方法は{broom}の<code>tidy()</code>関数を使う方法です。<code>tidy()</code>関数は推定値に関する様々な情報をデータフレームとして返す便利な関数です。デフォルトだと95%信頼区間は出力されませんが、<code>conf.int = TRUE</code>を指定すると信頼区間も出力されます。<code>tidy()</code>関数を提供する{broom}パッケージは{tidyverse}の一部ですが、{tidyverse}読み込みの際に一緒に読み込まれるものではないため、予め{broom}パッケージを読み込んでおくか、<code>broom::tidy()</code>で使うことができます。</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb139-1"><a href="iteration.html#cb139-1"></a>broom<span class="op">::</span><span class="kw">tidy</span>(lm_fit1, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"1.929308e+03","3":"3.229792e+03","4":"0.5973473","5":"5.510476e-01","6":"-4.445050e+03","7":"8.303665e+03"},{"1":"FH_Total","2":"3.256660e+02","3":"4.871626e+01","4":"6.6849553","5":"2.979474e-10","6":"2.295190e+02","7":"4.218131e+02"},{"1":"Population","2":"-2.217793e-06","3":"9.193256e-06","4":"-0.2412413","5":"8.096505e-01","6":"-2.036172e-05","7":"1.592613e-05"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>それでは<code>Model</code>列にあるlmオブジェクトから推定値の情報を抽出し、<code>Model2</code>という列に格納してみましょう。今回はラムダ式を使う必要がありません。なぜなら、<code>tidy()</code>の第一引数がデータだからです（<code>?tidy.lm</code>参照）。他にも必要な引数（<code>conf.int = TRUE</code>など）があれば、<code>map()</code>の第3引数以降で指定します。</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb140-1"><a href="iteration.html#cb140-1"></a>Nested_Data <span class="op">%&gt;%</span></span>
<span id="cb140-2"><a href="iteration.html#cb140-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Model  =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="kw">lm</span>(PPP_per_capita <span class="op">~</span><span class="st"> </span>FH_Total <span class="op">+</span><span class="st"> </span>Population, <span class="dt">data =</span> .x)),</span>
<span id="cb140-3"><a href="iteration.html#cb140-3"></a>         <span class="dt">Model2 =</span> <span class="kw">map</span>(Model, broom<span class="op">::</span>tidy, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Continent"],"name":[1],"type":["chr"],"align":["left"]},{"label":["data"],"name":[2],"type":["list"],"align":["right"]},{"label":["Model"],"name":[3],"type":["list"],"align":["right"]},{"label":["Model2"],"name":[4],"type":["list"],"align":["right"]}],"data":[{"1":"Asia","2":"<tbl_df[,17]>","3":"<S3: lm>","4":"<tbl_df[,7]>"},{"1":"Europe","2":"<tbl_df[,17]>","3":"<S3: lm>","4":"<tbl_df[,7]>"},{"1":"Africa","2":"<tbl_df[,17]>","3":"<S3: lm>","4":"<tbl_df[,7]>"},{"1":"America","2":"<tbl_df[,17]>","3":"<S3: lm>","4":"<tbl_df[,7]>"},{"1":"Oceania","2":"<tbl_df[,17]>","3":"<S3: lm>","4":"<tbl_df[,7]>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><code>Model2</code>列の各セルに7列のtibbleが格納されているようです。ここからは<code>data</code>と<code>Model</code>列は不要ですので<code>select()</code>関数を使って除去し、<code>Model2</code>の入れ子構造を解除してみます。</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb141-1"><a href="iteration.html#cb141-1"></a>Nested_Data <span class="op">%&gt;%</span></span>
<span id="cb141-2"><a href="iteration.html#cb141-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Model  =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="kw">lm</span>(PPP_per_capita <span class="op">~</span><span class="st"> </span>FH_Total <span class="op">+</span><span class="st"> </span>Population, <span class="dt">data =</span> .x)),</span>
<span id="cb141-3"><a href="iteration.html#cb141-3"></a>         <span class="dt">Model2 =</span> <span class="kw">map</span>(Model, broom<span class="op">::</span>tidy, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb141-4"><a href="iteration.html#cb141-4"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(data, Model)) <span class="op">%&gt;%</span></span>
<span id="cb141-5"><a href="iteration.html#cb141-5"></a><span class="st">  </span><span class="kw">unnest</span>(<span class="dt">cols =</span> Model2)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Continent"],"name":[1],"type":["chr"],"align":["left"]},{"label":["term"],"name":[2],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"Asia","2":"(Intercept)","3":"2.132281e+04","4":"7.376068e+03","5":"2.8908103","6":"6.320381e-03","7":"6.390744e+03","8":"3.625488e+04"},{"1":"Asia","2":"FH_Total","3":"6.991151e+01","4":"1.557777e+02","5":"0.4487901","6":"6.561320e-01","7":"-2.454441e+02","8":"3.852671e+02"},{"1":"Asia","2":"Population","3":"-1.262772e-05","4":"1.260637e-05","5":"-1.0016938","6":"3.228278e-01","7":"-3.814798e-05","8":"1.289254e-05"},{"1":"Europe","2":"(Intercept)","3":"-1.396684e+04","4":"9.406714e+03","5":"-1.4847736","6":"1.448983e-01","7":"-3.293729e+04","8":"5.003606e+03"},{"1":"Europe","2":"FH_Total","3":"6.290397e+02","4":"1.084026e+02","5":"5.8028095","6":"7.072711e-07","7":"4.104250e+02","8":"8.476544e+02"},{"1":"Europe","2":"Population","3":"1.171328e-04","4":"8.452736e-05","5":"1.3857380","6":"1.729724e-01","7":"-5.333289e-05","8":"2.875984e-04"},{"1":"Africa","2":"(Intercept)","3":"3.833772e+03","4":"1.836293e+03","5":"2.0877781","6":"4.203882e-02","7":"1.436034e+02","8":"7.523941e+03"},{"1":"Africa","2":"FH_Total","3":"5.105109e+01","4":"3.422242e+01","5":"1.4917439","6":"1.421769e-01","7":"-1.772144e+01","8":"1.198236e+02"},{"1":"Africa","2":"Population","3":"-1.428900e-05","4":"2.307903e-05","5":"-0.6191335","6":"5.386965e-01","7":"-6.066804e-05","8":"3.209004e-05"},{"1":"America","2":"(Intercept)","3":"-7.499211e+03","4":"5.926273e+03","5":"-1.2654178","6":"2.148583e-01","7":"-1.957063e+04","8":"4.572211e+03"},{"1":"America","2":"FH_Total","3":"3.116717e+02","4":"7.730219e+01","5":"4.0318607","6":"3.202153e-04","7":"1.542123e+02","8":"4.691311e+02"},{"1":"America","2":"Population","3":"9.131166e-05","4":"2.347654e-05","5":"3.8894851","6":"4.772635e-04","7":"4.349151e-05","8":"1.391318e-04"},{"1":"Oceania","2":"(Intercept)","3":"-5.101877e+04","4":"2.335063e+04","5":"-2.1848993","6":"2.732550e-01","7":"-3.477166e+05","8":"2.456791e+05"},{"1":"Oceania","2":"FH_Total","3":"9.755225e+02","4":"3.259640e+02","5":"2.9927308","6":"2.052965e-01","7":"-3.166243e+03","8":"5.117288e+03"},{"1":"Oceania","2":"Population","3":"1.518078e-04","4":"6.269977e-04","5":"0.2421185","6":"8.487728e-01","7":"-7.814954e-03","8":"8.118569e-03"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>各大陸ごとの回帰分析の推定結果が一つのデータフレームとして展開されました。ここでは<code>FH_Total</code>の推定値のみがほしいので、<code>filter()</code>関数を使用し、<code>term</code>の値が<code>"FH_Total"</code>の行のみを残します。また、<code>term</code>列も必要なくなるので除外しましょう。</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb142-1"><a href="iteration.html#cb142-1"></a>Nested_Data <span class="op">%&gt;%</span></span>
<span id="cb142-2"><a href="iteration.html#cb142-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Model  =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="kw">lm</span>(PPP_per_capita <span class="op">~</span><span class="st"> </span>FH_Total <span class="op">+</span><span class="st"> </span>Population, <span class="dt">data =</span> .x)),</span>
<span id="cb142-3"><a href="iteration.html#cb142-3"></a>         <span class="dt">Model2 =</span> <span class="kw">map</span>(Model, broom<span class="op">::</span>tidy, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb142-4"><a href="iteration.html#cb142-4"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(data, Model)) <span class="op">%&gt;%</span></span>
<span id="cb142-5"><a href="iteration.html#cb142-5"></a><span class="st">  </span><span class="kw">unnest</span>(<span class="dt">cols =</span> Model2) <span class="op">%&gt;%</span></span>
<span id="cb142-6"><a href="iteration.html#cb142-6"></a><span class="st">  </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;FH_Total&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb142-7"><a href="iteration.html#cb142-7"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>term)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Continent"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"Asia","2":"69.91151","3":"155.77775","4":"0.4487901","5":"6.561320e-01","6":"-245.44406","7":"385.2671"},{"1":"Europe","2":"629.03970","3":"108.40261","4":"5.8028095","5":"7.072711e-07","6":"410.42500","7":"847.6544"},{"1":"Africa","2":"51.05109","3":"34.22242","4":"1.4917439","5":"1.421769e-01","6":"-17.72144","7":"119.8236"},{"1":"America","2":"311.67167","3":"77.30219","4":"4.0318607","5":"3.202153e-04","6":"154.21226","7":"469.1311"},{"1":"Oceania","2":"975.52249","3":"325.96399","4":"2.9927308","5":"2.052965e-01","6":"-3166.24273","7":"5117.2877"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>これで終わりです。政治的自由度と所得水準の関係はアジアとアフリカでは連関の程度が小さく、統計的有意ではありません。オセアニアの場合、連関の程度は大きいと考えられますが、サンプルサイズが小さいため統計的有意な結果は得られませんでした。一方、ヨーロッパとアメリカでは連関の程度も大きく、統計的有意な連関が確認されました。</p>
<p>以上のコードをよりコンパクトにまとめると以下のようなコードとなります。</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb143-1"><a href="iteration.html#cb143-1"></a><span class="co"># {purrr}使用</span></span>
<span id="cb143-2"><a href="iteration.html#cb143-2"></a>Nested_Data <span class="op">%&gt;%</span></span>
<span id="cb143-3"><a href="iteration.html#cb143-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Model =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="kw">lm</span>(PPP_per_capita <span class="op">~</span><span class="st"> </span>FH_Total <span class="op">+</span><span class="st"> </span>Population, <span class="dt">data =</span> .x)),</span>
<span id="cb143-4"><a href="iteration.html#cb143-4"></a>         <span class="dt">Model =</span> <span class="kw">map</span>(Model, broom<span class="op">::</span>tidy, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb143-5"><a href="iteration.html#cb143-5"></a><span class="st">  </span><span class="kw">unnest</span>(<span class="dt">cols =</span> Model) <span class="op">%&gt;%</span></span>
<span id="cb143-6"><a href="iteration.html#cb143-6"></a><span class="st">  </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;FH_Total&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb143-7"><a href="iteration.html#cb143-7"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(Data, term))</span></code></pre></div>
<p>{purrr}パッケージを使用しない例も紹介します。むろん、以下のコードは可能な限り面倒な書き方をしています。<code>for()</code>文や<code>split()</code>と<code>*apply()</code>関数を組み合わせると以下の例よりも簡潔なコードは作成できます。R上級者になるためには{tidyverse}的な書き方だけでなく、ネイティブRの書き方にも慣れる必要があります。ぜひ挑戦してみましょう。</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb144-1"><a href="iteration.html#cb144-1"></a><span class="co"># {purrr}を使用しない場合</span></span>
<span id="cb144-2"><a href="iteration.html#cb144-2"></a><span class="co"># FH_Totalの係数と標準誤差のみを抽出する例</span></span>
<span id="cb144-3"><a href="iteration.html#cb144-3"></a>lm_fit1 &lt;-<span class="st"> </span><span class="kw">lm</span>(PPP_per_capita <span class="op">~</span><span class="st"> </span>FH_Total <span class="op">+</span><span class="st"> </span>Population, </span>
<span id="cb144-4"><a href="iteration.html#cb144-4"></a>              <span class="dt">data =</span> <span class="kw">subset</span>(Country_df, Country_df<span class="op">$</span>Continent <span class="op">==</span><span class="st"> &quot;Asia&quot;</span>))</span>
<span id="cb144-5"><a href="iteration.html#cb144-5"></a>lm_fit2 &lt;-<span class="st"> </span><span class="kw">lm</span>(PPP_per_capita <span class="op">~</span><span class="st"> </span>FH_Total <span class="op">+</span><span class="st"> </span>Population, </span>
<span id="cb144-6"><a href="iteration.html#cb144-6"></a>              <span class="dt">data =</span> <span class="kw">subset</span>(Country_df, Country_df<span class="op">$</span>Continent <span class="op">==</span><span class="st"> &quot;Europe&quot;</span>))</span>
<span id="cb144-7"><a href="iteration.html#cb144-7"></a>lm_fit3 &lt;-<span class="st"> </span><span class="kw">lm</span>(PPP_per_capita <span class="op">~</span><span class="st"> </span>FH_Total <span class="op">+</span><span class="st"> </span>Population, </span>
<span id="cb144-8"><a href="iteration.html#cb144-8"></a>              <span class="dt">data =</span> <span class="kw">subset</span>(Country_df, Country_df<span class="op">$</span>Continent <span class="op">==</span><span class="st"> &quot;Africa&quot;</span>))</span>
<span id="cb144-9"><a href="iteration.html#cb144-9"></a>lm_fit4 &lt;-<span class="st"> </span><span class="kw">lm</span>(PPP_per_capita <span class="op">~</span><span class="st"> </span>FH_Total <span class="op">+</span><span class="st"> </span>Population, </span>
<span id="cb144-10"><a href="iteration.html#cb144-10"></a>              <span class="dt">data =</span> <span class="kw">subset</span>(Country_df, Country_df<span class="op">$</span>Continent <span class="op">==</span><span class="st"> &quot;America&quot;</span>))</span>
<span id="cb144-11"><a href="iteration.html#cb144-11"></a>lm_fit5 &lt;-<span class="st"> </span><span class="kw">lm</span>(PPP_per_capita <span class="op">~</span><span class="st"> </span>FH_Total <span class="op">+</span><span class="st"> </span>Population, </span>
<span id="cb144-12"><a href="iteration.html#cb144-12"></a>              <span class="dt">data =</span> <span class="kw">subset</span>(Country_df, Country_df<span class="op">$</span>Continent <span class="op">==</span><span class="st"> &quot;Oceania&quot;</span>))</span>
<span id="cb144-13"><a href="iteration.html#cb144-13"></a></span>
<span id="cb144-14"><a href="iteration.html#cb144-14"></a>lm_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Continent =</span> <span class="kw">c</span>(<span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Africa&quot;</span>, <span class="st">&quot;America&quot;</span>, <span class="st">&quot;Oceania&quot;</span>),</span>
<span id="cb144-15"><a href="iteration.html#cb144-15"></a>                    <span class="dt">estimate  =</span> <span class="kw">c</span>(<span class="kw">summary</span>(lm_fit1)<span class="op">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>],</span>
<span id="cb144-16"><a href="iteration.html#cb144-16"></a>                                  <span class="kw">summary</span>(lm_fit2)<span class="op">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>],</span>
<span id="cb144-17"><a href="iteration.html#cb144-17"></a>                                  <span class="kw">summary</span>(lm_fit3)<span class="op">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>],</span>
<span id="cb144-18"><a href="iteration.html#cb144-18"></a>                                  <span class="kw">summary</span>(lm_fit4)<span class="op">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>],</span>
<span id="cb144-19"><a href="iteration.html#cb144-19"></a>                                  <span class="kw">summary</span>(lm_fit5)<span class="op">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span>]),</span>
<span id="cb144-20"><a href="iteration.html#cb144-20"></a>                    <span class="dt">se        =</span> <span class="kw">c</span>(<span class="kw">summary</span>(lm_fit1)<span class="op">$</span>coefficients[<span class="dv">2</span>, <span class="dv">2</span>],</span>
<span id="cb144-21"><a href="iteration.html#cb144-21"></a>                                  <span class="kw">summary</span>(lm_fit2)<span class="op">$</span>coefficients[<span class="dv">2</span>, <span class="dv">2</span>],</span>
<span id="cb144-22"><a href="iteration.html#cb144-22"></a>                                  <span class="kw">summary</span>(lm_fit3)<span class="op">$</span>coefficients[<span class="dv">2</span>, <span class="dv">2</span>],</span>
<span id="cb144-23"><a href="iteration.html#cb144-23"></a>                                  <span class="kw">summary</span>(lm_fit4)<span class="op">$</span>coefficients[<span class="dv">2</span>, <span class="dv">2</span>],</span>
<span id="cb144-24"><a href="iteration.html#cb144-24"></a>                                  <span class="kw">summary</span>(lm_fit5)<span class="op">$</span>coefficients[<span class="dv">2</span>, <span class="dv">2</span>]))</span></code></pre></div>
</div>
<div id="iteration-range" class="section level3" number="24.5.3">
<h3><span class="header-section-number">24.5.3</span> データの範囲を指定したモデル推定</h3>
<p>これまでの例は名目変数でグループ化を行いましたが、連続変数を使うことも可能です。たとえば、人口1千万未満の国、1千万以上5千万未満、5千万以上1億未満、1億以上でサンプルを分割することです。まず、<code>Country_df</code>から<code>PPP_per_capita</code>、<code>FH_Total</code>、<code>Population</code>列のみを抽出し、<code>Country_df2</code>に格納します。</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb145-1"><a href="iteration.html#cb145-1"></a>Country_df2 &lt;-<span class="st"> </span>Country_df <span class="op">%&gt;%</span></span>
<span id="cb145-2"><a href="iteration.html#cb145-2"></a><span class="st">  </span><span class="kw">select</span>(PPP_per_capita, FH_Total, Population)</span></code></pre></div>
<p>続いて、<code>case_when()</code>関数を使用し、<code>Population</code>の値を基準にケースがどの範囲内に属するかを表す変数<code>Group</code>を作成します。</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb146-1"><a href="iteration.html#cb146-1"></a>Country_df2 &lt;-<span class="st"> </span>Country_df2 <span class="op">%&gt;%</span></span>
<span id="cb146-2"><a href="iteration.html#cb146-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Group =</span> <span class="kw">case_when</span>(Population <span class="op">&lt;</span><span class="st">  </span><span class="dv">10000000</span>  <span class="op">~</span><span class="st"> &quot;1千万未満&quot;</span>,</span>
<span id="cb146-3"><a href="iteration.html#cb146-3"></a>                           Population <span class="op">&lt;</span><span class="st">  </span><span class="dv">50000000</span>  <span class="op">~</span><span class="st"> &quot;1千万以上5千万未満&quot;</span>,</span>
<span id="cb146-4"><a href="iteration.html#cb146-4"></a>                           Population <span class="op">&lt;</span><span class="st">  </span><span class="dv">100000000</span> <span class="op">~</span><span class="st"> &quot;5千万以上1億未満&quot;</span>,</span>
<span id="cb146-5"><a href="iteration.html#cb146-5"></a>                           Population <span class="op">&gt;=</span><span class="st"> </span><span class="dv">100000000</span> <span class="op">~</span><span class="st"> &quot;1億以上&quot;</span>))</span></code></pre></div>
<p>中身を確認してみましょう。</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb147-1"><a href="iteration.html#cb147-1"></a>Country_df2</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["PPP_per_capita"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["FH_Total"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Population"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Group"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"2125.3628","2":"27","3":"38928346","4":"1千万以上5千万未満"},{"1":"13780.6385","2":"67","3":"2877797","4":"1千万未満"},{"1":"11324.0725","2":"34","3":"43851044","4":"1千万以上5千万未満"},{"1":"NA","2":"94","3":"77265","4":"1千万未満"},{"1":"6649.1673","2":"32","3":"32866272","4":"1千万以上5千万未満"},{"1":"21267.2446","2":"85","3":"97929","4":"1千万未満"},{"1":"22938.4528","2":"85","3":"45195774","4":"1千万以上5千万未満"},{"1":"12974.2853","2":"53","3":"2963243","4":"1千万未満"},{"1":"50001.2706","2":"97","3":"25499884","4":"1千万以上5千万未満"},{"1":"55823.7755","2":"93","3":"9006398","4":"1千万未満"},{"1":"14257.2173","2":"10","3":"10139177","4":"1千万以上5千万未満"},{"1":"35662.1334","2":"91","3":"393244","4":"1千万未満"},{"1":"43624.1365","2":"11","3":"1701575","4":"1千万未満"},{"1":"4457.5289","2":"39","3":"164689383","4":"1億以上"},{"1":"16065.9069","2":"95","3":"287375","4":"1千万未満"},{"1":"19415.2375","2":"19","3":"9449323","4":"1千万未満"},{"1":"51548.9719","2":"96","3":"11589623","4":"1千万以上5千万未満"},{"1":"7090.5721","2":"86","3":"397628","4":"1千万未満"},{"1":"3067.3395","2":"66","3":"12123200","4":"1千万以上5千万未満"},{"1":"11362.5442","2":"59","3":"771608","4":"1千万未満"},{"1":"8623.4069","2":"63","3":"11673021","4":"1千万以上5千万未満"},{"1":"15158.6387","2":"53","3":"3280819","4":"1千万未満"},{"1":"17310.5769","2":"72","3":"2351627","4":"1千万未満"},{"1":"14734.4416","2":"75","3":"212559417","4":"1億以上"},{"1":"60655.6429","2":"28","3":"437479","4":"1千万未満"},{"1":"22550.8096","2":"80","3":"6948445","4":"1千万未満"},{"1":"1799.9818","2":"56","3":"20903273","4":"1千万以上5千万未満"},{"1":"4931.5849","2":"30","3":"54409800","4":"5千万以上1億未満"},{"1":"733.1417","2":"13","3":"11890784","4":"1千万以上5千万未満"},{"1":"6912.7516","2":"92","3":"555987","4":"1千万未満"},{"1":"4142.2038","2":"25","3":"16718965","4":"1千万以上5千万未満"},{"1":"3506.4386","2":"18","3":"26545863","4":"1千万以上5千万未満"},{"1":"49087.5312","2":"98","3":"37742154","4":"1千万以上5千万未満"},{"1":"923.5042","2":"10","3":"4829767","4":"1千万未満"},{"1":"1525.4869","2":"17","3":"16425864","4":"1千万以上5千万未満"},{"1":"24261.6318","2":"90","3":"19116201","4":"1千万以上5千万未満"},{"1":"15176.5676","2":"10","3":"1447470092","4":"1億以上"},{"1":"14474.6276","2":"66","3":"50882891","4":"5千万以上1億未満"},{"1":"3006.8733","2":"44","3":"869601","4":"1千万未満"},{"1":"3191.0497","2":"20","3":"5518087","4":"1千万未満"},{"1":"1043.4956","2":"18","3":"89561403","4":"5千万以上1億未満"},{"1":"19395.1534","2":"91","3":"5094118","4":"1千万未満"},{"1":"3641.9578","2":"51","3":"26378274","4":"1千万以上5千万未満"},{"1":"27996.1328","2":"85","3":"4105267","4":"1千万未満"},{"1":"NA","2":"14","3":"11326616","4":"1千万以上5千万未満"},{"1":"28723.8924","2":"94","3":"1207359","4":"1千万未満"},{"1":"40130.2309","2":"91","3":"10708981","4":"1千万以上5千万未満"},{"1":"56753.7975","2":"97","3":"5841065","4":"1千万未満"},{"1":"5071.1943","2":"24","3":"988000","4":"1千万未満"},{"1":"11755.0635","2":"93","3":"71986","4":"1千万未満"},{"1":"17774.0173","2":"67","3":"10847910","4":"1千万以上5千万未満"},{"1":"11478.2917","2":"65","3":"17643054","4":"1千万以上5千万未満"},{"1":"11198.2578","2":"21","3":"102334404","4":"1億以上"},{"1":"8727.6628","2":"66","3":"6486205","4":"1千万未満"},{"1":"19458.2978","2":"6","3":"1402985","4":"1千万未満"},{"1":"1860.3065","2":"2","3":"3546421","4":"1千万未満"},{"1":"36233.1035","2":"94","3":"1326535","4":"1千万未満"},{"1":"8633.5553","2":"19","3":"1160164","4":"1千万未満"},{"1":"2046.8136","2":"24","3":"114963588","4":"1億以上"},{"1":"13939.9071","2":"60","3":"896445","4":"1千万未満"},{"1":"49324.0806","2":"100","3":"5540720","4":"1千万未満"},{"1":"45649.6046","2":"90","3":"68147691","4":"5千万以上1億未満"},{"1":"14380.1640","2":"22","3":"2225734","4":"1千万未満"},{"1":"2072.3368","2":"46","3":"2416668","4":"1千万未満"},{"1":"13633.8664","2":"61","3":"3989167","4":"1千万未満"},{"1":"53886.1529","2":"94","3":"83783942","4":"5千万以上1億未満"},{"1":"5097.3606","2":"82","3":"31072940","4":"1千万以上5千万未満"},{"1":"31256.6403","2":"88","3":"10423054","4":"1千万以上5千万未満"},{"1":"33836.1811","2":"89","3":"56770","4":"1千万未満"},{"1":"8332.8092","2":"52","3":"17915568","4":"1千万以上5千万未満"},{"1":"2416.0775","2":"40","3":"13132795","4":"1千万以上5千万未満"},{"1":"1901.6047","2":"46","3":"1968001","4":"1千万未満"},{"1":"9447.4491","2":"74","3":"786552","4":"1千万未満"},{"1":"1765.8751","2":"38","3":"11402528","4":"1千万以上5千万未満"},{"1":"NA","2":"NA","3":"801","4":"1千万未満"},{"1":"5624.4120","2":"45","3":"9904607","4":"1千万未満"},{"1":"31955.3803","2":"70","3":"9660351","4":"1千万未満"},{"1":"60011.0479","2":"94","3":"341243","4":"1千万未満"},{"1":"6564.2485","2":"71","3":"1380004385","4":"1億以上"},{"1":"11396.9474","2":"61","3":"273523615","4":"1億以上"},{"1":"13961.4755","2":"17","3":"83992949","4":"5千万以上1億未満"},{"1":"10434.2023","2":"31","3":"40222493","4":"1千万以上5千万未満"},{"1":"83254.2783","2":"97","3":"4937786","4":"1千万未満"},{"1":"41318.4639","2":"76","3":"8655535","4":"1千万未満"},{"1":"42769.7379","2":"89","3":"60461826","4":"5千万以上1億未満"},{"1":"9886.5582","2":"78","3":"2961167","4":"1千万未満"},{"1":"41490.5730","2":"96","3":"126476461","4":"1億以上"},{"1":"9849.4855","2":"37","3":"10203134","4":"1千万以上5千万未満"},{"1":"25469.4537","2":"23","3":"18776707","4":"1千万以上5千万未満"},{"1":"4104.9732","2":"48","3":"53771296","4":"5千万以上1億未満"},{"1":"39921.9598","2":"83","3":"51269185","4":"5千万以上1億未満"},{"1":"11077.9066","2":"56","3":"1810463","4":"1千万未満"},{"1":"50094.7321","2":"36","3":"4270571","4":"1千万未満"},{"1":"5083.2110","2":"39","3":"6524195","4":"1千万未満"},{"1":"7548.9488","2":"14","3":"7275560","4":"1千万未満"},{"1":"31412.6831","2":"89","3":"1886198","4":"1千万未満"},{"1":"16473.3669","2":"44","3":"6825445","4":"1千万未満"},{"1":"3019.3082","2":"63","3":"2142249","4":"1千万未満"},{"1":"1461.0965","2":"60","3":"5057681","4":"1千万未満"},{"1":"14018.7988","2":"9","3":"6871292","4":"1千万未満"},{"1":"NA","2":"90","3":"38128","4":"1千万未満"},{"1":"36875.0342","2":"91","3":"2722289","4":"1千万未満"},{"1":"113423.0596","2":"98","3":"625978","4":"1千万未満"},{"1":"1567.1475","2":"61","3":"27691018","4":"1千万以上5千万未満"},{"1":"1016.0831","2":"62","3":"19129952","4":"1千万以上5千万未満"},{"1":"27477.8789","2":"52","3":"32365999","4":"1千万以上5千万未満"},{"1":"18087.8337","2":"40","3":"540544","4":"1千万未満"},{"1":"2208.4879","2":"41","3":"20250833","4":"1千万以上5千万未満"},{"1":"47787.1238","2":"90","3":"441543","4":"1千万未満"},{"1":"3601.3961","2":"34","3":"4649658","4":"1千万未満"},{"1":"22636.5579","2":"89","3":"1271768","4":"1千万未満"},{"1":"19962.7134","2":"62","3":"128932753","4":"1億以上"},{"1":"8428.7387","2":"60","3":"4033963","4":"1千万未満"},{"1":"NA","2":"83","3":"39242","4":"1千万未満"},{"1":"11801.1341","2":"84","3":"3278290","4":"1千万未満"},{"1":"21103.4509","2":"62","3":"628066","4":"1千万未満"},{"1":"7553.9970","2":"37","3":"36910560","4":"1千万以上5千万未満"},{"1":"1246.5947","2":"45","3":"31255435","4":"1千万以上5千万未満"},{"1":"10314.3368","2":"77","3":"2540905","4":"1千万未満"},{"1":"3210.7175","2":"56","3":"29136808","4":"1千万以上5千万未満"},{"1":"57277.7441","2":"99","3":"17474830","4":"1千万以上5千万未満"},{"1":"42178.3087","2":"97","3":"4842780","4":"1千万未満"},{"1":"5693.5486","2":"31","3":"6624554","4":"1千万未満"},{"1":"824.0225","2":"48","3":"24206644","4":"1千万以上5千万未満"},{"1":"5018.4108","2":"47","3":"206139589","4":"1億以上"},{"1":"16621.5380","2":"63","3":"2083374","4":"1千万未満"},{"1":"66276.1460","2":"100","3":"5421241","4":"1千万未満"},{"1":"27700.1116","2":"23","3":"5106626","4":"1千万未満"},{"1":"4664.2272","2":"38","3":"220892340","4":"1億以上"},{"1":"30816.6420","2":"84","3":"4314767","4":"1千万未満"},{"1":"4171.1177","2":"62","3":"8947024","4":"1千万未満"},{"1":"12877.6194","2":"65","3":"7132538","4":"1千万未満"},{"1":"12703.5404","2":"72","3":"32971854","4":"1千万以上5千万未満"},{"1":"8098.7861","2":"59","3":"109581078","4":"1億以上"},{"1":"31863.2889","2":"84","3":"37846611","4":"1千万以上5千万未満"},{"1":"34564.8307","2":"96","3":"10196709","4":"1千万以上5千万未満"},{"1":"93465.6495","2":"25","3":"2881053","4":"1千万未満"},{"1":"29406.3768","2":"83","3":"19237691","4":"1千万以上5千万未満"},{"1":"28731.6417","2":"20","3":"145934462","4":"1億以上"},{"1":"2007.9457","2":"22","3":"12952218","4":"1千万以上5千万未満"},{"1":"26152.9352","2":"89","3":"53199","4":"1千万未満"},{"1":"13828.2497","2":"92","3":"183627","4":"1千万未満"},{"1":"12686.0465","2":"91","3":"110940","4":"1千万未満"},{"1":"62554.0067","2":"95","3":"33931","4":"1千万未満"},{"1":"3890.9194","2":"84","3":"219159","4":"1千万未満"},{"1":"47196.1314","2":"7","3":"34813871","4":"1千万以上5千万未満"},{"1":"3247.9262","2":"71","3":"16743927","4":"1千万以上5千万未満"},{"1":"14078.8608","2":"66","3":"8737371","4":"1千万未満"},{"1":"27788.1379","2":"72","3":"98347","4":"1千万未満"},{"1":"1634.0012","2":"65","3":"7976983","4":"1千万未満"},{"1":"95251.7682","2":"50","3":"5850342","4":"1千万未満"},{"1":"32539.7563","2":"88","3":"5459642","4":"1千万未満"},{"1":"38655.2365","2":"94","3":"2078938","4":"1千万未満"},{"1":"NA","2":"7","3":"15893222","4":"1千万以上5千万未満"},{"1":"12604.8540","2":"79","3":"59308690","4":"5千万以上1億未満"},{"1":"1410.1588","2":"2","3":"11193725","4":"1千万以上5千万未満"},{"1":"40519.7997","2":"92","3":"46754778","4":"1千万以上5千万未満"},{"1":"13413.5833","2":"56","3":"21413249","4":"1千万以上5千万未満"},{"1":"4062.9183","2":"12","3":"43849260","4":"1千万以上5千万未満"},{"1":"15858.2041","2":"75","3":"586632","4":"1千万未満"},{"1":"54212.5155","2":"100","3":"10099265","4":"1千万以上5千万未満"},{"1":"68233.1626","2":"96","3":"8654622","4":"1千万未満"},{"1":"NA","2":"0","3":"17500658","4":"1千万以上5千万未満"},{"1":"46145.2065","2":"93","3":"23816775","4":"1千万以上5千万未満"},{"1":"3161.7648","2":"9","3":"9537645","4":"1千万未満"},{"1":"2428.0001","2":"40","3":"59734218","4":"5千万以上1億未満"},{"1":"18383.5264","2":"32","3":"69799978","4":"5千万以上1億未満"},{"1":"3034.1425","2":"71","3":"1318445","4":"1千万未満"},{"1":"1515.5174","2":"44","3":"8278724","4":"1千万未満"},{"1":"26727.7104","2":"82","3":"1399488","4":"1千万未満"},{"1":"10773.4423","2":"70","3":"11818619","4":"1千万以上5千万未満"},{"1":"27465.4040","2":"32","3":"84339067","4":"5千万以上1億未満"},{"1":"1716.0125","2":"34","3":"45741007","4":"1千万以上5千万未満"},{"1":"12207.2364","2":"62","3":"43733762","4":"1千万以上5千万未満"},{"1":"65777.6772","2":"17","3":"9890402","4":"1千万未満"},{"1":"45596.2099","2":"94","3":"68517621","4":"5千万以上1億未満"},{"1":"61789.9681","2":"86","3":"334308644","4":"1億以上"},{"1":"21961.2261","2":"98","3":"3473730","4":"1千万未満"},{"1":"6792.9947","2":"10","3":"33469203","4":"1千万以上5千万未満"},{"1":"17806.3176","2":"16","3":"28435940","4":"1千万以上5千万未満"},{"1":"7627.6246","2":"20","3":"97338579","4":"5千万以上1億未満"},{"1":"1396.1051","2":"25","3":"5101414","4":"1千万未満"},{"1":"NA","2":"4","3":"597339","4":"1千万未満"},{"1":"3083.9573","2":"11","3":"29825964","4":"1千万以上5千万未満"},{"1":"3396.9366","2":"54","3":"18383955","4":"1千万以上5千万未満"},{"1":"3264.8320","2":"29","3":"14862924","4":"1千万以上5千万未満"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>あとはこれまでの例と同じ手順となります。まず、データを<code>Group</code>変数でグループ化し、入れ子構造に変換します。</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb148-1"><a href="iteration.html#cb148-1"></a>Country_df2 &lt;-<span class="st"> </span>Country_df2 <span class="op">%&gt;%</span></span>
<span id="cb148-2"><a href="iteration.html#cb148-2"></a><span class="st">  </span><span class="kw">group_by</span>(Group) <span class="op">%&gt;%</span></span>
<span id="cb148-3"><a href="iteration.html#cb148-3"></a><span class="st">  </span><span class="kw">nest</span>()</span></code></pre></div>
<p>変換後のデータを確認してみます。</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb149-1"><a href="iteration.html#cb149-1"></a>Country_df2</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Group"],"name":[1],"type":["chr"],"align":["left"]},{"label":["data"],"name":[2],"type":["list"],"align":["right"]}],"data":[{"1":"1千万以上5千万未満","2":"<tbl_df[,3]>"},{"1":"1千万未満","2":"<tbl_df[,3]>"},{"1":"1億以上","2":"<tbl_df[,3]>"},{"1":"5千万以上1億未満","2":"<tbl_df[,3]>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>続いて、<code>data</code>列をデータとし、<code>map()</code>関数でモデルの推定をしてみましょう。目的変数は所得水準、説明変数は政治的自由度とします。推定後、{broom}の<code>tidy()</code>変数で推定値の情報のみを抽出し、入れ子構造を解除します。最後に<code>term</code>がFH_Totalの行のみを残します。</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb150-1"><a href="iteration.html#cb150-1"></a>Country_df2 &lt;-<span class="st"> </span>Country_df2 <span class="op">%&gt;%</span></span>
<span id="cb150-2"><a href="iteration.html#cb150-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Model =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="kw">lm</span>(PPP_per_capita <span class="op">~</span><span class="st"> </span>FH_Total, <span class="dt">data =</span> .x)),</span>
<span id="cb150-3"><a href="iteration.html#cb150-3"></a>         <span class="dt">Est   =</span> <span class="kw">map</span>(Model, broom<span class="op">::</span>tidy, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb150-4"><a href="iteration.html#cb150-4"></a><span class="st">  </span><span class="kw">unnest</span>(Est) <span class="op">%&gt;%</span></span>
<span id="cb150-5"><a href="iteration.html#cb150-5"></a><span class="st">  </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;FH_Total&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb150-6"><a href="iteration.html#cb150-6"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">!</span>term)</span></code></pre></div>
<div class="sourceCode" id="cb151"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb151-1"><a href="iteration.html#cb151-1"></a>Country_df2</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Group"],"name":[1],"type":["chr"],"align":["left"]},{"label":["data"],"name":[2],"type":["list"],"align":["right"]},{"label":["Model"],"name":[3],"type":["list"],"align":["right"]},{"label":["estimate"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"1千万以上5千万未満","2":"<tbl_df[,3]>","3":"<S3: lm>","4":"365.7877","5":"59.59901","6":"6.137479","7":"9.074519e-08","8":"246.39651","9":"485.1788"},{"1":"1千万未満","2":"<tbl_df[,3]>","3":"<S3: lm>","4":"245.7539","5":"83.00962","6":"2.960547","7":"3.935840e-03","8":"80.81551","9":"410.6922"},{"1":"1億以上","2":"<tbl_df[,3]>","3":"<S3: lm>","4":"324.8032","5":"158.00853","6":"2.055605","7":"6.225240e-02","8":"-19.46781","9":"669.0742"},{"1":"5千万以上1億未満","2":"<tbl_df[,3]>","3":"<S3: lm>","4":"486.6669","5":"101.36046","6":"4.801348","7":"3.460037e-04","8":"267.69093","9":"705.6429"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>せっかくなので推定結果を可視化してみましょう。横軸は人口規模（<code>Group</code>）とし、縦軸は推定値とします。係数の点推定値と95%信頼区間を同時に出力するために、<code>geom_pointrange()</code>幾何オブジェクトを使用します。</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb152-1"><a href="iteration.html#cb152-1"></a>Country_df2 <span class="op">%&gt;%</span></span>
<span id="cb152-2"><a href="iteration.html#cb152-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb152-3"><a href="iteration.html#cb152-3"></a>    <span class="co"># 横軸の表示順番を指定するために、Group変数をfactor化する</span></span>
<span id="cb152-4"><a href="iteration.html#cb152-4"></a>    <span class="dt">Group =</span> <span class="kw">factor</span>(Group, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;1千万未満&quot;</span>, <span class="st">&quot;1千万以上5千万未満&quot;</span>,</span>
<span id="cb152-5"><a href="iteration.html#cb152-5"></a>                                     <span class="st">&quot;5千万以上1億未満&quot;</span>, <span class="st">&quot;1億以上&quot;</span>)),</span>
<span id="cb152-6"><a href="iteration.html#cb152-6"></a>    <span class="co"># 統計的有意か否かを表すSig変数の作成</span></span>
<span id="cb152-7"><a href="iteration.html#cb152-7"></a>    <span class="dt">Sig   =</span> <span class="kw">if_else</span>(conf.low <span class="op">*</span><span class="st"> </span>conf.high <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;統計的有意&quot;</span>, <span class="st">&quot;統計的非有意&quot;</span>)</span>
<span id="cb152-8"><a href="iteration.html#cb152-8"></a>    ) <span class="op">%&gt;%</span></span>
<span id="cb152-9"><a href="iteration.html#cb152-9"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb152-10"><a href="iteration.html#cb152-10"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb152-11"><a href="iteration.html#cb152-11"></a><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Group, <span class="dt">y =</span> estimate, </span>
<span id="cb152-12"><a href="iteration.html#cb152-12"></a>                      <span class="dt">ymin =</span> conf.low, <span class="dt">ymax =</span> conf.high, <span class="dt">color =</span> Sig), </span>
<span id="cb152-13"><a href="iteration.html#cb152-13"></a>                  <span class="dt">size =</span> <span class="fl">0.75</span>) <span class="op">+</span></span>
<span id="cb152-14"><a href="iteration.html#cb152-14"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;人口&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;政治的自由度が所得に与える影響&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;&quot;</span>) <span class="op">+</span></span>
<span id="cb152-15"><a href="iteration.html#cb152-15"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;統計的有意&quot;</span> =<span class="st"> &quot;black&quot;</span>,</span>
<span id="cb152-16"><a href="iteration.html#cb152-16"></a>                                <span class="st">&quot;統計的非有意&quot;</span> =<span class="st"> &quot;gray70&quot;</span>)) <span class="op">+</span></span>
<span id="cb152-17"><a href="iteration.html#cb152-17"></a><span class="st">  </span><span class="kw">theme_minimal</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>,</span>
<span id="cb152-18"><a href="iteration.html#cb152-18"></a>                <span class="dt">base_size   =</span> <span class="dv">12</span>) <span class="op">+</span></span>
<span id="cb152-19"><a href="iteration.html#cb152-19"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-110-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>政治的自由度が高くなるほど所得水準も高くなる傾向が確認されますが、人口が1億人以上の国においてはそのような傾向が見られないことが分かります。</p>
<p>上記の例は、ある行は一つのグループに属するケースです。しかし、ある行が複数のグループに属するケースもあるでしょう。たとえば、ある変数の値が一定値以上である行のみでグループ化する場合です。<code>FH_Score</code>が一定値以上のSub-sampleに対して回帰分析を行う場合、<code>FH_Score</code>が最大値（100）である国はすべてのSub-sampleに属することになります。この場合は<code>group_by()</code>でグループ化することが難しいかも知れません。しかし、{dplyr}の<code>filter()</code>を使えば簡単に処理することができます。</p>
<p>ここでは人口を説明変数に、所得水準を応答変数とした単回帰分析を行います。データは政治的自由度が一定値以上の国家のみに限定します。<code>FH_Score</code>が0以上の国（すべてのケース）、10以上の国、20以上の国、…などにサンプルを分割してみましょう。まずは<code>FH_Score</code>の最小値のみを格納した<code>Rnage_df</code>を作成します。</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb153-1"><a href="iteration.html#cb153-1"></a>Range_df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">Min_FH =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">80</span>, <span class="dt">by =</span> <span class="dv">10</span>))</span>
<span id="cb153-2"><a href="iteration.html#cb153-2"></a></span>
<span id="cb153-3"><a href="iteration.html#cb153-3"></a>Range_df</span></code></pre></div>
<pre><code>## # A tibble: 9 x 1
##   Min_FH
##    &lt;dbl&gt;
## 1      0
## 2     10
## 3     20
## 4     30
## 5     40
## 6     50
## 7     60
## 8     70
## 9     80</code></pre>
<p>9行1列のtibbleが出来ました。続いて、<code>Subset</code>という列を生成し、ここにデータを入れてみましょう。ある変数の値を基準にサンプルを絞るには{dplyr}の<code>filter()</code>関数を使用します。たとえば、<code>Counter_df</code>の<code>FH_Total</code>が50以上のケースに絞るには<code>filter(Country_df, FH_Total &gt;= 50)</code>となります。パイプ演算子を使った場合は<code>Country_df %&gt;% filter(FH_Total &gt;= 50)</code>になりますが、ラムダ式とパイプ演算子の相性はあまり良くありませんので、ここではパイプ演算子なしとします。重要なのは<code>Min_FH</code>の値をデータとした<code>map()</code>関数を実行し、実行内容を「<code>Country_df</code>から<code>FH_Total</code>が<code>Min_FH</code>以上のケースのみを抽出せよ」にすることです。</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb155-1"><a href="iteration.html#cb155-1"></a>Range_df &lt;-<span class="st"> </span>Range_df <span class="op">%&gt;%</span></span>
<span id="cb155-2"><a href="iteration.html#cb155-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Subset =</span> <span class="kw">map</span>(Min_FH, <span class="op">~</span><span class="kw">filter</span>(Country_df, FH_Total <span class="op">&gt;=</span><span class="st"> </span>.x)))</span></code></pre></div>
<div class="sourceCode" id="cb156"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb156-1"><a href="iteration.html#cb156-1"></a>Range_df</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Min_FH"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Subset"],"name":[2],"type":["list"],"align":["right"]}],"data":[{"1":"0","2":"<spec_tbl_df[,18]>"},{"1":"10","2":"<spec_tbl_df[,18]>"},{"1":"20","2":"<spec_tbl_df[,18]>"},{"1":"30","2":"<spec_tbl_df[,18]>"},{"1":"40","2":"<spec_tbl_df[,18]>"},{"1":"50","2":"<spec_tbl_df[,18]>"},{"1":"60","2":"<spec_tbl_df[,18]>"},{"1":"70","2":"<spec_tbl_df[,18]>"},{"1":"80","2":"<spec_tbl_df[,18]>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>入れ子構造になっているのは確認できましたが、ちゃんとフィルタリングされているかどうかも確認してみましょう。たとえば、<code>Range_df$Subset[[9]]</code>だと<code>FH_Total</code>が80以上の国に絞られていると考えられます。18列の表ですから<code>Country</code>と<code>FH_Total</code>列のみを確認してみましょう。</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb157-1"><a href="iteration.html#cb157-1"></a>Range_df<span class="op">$</span>Subset[[<span class="dv">9</span>]] <span class="op">%&gt;%</span></span>
<span id="cb157-2"><a href="iteration.html#cb157-2"></a><span class="st">  </span><span class="kw">select</span>(Country, FH_Total)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Country"],"name":[1],"type":["chr"],"align":["left"]},{"label":["FH_Total"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"Andorra","2":"94"},{"1":"Antigua and Barbuda","2":"85"},{"1":"Argentina","2":"85"},{"1":"Australia","2":"97"},{"1":"Austria","2":"93"},{"1":"Bahamas","2":"91"},{"1":"Barbados","2":"95"},{"1":"Belgium","2":"96"},{"1":"Belize","2":"86"},{"1":"Bulgaria","2":"80"},{"1":"Cabo Verde","2":"92"},{"1":"Canada","2":"98"},{"1":"Chile","2":"90"},{"1":"Costa Rica","2":"91"},{"1":"Croatia","2":"85"},{"1":"Cyprus","2":"94"},{"1":"Czechia","2":"91"},{"1":"Denmark","2":"97"},{"1":"Dominica","2":"93"},{"1":"Estonia","2":"94"},{"1":"Finland","2":"100"},{"1":"France","2":"90"},{"1":"Germany","2":"94"},{"1":"Ghana","2":"82"},{"1":"Greece","2":"88"},{"1":"Grenada","2":"89"},{"1":"Iceland","2":"94"},{"1":"Ireland","2":"97"},{"1":"Italy","2":"89"},{"1":"Japan","2":"96"},{"1":"South Korea","2":"83"},{"1":"Latvia","2":"89"},{"1":"Liechtenstein","2":"90"},{"1":"Lithuania","2":"91"},{"1":"Luxembourg","2":"98"},{"1":"Malta","2":"90"},{"1":"Mauritius","2":"89"},{"1":"Monaco","2":"83"},{"1":"Mongolia","2":"84"},{"1":"Netherlands","2":"99"},{"1":"New Zealand","2":"97"},{"1":"Norway","2":"100"},{"1":"Panama","2":"84"},{"1":"Poland","2":"84"},{"1":"Portugal","2":"96"},{"1":"Romania","2":"83"},{"1":"Saint Kitts and Nevis","2":"89"},{"1":"Saint Lucia","2":"92"},{"1":"Saint Vincent and the Grenadines","2":"91"},{"1":"San Marino","2":"95"},{"1":"Sao Tome and Principe","2":"84"},{"1":"Slovakia","2":"88"},{"1":"Slovenia","2":"94"},{"1":"Spain","2":"92"},{"1":"Sweden","2":"100"},{"1":"Switzerland","2":"96"},{"1":"Taiwan","2":"93"},{"1":"Trinidad and Tobago","2":"82"},{"1":"United Kingdom","2":"94"},{"1":"United States","2":"86"},{"1":"Uruguay","2":"98"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>問題なくフィルタリングされているようですね。ここまで出来ればあとはこれまでの内容の復習でしょう。</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb158-1"><a href="iteration.html#cb158-1"></a>Range_df &lt;-<span class="st"> </span>Range_df <span class="op">%&gt;%</span></span>
<span id="cb158-2"><a href="iteration.html#cb158-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Model  =</span> <span class="kw">map</span>(Subset, <span class="op">~</span><span class="kw">lm</span>(PPP_per_capita <span class="op">~</span><span class="st"> </span>Population, <span class="dt">data =</span> .x)),</span>
<span id="cb158-3"><a href="iteration.html#cb158-3"></a>         <span class="dt">Model  =</span> <span class="kw">map</span>(Model,  broom<span class="op">::</span>tidy, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb158-4"><a href="iteration.html#cb158-4"></a><span class="st">  </span><span class="kw">unnest</span>(<span class="dt">cols =</span> Model) <span class="op">%&gt;%</span></span>
<span id="cb158-5"><a href="iteration.html#cb158-5"></a><span class="st">  </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;Population&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb158-6"><a href="iteration.html#cb158-6"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(Subset, term))</span></code></pre></div>
<p>今回も可視化してみましょう。</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb159-1"><a href="iteration.html#cb159-1"></a>Range_df <span class="op">%&gt;%</span></span>
<span id="cb159-2"><a href="iteration.html#cb159-2"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb159-3"><a href="iteration.html#cb159-3"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb159-4"><a href="iteration.html#cb159-4"></a><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Min_FH, <span class="dt">y =</span> estimate, </span>
<span id="cb159-5"><a href="iteration.html#cb159-5"></a>                      <span class="dt">ymin =</span> conf.low, <span class="dt">ymax =</span> conf.high)) <span class="op">+</span></span>
<span id="cb159-6"><a href="iteration.html#cb159-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;データ内FH_Scoreの最小値&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Populationの係数&quot;</span>) <span class="op">+</span></span>
<span id="cb159-7"><a href="iteration.html#cb159-7"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">80</span>, <span class="dt">by =</span> <span class="dv">10</span>),</span>
<span id="cb159-8"><a href="iteration.html#cb159-8"></a>                     <span class="dt">labels =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">80</span>, <span class="dt">by =</span> <span class="dv">10</span>)) <span class="op">+</span></span>
<span id="cb159-9"><a href="iteration.html#cb159-9"></a><span class="st">  </span><span class="kw">theme_minimal</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-118-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>以上の例は実際の分析では多く使われる方法ではないかも知れません。しかし、ノンパラメトリック回帰不連続デザイン（Regression Discontinuity Design; RDD）の場合、感度分析を行う際、バンド幅を色々と調整しながら局所処置効果を推定します。RDDの詳細については<a href="https://yukiyanai.github.io/econometrics2/regression-discontinuity.html">矢内の授業資料</a>、および<a href="https://www.jaysong.net/post/kobe2020-qpm1/">SONGの授業資料</a>などに譲りますが、ハンド幅の調整はデータの範囲を少しずつ拡張（縮小）させながら同じ分析を繰り返すことです。以下ではアメリカ上院選挙のデータを例に、方法を紹介します。</p>
<p>使用するデータは{rdrobust}パッケージが提供する<code>rdrobust_RDsenate</code>というデータセットです。{pacman}パッケージの<code>p_load()</code>関数を使ってパッケージのインストールと読み込みを行い、<code>data()</code>関数を使って、データを読み込みます。</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb160-1"><a href="iteration.html#cb160-1"></a>pacman<span class="op">::</span><span class="kw">p_load</span>(rdrobust)  <span class="co"># {rdrobust}のインストール &amp; 読み込み</span></span>
<span id="cb160-2"><a href="iteration.html#cb160-2"></a><span class="kw">data</span>(<span class="st">&quot;rdrobust_RDsenate&quot;</span>) <span class="co"># rdrobust_RDsenateデータの読み込み</span></span>
<span id="cb160-3"><a href="iteration.html#cb160-3"></a></span>
<span id="cb160-4"><a href="iteration.html#cb160-4"></a><span class="co"># データをSenate_dfという名で格納</span></span>
<span id="cb160-5"><a href="iteration.html#cb160-5"></a>Senate_df &lt;-<span class="st"> </span>rdrobust_RDsenate</span></code></pre></div>
<div class="sourceCode" id="cb161"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb161-1"><a href="iteration.html#cb161-1"></a>RDD_df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">BW =</span> <span class="kw">seq</span>(<span class="dv">100</span>, <span class="dv">10</span>, <span class="dt">by =</span> <span class="dv">-5</span>))</span>
<span id="cb161-2"><a href="iteration.html#cb161-2"></a></span>
<span id="cb161-3"><a href="iteration.html#cb161-3"></a>RDD_df &lt;-<span class="st"> </span>RDD_df <span class="op">%&gt;%</span></span>
<span id="cb161-4"><a href="iteration.html#cb161-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Subset =</span> <span class="kw">map</span>(BW, <span class="op">~</span><span class="kw">filter</span>(Senate_df, margin <span class="op">&gt;=</span><span class="st"> </span><span class="op">-</span>.x <span class="op">&amp;</span><span class="st"> </span>margin <span class="op">&lt;=</span><span class="st"> </span>.x)))</span></code></pre></div>
<div class="sourceCode" id="cb162"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb162-1"><a href="iteration.html#cb162-1"></a>RDD_df</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["BW"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Subset"],"name":[2],"type":["list"],"align":["right"]}],"data":[{"1":"100","2":"<df[,2] [1,390 × 2]>"},{"1":"95","2":"<df[,2] [1,327 × 2]>"},{"1":"90","2":"<df[,2] [1,319 × 2]>"},{"1":"85","2":"<df[,2] [1,308 × 2]>"},{"1":"80","2":"<df[,2] [1,303 × 2]>"},{"1":"75","2":"<df[,2] [1,294 × 2]>"},{"1":"70","2":"<df[,2] [1,287 × 2]>"},{"1":"65","2":"<df[,2] [1,270 × 2]>"},{"1":"60","2":"<df[,2] [1,256 × 2]>"},{"1":"55","2":"<df[,2] [1,237 × 2]>"},{"1":"50","2":"<df[,2] [1,211 × 2]>"},{"1":"45","2":"<df[,2] [1,178 × 2]>"},{"1":"40","2":"<df[,2] [1,128 × 2]>"},{"1":"35","2":"<df[,2] [1,077 × 2]>"},{"1":"30","2":"<df[,2] [995 × 2]>"},{"1":"25","2":"<df[,2] [901 × 2]>"},{"1":"20","2":"<df[,2] [778 × 2]>"},{"1":"15","2":"<df[,2] [639 × 2]>"},{"1":"10","2":"<df[,2] [471 × 2]>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb163"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb163-1"><a href="iteration.html#cb163-1"></a>RDD_df <span class="op">%&gt;%</span></span>
<span id="cb163-2"><a href="iteration.html#cb163-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Model  =</span> <span class="kw">map</span>(Subset, <span class="op">~</span><span class="kw">lm</span>(vote <span class="op">~</span><span class="st"> </span>margin <span class="op">*</span><span class="st"> </span><span class="kw">I</span>(margin <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>), <span class="dt">data =</span> .x)),</span>
<span id="cb163-3"><a href="iteration.html#cb163-3"></a>         <span class="dt">Est    =</span> <span class="kw">map</span>(Model, broom<span class="op">::</span>tidy, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb163-4"><a href="iteration.html#cb163-4"></a><span class="st">  </span><span class="kw">unnest</span>(Est) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-5"><a href="iteration.html#cb163-5"></a><span class="st">  </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;I(margin &gt; 0)TRUE&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb163-6"><a href="iteration.html#cb163-6"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">!</span><span class="kw">c</span>(Subset, Model, term))</span></code></pre></div>
<pre><code>## # A tibble: 19 x 7
##       BW estimate std.error statistic  p.value conf.low conf.high
##    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1   100     6.04     0.942      6.41 1.98e-10     4.20      7.89
##  2    95     5.76     0.975      5.90 4.58e- 9     3.85      7.67
##  3    90     5.90     0.981      6.02 2.37e- 9     3.98      7.83
##  4    85     5.80     0.993      5.84 6.64e- 9     3.85      7.75
##  5    80     5.10     0.999      5.11 3.84e- 7     3.14      7.06
##  6    75     5.18     1.01       5.16 2.96e- 7     3.21      7.15
##  7    70     5.57     1.01       5.51 4.44e- 8     3.58      7.55
##  8    65     5.21     1.03       5.08 4.28e- 7     3.20      7.23
##  9    60     4.89     1.04       4.72 2.71e- 6     2.86      6.93
## 10    55     5.23     1.05       4.98 7.36e- 7     3.17      7.29
## 11    50     5.73     1.07       5.37 9.38e- 8     3.64      7.82
## 12    45     5.94     1.09       5.44 6.45e- 8     3.80      8.09
## 13    40     6.12     1.12       5.45 6.24e- 8     3.92      8.33
## 14    35     6.34     1.15       5.53 4.09e- 8     4.09      8.59
## 15    30     7.18     1.18       6.08 1.75e- 9     4.86      9.50
## 16    25     7.38     1.21       6.09 1.72e- 9     5.00      9.76
## 17    20     7.03     1.32       5.31 1.42e- 7     4.43      9.62
## 18    15     6.96     1.50       4.63 4.47e- 6     4.01      9.92
## 19    10     6.90     1.75       3.94 9.45e- 5     3.46     10.3</code></pre>
<p>以上の例は、交互作用ありの線形回帰分析による局所処置効果の推定例です。しかし、ノンパラメトリックRDDでは、割当変数（running variable）の二乗項を入れる場合が多いです。今回の割当変数は<code>margin</code>です。また、閾値（cutpoint）に近いケースには高い重みを付けることが一般的な作法であり、多く使われるのが三角（triangular）カーネルです。上記の例はすべてのケースに同じ重みを付ける矩形（rectagular）カーネルを使った例です。</p>
<p>以上の理由により、やはりRDDは専用のパッケージを使った方が良いかも知れません。既に読み込んである{rdrobust}も推定可能ですが、ここでは{rdd}パッケージを使ってみましょう。</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb165-1"><a href="iteration.html#cb165-1"></a><span class="co"># cutpoint引数の既定値は0であるため、今回の例では省略可能</span></span>
<span id="cb165-2"><a href="iteration.html#cb165-2"></a><span class="kw">RDestimate</span>(応答変数 <span class="op">~</span><span class="st"> </span>割当変数, <span class="dt">data =</span> データオブジェクト, </span>
<span id="cb165-3"><a href="iteration.html#cb165-3"></a>               <span class="dt">cutpoint =</span> 閾値, <span class="dt">bw =</span> バンド幅)</span></code></pre></div>
<div class="sourceCode" id="cb166"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb166-1"><a href="iteration.html#cb166-1"></a><span class="kw">library</span>(rdd)</span>
<span id="cb166-2"><a href="iteration.html#cb166-2"></a></span>
<span id="cb166-3"><a href="iteration.html#cb166-3"></a><span class="co"># バンド幅を指定したRDD推定</span></span>
<span id="cb166-4"><a href="iteration.html#cb166-4"></a>RDD_Fit &lt;-<span class="st"> </span><span class="kw">RDestimate</span>(vote <span class="op">~</span><span class="st"> </span>margin, <span class="dt">data =</span> Senate_df, <span class="dt">bw =</span> <span class="dv">25</span>)</span>
<span id="cb166-5"><a href="iteration.html#cb166-5"></a></span>
<span id="cb166-6"><a href="iteration.html#cb166-6"></a><span class="co"># RDDの推定結果を見る</span></span>
<span id="cb166-7"><a href="iteration.html#cb166-7"></a><span class="kw">summary</span>(RDD_Fit)</span></code></pre></div>
<pre><code>## 
## Call:
## RDestimate(formula = vote ~ margin, data = Senate_df, bw = 25)
## 
## Type:
## sharp 
## 
## Estimates:
##            Bandwidth  Observations  Estimate  Std. Error  z value  Pr(&gt;|z|) 
## LATE       25.0        845          7.104     1.260       5.640    1.699e-08
## Half-BW    12.5        536          7.620     1.682       4.531    5.859e-06
## Double-BW  50.0       1127          6.480     1.004       6.455    1.084e-10
##               
## LATE       ***
## Half-BW    ***
## Double-BW  ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## F-statistics:
##            F       Num. DoF  Denom. DoF  p
## LATE        90.20  3          841        0
## Half-BW     42.75  3          532        0
## Double-BW  179.75  3         1123        0</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb168-1"><a href="iteration.html#cb168-1"></a><span class="co"># 推定値の情報がどこに格納されているかを確認</span></span>
<span id="cb168-2"><a href="iteration.html#cb168-2"></a><span class="kw">str</span>(RDD_Fit)</span></code></pre></div>
<pre><code>## List of 12
##  $ type     : chr &quot;sharp&quot;
##  $ call     : language RDestimate(formula = vote ~ margin, data = Senate_df, bw = 25)
##  $ est      : Named num [1:3] 7.1 7.62 6.48
##   ..- attr(*, &quot;names&quot;)= chr [1:3] &quot;LATE&quot; &quot;Half-BW&quot; &quot;Double-BW&quot;
##  $ bw       : num [1:3] 25 12.5 50
##  $ se       : num [1:3] 1.26 1.68 1
##  $ z        : num [1:3] 5.64 4.53 6.45
##  $ p        : num [1:3] 1.70e-08 5.86e-06 1.08e-10
##  $ obs      : num [1:3] 845 536 1127
##  $ ci       : num [1:3, 1:2] 4.64 4.32 4.51 9.57 10.92 ...
##  $ model    : list()
##  $ frame    : list()
##  $ na.action: int [1:93] 28 29 57 58 86 113 114 142 143 168 ...
##  - attr(*, &quot;class&quot;)= chr &quot;RD&quot;</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb170-1"><a href="iteration.html#cb170-1"></a><span class="co"># est要素の1番目の要素がLATE</span></span>
<span id="cb170-2"><a href="iteration.html#cb170-2"></a>RDD_Fit<span class="op">$</span>est</span></code></pre></div>
<pre><code>##      LATE   Half-BW Double-BW 
##  7.104054  7.619927  6.480344</code></pre>
<div class="sourceCode" id="cb172"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb172-1"><a href="iteration.html#cb172-1"></a><span class="co"># se要素の1番目の要素がLATEの標準誤差</span></span>
<span id="cb172-2"><a href="iteration.html#cb172-2"></a>RDD_Fit<span class="op">$</span>se</span></code></pre></div>
<pre><code>## [1] 1.259550 1.681578 1.003973</code></pre>
<div class="sourceCode" id="cb174"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb174-1"><a href="iteration.html#cb174-1"></a>RDD_df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">BW =</span> <span class="kw">seq</span>(<span class="dv">100</span>, <span class="dv">10</span>, <span class="dt">by =</span> <span class="dv">-5</span>))</span>
<span id="cb174-2"><a href="iteration.html#cb174-2"></a></span>
<span id="cb174-3"><a href="iteration.html#cb174-3"></a>RDD_Func &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb174-4"><a href="iteration.html#cb174-4"></a>  Temp_Est &lt;-<span class="st"> </span><span class="kw">RDestimate</span>(vote <span class="op">~</span><span class="st"> </span>margin, <span class="dt">data =</span> Senate_df, <span class="dt">bw =</span> x)</span>
<span id="cb174-5"><a href="iteration.html#cb174-5"></a>  <span class="kw">tibble</span>(<span class="dt">LATE =</span> Temp_Est<span class="op">$</span>est[<span class="dv">1</span>],</span>
<span id="cb174-6"><a href="iteration.html#cb174-6"></a>         <span class="dt">SE   =</span> Temp_Est<span class="op">$</span>se[<span class="dv">1</span>])</span>
<span id="cb174-7"><a href="iteration.html#cb174-7"></a>}</span>
<span id="cb174-8"><a href="iteration.html#cb174-8"></a></span>
<span id="cb174-9"><a href="iteration.html#cb174-9"></a>RDD_df &lt;-<span class="st"> </span>RDD_df <span class="op">%&gt;%</span></span>
<span id="cb174-10"><a href="iteration.html#cb174-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">RDD  =</span> <span class="kw">map</span>(BW, RDD_Func)) <span class="op">%&gt;%</span></span>
<span id="cb174-11"><a href="iteration.html#cb174-11"></a><span class="st">  </span><span class="kw">unnest</span>(RDD)</span>
<span id="cb174-12"><a href="iteration.html#cb174-12"></a></span>
<span id="cb174-13"><a href="iteration.html#cb174-13"></a>RDD_df</span></code></pre></div>
<pre><code>## # A tibble: 19 x 3
##       BW  LATE    SE
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1   100  5.64 0.884
##  2    95  5.64 0.890
##  3    90  5.63 0.897
##  4    85  5.61 0.905
##  5    80  5.65 0.913
##  6    75  5.75 0.922
##  7    70  5.81 0.934
##  8    65  5.91 0.949
##  9    60  6.07 0.963
## 10    55  6.29 0.982
## 11    50  6.48 1.00 
## 12    45  6.67 1.03 
## 13    40  6.91 1.07 
## 14    35  7.19 1.11 
## 15    30  7.28 1.17 
## 16    25  7.10 1.26 
## 17    20  7.27 1.38 
## 18    15  7.49 1.57 
## 19    10  7.98 1.84</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb176-1"><a href="iteration.html#cb176-1"></a>RDD_df <span class="op">%&gt;%</span></span>
<span id="cb176-2"><a href="iteration.html#cb176-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">CI_lwr =</span> LATE <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.025</span>) <span class="op">*</span><span class="st"> </span>SE,</span>
<span id="cb176-3"><a href="iteration.html#cb176-3"></a>         <span class="dt">CI_upr =</span> LATE <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.975</span>) <span class="op">*</span><span class="st"> </span>SE) <span class="op">%&gt;%</span></span>
<span id="cb176-4"><a href="iteration.html#cb176-4"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb176-5"><a href="iteration.html#cb176-5"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb176-6"><a href="iteration.html#cb176-6"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> BW, <span class="dt">ymin =</span> CI_lwr, <span class="dt">ymax =</span> CI_upr), <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb176-7"><a href="iteration.html#cb176-7"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> BW, <span class="dt">y =</span> LATE), <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb176-8"><a href="iteration.html#cb176-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Bandwidth&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Local Average Treatment Effect (%p)&quot;</span>) <span class="op">+</span></span>
<span id="cb176-9"><a href="iteration.html#cb176-9"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-125-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="iteration-variables" class="section level3" number="24.5.4">
<h3><span class="header-section-number">24.5.4</span> 説明・応答変数を指定したモデル推定</h3>
<p>バランスチェックの例（応答変数を変えながら推定）</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>引数が2つなら<code>.x</code>と<code>.y</code>を使用します。もし3つ以上なら<code>..1</code>、<code>..2</code>、<code>..3</code>、…と表記します。<a href="iteration.html#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>実は今回の例のように要素を抽出する場合、<code>`[`</code>すら要りません。<code>map_dbl(num_list, 3)</code>だけで十分です。<a href="iteration.html#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p><code>paste()</code>関数は<code>sep =</code>以外はすべて結合の対象となります。引数が4つ以上になることもあります。たとえば、<code>paste("We", "love", "cats!", sep = " ")</code>です。<a href="iteration.html#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>ただしtibbleは<code>tibble名[3, 2:4] &lt;- c("A", "B", "C")</code>のような、列をまたがった値の代入は出来ません。これによってtibbleに対応しない関数もまだあります。この場合、<code>as.data.frame()</code>を使って一旦データフレームに変換する必要があります。<a href="iteration.html#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>{tidyverse}のコア・パッケージであるため、別途読み込む必要はございません。<a href="iteration.html#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p><code>cor.test()$estimate</code>で直接相関係数を抽出することも可能ですが、コードの可読性が著しく低下します。またオブジェクトの再利用（例えば、「今度は<em>p</em>値を抽出しよう！」）が出来なくなります。<a href="iteration.html#fnref6" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="scraping.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rmarkdown.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["R_Not_for_Everyone.pdf", "R_Not_for_Everyone.epub"],
"toc": {
"collapse": "section"
},
"toolbar": {
"position": "fixed"
}
});
});
</script>

</body>

</html>
