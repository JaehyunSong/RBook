<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>13. 整然データ構造 | 私たちのR: あなたのために書いたわけじゃない</title>
  <meta name="description" content="R Not for Everyone: It’s not for you." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="13. 整然データ構造 | 私たちのR: あなたのために書いたわけじゃない" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="R Not for Everyone: It’s not for you." />
  <meta name="github-repo" content="JaehyunSong/RBook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="13. 整然データ構造 | 私たちのR: あなたのために書いたわけじゃない" />
  
  <meta name="twitter:description" content="R Not for Everyone: It’s not for you." />
  

<meta name="author" content="宋財泫 (Jaehyun Song)・矢内勇生 (Yuki Yanai)" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="HTML/apple-favicon.png" />
  <link rel="shortcut icon" href="HTML/favicon.png" type="image/x-icon" />
<link rel="prev" href="factor.html"/>
<link rel="next" href="visualization.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-165592410-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-165592410-1');
  gtag('set', {'user_id': 'USER_ID'}); 
</script>

<meta name="google-site-verification" content="QJouPRaPKBPU1jDp6VaBuFbVV5imTI-Aazl_ScJwVgU" />


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="HTML/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">私たちのR</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> 紹介</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#progress"><i class="fa fa-check"></i><b>1.1</b> 進捗状況</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#about-purpose"><i class="fa fa-check"></i><b>1.2</b> 本書の目的と対象</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#about-author"><i class="fa fa-check"></i><b>1.3</b> 著者たち</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#about-toc"><i class="fa fa-check"></i><b>1.4</b> 本書の構成</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#about-download"><i class="fa fa-check"></i><b>1.5</b> データのダウンロード</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#about-copyright"><i class="fa fa-check"></i><b>1.6</b> 著作権</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="aboutR.html"><a href="aboutR.html"><i class="fa fa-check"></i><b>2</b> R?</a><ul>
<li class="chapter" data-level="2.1" data-path="aboutR.html"><a href="aboutR.html#WhatIsR"><i class="fa fa-check"></i><b>2.1</b> Rとは</a></li>
<li class="chapter" data-level="2.2" data-path="aboutR.html"><a href="aboutR.html#WhyR"><i class="fa fa-check"></i><b>2.2</b> Why R?</a></li>
<li class="chapter" data-level="2.3" data-path="aboutR.html"><a href="aboutR.html#GUI_IDE"><i class="fa fa-check"></i><b>2.3</b> GUIとIDE</a><ul>
<li class="chapter" data-level="2.3.1" data-path="aboutR.html"><a href="aboutR.html#gui"><i class="fa fa-check"></i><b>2.3.1</b> GUI</a></li>
<li class="chapter" data-level="2.3.2" data-path="aboutR.html"><a href="aboutR.html#aboutR-IDE"><i class="fa fa-check"></i><b>2.3.2</b> IDE</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>3</b> Rのインストール</a><ul>
<li class="chapter" data-level="3.1" data-path="installation.html"><a href="installation.html#install-R"><i class="fa fa-check"></i><b>3.1</b> Rのインストール</a><ul>
<li class="chapter" data-level="3.1.1" data-path="installation.html"><a href="installation.html#macosの場合"><i class="fa fa-check"></i><b>3.1.1</b> macOSの場合</a></li>
<li class="chapter" data-level="3.1.2" data-path="installation.html"><a href="installation.html#linuxの場合"><i class="fa fa-check"></i><b>3.1.2</b> Linuxの場合</a></li>
<li class="chapter" data-level="3.1.3" data-path="installation.html"><a href="installation.html#windowsの場合"><i class="fa fa-check"></i><b>3.1.3</b> Windowsの場合</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="installation.html"><a href="installation.html#rbasic-profile"><i class="fa fa-check"></i><b>3.2</b> .Rprofileの設定</a></li>
<li class="chapter" data-level="3.3" data-path="installation.html"><a href="installation.html#install-rstudio"><i class="fa fa-check"></i><b>3.3</b> RStudio</a><ul>
<li class="chapter" data-level="3.3.1" data-path="installation.html"><a href="installation.html#rstudioのインストール"><i class="fa fa-check"></i><b>3.3.1</b> RStudioのインストール</a></li>
<li class="chapter" data-level="3.3.2" data-path="installation.html"><a href="installation.html#rstudioの起動と設定"><i class="fa fa-check"></i><b>3.3.2</b> RStudioの起動と設定</a></li>
<li class="chapter" data-level="3.3.3" data-path="installation.html"><a href="installation.html#rstudioの設定"><i class="fa fa-check"></i><b>3.3.3</b> RStudioの設定</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="installation.html"><a href="installation.html#install-package"><i class="fa fa-check"></i><b>3.4</b> パッケージのインストール</a><ul>
<li class="chapter" data-level="3.4.1" data-path="installation.html"><a href="installation.html#パッケージのインストール"><i class="fa fa-check"></i><b>3.4.1</b> パッケージのインストール</a></li>
<li class="chapter" data-level="3.4.2" data-path="installation.html"><a href="installation.html#パッケージの読み込み"><i class="fa fa-check"></i><b>3.4.2</b> パッケージの読み込み</a></li>
<li class="chapter" data-level="3.4.3" data-path="installation.html"><a href="installation.html#必須パッケージのインストール"><i class="fa fa-check"></i><b>3.4.3</b> 必須パッケージのインストール</a></li>
<li class="chapter" data-level="3.4.4" data-path="installation.html"><a href="installation.html#パッケージのインストールが出来ない場合-ubuntu"><i class="fa fa-check"></i><b>3.4.4</b> パッケージのインストールが出来ない場合 (Ubuntu)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ide.html"><a href="ide.html"><i class="fa fa-check"></i><b>4</b> IDEの導入</a><ul>
<li class="chapter" data-level="4.1" data-path="ide.html"><a href="ide.html#ide-install"><i class="fa fa-check"></i><b>4.1</b> RStudioのインストールと起動</a><ul>
<li class="chapter" data-level="4.1.1" data-path="installation.html"><a href="installation.html#macosの場合"><i class="fa fa-check"></i><b>4.1.1</b> macOSの場合</a></li>
<li class="chapter" data-level="4.1.2" data-path="ide.html"><a href="ide.html#linux-ubuntuの場合"><i class="fa fa-check"></i><b>4.1.2</b> Linux (Ubuntu)の場合</a></li>
<li class="chapter" data-level="4.1.3" data-path="installation.html"><a href="installation.html#windowsの場合"><i class="fa fa-check"></i><b>4.1.3</b> Windowsの場合</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="ide.html"><a href="ide.html#ide-setting"><i class="fa fa-check"></i><b>4.2</b> RStudioの設定</a><ul>
<li class="chapter" data-level="4.2.1" data-path="ide.html"><a href="ide.html#設定画面の開き方"><i class="fa fa-check"></i><b>4.2.1</b> 設定画面の開き方</a></li>
<li class="chapter" data-level="4.2.2" data-path="ide.html"><a href="ide.html#私たちのrstudio"><i class="fa fa-check"></i><b>4.2.2</b> 私たちのRStudio</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="ide.html"><a href="ide.html#rstudio-cloudについて"><i class="fa fa-check"></i><b>4.3</b> RStudio Cloudについて</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="process.html"><a href="process.html"><i class="fa fa-check"></i><b>5</b> 分析の手順</a></li>
<li class="chapter" data-level="6" data-path="rbasic.html"><a href="rbasic.html"><i class="fa fa-check"></i><b>6</b> 基本的な操作</a><ul>
<li class="chapter" data-level="6.1" data-path="rbasic.html"><a href="rbasic.html#rbasic-project"><i class="fa fa-check"></i><b>6.1</b> 「プロジェクト」のすゝめ</a></li>
<li class="chapter" data-level="6.2" data-path="rbasic.html"><a href="rbasic.html#rbasic-calc"><i class="fa fa-check"></i><b>6.2</b> 電卓としてのR</a><ul>
<li class="chapter" data-level="6.2.1" data-path="rbasic.html"><a href="rbasic.html#算術演算子"><i class="fa fa-check"></i><b>6.2.1</b> 算術演算子</a></li>
<li class="chapter" data-level="6.2.2" data-path="rbasic.html"><a href="rbasic.html#論理演算子"><i class="fa fa-check"></i><b>6.2.2</b> 論理演算子</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="rbasic.html"><a href="rbasic.html#rbasic-input"><i class="fa fa-check"></i><b>6.3</b> 格納（代入）</a></li>
<li class="chapter" data-level="6.4" data-path="rbasic.html"><a href="rbasic.html#rbasic-extract"><i class="fa fa-check"></i><b>6.4</b> 要素の抽出</a></li>
<li class="chapter" data-level="6.5" data-path="rbasic.html"><a href="rbasic.html#rbasic-read"><i class="fa fa-check"></i><b>6.5</b> データの読み込み</a><ul>
<li class="chapter" data-level="6.5.1" data-path="rbasic.html"><a href="rbasic.html#csvファイルの場合"><i class="fa fa-check"></i><b>6.5.1</b> csvファイルの場合</a></li>
<li class="chapter" data-level="6.5.2" data-path="rbasic.html"><a href="rbasic.html#その他のフォーマット"><i class="fa fa-check"></i><b>6.5.2</b> その他のフォーマット</a></li>
<li class="chapter" data-level="6.5.3" data-path="rbasic.html"><a href="rbasic.html#rdataファイルの場合"><i class="fa fa-check"></i><b>6.5.3</b> RDataファイルの場合</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="rbasic.html"><a href="rbasic.html#rbasic-export"><i class="fa fa-check"></i><b>6.6</b> データの書き出し</a><ul>
<li class="chapter" data-level="6.6.1" data-path="rbasic.html"><a href="rbasic.html#csvファイル"><i class="fa fa-check"></i><b>6.6.1</b> csvファイル</a></li>
<li class="chapter" data-level="6.6.2" data-path="rbasic.html"><a href="rbasic.html#rdataファイル"><i class="fa fa-check"></i><b>6.6.2</b> RDataファイル</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="rbasic.html"><a href="rbasic.html#rbasic-exercise"><i class="fa fa-check"></i><b>6.7</b> 演習問題</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="datatype.html"><a href="datatype.html"><i class="fa fa-check"></i><b>7</b> データの型</a><ul>
<li class="chapter" data-level="7.1" data-path="datatype.html"><a href="datatype.html#WhatIsDatatype"><i class="fa fa-check"></i><b>7.1</b> データ型とは</a></li>
<li class="chapter" data-level="7.2" data-path="datatype.html"><a href="datatype.html#type-logical"><i class="fa fa-check"></i><b>7.2</b> Logical</a></li>
<li class="chapter" data-level="7.3" data-path="datatype.html"><a href="datatype.html#type-numeric"><i class="fa fa-check"></i><b>7.3</b> Numeric</a></li>
<li class="chapter" data-level="7.4" data-path="datatype.html"><a href="datatype.html#type-complex"><i class="fa fa-check"></i><b>7.4</b> Complex</a></li>
<li class="chapter" data-level="7.5" data-path="datatype.html"><a href="datatype.html#type-character"><i class="fa fa-check"></i><b>7.5</b> Character</a></li>
<li class="chapter" data-level="7.6" data-path="datatype.html"><a href="datatype.html#type-factor"><i class="fa fa-check"></i><b>7.6</b> Factor</a></li>
<li class="chapter" data-level="7.7" data-path="datatype.html"><a href="datatype.html#type-date"><i class="fa fa-check"></i><b>7.7</b> Date</a><ul>
<li class="chapter" data-level="7.7.1" data-path="datatype.html"><a href="datatype.html#なぜdate型があるのか"><i class="fa fa-check"></i><b>7.7.1</b> なぜDate型があるのか</a></li>
<li class="chapter" data-level="7.7.2" data-path="datatype.html"><a href="datatype.html#date型の作り方"><i class="fa fa-check"></i><b>7.7.2</b> Date型の作り方</a></li>
<li class="chapter" data-level="7.7.3" data-path="datatype.html"><a href="datatype.html#posixctposixlt型について"><i class="fa fa-check"></i><b>7.7.3</b> POSIXct、POSIXlt型について</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="datatype.html"><a href="datatype.html#type-na"><i class="fa fa-check"></i><b>7.8</b> NA</a></li>
<li class="chapter" data-level="7.9" data-path="datatype.html"><a href="datatype.html#type-null"><i class="fa fa-check"></i><b>7.9</b> NULL</a></li>
<li class="chapter" data-level="7.10" data-path="datatype.html"><a href="datatype.html#type-nan"><i class="fa fa-check"></i><b>7.10</b> NaN</a></li>
<li class="chapter" data-level="7.11" data-path="datatype.html"><a href="datatype.html#type-inf"><i class="fa fa-check"></i><b>7.11</b> Inf</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="datastructure.html"><a href="datastructure.html"><i class="fa fa-check"></i><b>8</b> データの構造</a><ul>
<li class="chapter" data-level="8.1" data-path="datastructure.html"><a href="datastructure.html#WhatIsDatastructure"><i class="fa fa-check"></i><b>8.1</b> データ構造とは</a></li>
<li class="chapter" data-level="8.2" data-path="datastructure.html"><a href="datastructure.html#structure-vector"><i class="fa fa-check"></i><b>8.2</b> ベクトル (vector)</a><ul>
<li class="chapter" data-level="8.2.1" data-path="datastructure.html"><a href="datastructure.html#ベクトルの作り方"><i class="fa fa-check"></i><b>8.2.1</b> ベクトルの作り方</a></li>
<li class="chapter" data-level="8.2.2" data-path="datastructure.html"><a href="datastructure.html#ベクトルの操作"><i class="fa fa-check"></i><b>8.2.2</b> ベクトルの操作</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="datastructure.html"><a href="datastructure.html#structure-matrix"><i class="fa fa-check"></i><b>8.3</b> 行列 (matrix)</a><ul>
<li class="chapter" data-level="8.3.1" data-path="datastructure.html"><a href="datastructure.html#行列の作り方"><i class="fa fa-check"></i><b>8.3.1</b> 行列の作り方</a></li>
<li class="chapter" data-level="8.3.2" data-path="datastructure.html"><a href="datastructure.html#行列の操作"><i class="fa fa-check"></i><b>8.3.2</b> 行列の操作</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="datastructure.html"><a href="datastructure.html#structure-dataframe"><i class="fa fa-check"></i><b>8.4</b> データフレーム (data.frame)</a><ul>
<li class="chapter" data-level="8.4.1" data-path="datastructure.html"><a href="datastructure.html#データフレームの作成"><i class="fa fa-check"></i><b>8.4.1</b> データフレームの作成</a></li>
<li class="chapter" data-level="8.4.2" data-path="datastructure.html"><a href="datastructure.html#データフレームの操作"><i class="fa fa-check"></i><b>8.4.2</b> データフレームの操作</a></li>
<li class="chapter" data-level="8.4.3" data-path="datastructure.html"><a href="datastructure.html#tibble型"><i class="fa fa-check"></i><b>8.4.3</b> tibble型</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="datastructure.html"><a href="datastructure.html#structure-list"><i class="fa fa-check"></i><b>8.5</b> リスト (list)</a><ul>
<li class="chapter" data-level="8.5.1" data-path="datastructure.html"><a href="datastructure.html#リスト型データの作成"><i class="fa fa-check"></i><b>8.5.1</b> リスト型データの作成</a></li>
<li class="chapter" data-level="8.5.2" data-path="datastructure.html"><a href="datastructure.html#リスト型データの操作"><i class="fa fa-check"></i><b>8.5.2</b> リスト型データの操作</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="datastructure.html"><a href="datastructure.html#structure-array"><i class="fa fa-check"></i><b>8.6</b> 配列 (array)</a><ul>
<li class="chapter" data-level="8.6.1" data-path="datastructure.html"><a href="datastructure.html#配列型データの作成"><i class="fa fa-check"></i><b>8.6.1</b> 配列型データの作成</a></li>
<li class="chapter" data-level="8.6.2" data-path="datastructure.html"><a href="datastructure.html#配列型データの操作"><i class="fa fa-check"></i><b>8.6.2</b> 配列型データの操作</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="datastructure.html"><a href="datastructure.html#structure-exercise"><i class="fa fa-check"></i><b>8.7</b> 練習問題</a><ul>
<li class="chapter" data-level="8.7.1" data-path="datastructure.html"><a href="datastructure.html#ベクトル"><i class="fa fa-check"></i><b>8.7.1</b> ベクトル</a></li>
<li class="chapter" data-level="8.7.2" data-path="datastructure.html"><a href="datastructure.html#行列"><i class="fa fa-check"></i><b>8.7.2</b> 行列</a></li>
<li class="chapter" data-level="8.7.3" data-path="datastructure.html"><a href="datastructure.html#データフレーム"><i class="fa fa-check"></i><b>8.7.3</b> データフレーム</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="programming.html"><a href="programming.html"><i class="fa fa-check"></i><b>9</b> Rプログラミングの基礎</a><ul>
<li class="chapter" data-level="9.1" data-path="programming.html"><a href="programming.html#programming-intro"><i class="fa fa-check"></i><b>9.1</b> R言語の基礎概念</a></li>
<li class="chapter" data-level="9.2" data-path="programming.html"><a href="programming.html#programming-style"><i class="fa fa-check"></i><b>9.2</b> スクリプトの書き方</a><ul>
<li class="chapter" data-level="9.2.1" data-path="programming.html"><a href="programming.html#オブジェクト名"><i class="fa fa-check"></i><b>9.2.1</b> オブジェクト名</a></li>
<li class="chapter" data-level="9.2.2" data-path="programming.html"><a href="programming.html#改行"><i class="fa fa-check"></i><b>9.2.2</b> 改行</a></li>
<li class="chapter" data-level="9.2.3" data-path="programming.html"><a href="programming.html#スペースとインデント"><i class="fa fa-check"></i><b>9.2.3</b> スペースとインデント</a></li>
<li class="chapter" data-level="9.2.4" data-path="programming.html"><a href="programming.html#代入"><i class="fa fa-check"></i><b>9.2.4</b> 代入</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="programming.html"><a href="programming.html#programming-iteration"><i class="fa fa-check"></i><b>9.3</b> 反復</a><ul>
<li class="chapter" data-level="9.3.1" data-path="programming.html"><a href="programming.html#forによる反復"><i class="fa fa-check"></i><b>9.3.1</b> <code>for()</code>による反復</a></li>
<li class="chapter" data-level="9.3.2" data-path="programming.html"><a href="programming.html#whileによる反復"><i class="fa fa-check"></i><b>9.3.2</b> <code>while()</code>による反復</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="programming.html"><a href="programming.html#programming-condition"><i class="fa fa-check"></i><b>9.4</b> 条件分岐</a><ul>
<li class="chapter" data-level="9.4.1" data-path="programming.html"><a href="programming.html#ifelse-ifelseによる条件分岐"><i class="fa fa-check"></i><b>9.4.1</b> <code>if()</code>、<code>else if()</code>、<code>else()</code>による条件分岐</a></li>
<li class="chapter" data-level="9.4.2" data-path="programming.html"><a href="programming.html#ifelseによる条件分岐"><i class="fa fa-check"></i><b>9.4.2</b> <code>ifelse()</code>による条件分岐</a></li>
<li class="chapter" data-level="9.4.3" data-path="programming.html"><a href="programming.html#switchによる条件分岐"><i class="fa fa-check"></i><b>9.4.3</b> <code>switch()</code>による条件分岐</a></li>
<li class="chapter" data-level="9.4.4" data-path="programming.html"><a href="programming.html#上級者向け"><i class="fa fa-check"></i><b>9.4.4</b> 上級者向け</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="programming.html"><a href="programming.html#programming-function"><i class="fa fa-check"></i><b>9.5</b> 関数の作成</a><ul>
<li class="chapter" data-level="9.5.1" data-path="programming.html"><a href="programming.html#関数-in-関数"><i class="fa fa-check"></i><b>9.5.1</b> 関数 in 関数</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="programming.html"><a href="programming.html#programming-exercise"><i class="fa fa-check"></i><b>9.6</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="datahandling1.html"><a href="datahandling1.html"><i class="fa fa-check"></i><b>10</b> データハンドリング [基礎編: 抽出]</a><ul>
<li class="chapter" data-level="10.1" data-path="datahandling1.html"><a href="datahandling1.html#handling1-intro"><i class="fa fa-check"></i><b>10.1</b> データハンドリングとtidyverse</a></li>
<li class="chapter" data-level="10.2" data-path="datahandling1.html"><a href="datahandling1.html#handling1-pipe"><i class="fa fa-check"></i><b>10.2</b> パイプ演算子 (<code>%&gt;%</code>)</a></li>
<li class="chapter" data-level="10.3" data-path="datahandling1.html"><a href="datahandling1.html#handling1-select"><i class="fa fa-check"></i><b>10.3</b> 列の抽出</a><ul>
<li class="chapter" data-level="10.3.1" data-path="datahandling1.html"><a href="datahandling1.html#特定の列を抽出する"><i class="fa fa-check"></i><b>10.3.1</b> 特定の列を抽出する</a></li>
<li class="chapter" data-level="10.3.2" data-path="datahandling1.html"><a href="datahandling1.html#特定の列を抽出し列名を変更する"><i class="fa fa-check"></i><b>10.3.2</b> 特定の列を抽出し、列名を変更する</a></li>
<li class="chapter" data-level="10.3.3" data-path="datahandling1.html"><a href="datahandling1.html#特定の列を除外する"><i class="fa fa-check"></i><b>10.3.3</b> 特定の列を除外する</a></li>
<li class="chapter" data-level="10.3.4" data-path="datahandling1.html"><a href="datahandling1.html#隣接した列を指定する"><i class="fa fa-check"></i><b>10.3.4</b> 隣接した列を指定する</a></li>
<li class="chapter" data-level="10.3.5" data-path="datahandling1.html"><a href="datahandling1.html#一部の列の順番だけを変える"><i class="fa fa-check"></i><b>10.3.5</b> 一部の列の順番だけを変える</a></li>
<li class="chapter" data-level="10.3.6" data-path="datahandling1.html"><a href="datahandling1.html#selectの便利な機能"><i class="fa fa-check"></i><b>10.3.6</b> <code>select()</code>の便利な機能</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="datahandling1.html"><a href="datahandling1.html#handling1-filter"><i class="fa fa-check"></i><b>10.4</b> 行の抽出</a><ul>
<li class="chapter" data-level="10.4.1" data-path="datahandling1.html"><a href="datahandling1.html#指定した行を抽出する"><i class="fa fa-check"></i><b>10.4.1</b> 指定した行を抽出する</a></li>
<li class="chapter" data-level="10.4.2" data-path="datahandling1.html"><a href="datahandling1.html#条件に合致する行を抽出する"><i class="fa fa-check"></i><b>10.4.2</b> 条件に合致する行を抽出する</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="datahandling1.html"><a href="datahandling1.html#handling1-arrange"><i class="fa fa-check"></i><b>10.5</b> 行のソート</a></li>
<li class="chapter" data-level="10.6" data-path="datahandling1.html"><a href="datahandling1.html#handling1-exercise"><i class="fa fa-check"></i><b>10.6</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="datahandling2.html"><a href="datahandling2.html"><i class="fa fa-check"></i><b>11</b> データハンドリング [基礎編: 拡張]</a><ul>
<li class="chapter" data-level="11.1" data-path="datahandling2.html"><a href="datahandling2.html#handling2-summarise"><i class="fa fa-check"></i><b>11.1</b> 記述統計量の計算</a><ul>
<li class="chapter" data-level="11.1.1" data-path="datahandling2.html"><a href="datahandling2.html#summariseによる記述統計量の計算"><i class="fa fa-check"></i><b>11.1.1</b> <code>summarise()</code>による記述統計量の計算</a></li>
<li class="chapter" data-level="11.1.2" data-path="datahandling2.html"><a href="datahandling2.html#summariseに使える便利な関数"><i class="fa fa-check"></i><b>11.1.2</b> <code>summarise()</code>に使える便利な関数</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="datahandling2.html"><a href="datahandling2.html#handling2-group"><i class="fa fa-check"></i><b>11.2</b> グルーピング</a><ul>
<li class="chapter" data-level="11.2.1" data-path="datahandling2.html"><a href="datahandling2.html#group_byによるグループ化"><i class="fa fa-check"></i><b>11.2.1</b> <code>group_by()</code>によるグループ化</a></li>
<li class="chapter" data-level="11.2.2" data-path="datahandling2.html"><a href="datahandling2.html#複数の変数を用いたグループ化"><i class="fa fa-check"></i><b>11.2.2</b> 複数の変数を用いたグループ化</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="datahandling2.html"><a href="datahandling2.html#handling2-mutate"><i class="fa fa-check"></i><b>11.3</b> 変数の計算</a><ul>
<li class="chapter" data-level="11.3.1" data-path="datahandling2.html"><a href="datahandling2.html#mutate関数の使い方"><i class="fa fa-check"></i><b>11.3.1</b> <code>mutate()</code>関数の使い方</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="datahandling2.html"><a href="datahandling2.html#handling2-rowwise"><i class="fa fa-check"></i><b>11.4</b> 行単位の操作</a></li>
<li class="chapter" data-level="11.5" data-path="datahandling2.html"><a href="datahandling2.html#handling2-merge"><i class="fa fa-check"></i><b>11.5</b> データの結合</a><ul>
<li class="chapter" data-level="11.5.1" data-path="datahandling2.html"><a href="datahandling2.html#行の結合"><i class="fa fa-check"></i><b>11.5.1</b> 行の結合</a></li>
<li class="chapter" data-level="11.5.2" data-path="datahandling2.html"><a href="datahandling2.html#列の結合"><i class="fa fa-check"></i><b>11.5.2</b> 列の結合</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="datahandling2.html"><a href="datahandling2.html#handling2-exercise"><i class="fa fa-check"></i><b>11.6</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="factor.html"><a href="factor.html"><i class="fa fa-check"></i><b>12</b> データハンドリング [基礎編: factor型]</a><ul>
<li class="chapter" data-level="12.1" data-path="factor.html"><a href="factor.html#名目変数を含むグラフを作成する際の注意点"><i class="fa fa-check"></i><b>12.1</b> 名目変数を含むグラフを作成する際の注意点</a></li>
<li class="chapter" data-level="12.2" data-path="factor.html"><a href="factor.html#forcatsパッケージについて"><i class="fa fa-check"></i><b>12.2</b> <code>forcats</code>パッケージについて</a><ul>
<li class="chapter" data-level="12.2.1" data-path="factor.html"><a href="factor.html#fct_relevel-水準の順番を変更する"><i class="fa fa-check"></i><b>12.2.1</b> <code>fct_relevel()</code>: 水準の順番を変更する</a></li>
<li class="chapter" data-level="12.2.2" data-path="factor.html"><a href="factor.html#fct_recode-水準のラベルを変更する"><i class="fa fa-check"></i><b>12.2.2</b> <code>fct_recode()</code>: 水準のラベルを変更する</a></li>
<li class="chapter" data-level="12.2.3" data-path="factor.html"><a href="factor.html#fct_rev-水準の順番を反転させる"><i class="fa fa-check"></i><b>12.2.3</b> <code>fct_rev()</code>: 水準の順番を反転させる</a></li>
<li class="chapter" data-level="12.2.4" data-path="factor.html"><a href="factor.html#fct_infreq-頻度順に順番を変更する"><i class="fa fa-check"></i><b>12.2.4</b> <code>fct_infreq()</code>: 頻度順に順番を変更する</a></li>
<li class="chapter" data-level="12.2.5" data-path="factor.html"><a href="factor.html#fct_inorder-データ内の出現順番に順番を変更する"><i class="fa fa-check"></i><b>12.2.5</b> <code>fct_inorder()</code>: データ内の出現順番に順番を変更する</a></li>
<li class="chapter" data-level="12.2.6" data-path="factor.html"><a href="factor.html#fct_shift-水準の順番をずらす"><i class="fa fa-check"></i><b>12.2.6</b> <code>fct_shift()</code>: 水準の順番をずらす</a></li>
<li class="chapter" data-level="12.2.7" data-path="factor.html"><a href="factor.html#fct_shuffle-水準の順番をランダム化する"><i class="fa fa-check"></i><b>12.2.7</b> <code>fct_shuffle()</code>: 水準の順番をランダム化する</a></li>
<li class="chapter" data-level="12.2.8" data-path="factor.html"><a href="factor.html#fct_reorder-別の1変数の値を基準に水準の順番を変更する"><i class="fa fa-check"></i><b>12.2.8</b> <code>fct_reorder()</code>: 別の1変数の値を基準に水準の順番を変更する</a></li>
<li class="chapter" data-level="12.2.9" data-path="factor.html"><a href="factor.html#fct_reorder2-別の2変数の値を基準に水準の順番を変更する"><i class="fa fa-check"></i><b>12.2.9</b> <code>fct_reorder2()</code>: 別の2変数の値を基準に水準の順番を変更する</a></li>
<li class="chapter" data-level="12.2.10" data-path="factor.html"><a href="factor.html#fct_collapse-水準を統合する"><i class="fa fa-check"></i><b>12.2.10</b> <code>fct_collapse()</code>: 水準を統合する</a></li>
<li class="chapter" data-level="12.2.11" data-path="factor.html"><a href="factor.html#fct_drop-使われていない水準を除去する"><i class="fa fa-check"></i><b>12.2.11</b> <code>fct_drop()</code>: 使われていない水準を除去する</a></li>
<li class="chapter" data-level="12.2.12" data-path="factor.html"><a href="factor.html#fct_expand-水準を追加する"><i class="fa fa-check"></i><b>12.2.12</b> <code>fct_expand()</code>: 水準を追加する</a></li>
<li class="chapter" data-level="12.2.13" data-path="factor.html"><a href="factor.html#fct_explicit_na-欠損値に水準を与える"><i class="fa fa-check"></i><b>12.2.13</b> <code>fct_explicit_na()</code>: 欠損値に水準を与える</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="factor.html"><a href="factor.html#factor-excersie"><i class="fa fa-check"></i><b>12.3</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="tidydata.html"><a href="tidydata.html"><i class="fa fa-check"></i><b>13</b> 整然データ構造</a><ul>
<li class="chapter" data-level="13.1" data-path="tidydata.html"><a href="tidydata.html#tidydata-intro"><i class="fa fa-check"></i><b>13.1</b> 整然データ (tidy data)とは</a><ul>
<li class="chapter" data-level="13.1.1" data-path="tidydata.html"><a href="tidydata.html#つの列は1つの変数を表す"><i class="fa fa-check"></i><b>13.1.1</b> 1つの列は、1つの変数を表す</a></li>
<li class="chapter" data-level="13.1.2" data-path="tidydata.html"><a href="tidydata.html#つの行は1つの観測を表す"><i class="fa fa-check"></i><b>13.1.2</b> 1つの行は、1つの観測を表す</a></li>
<li class="chapter" data-level="13.1.3" data-path="tidydata.html"><a href="tidydata.html#つのセルは1つの値を表す"><i class="fa fa-check"></i><b>13.1.3</b> 1つのセルは、1つの値を表す</a></li>
<li class="chapter" data-level="13.1.4" data-path="tidydata.html"><a href="tidydata.html#つの表は1つの観測単位をもつ"><i class="fa fa-check"></i><b>13.1.4</b> 1つの表は、1つの観測単位をもつ</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="tidydata.html"><a href="tidydata.html#tidydata-gather"><i class="fa fa-check"></i><b>13.2</b> Wide型からLong型へ</a></li>
<li class="chapter" data-level="13.3" data-path="tidydata.html"><a href="tidydata.html#tidydata-spread"><i class="fa fa-check"></i><b>13.3</b> Long型からWide型へ</a></li>
<li class="chapter" data-level="13.4" data-path="tidydata.html"><a href="tidydata.html#tidydata-separate"><i class="fa fa-check"></i><b>13.4</b> 列の操作</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>14</b> 可視化</a><ul>
<li class="chapter" data-level="14.1" data-path="visualization.html"><a href="visualization.html#visual-packages"><i class="fa fa-check"></i><b>14.1</b> 可視化のためのパッケージ</a></li>
<li class="chapter" data-level="14.2" data-path="visualization.html"><a href="visualization.html#visual-principal"><i class="fa fa-check"></i><b>14.2</b> 良いグラフとは</a></li>
<li class="chapter" data-level="14.3" data-path="visualization.html"><a href="visualization.html#visual-ggplot"><i class="fa fa-check"></i><b>14.3</b> グラフィックの文法</a></li>
<li class="chapter" data-level="14.4" data-path="visualization.html"><a href="visualization.html#visual-data"><i class="fa fa-check"></i><b>14.4</b> 実習用データ</a></li>
<li class="chapter" data-level="14.5" data-path="visualization.html"><a href="visualization.html#visual-barplot"><i class="fa fa-check"></i><b>14.5</b> 棒グラフ</a></li>
<li class="chapter" data-level="14.6" data-path="visualization.html"><a href="visualization.html#visual-histogram"><i class="fa fa-check"></i><b>14.6</b> ヒストグラム</a></li>
<li class="chapter" data-level="14.7" data-path="visualization.html"><a href="visualization.html#visual-scatter"><i class="fa fa-check"></i><b>14.7</b> 散布図</a></li>
<li class="chapter" data-level="14.8" data-path="visualization.html"><a href="visualization.html#visual-customize"><i class="fa fa-check"></i><b>14.8</b> 図のカスタマイズ</a></li>
<li class="chapter" data-level="14.9" data-path="visualization.html"><a href="visualization.html#visual-excersie"><i class="fa fa-check"></i><b>14.9</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="datahandling3.html"><a href="datahandling3.html"><i class="fa fa-check"></i><b>15</b> データハンドリング[応用編]</a></li>
<li class="chapter" data-level="16" data-path="string.html"><a href="string.html"><i class="fa fa-check"></i><b>16</b> 文字列の処理</a></li>
<li class="chapter" data-level="17" data-path="scraping.html"><a href="scraping.html"><i class="fa fa-check"></i><b>17</b> スクレイピング</a></li>
<li class="chapter" data-level="18" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>18</b> R Markdown</a><ul>
<li class="chapter" data-level="18.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-intro"><i class="fa fa-check"></i><b>18.1</b> R Markdown</a></li>
<li class="chapter" data-level="18.2" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-grammar"><i class="fa fa-check"></i><b>18.2</b> Markdown文法の基本</a></li>
<li class="chapter" data-level="18.3" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-chunk"><i class="fa fa-check"></i><b>18.3</b> チャンクのオプション</a></li>
<li class="chapter" data-level="18.4" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-header"><i class="fa fa-check"></i><b>18.4</b> ヘッダーのオプション</a></li>
<li class="chapter" data-level="18.5" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-japanese"><i class="fa fa-check"></i><b>18.5</b> 日本語が含まれているPDFの出力</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="solution.html"><a href="solution.html"><i class="fa fa-check"></i><b>19</b> 演習問題の回答</a><ul>
<li class="chapter" data-level="19.1" data-path="solution.html"><a href="solution.html#solution-rbasic"><i class="fa fa-check"></i><b>19.1</b> 基本的な操作</a></li>
<li class="chapter" data-level="19.2" data-path="solution.html"><a href="solution.html#solution-datastructure"><i class="fa fa-check"></i><b>19.2</b> データの構造</a><ul>
<li class="chapter" data-level="19.2.1" data-path="datastructure.html"><a href="datastructure.html#ベクトル"><i class="fa fa-check"></i><b>19.2.1</b> ベクトル</a></li>
<li class="chapter" data-level="19.2.2" data-path="datastructure.html"><a href="datastructure.html#行列"><i class="fa fa-check"></i><b>19.2.2</b> 行列</a></li>
<li class="chapter" data-level="19.2.3" data-path="datastructure.html"><a href="datastructure.html#データフレーム"><i class="fa fa-check"></i><b>19.2.3</b> データフレーム</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="solution.html"><a href="solution.html#rプログラミングの基礎"><i class="fa fa-check"></i><b>19.3</b> Rプログラミングの基礎</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="sessioninfo.html"><a href="sessioninfo.html"><i class="fa fa-check"></i><b>20</b> 本書の執筆環境</a></li>
<li class="chapter" data-level="21" data-path="reference.html"><a href="reference.html"><i class="fa fa-check"></i><b>21</b> 参考資料</a></li>
<li class="divider"></li>
<p style = "text-align:center;"><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="クリエイティブ・コモンズ・ライセンス" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a></p>
<p style = "text-align:center;"><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></p>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">私たちのR: あなたのために書いたわけじゃない</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tidydata" class="section level1">
<h1><span class="header-section-number">13.</span> 整然データ構造</h1>
<p>本章ではグラフの作成に適した形へデータを整形することについて学習します。ただし、これはグラフに限られた話ではありません。作図に適したデータは分析にも適します。</p>
<div id="tidydata-intro" class="section level2">
<h2><span class="header-section-number">13.1</span> 整然データ (tidy data)とは</h2>
<p>分析や作図に適したデータの形は整然データ、または簡潔データ (tidy data)と呼ばれます。整然データの概念はtidyverse世界の産みの親であるHadely Wickham先生が提唱した概念であり、詳細はHadley先生が2014年に発表した論文<a href="#fn61" class="footnote-ref" id="fnref61"><sup>61</sup></a>を参照してください。</p>
<p>整然データは目指す到達点は非常に単純です。それは「データの構造 (structure)と意味 (semantic)を一致させる」ことです。そして、この「意味」を出来る限り小さい単位で分解します。</p>
<p>例えば、3人で構成されたあるクラス内の被験者が投薬の前後に測った数学成績があるとします。投薬前の成績は<code>"Control"</code>、投薬後の状況を<code>"Treatment"</code>とします。これをまとめたのが表<a href="tidydata.html#tab:messy-data1">13.1</a>です。</p>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:messy-data1">表 13.1: </span>Messy Dataの例 (1)
</caption>
<thead>
<tr>
<th style="text-align:left;text-align: center;">
Name
</th>
<th style="text-align:right;text-align: center;">
Control
</th>
<th style="text-align:right;text-align: center;">
Treatment
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Hadley
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
90
</td>
</tr>
<tr>
<td style="text-align:left;">
Song
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
25
</td>
</tr>
<tr>
<td style="text-align:left;">
Yanai
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
95
</td>
</tr>
</tbody>
</table>
<p>また、以上の表は転置も可能であり、以下のように表現することが可能です (表<a href="tidydata.html#tab:messy-data2">13.2</a>)。</p>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:messy-data2">表 13.2: </span>Messy Dataの例 (2)
</caption>
<thead>
<tr>
<th style="text-align:left;text-align: center;">
Treat
</th>
<th style="text-align:right;text-align: center;">
Hadely
</th>
<th style="text-align:right;text-align: center;">
Song
</th>
<th style="text-align:right;text-align: center;">
Yanai
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:left;">
Treatment
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
95
</td>
</tr>
</tbody>
</table>
<p>2つのデータが持つ情報は全く同じです。これは「同じ意味を持つが、異なる構造を持つ」とも言えます。このような多様性が生じる意味は行と列のあり方が各値を説明するに十分ではないからです。異なるデータ構造として表現される余地があるということです。</p>
<p>たとえば、表<a href="tidydata.html#tab:messy-data1">13.1</a>の場合、各列は以下のような3つの情報があります。</p>
<ol style="list-style-type: decimal">
<li><code>Name</code>: 被験者名</li>
<li><code>Control</code>: 投薬前の数学成績</li>
<li><code>Treatment</code>: 投薬後の数学成績</li>
</ol>
<p>このデータの問題は「投薬有無」と「数学成績」が2回登場したという点です。1は問題ありませんが、2と3の値は「投薬有無 <span class="math inline">\(\times\)</span> 数学成績」の組み合わせです。一つの変数に2つの情報が含まれていますね。これによって、投薬有無を行にしても列にしてもいいわけです。「ならばこっちの方が柔軟だしいいのでは?」と思う方もいるかも知れません。しかし、パソコンはこの曖昧さが嫌いです。なぜなら、人間のような思考ができないからです。データフレームは縦ベクトルの集合であるから、各列には一つの情報のみ格納する必要があります。たとえば、以下のように列を変更するとしましょう。</p>
<ol style="list-style-type: decimal">
<li><code>Name</code>: 被験者名</li>
<li><code>Treat</code>: 投薬有無</li>
<li><code>Math_Score</code>: 数学成績</li>
</ol>
<p><code>Treat</code>は投薬前なら<code>"Control"</code>の値を、投薬後なら<code>"Treatment"</code>の値が入ります。<code>Math_Socre</code>には数学成績が入ります。これに則って表に直したのが表<a href="tidydata.html#tab:tidydata1">13.3</a>です。</p>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:tidydata1">表 13.3: </span>整然データの例
</caption>
<thead>
<tr>
<th style="text-align:left;text-align: center;">
Name
</th>
<th style="text-align:left;text-align: center;">
Treat
</th>
<th style="text-align:right;text-align: center;">
Math_Score
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Hadley
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
90
</td>
</tr>
<tr>
<td style="text-align:left;">
Hadley
</td>
<td style="text-align:left;">
Treatment
</td>
<td style="text-align:right;">
90
</td>
</tr>
<tr>
<td style="text-align:left;">
Song
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
80
</td>
</tr>
<tr>
<td style="text-align:left;">
Song
</td>
<td style="text-align:left;">
Treatment
</td>
<td style="text-align:right;">
25
</td>
</tr>
<tr>
<td style="text-align:left;">
Yanai
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:left;">
Yanai
</td>
<td style="text-align:left;">
Treatment
</td>
<td style="text-align:right;">
95
</td>
</tr>
</tbody>
</table>
<p>表が長くなりましたが、これなら一つの列に2つ以上の情報が含まれることはありません。この場合、表<a href="tidydata.html#tab:messy-data1">13.1</a>と表<a href="tidydata.html#tab:messy-data2">13.2</a>のように、行と列を転置することができるでしょうか。</p>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:transdata">表 13.4: </span>表<a href="tidydata.html#tab:tidydata1">13.3</a>を転置した場合
</caption>
<thead>
<tr>
<th style="text-align:left;text-align: center;">
Name
</th>
<th style="text-align:left;text-align: center;">
Hadley
</th>
<th style="text-align:left;text-align: center;">
Hadley
</th>
<th style="text-align:left;text-align: center;">
Song
</th>
<th style="text-align:left;text-align: center;">
Song
</th>
<th style="text-align:left;text-align: center;">
Yanai
</th>
<th style="text-align:left;text-align: center;">
Yanai
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Treat
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:left;">
Treatment
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:left;">
Treatment
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:left;">
Treatment
</td>
</tr>
<tr>
<td style="text-align:left;">
Math_Score
</td>
<td style="text-align:left;">
90
</td>
<td style="text-align:left;">
90
</td>
<td style="text-align:left;">
80
</td>
<td style="text-align:left;">
25
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:left;">
95
</td>
</tr>
</tbody>
</table>
<p>その結果が表<a href="tidydata.html#tab:transdata">13.4</a>ですが、いかがでしょうか。まず、列名が重複している時点でアウトですし、人間が見ても非常に分かりにくい表になりました。また、一つの列に異なるデータ (この場合、character型とnumeirc型)が混在しています。パソコンから見てはわけのわからないデータになったわけです。</p>
<p>ここまで来たら整然データのイメージはある程度掴めたかも知れません。具体的に整然データとは次の4つの条件を満たすデータです<span class="citation">(Wickham, <a href="#ref-Wickham:2014" role="doc-biblioref">2014</a>)</span>。</p>
<ol style="list-style-type: decimal">
<li>1つの列は、1つの変数を表す。</li>
<li>1つの行は、1つの観測を表す。</li>
<li>1つのセル（特定の列の特定の行）は、1つの値を表す。</li>
<li>1つの表は、1つの観測単位 (unit of observation)をもつ（異なる観測単位が混ざっていない）。</li>
</ol>
<p>以下でも、表<a href="tidydata.html#tab:messy-data1">13.1</a>と表<a href="tidydata.html#tab:tidydata1">13.3</a>を対比しながら、以上の4条件をより詳しく説明します。</p>
<div id="つの列は1つの変数を表す" class="section level3">
<h3><span class="header-section-number">13.1.1</span> 1つの列は、1つの変数を表す</h3>
<p>表<a href="tidydata.html#tab:messy-data1">13.1</a>と表<a href="tidydata.html#tab:tidydata1">13.3</a>に含まれる情報は以下の3つで共通しています。</p>
<ol style="list-style-type: decimal">
<li>被験者名</li>
<li>投薬有無</li>
<li>数学成績</li>
</ol>
<p>これらの情報がそれぞれデータの変数になるわけですが、整然データは一つの列が一つの変数を表します。それではまず、表<a href="tidydata.html#tab:messy-data1">13.1</a> (図<a href="tidydata.html#fig:messy-data7">13.1</a>の左)から考えてみましょう。この図には3つの情報が全て含まれています。しかし、数学成績は2列に渡って格納されており、「1列1変数」の条件を満たしておりません。一方、表<a href="tidydata.html#tab:tidydata1">13.3</a> (図<a href="tidydata.html#fig:messy-data7">13.1</a>の右)は投薬前後を表す<code>Treat</code>変数を作成し、その値に応じた数学成績が格納されており、「1列1変数」の条件を満たしています。</p>
<div class="figure" style="text-align: center"><span id="fig:messy-data7"></span>
<img src="Figures/Tidydata/TidyData1.png" alt="1つの列は、1つの変数を表す" width="100%" />
<p class="caption">
図 13.1: 1つの列は、1つの変数を表す
</p>
</div>
<p>「1列1変数」は整然データの最も基本となる条件であり、整然データ作成の出発点とも言えます。</p>
</div>
<div id="つの行は1つの観測を表す" class="section level3">
<h3><span class="header-section-number">13.1.2</span> 1つの行は、1つの観測を表す</h3>
<p>図<a href="tidydata.html#fig:messy-data6">13.2</a>の左は一行当たり、いくつの観察が含まれているでしょうか。そのためにはこのデータが何を観察しているかを考える必要があります。このデータは投薬<strong>前後</strong>の数学成績を観察し、量的に測定したものです。つまり、同じ人に対して2回観察を行ったことになります。したがって、投薬前の数学成績と投薬後の数学成績は別の観察であり、図<a href="tidydata.html#fig:messy-data6">13.2</a>の左は3行の表ですが、実は6回分の観察が含まれていることになります。1行に2つの観察が載っていることですね。</p>
<div class="figure" style="text-align: center"><span id="fig:messy-data6"></span>
<img src="Figures/Tidydata/TidyData2.png" alt="1つの行は、1つの観測を表す" width="100%" />
<p class="caption">
図 13.2: 1つの行は、1つの観測を表す
</p>
</div>
<p>一方、図<a href="tidydata.html#fig:messy-data6">13.2</a>の右は6行のデータであり、観察回数とデータの行数が一致しています。つまり、1行に1観察となります。</p>
<p>今回は数学成績しか測っていたいので、簡単な例ですが、実際のデータには曖昧な部分があります。たとえば、投薬によって血圧が変化する可能性があるため、最高血圧もまた投薬前後に測定したとします。それが表<a href="tidydata.html#tab:blood-pressure">13.5</a>の左です。</p>
<table class="kable_wrapper table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:blood-pressure">表 13.5: </span>1行1観察の例
</caption>
<tbody>
<tr>
<td>
<table>
<thead>
<tr>
<th style="text-align:left;">
Name
</th>
<th style="text-align:left;">
Treat
</th>
<th style="text-align:right;">
Math
</th>
<th style="text-align:right;">
Blood
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Hadley
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
110
</td>
</tr>
<tr>
<td style="text-align:left;">
Hadley
</td>
<td style="text-align:left;">
Treatment
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
115
</td>
</tr>
<tr>
<td style="text-align:left;">
Song
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
95
</td>
</tr>
<tr>
<td style="text-align:left;">
Song
</td>
<td style="text-align:left;">
Treatment
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
110
</td>
</tr>
<tr>
<td style="text-align:left;">
Yanai
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:left;">
Yanai
</td>
<td style="text-align:left;">
Treatment
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
95
</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr>
<th style="text-align:left;">
Name
</th>
<th style="text-align:left;">
Treat
</th>
<th style="text-align:left;">
Type
</th>
<th style="text-align:right;">
Value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Hadley
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:left;">
Math
</td>
<td style="text-align:right;">
90
</td>
</tr>
<tr>
<td style="text-align:left;">
Hadley
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:left;">
Blood
</td>
<td style="text-align:right;">
110
</td>
</tr>
<tr>
<td style="text-align:left;">
Hadley
</td>
<td style="text-align:left;">
Treatment
</td>
<td style="text-align:left;">
Math
</td>
<td style="text-align:right;">
90
</td>
</tr>
<tr>
<td style="text-align:left;">
Hadley
</td>
<td style="text-align:left;">
Treatment
</td>
<td style="text-align:left;">
Blood
</td>
<td style="text-align:right;">
115
</td>
</tr>
<tr>
<td style="text-align:left;">
Song
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:left;">
Math
</td>
<td style="text-align:right;">
80
</td>
</tr>
<tr>
<td style="text-align:left;">
Song
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:left;">
Blood
</td>
<td style="text-align:right;">
95
</td>
</tr>
<tr>
<td style="text-align:left;">
Song
</td>
<td style="text-align:left;">
Treatment
</td>
<td style="text-align:left;">
Math
</td>
<td style="text-align:right;">
25
</td>
</tr>
<tr>
<td style="text-align:left;">
Song
</td>
<td style="text-align:left;">
Treatment
</td>
<td style="text-align:left;">
Blood
</td>
<td style="text-align:right;">
110
</td>
</tr>
<tr>
<td style="text-align:left;">
Yanai
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:left;">
Math
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:left;">
Yanai
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:left;">
Blood
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:left;">
Yanai
</td>
<td style="text-align:left;">
Treatment
</td>
<td style="text-align:left;">
Math
</td>
<td style="text-align:right;">
95
</td>
</tr>
<tr>
<td style="text-align:left;">
Yanai
</td>
<td style="text-align:left;">
Treatment
</td>
<td style="text-align:left;">
Blood
</td>
<td style="text-align:right;">
95
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
<p>3人に投薬前後に数学成績と最高血圧を測定した場合の観察回数は何回でしょう。3人 <span class="math inline">\(\times\)</span> 2時点 <span class="math inline">\(\times\)</span> 2指標の測定だから12回の測定でしょうか。ならば、表<a href="tidydata.html#tab:blood-pressure">13.5</a>の右が整然データでしょう。しかし、この場合、1列1変数という条件が満たされなくなります。<code>Value</code>列には数学成績と血圧が混在しており、2つの変数になります。ならば、どれも整然データではないということでしょうか。実は整然データは表<a href="tidydata.html#tab:blood-pressure">13.5</a>の左です。なぜなら、「1観察=1値」ではないからです。データにおける観察とは観察単位ごとに測定された<strong>値の集合</strong>です。観察対象とは人や自治体、企業、国などだけでなく、時間も含まれます。たとえば、人の特徴 (性別、身長、所得、政治関心など)を測定しもの、ある日の特徴 (気温、株価など)を測定したもの全てが観察です。むろん、人 <span class="math inline">\(\times\)</span> 時間のような組み合わせが観察単位ともなり得ます。この一つ一つの観察単位から得られた値の集合が観察です。表<a href="tidydata.html#tab:blood-pressure">13.5</a>の分析単位は「人 <span class="math inline">\(\times\)</span> 時間」です。成績や最高血圧は分析単位が持つ特徴や性質であって、分析単位ではありません。</p>
</div>
<div id="つのセルは1つの値を表す" class="section level3">
<h3><span class="header-section-number">13.1.3</span> 1つのセルは、1つの値を表す</h3>
<p>この条件に反するケースはあまりないかも知れません。たとえば、「Hadleyは処置前後の数学成績が同じだし、一行にまとめよう」という意味で図<a href="tidydata.html#fig:messy-data5">13.3</a>の左のような表を作る方もいるかも知れませんが、あまりいないでしょう。</p>
<div class="figure" style="text-align: center"><span id="fig:messy-data5"></span>
<img src="Figures/Tidydata/TidyData3.png" alt="1つのセルは、1つの値を表す" width="50%" />
<p class="caption">
図 13.3: 1つのセルは、1つの値を表す
</p>
</div>
<p>図<a href="tidydata.html#fig:messy-data5">13.3</a>の例は「1セル1値」の条件に明らかに反します。しかし、基準が曖昧な変数もあり、その一つが日付です。</p>
<table class="kable_wrapper table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:date-table">表 13.6: </span>日付の扱い方
</caption>
<tbody>
<tr>
<td>
<table>
<thead>
<tr>
<th style="text-align:left;">
Date
</th>
<th style="text-align:right;">
Stock
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2020/06/29
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:left;">
2020/06/30
</td>
<td style="text-align:right;">
105
</td>
</tr>
<tr>
<td style="text-align:left;">
2020/07/01
</td>
<td style="text-align:right;">
110
</td>
</tr>
<tr>
<td style="text-align:left;">
2020/07/02
</td>
<td style="text-align:right;">
85
</td>
</tr>
<tr>
<td style="text-align:left;">
2020/07/03
</td>
<td style="text-align:right;">
90
</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr>
<th style="text-align:right;">
Year
</th>
<th style="text-align:right;">
Month
</th>
<th style="text-align:right;">
Date
</th>
<th style="text-align:right;">
Stock
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
105
</td>
</tr>
<tr>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
110
</td>
</tr>
<tr>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
85
</td>
</tr>
<tr>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
90
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
<p>表<a href="tidydata.html#tab:date-table">13.6</a>の左側の表はどうでしょうか。5日間の株価を記録した架空のデータですが、たしかに<code>Date</code>列には日付が1つずつ、<code>Stock</code>には株価の値が1つずつ格納されています。しかし、解釈によっては「<code>Date</code>に年、月、日といった3つの値が含まれているぞ」と見ることもできます。この解釈に基づく場合、表<a href="tidydata.html#tab:date-table">13.6</a>の右側の表が整然データとなり、左側は雑然データとなります。このケースは第一条件であった「一列一変数」とも関係します。なぜなら、<code>Date</code>という列が年・月・日といった3変数で構成されているとも解釈できるからです。</p>
<p>分析によっては左側のような表でも全く問題ないケースもあります。時系列分析でトレンド変数のみ必要ならこれでも十分に整然データと呼べます。しかし、季節変動などの要素も考慮するならば、左側は雑然データになります。データとしての使い勝手は右側の方が優れているのは確かです。</p>
<p>データを出来る限り細かく分解するほど情報量が豊かになりますが、それにも限度はあるでしょう。たとえば、「<code>Year</code>は実は世紀の情報も含まれているのでは…?」という解釈もできますが、これを反映してデータ整形を行うか否かは分析の目的と分析モデルによって異なります。この意味で、明らかな雑然データはあり得ますが、明らかな整然データは存在しないでしょう。どちらかといえば、整然さの度合いがあり、「これなら十分に整然データと言えないだろうか」と判断できれば十分ではないかと筆者 (Song)は考えます。</p>
</div>
<div id="つの表は1つの観測単位をもつ" class="section level3">
<h3><span class="header-section-number">13.1.4</span> 1つの表は、1つの観測単位をもつ</h3>
<p><a href="https://www.e-stat.go.jp">e-stat</a>などから<a href="https://www.e-stat.go.jp/stat-search/database?page=1&amp;toukei=00200521&amp;tstat=000001080615">国勢調査データ</a>をダウンロードした経験はあるでしょうか。以下の図<a href="tidydata.html#fig:messy-data3">13.4</a>は2015年度国勢調査データの一部です。</p>
<div class="figure" style="text-align: center"><span id="fig:messy-data3"></span>
<img src="Figures/Tidydata/MessyData4.png" alt="国勢調査データ" width="100%" />
<p class="caption">
図 13.4: 国勢調査データ
</p>
</div>
<p>このデータの観察単位はなんでしょうか。データのの1行目は全国の人口を表しています。つまり、単位は国となります。しかし、2行目は北海道の人口です。この場合の観測単位は都道府県となります。つづいて、3行目は札幌市なので単位は市区町村になります。4行目は札幌市中央区、つまり観測単位が行政区になっています。そして14行目は函館市でまた単位は市区町村に戻っています。実際、会社や政府が作成するデータには図<a href="tidydata.html#fig:messy-data3">13.4</a>や図<a href="tidydata.html#fig:messy-data4">13.5</a>のようなものが多いです。とりわけ、図<a href="tidydata.html#fig:messy-data4">13.5</a>のように、最後の行に「合計」などが表記されている場合が多いです。</p>
<div class="figure" style="text-align: center"><span id="fig:messy-data4"></span>
<img src="Figures/Tidydata/TidyData4.png" alt="1つの表は、1つの観測単位をもつ" width="65%" />
<p class="caption">
図 13.5: 1つの表は、1つの観測単位をもつ
</p>
</div>
<p>このような表・データを作成することが悪いことではありません。むしろ、「読む」ための表ならこのような書き方が一般的でしょう。しかし、「分析」のためのデータは観察の単位を統一する必要があります。</p>
<hr />
</div>
</div>
<div id="tidydata-gather" class="section level2">
<h2><span class="header-section-number">13.2</span> Wide型からLong型へ</h2>
<p>以下では「1列1変数」の条件を満たすデータの作成に便利な<code>pivot_longer()</code>と<code>pivot_wider()</code>関数について解説します。この関数群はおなじみの<code>dplyr</code>でなく、<code>tidyr</code>パッケージが提供している関数ですが、どれも<code>tidyverse</code>パッケージ群に含まれているため、<code>tidyverse</code>パッケージを読み込むだけで十分です。本節では<code>pivot_longer()</code>を、次節では<code>pivot_wider()</code>を取り上げます。</p>
<p>まず、<code>pivot_longer()</code>ですが、この関数は比較的に新しい関数であり、これまでは<code>tidyr</code>の<code>gather()</code>関数が使われてきました。しかし、<code>gahter()</code>関数は将来、なくなる予定の関数であり、今から<code>tidyr</code>を学習する方は<code>pivot_*()</code>関数群に慣れておきましょう。</p>
<p>まずは<code>tidyverse</code>パッケージを読み込みます。</p>
<div class="sourceCode" id="cb1125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1125-1"><a href="tidydata.html#cb1125-1"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<p>今回は様々な形のデータを変形する作業をするので、あるデータセットを使うよりも、架空の簡単なデータを使います。</p>
<div class="sourceCode" id="cb1126"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1126-1"><a href="tidydata.html#cb1126-1"></a>df1 &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb1126-2"><a href="tidydata.html#cb1126-2"></a>  <span class="dt">Name      =</span> <span class="kw">c</span>(<span class="st">&quot;Hadley&quot;</span>, <span class="st">&quot;Song&quot;</span>, <span class="st">&quot;Yanai&quot;</span>),</span>
<span id="cb1126-3"><a href="tidydata.html#cb1126-3"></a>  <span class="dt">Control   =</span> <span class="kw">c</span>(<span class="dv">90</span>, <span class="dv">80</span>, <span class="dv">100</span>),</span>
<span id="cb1126-4"><a href="tidydata.html#cb1126-4"></a>  <span class="dt">Treatment =</span> <span class="kw">c</span>(<span class="dv">90</span>, <span class="dv">25</span>, <span class="dv">95</span>),</span>
<span id="cb1126-5"><a href="tidydata.html#cb1126-5"></a>  <span class="dt">Gender    =</span> <span class="kw">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Female&quot;</span>)</span>
<span id="cb1126-6"><a href="tidydata.html#cb1126-6"></a>)</span>
<span id="cb1126-7"><a href="tidydata.html#cb1126-7"></a></span>
<span id="cb1126-8"><a href="tidydata.html#cb1126-8"></a>df1</span></code></pre></div>
<pre><code>## # A tibble: 3 x 4
##   Name   Control Treatment Gender
##   &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; 
## 1 Hadley      90        90 Male  
## 2 Song        80        25 Female
## 3 Yanai      100        95 Female</code></pre>
<p>このデータは既に指摘した通り「1列1変数」の条件を満たしております。この条件を満たすデータは以下のような形となります。</p>
<pre><code>## # A tibble: 6 x 4
##   Name   Gender Treat     Math_Score
##   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;          &lt;dbl&gt;
## 1 Hadley Male   Control           90
## 2 Hadley Male   Treatment         90
## 3 Song   Female Control           80
## 4 Song   Female Treatment         25
## 5 Yanai  Female Control          100
## 6 Yanai  Female Treatment         95</code></pre>
<p><code>Treat</code>変数が作成され、元々は変数名であった<code>"Control"</code>と<code>"Treatment"</code>が値として格納されます。この変数をキー変数と呼びます。そして、キー変数の値に応じた数学成績が<code>Math_Score</code>という変数でまとめられました。この変数を値変数と呼びます。</p>
<p>「1列1変数」を満たさなかった最初のデータは「Wide型データ」、これを満たすようなデータは「Long型データ」と呼ばれます。これは相対的に最初のデータが横に広いから名付けた名前であって、「Wide型=雑然データ」もしくは「Long型=雑然データ」ではないことに注意してください<a href="#fn62" class="footnote-ref" id="fnref62"><sup>62</sup></a>。</p>
<p>Wide型データをLong型へ変換する関数が<code>pivot_longer()</code>であり、基本的な使い方は以下の通りです。</p>
<div class="sourceCode" id="cb1129"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1129-1"><a href="tidydata.html#cb1129-1"></a><span class="co"># pivot_longer()の使い方</span></span>
<span id="cb1129-2"><a href="tidydata.html#cb1129-2"></a>データ名 <span class="op">%&gt;%</span></span>
<span id="cb1129-3"><a href="tidydata.html#cb1129-3"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols      =</span> <span class="kw">c</span>(まとめる変数1, まとめる変数2, ...),</span>
<span id="cb1129-4"><a href="tidydata.html#cb1129-4"></a>               <span class="dt">names_to  =</span> <span class="st">&quot;キー変数名&quot;</span>,</span>
<span id="cb1129-5"><a href="tidydata.html#cb1129-5"></a>               <span class="dt">values_to =</span> <span class="st">&quot;値変数名&quot;</span>)</span></code></pre></div>
<p>ここでは同じ変数が<code>Control</code>と<code>Treatment</code>変数で分けられているため、まとめる変数はこの2つであり、<code>cols = c(Control, Treatment)</code>と指定します。<code>Control</code>と<code>Treatment</code>は<code>"</code>で囲んでも、囲まなくても同じです。また、<code>dplyr</code>の<code>select()</code>関数で使える変数選択の関数 (<code>starts_with()</code>、<code>where()</code>など)や<code>:</code>演算子も使用可能です。また、<code>cols</code>引数は<code>pivot_longer()</code>の第2引数であるため、<code>cols =</code>は省略可能です（第一引数はパイプにより既に渡されています）。</p>
<p><code>names_to</code>と<code>values_to</code>引数はそれぞれキー変数名と値変数名を指定する引数で、ここは必ず<code>"</code>で囲んでください。この<code>df1</code>をLong型へ変換し、<code>df1_L</code>と名付けるコードが以下のコードです。</p>
<div class="sourceCode" id="cb1130"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1130-1"><a href="tidydata.html#cb1130-1"></a>df1_L &lt;-<span class="st"> </span>df1 <span class="op">%&gt;%</span></span>
<span id="cb1130-2"><a href="tidydata.html#cb1130-2"></a><span class="st">  </span><span class="kw">pivot_longer</span>(Control<span class="op">:</span>Treatment,</span>
<span id="cb1130-3"><a href="tidydata.html#cb1130-3"></a>               <span class="dt">names_to  =</span> <span class="st">&quot;Treat&quot;</span>,</span>
<span id="cb1130-4"><a href="tidydata.html#cb1130-4"></a>               <span class="dt">values_to =</span> <span class="st">&quot;Math_Score&quot;</span>)</span>
<span id="cb1130-5"><a href="tidydata.html#cb1130-5"></a></span>
<span id="cb1130-6"><a href="tidydata.html#cb1130-6"></a>df1_L</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   Name   Gender Treat     Math_Score
##   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;          &lt;dbl&gt;
## 1 Hadley Male   Control           90
## 2 Hadley Male   Treatment         90
## 3 Song   Female Control           80
## 4 Song   Female Treatment         25
## 5 Yanai  Female Control          100
## 6 Yanai  Female Treatment         95</code></pre>
<p>これだけでも<code>pivot_longer()</code>関数を使ってWide型からLong型への変換は問題なくできますが、以下ではもうちょっと踏み込んだ使い方について解説します。「ここまでで十分だよ」という方は、ここを飛ばしても構いません。</p>
<p>今回の実習データ<code>df3</code>は3人の体重を3日間に渡って計測したものです。ただし、ドジっ子のSongは2日目にうっかり測るのを忘れており、欠損値となっています。</p>
<div class="sourceCode" id="cb1132"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1132-1"><a href="tidydata.html#cb1132-1"></a>df2 &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb1132-2"><a href="tidydata.html#cb1132-2"></a>  <span class="dt">Name =</span> <span class="kw">c</span>(<span class="st">&quot;Hadley&quot;</span>, <span class="st">&quot;Song&quot;</span>, <span class="st">&quot;Yanai&quot;</span>),</span>
<span id="cb1132-3"><a href="tidydata.html#cb1132-3"></a>  <span class="dt">Day1 =</span> <span class="kw">c</span>(<span class="dv">75</span>, <span class="dv">120</span>, <span class="dv">70</span>),</span>
<span id="cb1132-4"><a href="tidydata.html#cb1132-4"></a>  <span class="dt">Day2 =</span> <span class="kw">c</span>(<span class="dv">73</span>,  <span class="ot">NA</span>, <span class="dv">69</span>),</span>
<span id="cb1132-5"><a href="tidydata.html#cb1132-5"></a>  <span class="dt">Day3 =</span> <span class="kw">c</span>(<span class="dv">71</span>, <span class="dv">140</span>, <span class="dv">71</span>)</span>
<span id="cb1132-6"><a href="tidydata.html#cb1132-6"></a>)</span>
<span id="cb1132-7"><a href="tidydata.html#cb1132-7"></a></span>
<span id="cb1132-8"><a href="tidydata.html#cb1132-8"></a>df2</span></code></pre></div>
<pre><code>## # A tibble: 3 x 4
##   Name    Day1  Day2  Day3
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Hadley    75    73    71
## 2 Song     120    NA   140
## 3 Yanai     70    69    71</code></pre>
<p>まず、これをこれまでのやり方でLong型へ変形し、<code>df2_L</code>と名付けます。</p>
<div class="sourceCode" id="cb1134"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1134-1"><a href="tidydata.html#cb1134-1"></a>df2_L &lt;-<span class="st"> </span>df2 <span class="op">%&gt;%</span></span>
<span id="cb1134-2"><a href="tidydata.html#cb1134-2"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">starts_with</span>(<span class="st">&quot;Day&quot;</span>),</span>
<span id="cb1134-3"><a href="tidydata.html#cb1134-3"></a>               <span class="dt">names_to  =</span> <span class="st">&quot;Day&quot;</span>,</span>
<span id="cb1134-4"><a href="tidydata.html#cb1134-4"></a>               <span class="dt">values_to =</span> <span class="st">&quot;Weight&quot;</span>)</span>
<span id="cb1134-5"><a href="tidydata.html#cb1134-5"></a></span>
<span id="cb1134-6"><a href="tidydata.html#cb1134-6"></a>df2_L</span></code></pre></div>
<pre><code>## # A tibble: 9 x 3
##   Name   Day   Weight
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt;
## 1 Hadley Day1      75
## 2 Hadley Day2      73
## 3 Hadley Day3      71
## 4 Song   Day1     120
## 5 Song   Day2      NA
## 6 Song   Day3     140
## 7 Yanai  Day1      70
## 8 Yanai  Day2      69
## 9 Yanai  Day3      71</code></pre>
<p>これでも問題ないかも知れませんが、以下のような操作を追加に行うとします。</p>
<ol style="list-style-type: decimal">
<li><code>Weight</code>が欠損している行を除去する</li>
<li><code>Day</code>の値から<code>"Day"</code>を除去し、numeric型にする</li>
</ol>
<p>以上の作業を行うには、<code>dplyr</code>が便利でしょう。ちなみに<code>str_remove()</code>関数が初めて登場しましたが、これについては第<a href="string.html#string">16</a>章で詳細に解説します。簡単に説明しますと、<code>str_remove("X123", "X")</code>は<code>"X123"</code>から<code>"X"</code>を除去し、<code>"123"</code>のみ残す関すです。残された値が数字のみであってもデータ型はcharacter型なので、もう一回、numeric型に変換する必要があります<a href="#fn63" class="footnote-ref" id="fnref63"><sup>63</sup></a>。<code>dplyr</code>を使ったコードは以下の通りです。</p>
<div class="sourceCode" id="cb1136"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1136-1"><a href="tidydata.html#cb1136-1"></a><span class="co"># 1. WeightがNAのケースを除去</span></span>
<span id="cb1136-2"><a href="tidydata.html#cb1136-2"></a><span class="co"># 2. Day変数の値から&quot;Day&quot;を除去</span></span>
<span id="cb1136-3"><a href="tidydata.html#cb1136-3"></a><span class="co"># 3. Day変数をnumeric型へ変換</span></span>
<span id="cb1136-4"><a href="tidydata.html#cb1136-4"></a>df2_L <span class="op">%&gt;%</span></span>
<span id="cb1136-5"><a href="tidydata.html#cb1136-5"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(Weight)) <span class="op">%&gt;%</span><span class="st">           </span><span class="co"># 1</span></span>
<span id="cb1136-6"><a href="tidydata.html#cb1136-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Day =</span> <span class="kw">str_remove</span>(Day, <span class="st">&quot;Day&quot;</span>), <span class="co"># 2</span></span>
<span id="cb1136-7"><a href="tidydata.html#cb1136-7"></a>         <span class="dt">Day =</span> <span class="kw">as.numeric</span>(Day))        <span class="co"># 3</span></span></code></pre></div>
<pre><code>## # A tibble: 8 x 3
##   Name     Day Weight
##   &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 Hadley     1     75
## 2 Hadley     2     73
## 3 Hadley     3     71
## 4 Song       1    120
## 5 Song       3    140
## 6 Yanai      1     70
## 7 Yanai      2     69
## 8 Yanai      3     71</code></pre>
<p>実はこの作業、<code>pivot_longer()</code>内で行うことも可能です。たとえば、<code>values_to</code>で指定した変数の値が欠損しているケースを除去するには<code>values_drop_na</code>引数を<code>TRUE</code>に指定するだけです。</p>
<div class="sourceCode" id="cb1138"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1138-1"><a href="tidydata.html#cb1138-1"></a><span class="co"># Weight変数がNAのケースを除去する</span></span>
<span id="cb1138-2"><a href="tidydata.html#cb1138-2"></a>df2 <span class="op">%&gt;%</span></span>
<span id="cb1138-3"><a href="tidydata.html#cb1138-3"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">starts_with</span>(<span class="st">&quot;Day&quot;</span>),</span>
<span id="cb1138-4"><a href="tidydata.html#cb1138-4"></a>               <span class="dt">names_to       =</span> <span class="st">&quot;Day&quot;</span>,</span>
<span id="cb1138-5"><a href="tidydata.html#cb1138-5"></a>               <span class="dt">values_to      =</span> <span class="st">&quot;Weight&quot;</span>,</span>
<span id="cb1138-6"><a href="tidydata.html#cb1138-6"></a>               <span class="dt">values_drop_na =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 8 x 3
##   Name   Day   Weight
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt;
## 1 Hadley Day1      75
## 2 Hadley Day2      73
## 3 Hadley Day3      71
## 4 Song   Day1     120
## 5 Song   Day3     140
## 6 Yanai  Day1      70
## 7 Yanai  Day2      69
## 8 Yanai  Day3      71</code></pre>
<div class="sourceCode" id="cb1140"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1140-1"><a href="tidydata.html#cb1140-1"></a><span class="co"># 1. Day変数の値から&quot;Day&quot;を除去する</span></span>
<span id="cb1140-2"><a href="tidydata.html#cb1140-2"></a><span class="co"># 2. Day変数をinteger型に変換</span></span>
<span id="cb1140-3"><a href="tidydata.html#cb1140-3"></a><span class="co"># 3. Weight変数がNAのケースを除去する</span></span>
<span id="cb1140-4"><a href="tidydata.html#cb1140-4"></a>df2 <span class="op">%&gt;%</span></span>
<span id="cb1140-5"><a href="tidydata.html#cb1140-5"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">starts_with</span>(<span class="st">&quot;Day&quot;</span>),</span>
<span id="cb1140-6"><a href="tidydata.html#cb1140-6"></a>               <span class="dt">names_to        =</span> <span class="st">&quot;Day&quot;</span>,</span>
<span id="cb1140-7"><a href="tidydata.html#cb1140-7"></a>               <span class="dt">names_prefix    =</span> <span class="st">&quot;Day&quot;</span>,                  <span class="co"># 1</span></span>
<span id="cb1140-8"><a href="tidydata.html#cb1140-8"></a>               <span class="dt">names_transform =</span> <span class="kw">list</span>(<span class="dt">Day =</span> as.numeric), <span class="co"># 2</span></span>
<span id="cb1140-9"><a href="tidydata.html#cb1140-9"></a>               <span class="dt">values_to       =</span> <span class="st">&quot;Weight&quot;</span>,</span>
<span id="cb1140-10"><a href="tidydata.html#cb1140-10"></a>               <span class="dt">values_drop_na  =</span> <span class="ot">TRUE</span>)                   <span class="co"># 3</span></span></code></pre></div>
<pre><code>## # A tibble: 8 x 3
##   Name     Day Weight
##   &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 Hadley     1     75
## 2 Hadley     2     73
## 3 Hadley     3     71
## 4 Song       1    120
## 5 Song       3    140
## 6 Yanai      1     70
## 7 Yanai      2     69
## 8 Yanai      3     71</code></pre>
<p>他にも<code>pivot_longer()</code>は様々な引数に対応しており、詳細は<code>?pivot_longer</code>や<a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">レファレンスページ</a>を参照してください。</p>
</div>
<div id="tidydata-spread" class="section level2">
<h2><span class="header-section-number">13.3</span> Long型からWide型へ</h2>
<p><code>pivot_wider()</code></p>
<p><code>spread()</code>は旧版</p>
</div>
<div id="tidydata-separate" class="section level2">
<h2><span class="header-section-number">13.4</span> 列の操作</h2>
<p><code>separate()</code></p>
<p><code>parse_number()</code></p>

</div>
</div>
<h3> 参考資料</h3>
<div id="refs" class="references">
<div id="ref-Wickham:2014">
<p>Wickham Hadley. (2014). Tidy data. <em>Journal of Statistical Software</em>, <em>59</em>(10).</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="61">
<li id="fn61"><p><a href="https://www.jstatsoft.org/article/view/v059i10">Wickham, Hadley. 2014. “Tidy data.” <em>Journal of Statistical Software.</em> 59 (10)</a><a href="tidydata.html#fnref61" class="footnote-back">↩︎</a></p></li>
<li id="fn62"><p>たとえば、表<a href="tidydata.html#tab:blood-pressure">13.5</a>は右の方がLong型データですが、整然データはWide型である左の方ですね。<a href="tidydata.html#fnref62" class="footnote-back">↩︎</a></p></li>
<li id="fn63"><p>実は<code>parse_number()</code>を使えばもっと簡単ですが、これについては後ほど解説します。<a href="tidydata.html#fnref63" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://aruaruaru.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            </section>

          </div>
        </div>
      </div>
<a href="factor.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualization.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["R_Not_for_Everyone.pdf", "R_Not_for_Everyone.epub"],
"toc": {
"collapse": "section"
},
"toolbar": {
"position": "fixed"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
