<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>19. 可視化[応用] | 私たちのR: ベストプラクティスの探究</title>
  <meta name="description" content="R Not for Everyone: An Esoteric Guide." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="19. 可視化[応用] | 私たちのR: ベストプラクティスの探究" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="R Not for Everyone: An Esoteric Guide." />
  <meta name="github-repo" content="JaehyunSong/RBook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="19. 可視化[応用] | 私たちのR: ベストプラクティスの探究" />
  
  <meta name="twitter:description" content="R Not for Everyone: An Esoteric Guide." />
  

<meta name="author" content="宋財泫 (Jaehyun Song)・矢内勇生 (Yuki Yanai)" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="HTML/apple-favicon.png" />
  <link rel="shortcut icon" href="HTML/favicon.png" type="image/x-icon" />
<link rel="prev" href="visualization2.html"/>
<link rel="next" href="visualization4.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.16/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-165592410-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-165592410-1');
  gtag('set', {'user_id': 'USER_ID'}); 
</script>

<meta name="google-site-verification" content="QJouPRaPKBPU1jDp6VaBuFbVV5imTI-Aazl_ScJwVgU" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="HTML/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">私たちのR</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> 紹介</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#progress"><i class="fa fa-check"></i><b>1.1</b> 進捗状況</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#purpose"><i class="fa fa-check"></i><b>1.2</b> 本書の目的と対象</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#about-author"><i class="fa fa-check"></i><b>1.3</b> 著者紹介</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#about-download"><i class="fa fa-check"></i><b>1.4</b> データのダウンロード</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#about-howtoread"><i class="fa fa-check"></i><b>1.5</b> 本書における表記法</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#about-copyright"><i class="fa fa-check"></i><b>1.6</b> 著作権</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="aboutR.html"><a href="aboutR.html"><i class="fa fa-check"></i><b>2</b> R?</a>
<ul>
<li class="chapter" data-level="2.1" data-path="aboutR.html"><a href="aboutR.html#WhatIsR"><i class="fa fa-check"></i><b>2.1</b> Rとは</a></li>
<li class="chapter" data-level="2.2" data-path="aboutR.html"><a href="aboutR.html#WhyR"><i class="fa fa-check"></i><b>2.2</b> Why R?</a></li>
<li class="chapter" data-level="2.3" data-path="aboutR.html"><a href="aboutR.html#GUI_IDE"><i class="fa fa-check"></i><b>2.3</b> GUIとIDE</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="aboutR.html"><a href="aboutR.html#gui"><i class="fa fa-check"></i><b>2.3.1</b> GUI</a></li>
<li class="chapter" data-level="2.3.2" data-path="aboutR.html"><a href="aboutR.html#aboutR-IDE"><i class="fa fa-check"></i><b>2.3.2</b> IDE</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>3</b> Rのインストール</a>
<ul>
<li class="chapter" data-level="3.1" data-path="installation.html"><a href="installation.html#install-package"><i class="fa fa-check"></i><b>3.1</b> パッケージのインストール</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="installation.html"><a href="installation.html#パッケージのインストール"><i class="fa fa-check"></i><b>3.1.1</b> パッケージのインストール</a></li>
<li class="chapter" data-level="3.1.2" data-path="installation.html"><a href="installation.html#パッケージの読み込み"><i class="fa fa-check"></i><b>3.1.2</b> パッケージの読み込み</a></li>
<li class="chapter" data-level="3.1.3" data-path="installation.html"><a href="installation.html#必須パッケージのインストール"><i class="fa fa-check"></i><b>3.1.3</b> 必須パッケージのインストール</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ide.html"><a href="ide.html"><i class="fa fa-check"></i><b>4</b> IDEの導入</a></li>
<li class="chapter" data-level="5" data-path="R-Customize.html"><a href="R-Customize.html"><i class="fa fa-check"></i><b>5</b> 分析環境のカスタマイズ</a></li>
<li class="chapter" data-level="6" data-path="process.html"><a href="process.html"><i class="fa fa-check"></i><b>6</b> 分析の手順</a></li>
<li class="chapter" data-level="7" data-path="rbasic.html"><a href="rbasic.html"><i class="fa fa-check"></i><b>7</b> 基本的な操作</a>
<ul>
<li class="chapter" data-level="" data-path="rbasic.html"><a href="rbasic.html#目次"><i class="fa fa-check"></i>目次</a></li>
<li class="chapter" data-level="7.1" data-path="rbasic.html"><a href="rbasic.html#rbasic-compbasic"><i class="fa fa-check"></i><b>7.1</b> コンピュータの基礎知識</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="rbasic.html"><a href="rbasic.html#ファイル名"><i class="fa fa-check"></i><b>7.1.1</b> ファイル名</a></li>
<li class="chapter" data-level="7.1.2" data-path="rbasic.html"><a href="rbasic.html#ファイルシステムとパス"><i class="fa fa-check"></i><b>7.1.2</b> ファイルシステムとパス</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="rbasic.html"><a href="rbasic.html#rbasic-project"><i class="fa fa-check"></i><b>7.2</b> 「プロジェクト」のすゝめ</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="rbasic.html"><a href="rbasic.html#プロジェクト"><i class="fa fa-check"></i><b>7.2.1</b> プロジェクト</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="rbasic.html"><a href="rbasic.html#rbasic-calc"><i class="fa fa-check"></i><b>7.3</b> 電卓としてのR</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="rbasic.html"><a href="rbasic.html#算術演算子"><i class="fa fa-check"></i><b>7.3.1</b> 算術演算子</a></li>
<li class="chapter" data-level="7.3.2" data-path="rbasic.html"><a href="rbasic.html#論理演算子"><i class="fa fa-check"></i><b>7.3.2</b> 論理演算子</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="rbasic.html"><a href="rbasic.html#rbasic-input"><i class="fa fa-check"></i><b>7.4</b> 格納とオブジェクトの作成</a></li>
<li class="chapter" data-level="7.5" data-path="rbasic.html"><a href="rbasic.html#rbasic-extract"><i class="fa fa-check"></i><b>7.5</b> 要素の抽出</a></li>
<li class="chapter" data-level="7.6" data-path="rbasic.html"><a href="rbasic.html#rbasic-exercise"><i class="fa fa-check"></i><b>7.6</b> 演習問題</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="io.html"><a href="io.html"><i class="fa fa-check"></i><b>8</b> データの入出力</a>
<ul>
<li class="chapter" data-level="" data-path="io.html"><a href="io.html#目次-1"><i class="fa fa-check"></i>目次</a></li>
<li class="chapter" data-level="8.1" data-path="io.html"><a href="io.html#io-read"><i class="fa fa-check"></i><b>8.1</b> データの読み込み</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="io.html"><a href="io.html#csvファイルの場合"><i class="fa fa-check"></i><b>8.1.1</b> csvファイルの場合</a></li>
<li class="chapter" data-level="8.1.2" data-path="io.html"><a href="io.html#その他のフォーマット"><i class="fa fa-check"></i><b>8.1.2</b> その他のフォーマット</a></li>
<li class="chapter" data-level="8.1.3" data-path="io.html"><a href="io.html#rdataファイルの場合"><i class="fa fa-check"></i><b>8.1.3</b> RDataファイルの場合</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="io.html"><a href="io.html#io-export"><i class="fa fa-check"></i><b>8.2</b> データの書き出し</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="io.html"><a href="io.html#csvファイル"><i class="fa fa-check"></i><b>8.2.1</b> csvファイル</a></li>
<li class="chapter" data-level="8.2.2" data-path="io.html"><a href="io.html#rdataファイル"><i class="fa fa-check"></i><b>8.2.2</b> RDataファイル</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="datatype.html"><a href="datatype.html"><i class="fa fa-check"></i><b>9</b> データの型</a>
<ul>
<li class="chapter" data-level="9.1" data-path="datatype.html"><a href="datatype.html#WhatIsDatatype"><i class="fa fa-check"></i><b>9.1</b> データ型とは</a></li>
<li class="chapter" data-level="9.2" data-path="datatype.html"><a href="datatype.html#type-logical"><i class="fa fa-check"></i><b>9.2</b> Logical</a></li>
<li class="chapter" data-level="9.3" data-path="datatype.html"><a href="datatype.html#type-numeric"><i class="fa fa-check"></i><b>9.3</b> Numeric</a></li>
<li class="chapter" data-level="9.4" data-path="datatype.html"><a href="datatype.html#type-complex"><i class="fa fa-check"></i><b>9.4</b> Complex</a></li>
<li class="chapter" data-level="9.5" data-path="datatype.html"><a href="datatype.html#type-character"><i class="fa fa-check"></i><b>9.5</b> Character</a></li>
<li class="chapter" data-level="9.6" data-path="datatype.html"><a href="datatype.html#type-factor"><i class="fa fa-check"></i><b>9.6</b> Factor</a></li>
<li class="chapter" data-level="9.7" data-path="datatype.html"><a href="datatype.html#type-date"><i class="fa fa-check"></i><b>9.7</b> Date</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="datatype.html"><a href="datatype.html#なぜdate型があるのか"><i class="fa fa-check"></i><b>9.7.1</b> なぜDate型があるのか</a></li>
<li class="chapter" data-level="9.7.2" data-path="datatype.html"><a href="datatype.html#date型の作り方"><i class="fa fa-check"></i><b>9.7.2</b> Date型の作り方</a></li>
<li class="chapter" data-level="9.7.3" data-path="datatype.html"><a href="datatype.html#posixctposixlt型について"><i class="fa fa-check"></i><b>9.7.3</b> POSIXct、POSIXlt型について</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="datatype.html"><a href="datatype.html#type-na"><i class="fa fa-check"></i><b>9.8</b> NA</a></li>
<li class="chapter" data-level="9.9" data-path="datatype.html"><a href="datatype.html#type-null"><i class="fa fa-check"></i><b>9.9</b> NULL</a></li>
<li class="chapter" data-level="9.10" data-path="datatype.html"><a href="datatype.html#type-nan"><i class="fa fa-check"></i><b>9.10</b> NaN</a></li>
<li class="chapter" data-level="9.11" data-path="datatype.html"><a href="datatype.html#type-inf"><i class="fa fa-check"></i><b>9.11</b> Inf</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="datastructure.html"><a href="datastructure.html"><i class="fa fa-check"></i><b>10</b> データの構造</a>
<ul>
<li class="chapter" data-level="10.1" data-path="datastructure.html"><a href="datastructure.html#WhatIsDatastructure"><i class="fa fa-check"></i><b>10.1</b> データ構造とは</a></li>
<li class="chapter" data-level="10.2" data-path="datastructure.html"><a href="datastructure.html#structure-vector"><i class="fa fa-check"></i><b>10.2</b> ベクトル (vector)</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="datastructure.html"><a href="datastructure.html#ベクトルの作り方"><i class="fa fa-check"></i><b>10.2.1</b> ベクトルの作り方</a></li>
<li class="chapter" data-level="10.2.2" data-path="datastructure.html"><a href="datastructure.html#ベクトルの操作"><i class="fa fa-check"></i><b>10.2.2</b> ベクトルの操作</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="datastructure.html"><a href="datastructure.html#structure-matrix"><i class="fa fa-check"></i><b>10.3</b> 行列 (matrix)</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="datastructure.html"><a href="datastructure.html#行列の作り方"><i class="fa fa-check"></i><b>10.3.1</b> 行列の作り方</a></li>
<li class="chapter" data-level="10.3.2" data-path="datastructure.html"><a href="datastructure.html#行列の操作"><i class="fa fa-check"></i><b>10.3.2</b> 行列の操作</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="datastructure.html"><a href="datastructure.html#structure-dataframe"><i class="fa fa-check"></i><b>10.4</b> データフレーム (data.frame)</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="datastructure.html"><a href="datastructure.html#データフレームの作成"><i class="fa fa-check"></i><b>10.4.1</b> データフレームの作成</a></li>
<li class="chapter" data-level="10.4.2" data-path="datastructure.html"><a href="datastructure.html#データフレームの操作"><i class="fa fa-check"></i><b>10.4.2</b> データフレームの操作</a></li>
<li class="chapter" data-level="10.4.3" data-path="datastructure.html"><a href="datastructure.html#tibble型"><i class="fa fa-check"></i><b>10.4.3</b> tibble型</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="datastructure.html"><a href="datastructure.html#structure-list"><i class="fa fa-check"></i><b>10.5</b> リスト (list)</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="datastructure.html"><a href="datastructure.html#リスト型データの作成"><i class="fa fa-check"></i><b>10.5.1</b> リスト型データの作成</a></li>
<li class="chapter" data-level="10.5.2" data-path="datastructure.html"><a href="datastructure.html#リスト型データの操作"><i class="fa fa-check"></i><b>10.5.2</b> リスト型データの操作</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="datastructure.html"><a href="datastructure.html#structure-array"><i class="fa fa-check"></i><b>10.6</b> 配列 (array)</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="datastructure.html"><a href="datastructure.html#配列型データの作成"><i class="fa fa-check"></i><b>10.6.1</b> 配列型データの作成</a></li>
<li class="chapter" data-level="10.6.2" data-path="datastructure.html"><a href="datastructure.html#配列型データの操作"><i class="fa fa-check"></i><b>10.6.2</b> 配列型データの操作</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="datastructure.html"><a href="datastructure.html#structure-exercise"><i class="fa fa-check"></i><b>10.7</b> 練習問題</a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="datastructure.html"><a href="datastructure.html#ベクトル"><i class="fa fa-check"></i><b>10.7.1</b> ベクトル</a></li>
<li class="chapter" data-level="10.7.2" data-path="datastructure.html"><a href="datastructure.html#行列"><i class="fa fa-check"></i><b>10.7.2</b> 行列</a></li>
<li class="chapter" data-level="10.7.3" data-path="datastructure.html"><a href="datastructure.html#データフレーム"><i class="fa fa-check"></i><b>10.7.3</b> データフレーム</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datastructure.html"><a href="datastructure.html#目次-2"><i class="fa fa-check"></i>目次</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="programming.html"><a href="programming.html"><i class="fa fa-check"></i><b>11</b> Rプログラミングの基礎</a>
<ul>
<li class="chapter" data-level="11.1" data-path="programming.html"><a href="programming.html#programming-intro"><i class="fa fa-check"></i><b>11.1</b> R言語の基礎概念</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="programming.html"><a href="programming.html#オブジェクト"><i class="fa fa-check"></i><b>11.1.1</b> オブジェクト</a></li>
<li class="chapter" data-level="11.1.2" data-path="programming.html"><a href="programming.html#クラス"><i class="fa fa-check"></i><b>11.1.2</b> クラス</a></li>
<li class="chapter" data-level="11.1.3" data-path="programming.html"><a href="programming.html#関数と引数"><i class="fa fa-check"></i><b>11.1.3</b> 関数と引数</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="programming.html"><a href="programming.html#programming-style"><i class="fa fa-check"></i><b>11.2</b> Rのコーディングスタイル</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="programming.html"><a href="programming.html#オブジェクト名"><i class="fa fa-check"></i><b>11.2.1</b> オブジェクト名</a></li>
<li class="chapter" data-level="11.2.2" data-path="programming.html"><a href="programming.html#改行"><i class="fa fa-check"></i><b>11.2.2</b> 改行</a></li>
<li class="chapter" data-level="11.2.3" data-path="programming.html"><a href="programming.html#スペースとインデント"><i class="fa fa-check"></i><b>11.2.3</b> スペースとインデント</a></li>
<li class="chapter" data-level="11.2.4" data-path="programming.html"><a href="programming.html#代入"><i class="fa fa-check"></i><b>11.2.4</b> 代入</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="programming.html"><a href="programming.html#programming-iteration"><i class="fa fa-check"></i><b>11.3</b> 反復</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="programming.html"><a href="programming.html#for-による反復"><i class="fa fa-check"></i><b>11.3.1</b> <code>for</code> による反復</a></li>
<li class="chapter" data-level="11.3.2" data-path="programming.html"><a href="programming.html#whileによる反復"><i class="fa fa-check"></i><b>11.3.2</b> <code>while</code>による反復</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="programming.html"><a href="programming.html#programming-condition"><i class="fa fa-check"></i><b>11.4</b> 条件分岐</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="programming.html"><a href="programming.html#ifelse-ifelse-による条件分岐"><i class="fa fa-check"></i><b>11.4.1</b> <code>if</code>、<code>else if</code>、<code>else</code> による条件分岐</a></li>
<li class="chapter" data-level="11.4.2" data-path="programming.html"><a href="programming.html#ifelseによる条件分岐"><i class="fa fa-check"></i><b>11.4.2</b> <code>ifelse()</code>による条件分岐</a></li>
<li class="chapter" data-level="11.4.3" data-path="programming.html"><a href="programming.html#switchによる条件分岐"><i class="fa fa-check"></i><b>11.4.3</b> <code>switch()</code>による条件分岐</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="programming.html"><a href="programming.html#programming-exercise"><i class="fa fa-check"></i><b>11.5</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>12</b> 関数の自作</a>
<ul>
<li class="chapter" data-level="12.1" data-path="functions.html"><a href="functions.html#func-intro"><i class="fa fa-check"></i><b>12.1</b> 関数の作成</a></li>
<li class="chapter" data-level="12.2" data-path="functions.html"><a href="functions.html#func-adv"><i class="fa fa-check"></i><b>12.2</b> ちょっと複雑な関数</a></li>
<li class="chapter" data-level="12.3" data-path="functions.html"><a href="functions.html#func-in-func"><i class="fa fa-check"></i><b>12.3</b> 関数 in 関数</a></li>
<li class="chapter" data-level="12.4" data-path="functions.html"><a href="functions.html#func-exercise"><i class="fa fa-check"></i><b>12.4</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="datahandling1.html"><a href="datahandling1.html"><i class="fa fa-check"></i><b>13</b> データハンドリング [基礎編: 抽出]</a>
<ul>
<li class="chapter" data-level="13.1" data-path="datahandling1.html"><a href="datahandling1.html#handling1-intro"><i class="fa fa-check"></i><b>13.1</b> データハンドリングとtidyverse</a></li>
<li class="chapter" data-level="13.2" data-path="datahandling1.html"><a href="datahandling1.html#handling1-pipe"><i class="fa fa-check"></i><b>13.2</b> パイプ演算子 (<code>%&gt;%</code>)</a></li>
<li class="chapter" data-level="13.3" data-path="datahandling1.html"><a href="datahandling1.html#handling1-select"><i class="fa fa-check"></i><b>13.3</b> 列の抽出</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="datahandling1.html"><a href="datahandling1.html#特定の列を抽出する"><i class="fa fa-check"></i><b>13.3.1</b> 特定の列を抽出する</a></li>
<li class="chapter" data-level="13.3.2" data-path="datahandling1.html"><a href="datahandling1.html#特定の列を抽出し列名を変更する"><i class="fa fa-check"></i><b>13.3.2</b> 特定の列を抽出し、列名を変更する</a></li>
<li class="chapter" data-level="13.3.3" data-path="datahandling1.html"><a href="datahandling1.html#特定の列を除外する"><i class="fa fa-check"></i><b>13.3.3</b> 特定の列を除外する</a></li>
<li class="chapter" data-level="13.3.4" data-path="datahandling1.html"><a href="datahandling1.html#隣接した列を指定する"><i class="fa fa-check"></i><b>13.3.4</b> 隣接した列を指定する</a></li>
<li class="chapter" data-level="13.3.5" data-path="datahandling1.html"><a href="datahandling1.html#一部の列の順番だけを変える"><i class="fa fa-check"></i><b>13.3.5</b> 一部の列の順番だけを変える</a></li>
<li class="chapter" data-level="13.3.6" data-path="datahandling1.html"><a href="datahandling1.html#selectの便利な機能"><i class="fa fa-check"></i><b>13.3.6</b> <code>select()</code>の便利な機能</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="datahandling1.html"><a href="datahandling1.html#handling1-filter"><i class="fa fa-check"></i><b>13.4</b> 行の抽出</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="datahandling1.html"><a href="datahandling1.html#指定した行を抽出する"><i class="fa fa-check"></i><b>13.4.1</b> 指定した行を抽出する</a></li>
<li class="chapter" data-level="13.4.2" data-path="datahandling1.html"><a href="datahandling1.html#条件に合致する行を抽出する"><i class="fa fa-check"></i><b>13.4.2</b> 条件に合致する行を抽出する</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="datahandling1.html"><a href="datahandling1.html#handling1-arrange"><i class="fa fa-check"></i><b>13.5</b> 行のソート</a></li>
<li class="chapter" data-level="13.6" data-path="datahandling1.html"><a href="datahandling1.html#handling1-exercise"><i class="fa fa-check"></i><b>13.6</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="datahandling2.html"><a href="datahandling2.html"><i class="fa fa-check"></i><b>14</b> データハンドリング [基礎編: 拡張]</a>
<ul>
<li class="chapter" data-level="14.1" data-path="datahandling2.html"><a href="datahandling2.html#handling2-summarise"><i class="fa fa-check"></i><b>14.1</b> 記述統計量の計算</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="datahandling2.html"><a href="datahandling2.html#summariseによる記述統計量の計算"><i class="fa fa-check"></i><b>14.1.1</b> <code>summarise()</code>による記述統計量の計算</a></li>
<li class="chapter" data-level="14.1.2" data-path="datahandling2.html"><a href="datahandling2.html#summariseに使える便利な関数"><i class="fa fa-check"></i><b>14.1.2</b> <code>summarise()</code>に使える便利な関数</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="datahandling2.html"><a href="datahandling2.html#handling2-group"><i class="fa fa-check"></i><b>14.2</b> グルーピング</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="datahandling2.html"><a href="datahandling2.html#group_byによるグループ化"><i class="fa fa-check"></i><b>14.2.1</b> <code>group_by()</code>によるグループ化</a></li>
<li class="chapter" data-level="14.2.2" data-path="datahandling2.html"><a href="datahandling2.html#複数の変数を用いたグループ化"><i class="fa fa-check"></i><b>14.2.2</b> 複数の変数を用いたグループ化</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="datahandling2.html"><a href="datahandling2.html#handling2-mutate"><i class="fa fa-check"></i><b>14.3</b> 変数の計算</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="datahandling2.html"><a href="datahandling2.html#mutate関数の使い方"><i class="fa fa-check"></i><b>14.3.1</b> <code>mutate()</code>関数の使い方</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="datahandling2.html"><a href="datahandling2.html#handling2-rowwise"><i class="fa fa-check"></i><b>14.4</b> 行単位の操作</a></li>
<li class="chapter" data-level="14.5" data-path="datahandling2.html"><a href="datahandling2.html#handling2-merge"><i class="fa fa-check"></i><b>14.5</b> データの結合</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="datahandling2.html"><a href="datahandling2.html#行の結合"><i class="fa fa-check"></i><b>14.5.1</b> 行の結合</a></li>
<li class="chapter" data-level="14.5.2" data-path="datahandling2.html"><a href="datahandling2.html#列の結合"><i class="fa fa-check"></i><b>14.5.2</b> 列の結合</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="datahandling2.html"><a href="datahandling2.html#handling2-exercise"><i class="fa fa-check"></i><b>14.6</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="factor.html"><a href="factor.html"><i class="fa fa-check"></i><b>15</b> データハンドリング [基礎編: factor型]</a>
<ul>
<li class="chapter" data-level="15.1" data-path="factor.html"><a href="factor.html#名目変数を含むグラフを作成する際の注意点"><i class="fa fa-check"></i><b>15.1</b> 名目変数を含むグラフを作成する際の注意点</a></li>
<li class="chapter" data-level="15.2" data-path="factor.html"><a href="factor.html#forcatsパッケージについて"><i class="fa fa-check"></i><b>15.2</b> <code>forcats</code>パッケージについて</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="factor.html"><a href="factor.html#fct_relevel-水準の順番を変更する"><i class="fa fa-check"></i><b>15.2.1</b> <code>fct_relevel()</code>: 水準の順番を変更する</a></li>
<li class="chapter" data-level="15.2.2" data-path="factor.html"><a href="factor.html#fct_recode-水準のラベルを変更する"><i class="fa fa-check"></i><b>15.2.2</b> <code>fct_recode()</code>: 水準のラベルを変更する</a></li>
<li class="chapter" data-level="15.2.3" data-path="factor.html"><a href="factor.html#fct_rev-水準の順番を反転させる"><i class="fa fa-check"></i><b>15.2.3</b> <code>fct_rev()</code>: 水準の順番を反転させる</a></li>
<li class="chapter" data-level="15.2.4" data-path="factor.html"><a href="factor.html#fct_infreq-頻度順に順番を変更する"><i class="fa fa-check"></i><b>15.2.4</b> <code>fct_infreq()</code>: 頻度順に順番を変更する</a></li>
<li class="chapter" data-level="15.2.5" data-path="factor.html"><a href="factor.html#fct_inorder-データ内の出現順番に順番を変更する"><i class="fa fa-check"></i><b>15.2.5</b> <code>fct_inorder()</code>: データ内の出現順番に順番を変更する</a></li>
<li class="chapter" data-level="15.2.6" data-path="factor.html"><a href="factor.html#fct_shift-水準の順番をずらす"><i class="fa fa-check"></i><b>15.2.6</b> <code>fct_shift()</code>: 水準の順番をずらす</a></li>
<li class="chapter" data-level="15.2.7" data-path="factor.html"><a href="factor.html#fct_shuffle-水準の順番をランダム化する"><i class="fa fa-check"></i><b>15.2.7</b> <code>fct_shuffle()</code>: 水準の順番をランダム化する</a></li>
<li class="chapter" data-level="15.2.8" data-path="factor.html"><a href="factor.html#fct_reorder-別の1変数の値を基準に水準の順番を変更する"><i class="fa fa-check"></i><b>15.2.8</b> <code>fct_reorder()</code>: 別の1変数の値を基準に水準の順番を変更する</a></li>
<li class="chapter" data-level="15.2.9" data-path="factor.html"><a href="factor.html#fct_reorder2-別の2変数の値を基準に水準の順番を変更する"><i class="fa fa-check"></i><b>15.2.9</b> <code>fct_reorder2()</code>: 別の2変数の値を基準に水準の順番を変更する</a></li>
<li class="chapter" data-level="15.2.10" data-path="factor.html"><a href="factor.html#fct_collapse-水準を統合する"><i class="fa fa-check"></i><b>15.2.10</b> <code>fct_collapse()</code>: 水準を統合する</a></li>
<li class="chapter" data-level="15.2.11" data-path="factor.html"><a href="factor.html#fct_drop-使われていない水準を除去する"><i class="fa fa-check"></i><b>15.2.11</b> <code>fct_drop()</code>: 使われていない水準を除去する</a></li>
<li class="chapter" data-level="15.2.12" data-path="factor.html"><a href="factor.html#fct_expand-水準を追加する"><i class="fa fa-check"></i><b>15.2.12</b> <code>fct_expand()</code>: 水準を追加する</a></li>
<li class="chapter" data-level="15.2.13" data-path="factor.html"><a href="factor.html#fct_explicit_na-欠損値に水準を与える"><i class="fa fa-check"></i><b>15.2.13</b> <code>fct_explicit_na()</code>: 欠損値に水準を与える</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="factor.html"><a href="factor.html#factor-excersie"><i class="fa fa-check"></i><b>15.3</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="tidydata.html"><a href="tidydata.html"><i class="fa fa-check"></i><b>16</b> 整然データ構造</a>
<ul>
<li class="chapter" data-level="16.1" data-path="tidydata.html"><a href="tidydata.html#tidydata-intro"><i class="fa fa-check"></i><b>16.1</b> 整然データ (tidy data)とは</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="tidydata.html"><a href="tidydata.html#つの列は1つの変数を表す"><i class="fa fa-check"></i><b>16.1.1</b> 1つの列は、1つの変数を表す</a></li>
<li class="chapter" data-level="16.1.2" data-path="tidydata.html"><a href="tidydata.html#つの行は1つの観測を表す"><i class="fa fa-check"></i><b>16.1.2</b> 1つの行は、1つの観測を表す</a></li>
<li class="chapter" data-level="16.1.3" data-path="tidydata.html"><a href="tidydata.html#つのセルは1つの値を表す"><i class="fa fa-check"></i><b>16.1.3</b> 1つのセルは、1つの値を表す</a></li>
<li class="chapter" data-level="16.1.4" data-path="tidydata.html"><a href="tidydata.html#つの表は1つの観測単位をもつ"><i class="fa fa-check"></i><b>16.1.4</b> 1つの表は、1つの観測単位をもつ</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="tidydata.html"><a href="tidydata.html#tidydata-gather"><i class="fa fa-check"></i><b>16.2</b> Wide型からLong型へ</a></li>
<li class="chapter" data-level="16.3" data-path="tidydata.html"><a href="tidydata.html#tidydata-spread"><i class="fa fa-check"></i><b>16.3</b> Long型からWide型へ</a></li>
<li class="chapter" data-level="16.4" data-path="tidydata.html"><a href="tidydata.html#tidydata-separate"><i class="fa fa-check"></i><b>16.4</b> 列の操作</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="visualization1.html"><a href="visualization1.html"><i class="fa fa-check"></i><b>17</b> 可視化[理論]</a>
<ul>
<li class="chapter" data-level="17.1" data-path="visualization1.html"><a href="visualization1.html#visual-packages"><i class="fa fa-check"></i><b>17.1</b> 可視化のためのパッケージ</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="visualization1.html"><a href="visualization1.html#base-r"><i class="fa fa-check"></i><b>17.1.1</b> Base R</a></li>
<li class="chapter" data-level="17.1.2" data-path="visualization1.html"><a href="visualization1.html#latticeパッケージ"><i class="fa fa-check"></i><b>17.1.2</b> <code>lattice</code>パッケージ</a></li>
<li class="chapter" data-level="17.1.3" data-path="visualization1.html"><a href="visualization1.html#ggplot2パッケージ"><i class="fa fa-check"></i><b>17.1.3</b> <code>ggplot2</code>パッケージ</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="visualization1.html"><a href="visualization1.html#visual-ggplot"><i class="fa fa-check"></i><b>17.2</b> グラフィックの文法</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="visualization1.html"><a href="visualization1.html#グラフィックの文法"><i class="fa fa-check"></i><b>17.2.1</b> グラフィックの文法</a></li>
<li class="chapter" data-level="17.2.2" data-path="visualization1.html"><a href="visualization1.html#ggplot2のイメージ"><i class="fa fa-check"></i><b>17.2.2</b> ggplot2のイメージ</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="visualization1.html"><a href="visualization1.html#グラフィックの構成要素"><i class="fa fa-check"></i><b>17.3</b> グラフィックの構成要素</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="visualization1.html"><a href="visualization1.html#データ"><i class="fa fa-check"></i><b>17.3.1</b> データ</a></li>
<li class="chapter" data-level="17.3.2" data-path="visualization1.html"><a href="visualization1.html#幾何オブジェクト"><i class="fa fa-check"></i><b>17.3.2</b> 幾何オブジェクト</a></li>
<li class="chapter" data-level="17.3.3" data-path="visualization1.html"><a href="visualization1.html#マッピング"><i class="fa fa-check"></i><b>17.3.3</b> マッピング</a></li>
<li class="chapter" data-level="17.3.4" data-path="visualization1.html"><a href="visualization1.html#マッピング-その他"><i class="fa fa-check"></i><b>17.3.4</b> マッピング: その他</a></li>
<li class="chapter" data-level="17.3.5" data-path="visualization1.html"><a href="visualization1.html#座標系"><i class="fa fa-check"></i><b>17.3.5</b> 座標系</a></li>
<li class="chapter" data-level="17.3.6" data-path="visualization1.html"><a href="visualization1.html#スケール"><i class="fa fa-check"></i><b>17.3.6</b> スケール</a></li>
<li class="chapter" data-level="17.3.7" data-path="visualization1.html"><a href="visualization1.html#ファセット"><i class="fa fa-check"></i><b>17.3.7</b> ファセット</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="visualization1.html"><a href="visualization1.html#visual-principal"><i class="fa fa-check"></i><b>17.4</b> 良いグラフとは</a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="visualization1.html"><a href="visualization1.html#データインク比"><i class="fa fa-check"></i><b>17.4.1</b> データ・インク比</a></li>
<li class="chapter" data-level="17.4.2" data-path="visualization1.html"><a href="visualization1.html#次元プロット"><i class="fa fa-check"></i><b>17.4.2</b> 3次元プロット</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="visualization2.html"><a href="visualization2.html"><i class="fa fa-check"></i><b>18</b> 可視化[基礎]</a>
<ul>
<li class="chapter" data-level="18.1" data-path="visualization2.html"><a href="visualization2.html#本章の内容"><i class="fa fa-check"></i><b>18.1</b> 本章の内容</a></li>
<li class="chapter" data-level="18.2" data-path="visualization2.html"><a href="visualization2.html#visual2-data"><i class="fa fa-check"></i><b>18.2</b> 実習用データ</a></li>
<li class="chapter" data-level="18.3" data-path="visualization2.html"><a href="visualization2.html#visual2-barplot"><i class="fa fa-check"></i><b>18.3</b> 棒グラフ</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="visualization2.html"><a href="visualization2.html#ケース数のグラフ"><i class="fa fa-check"></i><b>18.3.1</b> ケース数のグラフ</a></li>
<li class="chapter" data-level="18.3.2" data-path="visualization2.html"><a href="visualization2.html#記述統計量のグラフ"><i class="fa fa-check"></i><b>18.3.2</b> 記述統計量のグラフ</a></li>
<li class="chapter" data-level="18.3.3" data-path="visualization2.html"><a href="visualization2.html#次元を追加する"><i class="fa fa-check"></i><b>18.3.3</b> 次元を追加する</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="visualization2.html"><a href="visualization2.html#visual2-histogram"><i class="fa fa-check"></i><b>18.4</b> ヒストグラム</a>
<ul>
<li class="chapter" data-level="18.4.1" data-path="visualization2.html"><a href="visualization2.html#ヒストグラムの棒の大きさを調整する"><i class="fa fa-check"></i><b>18.4.1</b> ヒストグラムの棒の大きさを調整する</a></li>
<li class="chapter" data-level="18.4.2" data-path="visualization2.html"><a href="visualization2.html#密度を追加する"><i class="fa fa-check"></i><b>18.4.2</b> 密度を追加する</a></li>
<li class="chapter" data-level="18.4.3" data-path="visualization2.html"><a href="visualization2.html#次元を追加する-1"><i class="fa fa-check"></i><b>18.4.3</b> 次元を追加する</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="visualization2.html"><a href="visualization2.html#visual2-box"><i class="fa fa-check"></i><b>18.5</b> 箱ひげ図</a>
<ul>
<li class="chapter" data-level="18.5.1" data-path="visualization2.html"><a href="visualization2.html#個別のデータを表示する"><i class="fa fa-check"></i><b>18.5.1</b> 個別のデータを表示する</a></li>
<li class="chapter" data-level="18.5.2" data-path="visualization2.html"><a href="visualization2.html#次元を追加する-2"><i class="fa fa-check"></i><b>18.5.2</b> 次元を追加する</a></li>
<li class="chapter" data-level="18.5.3" data-path="visualization2.html"><a href="visualization2.html#複数の変数の場合"><i class="fa fa-check"></i><b>18.5.3</b> 複数の変数の場合</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="visualization2.html"><a href="visualization2.html#visual2-scatter"><i class="fa fa-check"></i><b>18.6</b> 散布図</a>
<ul>
<li class="chapter" data-level="18.6.1" data-path="visualization2.html"><a href="visualization2.html#次元を追加する-3"><i class="fa fa-check"></i><b>18.6.1</b> 次元を追加する</a></li>
<li class="chapter" data-level="18.6.2" data-path="visualization2.html"><a href="visualization2.html#一部の点をハイライトする"><i class="fa fa-check"></i><b>18.6.2</b> 一部の点をハイライトする</a></li>
</ul></li>
<li class="chapter" data-level="18.7" data-path="visualization2.html"><a href="visualization2.html#visual2-line"><i class="fa fa-check"></i><b>18.7</b> 折れ線グラフ</a>
<ul>
<li class="chapter" data-level="18.7.1" data-path="visualization2.html"><a href="visualization2.html#一部の線をハイライトする"><i class="fa fa-check"></i><b>18.7.1</b> 一部の線をハイライトする</a></li>
</ul></li>
<li class="chapter" data-level="18.8" data-path="visualization2.html"><a href="visualization2.html#図の保存"><i class="fa fa-check"></i><b>18.8</b> 図の保存</a>
<ul>
<li class="chapter" data-level="18.8.1" data-path="visualization2.html"><a href="visualization2.html#ggsaveを利用した図の保存"><i class="fa fa-check"></i><b>18.8.1</b> <code>ggsave()</code>を利用した図の保存</a></li>
<li class="chapter" data-level="18.8.2" data-path="visualization2.html"><a href="visualization2.html#quartzを利用した図の保存"><i class="fa fa-check"></i><b>18.8.2</b> <code>quartz()</code>を利用した図の保存</a></li>
</ul></li>
<li class="chapter" data-level="18.9" data-path="visualization2.html"><a href="visualization2.html#まとめ"><i class="fa fa-check"></i><b>18.9</b> まとめ</a></li>
<li class="chapter" data-level="18.10" data-path="visualization2.html"><a href="visualization2.html#visual2-excersie"><i class="fa fa-check"></i><b>18.10</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="visualization3.html"><a href="visualization3.html"><i class="fa fa-check"></i><b>19</b> 可視化[応用]</a>
<ul>
<li class="chapter" data-level="19.1" data-path="visualization3.html"><a href="visualization3.html#visual3-labs"><i class="fa fa-check"></i><b>19.1</b> <code>labs()</code>: ラベルの修正</a></li>
<li class="chapter" data-level="19.2" data-path="visualization3.html"><a href="visualization3.html#visual3-coordinate"><i class="fa fa-check"></i><b>19.2</b> <code>coord_*()</code>: 座標系の調整</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="visualization3.html"><a href="visualization3.html#直交座標系の操作"><i class="fa fa-check"></i><b>19.2.1</b> 直交座標系の操作</a></li>
<li class="chapter" data-level="19.2.2" data-path="visualization3.html"><a href="visualization3.html#座標系の変換"><i class="fa fa-check"></i><b>19.2.2</b> 座標系の変換</a></li>
<li class="chapter" data-level="19.2.3" data-path="visualization3.html"><a href="visualization3.html#座標系の回転"><i class="fa fa-check"></i><b>19.2.3</b> 座標系の回転</a></li>
<li class="chapter" data-level="19.2.4" data-path="visualization3.html"><a href="visualization3.html#座標系の固定"><i class="fa fa-check"></i><b>19.2.4</b> 座標系の固定</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="visualization3.html"><a href="visualization3.html#visual3-scale"><i class="fa fa-check"></i><b>19.3</b> <code>scale_*_*()</code>: スケールの調整</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="visualization3.html"><a href="visualization3.html#横軸縦軸スケールの調整"><i class="fa fa-check"></i><b>19.3.1</b> 横軸・縦軸スケールの調整</a></li>
<li class="chapter" data-level="19.3.2" data-path="visualization3.html"><a href="visualization3.html#colorスケールの調整"><i class="fa fa-check"></i><b>19.3.2</b> <code>color</code>スケールの調整</a></li>
<li class="chapter" data-level="19.3.3" data-path="visualization3.html"><a href="visualization3.html#alphaスケールの調整"><i class="fa fa-check"></i><b>19.3.3</b> <code>alpha</code>スケールの調整</a></li>
<li class="chapter" data-level="19.3.4" data-path="visualization3.html"><a href="visualization3.html#sizeスケールの調整"><i class="fa fa-check"></i><b>19.3.4</b> <code>size</code>スケールの調整</a></li>
<li class="chapter" data-level="19.3.5" data-path="visualization3.html"><a href="visualization3.html#shapelinetypeスケールの調整"><i class="fa fa-check"></i><b>19.3.5</b> <code>shape</code>、<code>linetype</code>スケールの調整</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="visualization3.html"><a href="visualization3.html#visual3-theme"><i class="fa fa-check"></i><b>19.4</b> <code>theme_*()</code>と<code>theme()</code>: テーマの指定</a></li>
<li class="chapter" data-level="19.5" data-path="visualization3.html"><a href="visualization3.html#visual3-merge"><i class="fa fa-check"></i><b>19.5</b> 図の結合</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="visualization4.html"><a href="visualization4.html"><i class="fa fa-check"></i><b>20</b> 可視化[発展]</a>
<ul>
<li class="chapter" data-level="20.1" data-path="visualization4.html"><a href="visualization4.html#visual4-violin"><i class="fa fa-check"></i><b>20.1</b> バイオリンプロット</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="datahandling3.html"><a href="datahandling3.html"><i class="fa fa-check"></i><b>21</b> データハンドリング[応用編]</a></li>
<li class="chapter" data-level="22" data-path="string.html"><a href="string.html"><i class="fa fa-check"></i><b>22</b> 文字列の処理</a></li>
<li class="chapter" data-level="23" data-path="scraping.html"><a href="scraping.html"><i class="fa fa-check"></i><b>23</b> スクレイピング</a></li>
<li class="chapter" data-level="24" data-path="iteration.html"><a href="iteration.html"><i class="fa fa-check"></i><b>24</b> 反復処理</a>
<ul>
<li class="chapter" data-level="24.1" data-path="iteration.html"><a href="iteration.html#iteration-abstract"><i class="fa fa-check"></i><b>24.1</b> 概要</a></li>
<li class="chapter" data-level="24.2" data-path="iteration.html"><a href="iteration.html#iteration-intro"><i class="fa fa-check"></i><b>24.2</b> <code>*apply()</code>関数群と<code>map_*()</code>関数群</a></li>
<li class="chapter" data-level="24.3" data-path="iteration.html"><a href="iteration.html#iteration-two-arguments"><i class="fa fa-check"></i><b>24.3</b> 引数が2つ以上の場合</a></li>
<li class="chapter" data-level="24.4" data-path="iteration.html"><a href="iteration.html#iteration-df"><i class="fa fa-check"></i><b>24.4</b> データフレームと{purrr}</a>
<ul>
<li class="chapter" data-level="24.4.1" data-path="iteration.html"><a href="iteration.html#iteration-tibble"><i class="fa fa-check"></i><b>24.4.1</b> tibbleの話</a></li>
</ul></li>
<li class="chapter" data-level="24.5" data-path="iteration.html"><a href="iteration.html#iteration-model1"><i class="fa fa-check"></i><b>24.5</b> モデルの反復推定</a>
<ul>
<li class="chapter" data-level="24.5.1" data-path="iteration.html"><a href="iteration.html#iteration-split1"><i class="fa fa-check"></i><b>24.5.1</b> サンプルの分割とモデル推定（<code>split()</code>利用）</a></li>
<li class="chapter" data-level="24.5.2" data-path="iteration.html"><a href="iteration.html#iteration-split2"><i class="fa fa-check"></i><b>24.5.2</b> サンプルの分割とモデル推定（<code>nest()</code>利用）</a></li>
<li class="chapter" data-level="24.5.3" data-path="iteration.html"><a href="iteration.html#iteration-range"><i class="fa fa-check"></i><b>24.5.3</b> データの範囲を指定したモデル推定</a></li>
<li class="chapter" data-level="24.5.4" data-path="iteration.html"><a href="iteration.html#iteration-variables"><i class="fa fa-check"></i><b>24.5.4</b> 説明・応答変数を指定したモデル推定</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="25" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>25</b> R Markdown [基礎]</a>
<ul>
<li class="chapter" data-level="25.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-intro"><i class="fa fa-check"></i><b>25.1</b> R Markdownとは</a></li>
<li class="chapter" data-level="25.2" data-path="rmarkdown.html"><a href="rmarkdown.html#とりあえずknit"><i class="fa fa-check"></i><b>25.2</b> とりあえずKnit</a></li>
<li class="chapter" data-level="25.3" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-grammar"><i class="fa fa-check"></i><b>25.3</b> Markdown文法の基本</a>
<ul>
<li class="chapter" data-level="25.3.1" data-path="rmarkdown.html"><a href="rmarkdown.html#改行-1"><i class="fa fa-check"></i><b>25.3.1</b> 改行</a></li>
<li class="chapter" data-level="25.3.2" data-path="rmarkdown.html"><a href="rmarkdown.html#強調"><i class="fa fa-check"></i><b>25.3.2</b> 強調</a></li>
<li class="chapter" data-level="25.3.3" data-path="rmarkdown.html"><a href="rmarkdown.html#箇条書き"><i class="fa fa-check"></i><b>25.3.3</b> 箇条書き</a></li>
<li class="chapter" data-level="25.3.4" data-path="rmarkdown.html"><a href="rmarkdown.html#見出し"><i class="fa fa-check"></i><b>25.3.4</b> 見出し</a></li>
<li class="chapter" data-level="25.3.5" data-path="rmarkdown.html"><a href="rmarkdown.html#区切り線"><i class="fa fa-check"></i><b>25.3.5</b> 区切り線</a></li>
<li class="chapter" data-level="25.3.6" data-path="rmarkdown.html"><a href="rmarkdown.html#表"><i class="fa fa-check"></i><b>25.3.6</b> 表</a></li>
<li class="chapter" data-level="25.3.7" data-path="rmarkdown.html"><a href="rmarkdown.html#画像"><i class="fa fa-check"></i><b>25.3.7</b> 画像</a></li>
<li class="chapter" data-level="25.3.8" data-path="rmarkdown.html"><a href="rmarkdown.html#リンク"><i class="fa fa-check"></i><b>25.3.8</b> リンク</a></li>
<li class="chapter" data-level="25.3.9" data-path="rmarkdown.html"><a href="rmarkdown.html#脚注"><i class="fa fa-check"></i><b>25.3.9</b> 脚注</a></li>
<li class="chapter" data-level="25.3.10" data-path="rmarkdown.html"><a href="rmarkdown.html#数式"><i class="fa fa-check"></i><b>25.3.10</b> 数式</a></li>
<li class="chapter" data-level="25.3.11" data-path="rmarkdown.html"><a href="rmarkdown.html#引用"><i class="fa fa-check"></i><b>25.3.11</b> 引用</a></li>
<li class="chapter" data-level="25.3.12" data-path="rmarkdown.html"><a href="rmarkdown.html#コメント"><i class="fa fa-check"></i><b>25.3.12</b> コメント</a></li>
<li class="chapter" data-level="25.3.13" data-path="rmarkdown.html"><a href="rmarkdown.html#コード"><i class="fa fa-check"></i><b>25.3.13</b> コード</a></li>
</ul></li>
<li class="chapter" data-level="25.4" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-chunk"><i class="fa fa-check"></i><b>25.4</b> チャンクのオプション</a>
<ul>
<li class="chapter" data-level="25.4.1" data-path="rmarkdown.html"><a href="rmarkdown.html#チャンク名とチャンク間依存関係"><i class="fa fa-check"></i><b>25.4.1</b> チャンク名とチャンク間依存関係</a></li>
<li class="chapter" data-level="25.4.2" data-path="rmarkdown.html"><a href="rmarkdown.html#コードまたは結果の表示非常時"><i class="fa fa-check"></i><b>25.4.2</b> コードまたは結果の表示/非常時</a></li>
<li class="chapter" data-level="25.4.3" data-path="rmarkdown.html"><a href="rmarkdown.html#プロット"><i class="fa fa-check"></i><b>25.4.3</b> プロット</a></li>
<li class="chapter" data-level="25.4.4" data-path="rmarkdown.html"><a href="rmarkdown.html#コードの見栄"><i class="fa fa-check"></i><b>25.4.4</b> コードの見栄</a></li>
</ul></li>
<li class="chapter" data-level="25.5" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-header"><i class="fa fa-check"></i><b>25.5</b> ヘッダーのオプション</a>
<ul>
<li class="chapter" data-level="25.5.1" data-path="rmarkdown.html"><a href="rmarkdown.html#目次の追加"><i class="fa fa-check"></i><b>25.5.1</b> 目次の追加</a></li>
<li class="chapter" data-level="25.5.2" data-path="rmarkdown.html"><a href="rmarkdown.html#コードのハイライト"><i class="fa fa-check"></i><b>25.5.2</b> コードのハイライト</a></li>
</ul></li>
<li class="chapter" data-level="25.6" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-japanese"><i class="fa fa-check"></i><b>25.6</b> 日本語が含まれているPDFの出力</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="rmarkdown2.html"><a href="rmarkdown2.html"><i class="fa fa-check"></i><b>26</b> R Markdown [応用]</a>
<ul>
<li class="chapter" data-level="26.1" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmarkdown2-table"><i class="fa fa-check"></i><b>26.1</b> 表の作成</a></li>
<li class="chapter" data-level="26.2" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-slide"><i class="fa fa-check"></i><b>26.2</b> R Markdownを用いたスライド作成</a>
<ul>
<li class="chapter" data-level="26.2.1" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-brak"><i class="fa fa-check"></i><b>26.2.1</b> スライド区分</a></li>
<li class="chapter" data-level="26.2.2" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-chunk"><i class="fa fa-check"></i><b>26.2.2</b> コード</a></li>
<li class="chapter" data-level="26.2.3" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-highlight"><i class="fa fa-check"></i><b>26.2.3</b> ハイライト</a></li>
<li class="chapter" data-level="26.2.4" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-operation"><i class="fa fa-check"></i><b>26.2.4</b> Xaringanスライドの操作</a></li>
<li class="chapter" data-level="26.2.5" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-japanese"><i class="fa fa-check"></i><b>26.2.5</b> 日本語フォントの指定</a></li>
<li class="chapter" data-level="26.2.6" data-path="rmarkdown2.html"><a href="rmarkdown2.html#スライドのpdf出力"><i class="fa fa-check"></i><b>26.2.6</b> スライドのPDF出力</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="27" data-path="solution.html"><a href="solution.html"><i class="fa fa-check"></i><b>27</b> 演習問題の回答</a>
<ul>
<li class="chapter" data-level="27.1" data-path="solution.html"><a href="solution.html#solution-rbasic"><i class="fa fa-check"></i><b>27.1</b> 基本的な操作</a></li>
<li class="chapter" data-level="27.2" data-path="solution.html"><a href="solution.html#solution-datastructure"><i class="fa fa-check"></i><b>27.2</b> データの構造</a>
<ul>
<li class="chapter" data-level="27.2.1" data-path="solution.html"><a href="solution.html#ベクトル-1"><i class="fa fa-check"></i><b>27.2.1</b> ベクトル</a></li>
<li class="chapter" data-level="27.2.2" data-path="solution.html"><a href="solution.html#行列-1"><i class="fa fa-check"></i><b>27.2.2</b> 行列</a></li>
<li class="chapter" data-level="27.2.3" data-path="solution.html"><a href="solution.html#データフレーム-1"><i class="fa fa-check"></i><b>27.2.3</b> データフレーム</a></li>
</ul></li>
<li class="chapter" data-level="27.3" data-path="solution.html"><a href="solution.html#rプログラミングの基礎"><i class="fa fa-check"></i><b>27.3</b> Rプログラミングの基礎</a></li>
<li class="chapter" data-level="27.4" data-path="solution.html"><a href="solution.html#関数の自作"><i class="fa fa-check"></i><b>27.4</b> 関数の自作</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="sessioninfo.html"><a href="sessioninfo.html"><i class="fa fa-check"></i><b>28</b> 本書の執筆環境</a></li>
<li class="chapter" data-level="29" data-path="reference.html"><a href="reference.html"><i class="fa fa-check"></i><b>29</b> 参考資料</a></li>
<li class="divider"></li>
<p style = "text-align:center;"><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="クリエイティブ・コモンズ・ライセンス" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a></p>
<p style = "text-align:center;"><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></p>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">私たちのR: ベストプラクティスの探究</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="visualization3" class="section level1" number="19">
<h1><span class="header-section-number">19.</span> 可視化[応用]</h1>
<p>　第<a href="visualization1.html#visualization1">17</a>章と第<a href="visualization2.html#visualization2">18</a>章では{ggplot2}の概念と5つの代表的なグラフ（棒、ヒストグラム、箱ひげ図、散布図、折れ線）の作り方について説明しました。本章では軸の調整、座標系の調整など、幾何オブジェクト<strong>以外</strong>のレイヤーについて説明します。第<a href="visualization2.html#visualization2">18</a>章で紹介しなかった図の作成方法については第<a href="visualization4.html#visualization4">20</a>章で解説します。</p>
<ol style="list-style-type: decimal">
<li><a href="visualization3.html#visual3-labs">ラベル</a></li>
<li><a href="visualization3.html#visual3-coordinate">座標系</a></li>
<li><a href="visualization3.html#visual3-scale">スケール</a></li>
<li><a href="visualization3.html#visual3-theme">テーマ</a></li>
<li><a href="visualization3.html#visual3-merge">図の結合</a></li>
</ol>
<p>　本章で使用するデータは第<a href="visualization2.html#visualization2">18</a>章で使用したものと同じデータを使います。データの詳細については第<a href="visualization2.html#visualization2">18</a>章を参照してください。</p>
<div class="sourceCode" id="cb1342"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1342-1"><a href="visualization3.html#cb1342-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1342-2"><a href="visualization3.html#cb1342-2"></a>Country_df &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;Data/Countries.csv&quot;</span>)</span>
<span id="cb1342-3"><a href="visualization3.html#cb1342-3"></a>COVID19_df &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;Data/COVID19_Worldwide.csv&quot;</span>, <span class="dt">guess_max =</span> <span class="dv">10000</span>)</span></code></pre></div>
<hr />
<div id="visual3-labs" class="section level2" number="19.1">
<h2><span class="header-section-number">19.1</span> <code>labs()</code>: ラベルの修正</h2>
<p>　既に<code>labs()</code>レイヤーは第<a href="visualization2.html#visualization2">18</a>章で使ったことがあるでしょう。ここでは<code>labs()</code>の仕組みについて簡単に解説します。</p>
<p>　<code>labs()</code>関数は軸、凡例、プロットのラベル（タイトルなど）を修正する際に使用する関数です。軸ラベルは横軸（<code>x</code>）と縦軸（<code>y</code>）のラベルを意味します。指定しない場合は、マッピングで指定した変数名がそのまま出力されます。これは凡例ラベルも同じです。{ggplot2}は2次元のグラフの出力に特化したパッケージであるため、出力される図には必ず横軸と縦軸があります。したがって、引数として<code>x</code>と<code>y</code>は常に指定可能です。</p>
<p>　一方、凡例はマッピングされない場合、表示されません。幾何オブジェクトの<code>aes()</code>内に<code>color</code>、<code>size</code>、<code>linetype</code>などの要素がマッピングされてから初めて凡例で表示されます。凡例が存在することは何かの要素にマッピングがされていることを意味します。このマッピング要素名（<code>color</code>、<code>size</code>、<code>linetype</code>など）を<code>labs()</code>の引数として使うことで凡例のラベルが修正されます。マッピングされていない要素に対してラベルを指定しても、図に影響はありません。たとえば、<code>Country_df</code>の一人あたりGDP（<code>GDP_per_capita</code>）を横軸、フリーダムハウスのスコア（<code>FH_Total</code>）を縦軸にした散布図を作成します。</p>
<div class="sourceCode" id="cb1343"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1343-1"><a href="visualization3.html#cb1343-1"></a>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1343-2"><a href="visualization3.html#cb1343-2"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1343-3"><a href="visualization3.html#cb1343-3"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> FH_Total, <span class="dt">y =</span> GDP_per_capita)) <span class="op">+</span></span>
<span id="cb1343-4"><a href="visualization3.html#cb1343-4"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;フリーダムハウススコア&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;一人あたりGDP (USD)&quot;</span>, </span>
<span id="cb1343-5"><a href="visualization3.html#cb1343-5"></a>         <span class="dt">color =</span> <span class="st">&quot;大陸&quot;</span>) <span class="op">+</span></span>
<span id="cb1343-6"><a href="visualization3.html#cb1343-6"></a><span class="st">    </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-676-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>　<code>geom_point()</code>は横軸と縦軸のみにマッピングをしているため、<code>labs()</code>に<code>color =</code>を指定しても何の変化もありません。そもそも凡例が存在しないからです。それでは大陸ごとに色分けした散布図に修正してみましょう。</p>
<div class="sourceCode" id="cb1344"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1344-1"><a href="visualization3.html#cb1344-1"></a>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1344-2"><a href="visualization3.html#cb1344-2"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1344-3"><a href="visualization3.html#cb1344-3"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> FH_Total, <span class="dt">y =</span> GDP_per_capita, <span class="dt">color =</span> Continent)) <span class="op">+</span></span>
<span id="cb1344-4"><a href="visualization3.html#cb1344-4"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;フリーダムハウススコア&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;一人あたりGDP (USD)&quot;</span>, </span>
<span id="cb1344-5"><a href="visualization3.html#cb1344-5"></a>         <span class="dt">color =</span> <span class="st">&quot;大陸&quot;</span>) <span class="op">+</span></span>
<span id="cb1344-6"><a href="visualization3.html#cb1344-6"></a><span class="st">    </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-677-1.png" width="480" style="display: block; margin: auto;" /></p>
<p><code>color</code>に<code>Continent</code>変数をマッピングすることによって、各点の色は何らかの情報を持つようになりました。そして各色が<code>Continent</code>のどの値に対応しているかを示すために凡例が表示されます。凡例のラベルはデフォルトは変数名（この例の場合、「Continent」）ですが、ここでは「大陸」と修正されました。</p>
<p>　ここまでが第<a href="visualization2.html#visualization2">18</a>章で使用しました<code>labs()</code>レイヤーの使い方です。他にも<code>labs()</code>は<strong>プロット</strong>のラベルを指定することもできます。ここでいう「プロットのラベル」とはプロットのタイトルとほぼ同じです。使用可能な引数は<code>title</code>、<code>subtitle</code>、<code>tag</code>です。</p>
<div class="sourceCode" id="cb1345"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1345-1"><a href="visualization3.html#cb1345-1"></a>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1345-2"><a href="visualization3.html#cb1345-2"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1345-3"><a href="visualization3.html#cb1345-3"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> FH_Total, <span class="dt">y =</span> GDP_per_capita, <span class="dt">color =</span> Continent)) <span class="op">+</span></span>
<span id="cb1345-4"><a href="visualization3.html#cb1345-4"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;フリーダムハウススコア&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;一人あたりGDP (USD)&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;大陸&quot;</span>,</span>
<span id="cb1345-5"><a href="visualization3.html#cb1345-5"></a>         <span class="dt">title =</span> <span class="st">&quot;民主主義の度合いと所得の関係&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;大陸別の傾向&quot;</span>, </span>
<span id="cb1345-6"><a href="visualization3.html#cb1345-6"></a>         <span class="dt">tag =</span> <span class="st">&quot;(a)&quot;</span>) <span class="op">+</span></span>
<span id="cb1345-7"><a href="visualization3.html#cb1345-7"></a><span class="st">    </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-678-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>　<code>title</code>は図のメインタイトルとおり、プロットのタイトルを意味します。上の図だと「民主主義の度合いと所得の関係」です。また、<code>subtitle</code>引数を指定することでサブタイトルを付けることも可能です。上の図の「大陸別の傾向」がサブタイトルです。最後の<code>tag</code>は複数の図を並べる際に便利な引数です。図が横に2つ並んでいる場合、それぞれ(a)と(b)という識別子を付けると、文中において「図3(a)は…」のように、引用しやすくなります。この「(a)」が<code>tag</code>引数に対応します。複数の図を並べる方法は本章の後半にて説明します。</p>
<p>最後にキャプションの付け方について説明します。たとえば、外部のデータを利用して作図を行った場合、図の右下に「データ出典：〜〜」や「Source: <a href="https://www.jaysong.net" class="uri">https://www.jaysong.net</a> 」などを付ける場合があります。このキャプションは<code>labs()</code>関数内に<code>caption</code>引数を指定するだけで付けることができます。たとえば、先程の図に「Source: Freedom House」を付けてみましょう。</p>
<div class="sourceCode" id="cb1346"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1346-1"><a href="visualization3.html#cb1346-1"></a>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1346-2"><a href="visualization3.html#cb1346-2"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1346-3"><a href="visualization3.html#cb1346-3"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> FH_Total, <span class="dt">y =</span> GDP_per_capita, <span class="dt">color =</span> Continent)) <span class="op">+</span></span>
<span id="cb1346-4"><a href="visualization3.html#cb1346-4"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;フリーダムハウススコア&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;一人あたりGDP (USD)&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;大陸&quot;</span>,</span>
<span id="cb1346-5"><a href="visualization3.html#cb1346-5"></a>         <span class="dt">title =</span> <span class="st">&quot;民主主義の度合いと所得の関係&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;大陸別の傾向&quot;</span>, </span>
<span id="cb1346-6"><a href="visualization3.html#cb1346-6"></a>         <span class="dt">tag =</span> <span class="st">&quot;(a)&quot;</span>, <span class="dt">caption =</span> <span class="st">&quot;Source: Freedom House&quot;</span>) <span class="op">+</span></span>
<span id="cb1346-7"><a href="visualization3.html#cb1346-7"></a><span class="st">    </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-679-1.png" width="480" style="display: block; margin: auto;" /></p>
<!--
## `guides()`: 
-->
<hr />
</div>
<div id="visual3-coordinate" class="section level2" number="19.2">
<h2><span class="header-section-number">19.2</span> <code>coord_*()</code>: 座標系の調整</h2>
<p>　{ggplot2}はいくつかの座標系を提供しています。円グラフを作成する際に使われる極座標系（<code>coord_polar()</code>）や地図の出力によく使われる<code>coord_map()</code>や<code>coord_sf()</code>がその例です。中でも最も頻繁に使われる座標系はやはり縦軸と横軸は直交する直交座標系（デカルト座標系）でしょう。ここでは直交座標系の扱い方について解説します。</p>
<div id="直交座標系の操作" class="section level3" number="19.2.1">
<h3><span class="header-section-number">19.2.1</span> 直交座標系の操作</h3>
<p>　まずは座標系の上限と下限を指定する方法から考えましょう。日米中間のCOVID-19累積感染者数の折れ線グラフを作成してみましょう。</p>
<div class="sourceCode" id="cb1347"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1347-1"><a href="visualization3.html#cb1347-1"></a>Fig1 &lt;-<span class="st"> </span>COVID19_df <span class="op">%&gt;%</span></span>
<span id="cb1347-2"><a href="visualization3.html#cb1347-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Date =</span> <span class="kw">as.Date</span>(Date)) <span class="op">%&gt;%</span></span>
<span id="cb1347-3"><a href="visualization3.html#cb1347-3"></a><span class="st">  </span><span class="kw">filter</span>(Country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Japan&quot;</span>, <span class="st">&quot;South Korea&quot;</span>, <span class="st">&quot;China&quot;</span>, <span class="st">&quot;United States&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1347-4"><a href="visualization3.html#cb1347-4"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1347-5"><a href="visualization3.html#cb1347-5"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Date, <span class="dt">y =</span> Confirmed_Total, <span class="dt">color =</span> Country)) <span class="op">+</span></span>
<span id="cb1347-6"><a href="visualization3.html#cb1347-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;月&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;累積感染者数 (人)&quot;</span>) <span class="op">+</span></span>
<span id="cb1347-7"><a href="visualization3.html#cb1347-7"></a><span class="st">  </span><span class="kw">theme_minimal</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>)</span>
<span id="cb1347-8"><a href="visualization3.html#cb1347-8"></a></span>
<span id="cb1347-9"><a href="visualization3.html#cb1347-9"></a><span class="kw">print</span>(Fig1)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-680-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>　アメリカの感染者が圧倒的に多いこともあり、日韓がほぼ同じ線に見えます。これを是正するために対数変換などを行うわけですが、対数変換したグラフは直感的ではないというデメリットがあります。それでもう一つの方法として、アメリカに関する情報は一部失われますが、縦軸の上限を10万にすることが考えられます。直交座標系の上限・下限を調整する関数が<code>coord_cartesian()</code>です。横軸は<code>xlim</code>、縦軸は<code>ylim</code>引数を指定し、実引数としては長さ2のnumericベクトルを指定します。たとえば、縦軸の下限を0、上限を10万にするなら、<code>ylim = c(0, 100000)</code>となります。先ほどの図は既に<code>Fig1</code>という名のオブジェクトとして保存されているため、ここに<code>coord_cartesian()</code>レイヤーを追加してみましょう。</p>
<div class="sourceCode" id="cb1348"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1348-1"><a href="visualization3.html#cb1348-1"></a>Fig1 <span class="op">+</span></span>
<span id="cb1348-2"><a href="visualization3.html#cb1348-2"></a><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100000</span>))</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-681-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>3月下旬以降、アメリカの情報は図から失われましたが、日中韓についてはよりトレンドの差が区別できるようになりました。{ggplot2}は座標系の上限と下限をデータの最小値と最大値に合わせて自動的に調整してくれます。たとえば、以下のような例を考えてみましょう。</p>
<div class="sourceCode" id="cb1349"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1349-1"><a href="visualization3.html#cb1349-1"></a>Fig2 &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">Class =</span> <span class="kw">paste0</span>(LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>], <span class="st">&quot;組&quot;</span>),</span>
<span id="cb1349-2"><a href="visualization3.html#cb1349-2"></a>       <span class="dt">Score =</span> <span class="kw">c</span>(<span class="dv">78</span>, <span class="dv">80</span>, <span class="dv">85</span>, <span class="dv">77</span>, <span class="dv">70</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1349-3"><a href="visualization3.html#cb1349-3"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1349-4"><a href="visualization3.html#cb1349-4"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Class, <span class="dt">y =</span> Score), <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span></span>
<span id="cb1349-5"><a href="visualization3.html#cb1349-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;クラス&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;数学成績の平均 (点)&quot;</span>) <span class="op">+</span></span>
<span id="cb1349-6"><a href="visualization3.html#cb1349-6"></a><span class="st">  </span><span class="kw">theme_minimal</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>)</span>
<span id="cb1349-7"><a href="visualization3.html#cb1349-7"></a></span>
<span id="cb1349-8"><a href="visualization3.html#cb1349-8"></a><span class="kw">print</span>(Fig2)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-682-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>　数学成績平均値は最大100点までありえますが、手元のデータにおける最高得点が85店であるため、棒グラフの縦軸の上限が85点程度となります。この場合、上限は満点である100点に調整した方が良いでしょう。</p>
<div class="sourceCode" id="cb1350"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1350-1"><a href="visualization3.html#cb1350-1"></a>Fig2 <span class="op">+</span></span>
<span id="cb1350-2"><a href="visualization3.html#cb1350-2"></a><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100</span>))</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-683-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>　このように上限を調整すると、成績の満点が何点かに関する情報が含まれ、グラフにより豊富な情報を持たせることが可能です。</p>
</div>
<div id="座標系の変換" class="section level3" number="19.2.2">
<h3><span class="header-section-number">19.2.2</span> 座標系の変換</h3>
<p>　続きまして座標系の変換について説明します。座標系の変換については実は第<a href="visualization2.html#visualization2">18</a>章でも取り上げました。対数化がその例です。例えば、連続型変数でマッピングされた横軸を底が10の対数化する場合、以下のような方法が考えれます。</p>
<ol style="list-style-type: decimal">
<li><code>log10()</code>関数を使用し、データレベルで値を対数化する</li>
<li><code>scale_x_continuous()</code>レイヤーを重ね、<code>trans = "log10"</code>引数を指定する</li>
<li><code>scale_x_log10()</code>レイヤーを重ねる</li>
<li><code>coord_trans()</code>レイヤーを重ね、<code>x = "log10"</code>引数を指定する</li>
</ol>
<p>　どの方法でも得られる結果はさほど変わりませんが、<code>coord_trans()</code>は座標系全般を調整することができます。たとえば、<code>xlim</code>や<code>ylim</code>引数を使って座標系の上限と下限を同時に指定することも可能です。たとえば、座標系の上限を横軸は[0, 100]、縦軸は[-100, 100]とし、全て対数化を行うとします。方法はいくつか考えられます。たとえば、<code>scale_*_log10()</code>と<code>coord_cartesian()</code>を組み合わせることもできます。</p>
<div class="sourceCode" id="cb1351"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1351-1"><a href="visualization3.html#cb1351-1"></a><span class="co"># coord_trans()を使用しない場合</span></span>
<span id="cb1351-2"><a href="visualization3.html#cb1351-2"></a>ggplotオブジェクト <span class="op">+</span></span>
<span id="cb1351-3"><a href="visualization3.html#cb1351-3"></a><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></span>
<span id="cb1351-4"><a href="visualization3.html#cb1351-4"></a><span class="st">  </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></span>
<span id="cb1351-5"><a href="visualization3.html#cb1351-5"></a><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>, <span class="dv">100</span>))</span></code></pre></div>
<p>　しかし、上のコードは<code>coord_trans()</code>を使うと一行にまとめることができます。</p>
<div class="sourceCode" id="cb1352"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1352-1"><a href="visualization3.html#cb1352-1"></a><span class="co"># coord_trans()を使用する場合</span></span>
<span id="cb1352-2"><a href="visualization3.html#cb1352-2"></a>ggplotオブジェクト <span class="op">+</span></span>
<span id="cb1352-3"><a href="visualization3.html#cb1352-3"></a><span class="st">  </span><span class="kw">coord_trans</span>(<span class="dt">x =</span> <span class="st">&quot;log10&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;log10&quot;</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>, <span class="dv">100</span>))</span></code></pre></div>
<p>　<code>coord_trans()</code>の<code>x</code>、<code>y</code>引数は<code>"log10"</code>以外にもあります。自然対数変換の<code>"log"</code>、反転を意味する<code>"reverse"</code>、平方根へ変換する<code>"sqrt"</code>などがあります。グラフを上下、または左右に反転する<code>"reverse"</code>は覚えておいて損はないでしょう。こちらは具体的には{tidyverse}パッケージ群に含まれている{scales}パッケージにある<code>*_trans()</code>関数に対応することになります。詳細は{scales}パッケージのヘルプを参照してください。</p>
</div>
<div id="座標系の回転" class="section level3" number="19.2.3">
<h3><span class="header-section-number">19.2.3</span> 座標系の回転</h3>
<p>　続きまして座標系を反時計方向回転する<code>coord_flip()</code>について紹介します。以下は<code>Country_df</code>を用い、大陸（<code>Continent</code>）ごとにPolity IVスコア（<code>Polity_Score</code>）の平均値を示した棒グラフです。</p>
<div class="sourceCode" id="cb1353"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1353-1"><a href="visualization3.html#cb1353-1"></a>Flip_Fig &lt;-<span class="st"> </span>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1353-2"><a href="visualization3.html#cb1353-2"></a><span class="st">  </span><span class="kw">group_by</span>(Continent) <span class="op">%&gt;%</span></span>
<span id="cb1353-3"><a href="visualization3.html#cb1353-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Democracy =</span> <span class="kw">mean</span>(Polity_Score, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb1353-4"><a href="visualization3.html#cb1353-4"></a>            <span class="dt">.groups   =</span> <span class="st">&quot;drop&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1353-5"><a href="visualization3.html#cb1353-5"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1353-6"><a href="visualization3.html#cb1353-6"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Continent, <span class="dt">y =</span> Democracy), <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span></span>
<span id="cb1353-7"><a href="visualization3.html#cb1353-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;大陸&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Polity IV スコアの平均値&quot;</span>) <span class="op">+</span></span>
<span id="cb1353-8"><a href="visualization3.html#cb1353-8"></a><span class="st">  </span><span class="kw">theme_minimal</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>)</span>
<span id="cb1353-9"><a href="visualization3.html#cb1353-9"></a></span>
<span id="cb1353-10"><a href="visualization3.html#cb1353-10"></a><span class="kw">print</span>(Flip_Fig)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-686-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>　この図を反時計方向回転する場合は以上のプロットに<code>coord_flip()</code>レイヤーを追加します。</p>
<div class="sourceCode" id="cb1354"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1354-1"><a href="visualization3.html#cb1354-1"></a>Flip_Fig <span class="op">+</span></span>
<span id="cb1354-2"><a href="visualization3.html#cb1354-2"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="co"># 座標系の回転</span></span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-687-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>　非常に簡単な方法で図を回転させることができました。しかし、実はこの<code>coord_flip()</code>関数、最近になって使う場面がどんどん減っています。たとえば、先ほどの<code>geom_bar()</code>幾何オブジェクトの場合、<code>x</code>をPolity IVスコアの平均値で、<code>y</code>を大陸名でマッピングすることが可能です。昔の{ggplot2}は横軸と縦軸にマッピングでいるデータ型が厳格に決まっていましたが、最近になってはますます柔軟となってきました<a href="#fn81" class="footnote-ref" id="fnref81"><sup>81</sup></a>。<code>coord_flip()</code>を使用する前に、各幾何オブジェクトのヘルプを確認し、<code>coord_flip()</code>を用いた回転が必要か否かを予め調べておくのも良いでしょう。</p>
</div>
<div id="座標系の固定" class="section level3" number="19.2.4">
<h3><span class="header-section-number">19.2.4</span> 座標系の固定</h3>
<p>　他にも地味に便利な機能として座標系比を固定する<code>coord_fixed()</code>を紹介します。これは出力される座標系の「横:縦」を調整するレイヤーです。たとえば、以下のような散布図を考えてみましょう。</p>
<div class="sourceCode" id="cb1355"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1355-1"><a href="visualization3.html#cb1355-1"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1355-2"><a href="visualization3.html#cb1355-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">y =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>))</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-688-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>　こちらは横と縦が同じスケールでありますが、図の大きさに応じて、見た目が変わってきます。たとえば、上の図だと、横軸における1間隔は縦軸のそれの約2倍です。もし、図を上下に大きくし、左右を縮小したら同じ図でありながら随分と見た目が変わってきます。</p>
<div class="sourceCode" id="cb1356"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1356-1"><a href="visualization3.html#cb1356-1"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1356-2"><a href="visualization3.html#cb1356-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">y =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>))</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-689-1.png" width="240" style="display: block; margin: auto;" /></p>
<p>　2つの図は本質的に同じですが、図の見せ方によって、傾きが緩やかに見せたり、急に見せたりすることができます。ここで活躍するレイヤーが<code>coord_fixed()</code>です。これを追加すると横を1とした場合の縦の比率を指定することができます。</p>
<div class="sourceCode" id="cb1357"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1357-1"><a href="visualization3.html#cb1357-1"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1357-2"><a href="visualization3.html#cb1357-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">y =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)) <span class="op">+</span></span>
<span id="cb1357-3"><a href="visualization3.html#cb1357-3"></a><span class="st">  </span><span class="kw">coord_fixed</span>(<span class="dt">ratio =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-690-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>　<code>ratio = 1</code>を指定すると縦横比は1:1となり、図の高さや幅を変更してもこの軸は変わりません。たとえば、RStudioのPlotsペインの大きさを変更すると図の大きさが変わりますが、<code>coord_fixed(ratio = 1)</code>を指定すると1:1の比率は維持されるまま図が拡大・縮小されます。直接やってみましょう。</p>
<hr />
</div>
</div>
<div id="visual3-scale" class="section level2" number="19.3">
<h2><span class="header-section-number">19.3</span> <code>scale_*_*()</code>: スケールの調整</h2>
<p>　続いて<code>scale_*_*()</code>関数群を用いたスケールを解説しますが、こちらの関数は非常に多く、全てのスケールレイヤーについて解説すことは難しいです。しかし、共通する部分も非常に多いです。本説ではこの共通項に注目します。</p>
<p>　連続変数でマッピングされた横軸のスケールを調整する関数はは<code>scale_x_continuous()</code>です。ここで<code>x</code>が横軸を意味し、<code>continuous</code>が連続であることを意味します。この<code>x</code>の箇所は幾何オブジェクトの<code>aes()</code>内で指定した仮引数と一致します。つまり、<code>scale_x_continuous()</code>の<code>x</code>の箇所には<code>y</code>、<code>alpha</code>、<code>linetype</code>、<code>size</code>などがあります。そして、実引数として与えられた変数のデータ型が<code>continuous</code>の箇所に相当します。もし、離散変数なら<code>discrete</code>、時系列なら<code>time</code>、全て手動で調整する場合は<code>manual</code>を使います。他にも2020年10月現在、最近追加されたものとして<code>binned</code>があり、こちらはヒストグラムに特化したものです（<code>scale_x_binned()</code>と<code>scale_y_binned()</code>）。つまり、スケール調整関数は<code>aes()</code>内に登場した仮引数名とそのデータ型の組み合わせで出来ています。</p>
<p>　たとえば、時系列の折れ線グラフにおいて横軸のスケールを調整するなら、<code>sacle_x_time()</code>を使います。また、棒グラフのように横軸が名目変数なら<code>scale_x_manual()</code>、順序変数のような離散変数なら<code>scale_x_discrete()</code>を使います。また、連続変数の縦軸のスケール調整なら<code>scale_y_continuous()</code>を使います。グラフによっては<code>aes()</code>内に<code>x</code>または<code>y</code>を指定しないケースもあります。前章において度数の棒グラフや1つの箱ひげ図を出す場合、前者は<code>x</code>、後者は<code>y</code>のみを指定しました。これは指定されていない<code>y</code>や<code>x</code>が存在しないことを意味しません。{ggplot2}が自動的に計算しマッピングを行ってくれることを意味します。{ggplot2}で出来上がった図は2次元座標系を持つため、横軸と縦軸は必ず存在します。したがって、<code>aes()</code>内の引数と関係なく<code>scale_x_*()</code>と<code>scale_y_*()</code>関数群は使用することが出来ます。</p>
<div id="横軸縦軸スケールの調整" class="section level3" number="19.3.1">
<h3><span class="header-section-number">19.3.1</span> 横軸・縦軸スケールの調整</h3>
<p>　軸のスケールを調整する目的は1) 目盛りの調整、2) 目盛りラベルの調整、3) 第2軸の追加などがありますが、主な目的は1と2です。第2軸の追加はスケールが異なるグラフが重なる場合に使用しますが、一般的に推奨されません。したがって、ここでは1と2について説明します。</p>
<div id="連続変数の場合" class="section level4" number="19.3.1.1">
<h4><span class="header-section-number">19.3.1.1</span> 連続変数の場合</h4>
<p>　軸に連続変数がマッピングされている場合は<code>scale_*_continuous()</code>レイヤーを追加します。<code>*</code>の箇所は横軸の場合は<code>x</code>、縦軸の場合は<code>y</code>となります。それでは<code>Country_df</code>の<code>FH_Total</code>を横軸、<code>GDP_per_capita</code>を縦軸にした散布図を作成し、<code>Scale_Fig1</code>という名のオブジェクトに格納します。</p>
<div class="sourceCode" id="cb1358"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1358-1"><a href="visualization3.html#cb1358-1"></a>Scale_Fig1 &lt;-<span class="st"> </span>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1358-2"><a href="visualization3.html#cb1358-2"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1358-3"><a href="visualization3.html#cb1358-3"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> FH_Total, <span class="dt">y =</span> GDP_per_capita)) <span class="op">+</span></span>
<span id="cb1358-4"><a href="visualization3.html#cb1358-4"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;フリーダムハウススコア&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;一人あたりGDP (USD)&quot;</span>) <span class="op">+</span></span>
<span id="cb1358-5"><a href="visualization3.html#cb1358-5"></a><span class="st">    </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>)</span>
<span id="cb1358-6"><a href="visualization3.html#cb1358-6"></a></span>
<span id="cb1358-7"><a href="visualization3.html#cb1358-7"></a><span class="kw">print</span>(Scale_Fig1)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-691-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>　<code>Scale_Fig1</code>の横軸の場合、最小値0、最大値100であり、目盛りは25間隔となっております。ここではこの横軸を調整したいと思います。まず、プロットにおける最小値と最大値はスケールではなく座標系の問題ですので、<code>coord_*()</code>を使用します。ここでは目盛りを修正してみましょう。たとえば、目盛りを10間隔にし、そのラベルも0、10、20、…、100にします。<code>FH_Total</code>は連続変数ですので、<code>scale_x_continuous()</code>を使います。使い方は以下の通りです。</p>
<div class="sourceCode" id="cb1359"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1359-1"><a href="visualization3.html#cb1359-1"></a>Scale_Fig1 <span class="op">+</span></span>
<span id="cb1359-2"><a href="visualization3.html#cb1359-2"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> 目盛りの位置,</span>
<span id="cb1359-3"><a href="visualization3.html#cb1359-3"></a>                     <span class="dt">labels =</span> 目盛りのラベル)</span></code></pre></div>
<p>　<code>breaks</code>と<code>labels</code>の実引数としては数値型ベクトルを指定します。0から100まで10刻みの目盛りとラベルなら、<code>seq(0, 100, by = 10)</code>、または<code>c(0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100)</code>と指定します。</p>
<div class="sourceCode" id="cb1360"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1360-1"><a href="visualization3.html#cb1360-1"></a>Scale_Fig1 <span class="op">+</span></span>
<span id="cb1360-2"><a href="visualization3.html#cb1360-2"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dt">by =</span> <span class="dv">10</span>),</span>
<span id="cb1360-3"><a href="visualization3.html#cb1360-3"></a>                     <span class="dt">labels =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dt">by =</span> <span class="dv">10</span>))</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-693-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>　目盛りのラベルを文字型にすることも可能です。例えば、目盛りを0、50、100にし、それぞれ「最低」、「中間」、「最高」としたい場合は以下のようにします。</p>
<div class="sourceCode" id="cb1361"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1361-1"><a href="visualization3.html#cb1361-1"></a>Scale_Fig1 <span class="op">+</span></span>
<span id="cb1361-2"><a href="visualization3.html#cb1361-2"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">100</span>),</span>
<span id="cb1361-3"><a href="visualization3.html#cb1361-3"></a>                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;最低&quot;</span>, <span class="st">&quot;中間&quot;</span>, <span class="st">&quot;最高&quot;</span>))</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-694-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>　<code>scale_x_continuous()</code>は目盛りの調整が主な使い道ですが、他にも様々な機能を提供しています。たとえば、座標系の最小値と最大値の指定は<code>coord_*()</code>を使うと説明しましたが、実は<code>scale_*_continuous()</code>でも<code>limits</code>引数で指定することも可能です。たとえば、縦軸の範囲を0ドルから10万ドルにしたい場合は<code>scale_y_continuous()</code>の中に<code>limits = c(0, 100000)</code>を指定します。</p>
<div class="sourceCode" id="cb1362"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1362-1"><a href="visualization3.html#cb1362-1"></a>Scale_Fig1 <span class="op">+</span></span>
<span id="cb1362-2"><a href="visualization3.html#cb1362-2"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dt">by =</span> <span class="dv">10</span>),</span>
<span id="cb1362-3"><a href="visualization3.html#cb1362-3"></a>                     <span class="dt">labels =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dt">by =</span> <span class="dv">10</span>)) <span class="op">+</span></span>
<span id="cb1362-4"><a href="visualization3.html#cb1362-4"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100000</span>))</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-695-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>　他にも目盛りと目盛りラベルの位置を変更することも可能です。これは<code>position</code>引数を使います。基本的に横軸の目盛りは下（<code>"bottom"</code>）、縦軸は左（<code>"left"</code>）ですが、<code>"top"</code>や<code>"right"</code>を使うことも可能です。もし、縦軸の目盛りとラベル、軸のラベルを右側にしたい場合は<code>scale_y_continuous()</code>の中に<code>position = "right"</code>を指定します。</p>
<div class="sourceCode" id="cb1363"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1363-1"><a href="visualization3.html#cb1363-1"></a>Scale_Fig1 <span class="op">+</span></span>
<span id="cb1363-2"><a href="visualization3.html#cb1363-2"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">position =</span> <span class="st">&quot;right&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-696-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="離散変数の場合" class="section level4" number="19.3.1.2">
<h4><span class="header-section-number">19.3.1.2</span> 離散変数の場合</h4>
<p>　もし、軸が名目変数や順序変数のような離散変数でマッピングされている場合は、<code>scale_*_discrete()</code>を使います。たとえば、座標系の回転の例で使いました<code>Flip_Fig</code>の場合、横軸の大陸名が英語のままになっています。これを日本語にする場合、データレベルで大陸名を日本語で置換することも可能ですが、<code>scale_x_discrete()</code>を使うことも可能です。使い方は<code>scale_*_continuous()</code>と同じであり、<code>breaks</code>と<code>labels</code>引数を指定するだけです。</p>
<div class="sourceCode" id="cb1364"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1364-1"><a href="visualization3.html#cb1364-1"></a>Flip_Fig <span class="op">+</span></span>
<span id="cb1364-2"><a href="visualization3.html#cb1364-2"></a><span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;Africa&quot;</span>, <span class="st">&quot;America&quot;</span>, <span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Oceania&quot;</span>),</span>
<span id="cb1364-3"><a href="visualization3.html#cb1364-3"></a>                   <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;アフリカ&quot;</span>, <span class="st">&quot;アメリカ&quot;</span>, <span class="st">&quot;アジア&quot;</span>, <span class="st">&quot;ヨーロッパ&quot;</span>, <span class="st">&quot;オセアニア&quot;</span>))</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-697-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>　今回は大陸名が文字型の列でしたが、factor型の場合、いくつか便利な機能が使えます。たとえば、<code>Polity_Type</code>ごとに国数を計算し、棒グラフを作成するとします。</p>
<div class="sourceCode" id="cb1365"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1365-1"><a href="visualization3.html#cb1365-1"></a>Scale_df1 &lt;-<span class="st"> </span>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1365-2"><a href="visualization3.html#cb1365-2"></a><span class="st">  </span><span class="kw">group_by</span>(Polity_Type) <span class="op">%&gt;%</span></span>
<span id="cb1365-3"><a href="visualization3.html#cb1365-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">N       =</span> <span class="kw">n</span>(),</span>
<span id="cb1365-4"><a href="visualization3.html#cb1365-4"></a>            <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span>)</span>
<span id="cb1365-5"><a href="visualization3.html#cb1365-5"></a></span>
<span id="cb1365-6"><a href="visualization3.html#cb1365-6"></a>Scale_df1</span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   Polity_Type         N
##   &lt;chr&gt;           &lt;int&gt;
## 1 Autocracy          19
## 2 Closed Anocracy    23
## 3 Democracy          65
## 4 Full Democracy     31
## 5 Open Anocracy      20
## 6 &lt;NA&gt;               28</code></pre>
<p>　続きまして、<code>Polity_Type</code>列をfactor型にします。最もスコアの低い独裁（Autocracy）から最もスコアの高い完全な民主主義（Full Democracy）の順番のfactorにします。</p>
<div class="sourceCode" id="cb1367"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1367-1"><a href="visualization3.html#cb1367-1"></a>Scale_df1 &lt;-<span class="st"> </span>Scale_df1 <span class="op">%&gt;%</span></span>
<span id="cb1367-2"><a href="visualization3.html#cb1367-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Polity_Type =</span> <span class="kw">factor</span>(Polity_Type, <span class="dt">ordered =</span> <span class="ot">TRUE</span>,</span>
<span id="cb1367-3"><a href="visualization3.html#cb1367-3"></a>                              <span class="dt">levels  =</span> <span class="kw">c</span>(<span class="st">&quot;Autocracy&quot;</span>,</span>
<span id="cb1367-4"><a href="visualization3.html#cb1367-4"></a>                                          <span class="st">&quot;Closed Anocracy&quot;</span>,</span>
<span id="cb1367-5"><a href="visualization3.html#cb1367-5"></a>                                          <span class="st">&quot;Open Anocracy&quot;</span>,</span>
<span id="cb1367-6"><a href="visualization3.html#cb1367-6"></a>                                          <span class="st">&quot;Democracy&quot;</span>,</span>
<span id="cb1367-7"><a href="visualization3.html#cb1367-7"></a>                                          <span class="st">&quot;Full Democracy&quot;</span>)))</span>
<span id="cb1367-8"><a href="visualization3.html#cb1367-8"></a></span>
<span id="cb1367-9"><a href="visualization3.html#cb1367-9"></a>Scale_df1<span class="op">$</span>Polity_Type</span></code></pre></div>
<pre><code>## [1] Autocracy       Closed Anocracy
## [3] Democracy       Full Democracy 
## [5] Open Anocracy   &lt;NA&gt;           
## 5 Levels: Autocracy &lt; ... &lt; Full Democracy</code></pre>
<p>　問題なくfactor化も出来たので、それでは作図をしてみましょう。</p>
<div class="sourceCode" id="cb1369"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1369-1"><a href="visualization3.html#cb1369-1"></a>Scale_df1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1369-2"><a href="visualization3.html#cb1369-2"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1369-3"><a href="visualization3.html#cb1369-3"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Polity_Type, <span class="dt">y =</span> N), <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-700-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>　Polityプロジェクトの対象外があり、この場合は欠損値（<code>NA</code>）になります。そして、問題はこの欠損値も表示されることです。むろん、欠損値のカテゴリも出力したいケースもありますが、もし欠損値カテゴリの棒を消すにはどうすれば良いでしょうか。1つ目の方法は<code>Scale_df1 %&gt;% drop_na()</code>で欠損値を含む行を除去してから作図する方法です。2つ目の方法は<code>scale_x_discrete()</code>で<code>na.translate = FALSE</code>を指定する方法です。ここでは横軸の目盛りラベルも日本語に変更し、欠損値のカテゴリを除外してみましょう。また、地味に便利な機能として、軸ラベルも<code>scale_*_*()</code>で指定可能です。第1引数として長さ1の文字ベクトルを指定すると、自動的に軸ラベルが修正され、<code>labs()</code>が不要となります。</p>
<div class="sourceCode" id="cb1370"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1370-1"><a href="visualization3.html#cb1370-1"></a>Scale_df1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1370-2"><a href="visualization3.html#cb1370-2"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1370-3"><a href="visualization3.html#cb1370-3"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Polity_Type, <span class="dt">y =</span> N), <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span></span>
<span id="cb1370-4"><a href="visualization3.html#cb1370-4"></a><span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="st">&quot;Polity IV スコア&quot;</span>, <span class="co"># 第1引数で軸ラベルも指定可能</span></span>
<span id="cb1370-5"><a href="visualization3.html#cb1370-5"></a>                   <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;Autocracy&quot;</span>, <span class="st">&quot;Closed Anocracy&quot;</span>, <span class="st">&quot;Open Anocracy&quot;</span>,</span>
<span id="cb1370-6"><a href="visualization3.html#cb1370-6"></a>                              <span class="st">&quot;Democracy&quot;</span>, <span class="st">&quot;Full Democracy&quot;</span>),</span>
<span id="cb1370-7"><a href="visualization3.html#cb1370-7"></a>                   <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;独裁&quot;</span>, <span class="st">&quot;閉じられたアノクラシー&quot;</span>,</span>
<span id="cb1370-8"><a href="visualization3.html#cb1370-8"></a>                              <span class="st">&quot;開かれたアノクラシー&quot;</span>, <span class="st">&quot;民主主義&quot;</span>,</span>
<span id="cb1370-9"><a href="visualization3.html#cb1370-9"></a>                              <span class="st">&quot;完全な民主主義&quot;</span>),</span>
<span id="cb1370-10"><a href="visualization3.html#cb1370-10"></a>                   <span class="dt">na.translate =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb1370-11"><a href="visualization3.html#cb1370-11"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;国数&quot;</span>) <span class="op">+</span></span>
<span id="cb1370-12"><a href="visualization3.html#cb1370-12"></a><span class="st">  </span><span class="kw">theme_minimal</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-701-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>これで欠損値を除外することができました。目盛りラベルが重なる箇所があり、多少気になりますが、この問題に関しては第<a href="visualization3.html#visual3-theme">19.4</a>節で取り上げます。</p>
</div>
</div>
<div id="colorスケールの調整" class="section level3" number="19.3.2">
<h3><span class="header-section-number">19.3.2</span> <code>color</code>スケールの調整</h3>
<p>　グラフの次元を増やす際において広く使われている方法は変数の値に応じて色分けをすることでした。この場合、幾何オブジェクトの<code>aes()</code>内に<code>color = マッピングする変数名</code>を指定することになります。このように色が変数でマッピングされている場合は、色分けのスケールも調整可能です。たとえば、折れ線グラフにおいて日本が赤い線だったのを青い線に変更することが考えられます。ここでも<code>color</code>にマッピングされている変数のデータ型によって使用する関数が変わります。ここでは連続変数、順序付き離散変数、順序なし離散変数について説明します。</p>
<div id="color引数が連続変数でマッピングされている場合" class="section level4" number="19.3.2.1">
<h4><span class="header-section-number">19.3.2.1</span> <code>color</code>引数が連続変数でマッピングされている場合</h4>
<p>　まずは、連続変数からです。横軸は底10の対数変換した一人あたりGDP（<code>GDP_per_capita</code>）、縦軸は人間開発指数（<code>HDI_2018</code>）にした散布図を作成し、Polity IVスコア（<code>Polity_Score</code>）で点の色分けをしてみましょう。</p>
<div class="sourceCode" id="cb1371"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1371-1"><a href="visualization3.html#cb1371-1"></a>Scale_Fig2 &lt;-<span class="st"> </span>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1371-2"><a href="visualization3.html#cb1371-2"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1371-3"><a href="visualization3.html#cb1371-3"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> GDP_per_capita, <span class="dt">y =</span> HDI_<span class="dv">2018</span>, <span class="dt">color =</span> Polity_Score)) <span class="op">+</span></span>
<span id="cb1371-4"><a href="visualization3.html#cb1371-4"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;一人あたりGDP (USD)&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;人間開発指数&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;Polity IVスコア&quot;</span>) <span class="op">+</span></span>
<span id="cb1371-5"><a href="visualization3.html#cb1371-5"></a><span class="st">    </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></span>
<span id="cb1371-6"><a href="visualization3.html#cb1371-6"></a><span class="st">    </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>)</span>
<span id="cb1371-7"><a href="visualization3.html#cb1371-7"></a></span>
<span id="cb1371-8"><a href="visualization3.html#cb1371-8"></a>Scale_Fig2</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-702-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>　これまでは<code>color</code>引数を離散変数でしかマッピングしませんでしたが、このように連続変数でマッピングすることも可能です。ただし、この場合は値に応じてはっきりした色分けがされるのではなく、グラデーションで色分けされます。この例だと、青に近いほどPolity IVスコアが高く、黒に近いほど低いことが分かります。この場合、<code>color</code>のスケール調整は最小値と最大値における色を指定するだけです。その間の色については{ggplot2}が自動的に計算してくれます。</p>
<p>　今回使用する関数は<code>scale_x_gradient()</code>です。これまでの例だと<code>scale_color_continuous()</code>かと思う方も多いでしょう。実際、<code>scale_color_continuous()</code>関数も提供されており、使い方もほぼ同じです。ただし、<code>scale_color_continuous()</code>を使う際は引数として<code>type = "gradient"</code>を指定する必要があります。<code>scale_x_gradient()</code>の場合、最小値における色を<code>low</code>、最大値のそれを<code>high</code>で指定します。数値は<code>"red"</code>や<code>"blue"</code>なども可能であり、<code>"#132B43"</code>のような書き方も使えます。たとえば、先ほどの<code>Scale_Fig2</code>においてPolity IVスコアが高いほど<span style="color:#cd3333;font-weight:bold;">brown3</span>、低いほど<span style="color:#6495ED;font-weight:bold;">cornflowerblue</span>になるようにする場合は以下のように書きます。</p>
<div class="sourceCode" id="cb1372"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1372-1"><a href="visualization3.html#cb1372-1"></a>Scale_Fig2 <span class="op">+</span></span>
<span id="cb1372-2"><a href="visualization3.html#cb1372-2"></a><span class="st">    </span><span class="kw">scale_color_gradient</span>(<span class="dt">high =</span> <span class="st">&quot;brown3&quot;</span>, <span class="dt">low =</span> <span class="st">&quot;cornflowerblue&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-703-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>　このような書き方だとどのような色名で使えるかを事前に知っておく必要があります。使える色名のリストは<code>colors()</code>から確認できます。全部で657種類がありますが、ここでは最初の50個のみを出力します。</p>
<div class="sourceCode" id="cb1373"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1373-1"><a href="visualization3.html#cb1373-1"></a><span class="kw">head</span>(<span class="kw">colors</span>(), <span class="dv">50</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;white&quot;          &quot;aliceblue&quot;     
##  [3] &quot;antiquewhite&quot;   &quot;antiquewhite1&quot; 
##  [5] &quot;antiquewhite2&quot;  &quot;antiquewhite3&quot; 
##  [7] &quot;antiquewhite4&quot;  &quot;aquamarine&quot;    
##  [9] &quot;aquamarine1&quot;    &quot;aquamarine2&quot;   
## [11] &quot;aquamarine3&quot;    &quot;aquamarine4&quot;   
## [13] &quot;azure&quot;          &quot;azure1&quot;        
## [15] &quot;azure2&quot;         &quot;azure3&quot;        
## [17] &quot;azure4&quot;         &quot;beige&quot;         
## [19] &quot;bisque&quot;         &quot;bisque1&quot;       
## [21] &quot;bisque2&quot;        &quot;bisque3&quot;       
## [23] &quot;bisque4&quot;        &quot;black&quot;         
## [25] &quot;blanchedalmond&quot; &quot;blue&quot;          
## [27] &quot;blue1&quot;          &quot;blue2&quot;         
## [29] &quot;blue3&quot;          &quot;blue4&quot;         
## [31] &quot;blueviolet&quot;     &quot;brown&quot;         
## [33] &quot;brown1&quot;         &quot;brown2&quot;        
## [35] &quot;brown3&quot;         &quot;brown4&quot;        
## [37] &quot;burlywood&quot;      &quot;burlywood1&quot;    
## [39] &quot;burlywood2&quot;     &quot;burlywood3&quot;    
## [41] &quot;burlywood4&quot;     &quot;cadetblue&quot;     
## [43] &quot;cadetblue1&quot;     &quot;cadetblue2&quot;    
## [45] &quot;cadetblue3&quot;     &quot;cadetblue4&quot;    
## [47] &quot;chartreuse&quot;     &quot;chartreuse1&quot;   
## [49] &quot;chartreuse2&quot;    &quot;chartreuse3&quot;</code></pre>
<p><code>scale_x_gradient()</code>から派生した関数として<code>scale_x_gradient2()</code>というものもあります。これは最小値と最大値だけでなく、<code>mid</code>引数を使って中間における色も指定可能な関数です。例えば、先ほどの例で真ん中を<span style="color:#00AC97;font-weight:bold;">seagreen</span>にしてみましょう。</p>
<div class="sourceCode" id="cb1375"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1375-1"><a href="visualization3.html#cb1375-1"></a>Scale_Fig2 <span class="op">+</span></span>
<span id="cb1375-2"><a href="visualization3.html#cb1375-2"></a><span class="st">    </span><span class="kw">scale_color_gradient2</span>(<span class="dt">high =</span> <span class="st">&quot;brown3&quot;</span>, <span class="dt">mid =</span> <span class="st">&quot;seagreen&quot;</span>, <span class="dt">low =</span> <span class="st">&quot;cornflowerblue&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-705-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>　色は<code>"seagreen"</code>、<code>"red"</code>でなく、<code>"#00AC97"</code>、<code>"#FF0000"</code>のように具体的なRGB値で指定することもできます。これは色を赤（R）、緑（G）、青（B）の3つの原色を混ぜて様々な色を表現する方法です。<code>"#FF0000"</code>の場合、最初の<code>#</code>はRGB表記であることを意味し、<code>FF</code>は赤が255であることの16進法表記、次の<code>00</code>と最後の<code>00</code>は緑と青が0であることの16進法表記です。各原色は0から255までの値を取ります。{ggplot2}でよく見る色としては<span style="color:#F8766D;font-weight:bold;">#F8766D</span>、<span style="color:#00BFC4;font-weight:bold;">#00BFC4</span>、<span style="color:#C77CFF;font-weight:bold;">#C77CFF</span>、<span style="color:#7CAE00;font-weight:bold;">#7CAE00</span>があります。他にもGoogleなどで「RGB color list」などを検索すれば様々な色を見ることができます。</p>
<p>他にも{ggplot2}は様々なユーザー指定のパレットが使用可能であり、実際、パッケージの形式として提供される場合もあります。たとえば、ジブリ風のカラーパレットが{<a href="https://github.com/ewenme/ghibli">ghibli</a>}パッケージとして提供されており、<code>install.packages("ghibli")</code>でインストール可能です。</p>
<div class="sourceCode" id="cb1376"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1376-1"><a href="visualization3.html#cb1376-1"></a>Scale_Fig2 <span class="op">+</span></span>
<span id="cb1376-2"><a href="visualization3.html#cb1376-2"></a><span class="st">    </span><span class="co"># 連続変数（_c）用の「もののけ姫」パレット（medium）</span></span>
<span id="cb1376-3"><a href="visualization3.html#cb1376-3"></a><span class="st">    </span>ghibli<span class="op">::</span><span class="kw">scale_color_ghibli_c</span>(<span class="st">&quot;MononokeMedium&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-706-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="color引数が順序付き離散変数でマッピングされている場合" class="section level4" number="19.3.2.2">
<h4><span class="header-section-number">19.3.2.2</span> <code>color</code>引数が順序付き離散変数でマッピングされている場合</h4>
<p>　連続変数のようにグラデーションではあるものの、それぞれの値に対して具体的な色が指定されます。まずは先ほど作成しました<code>Scale_Fig2</code>の色分けを連続変数である<code>Polity_Score</code>でなく、順序付き離散変数である<code>Polity_Type</code>にします。<code>Polity_Type</code>の順序は独裁（Autocracy）、閉じられたアノクラシー（Closed Anocracy）、開かれたアノクラシー（Open Anocracy）、民主主義（Democracy）、完全な民主主義（Full Democracy）にします。また、<code>Polity_Type</code>が定義されていない国もデータセットに含まれているため、<code>drop_na(Polity_Type)</code>を追加し、<code>Polity_Type</code>が欠損している行を除去します。</p>
<div class="sourceCode" id="cb1377"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1377-1"><a href="visualization3.html#cb1377-1"></a>Scale_Fig3 &lt;-<span class="st"> </span>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1377-2"><a href="visualization3.html#cb1377-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Polity_Type =</span> <span class="kw">factor</span>(Polity_Type, <span class="dt">ordered =</span> <span class="ot">TRUE</span>,</span>
<span id="cb1377-3"><a href="visualization3.html#cb1377-3"></a>                              <span class="dt">levels  =</span> <span class="kw">c</span>(<span class="st">&quot;Autocracy&quot;</span>,</span>
<span id="cb1377-4"><a href="visualization3.html#cb1377-4"></a>                                          <span class="st">&quot;Closed Anocracy&quot;</span>,</span>
<span id="cb1377-5"><a href="visualization3.html#cb1377-5"></a>                                          <span class="st">&quot;Open Anocracy&quot;</span>,</span>
<span id="cb1377-6"><a href="visualization3.html#cb1377-6"></a>                                          <span class="st">&quot;Democracy&quot;</span>,</span>
<span id="cb1377-7"><a href="visualization3.html#cb1377-7"></a>                                          <span class="st">&quot;Full Democracy&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb1377-8"><a href="visualization3.html#cb1377-8"></a><span class="st">  </span><span class="kw">drop_na</span>(Polity_Type) <span class="op">%&gt;%</span></span>
<span id="cb1377-9"><a href="visualization3.html#cb1377-9"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1377-10"><a href="visualization3.html#cb1377-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> GDP_per_capita, <span class="dt">y =</span> HDI_<span class="dv">2018</span>, <span class="dt">color =</span> Polity_Type)) <span class="op">+</span></span>
<span id="cb1377-11"><a href="visualization3.html#cb1377-11"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;一人あたりGDP (USD)&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;人間開発指数&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;Polity IVタイプ&quot;</span>) <span class="op">+</span></span>
<span id="cb1377-12"><a href="visualization3.html#cb1377-12"></a><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></span>
<span id="cb1377-13"><a href="visualization3.html#cb1377-13"></a><span class="st">  </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>)</span>
<span id="cb1377-14"><a href="visualization3.html#cb1377-14"></a></span>
<span id="cb1377-15"><a href="visualization3.html#cb1377-15"></a>Scale_Fig3</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-707-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>　今回は紫（独裁）から黄色（完全な民主主義）の順で色分けがされ、その間のカテゴリーも紫と黄色の間の値をとります。実は順序付き離散変数の場合、色のスケールを調整することはあまりありませんし、これまでの方法に比べてやや複雑です。ここでは色相（Hue）の範囲と強度、明るさを調整する方法について紹介します。</p>
<p>　まずは、色相について知る必要があります。{ggplot2}において色相の範囲は0から360です。そして、色には強度（intensity）、または彩度という概念があり、0に近いほどグレイへ近づき、色間の区別がしにくくなります。{ggplot2}では彩度のデフォルト値は100であり、我々が普段{ggplot2}で見る図の色です。最後に明るさ（luminance）があり、0から100までの値を取ります。値が大きいほど明るくなり、{ggplot2}のデフォルト値は65です。重要なのは色相のところであり、Hueの具体的な数値がどの色なのかを確認する必要があります。そのためには、{scales}パッケージの<code>hue_pal()</code>と<code>show_col()</code>関数を使用します。</p>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-708-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>　左上が0、右下が360の色を意味します。順序変数でマッピングされた色スケールを色相に基づいて調整する際は、<code>scale_color_hue()</code>レイヤーを追加し、色相の範囲、彩度、明るさを指定します。たとえば、0から300までの範囲の色を使用し<a href="#fn82" class="footnote-ref" id="fnref82"><sup>82</sup></a>、再度と明るさはデフォルトにしたい場合、以下のように書きます。</p>
<div class="sourceCode" id="cb1378"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1378-1"><a href="visualization3.html#cb1378-1"></a>Scale_Fig3 <span class="op">+</span></span>
<span id="cb1378-2"><a href="visualization3.html#cb1378-2"></a><span class="st">  </span><span class="kw">scale_color_hue</span>(<span class="dt">h =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">360</span>), <span class="dt">c =</span> <span class="dv">100</span>, <span class="dt">l =</span> <span class="dv">65</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-709-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>　また、<code>direction = -1</code>を追加することで、色の順番を逆にすることも可能です。</p>
<div class="sourceCode" id="cb1379"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1379-1"><a href="visualization3.html#cb1379-1"></a>Scale_Fig3 <span class="op">+</span></span>
<span id="cb1379-2"><a href="visualization3.html#cb1379-2"></a><span class="st">  </span><span class="kw">scale_color_hue</span>(<span class="dt">h =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">360</span>), <span class="dt">c =</span> <span class="dv">100</span>, <span class="dt">l =</span> <span class="dv">65</span>, <span class="dt">direction =</span> <span class="dv">-1</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-710-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>　他にも<a href="https://bids.github.io/colormap/">mpl colormaps</a>というカラーマップを使うことも可能です。この場合は<code>scale_color_hue()</code>ではなく、<code>scale_color_viridis_d()</code>を使用します。具体的な色の情報は<a href="https://bids.github.io/colormap/">mpl colormaps</a>を参照してください。必要な引数は色のスタート地点（<code>begin</code>）と終了地点（<code>end</code>）です。そして、<code>option</code>の引数のデフォルト値は<code>"D"</code>であり、これはVIRIDIS colormapを意味します。実は<code>scale_color_*()</code>を付けなかった場合の色分けがこれです。たとえば、VIRIDIS colormapでなく、PLASMA colormapを使うなら<code>option = "C"</code>を付けます。</p>
<div class="sourceCode" id="cb1380"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1380-1"><a href="visualization3.html#cb1380-1"></a>Scale_Fig3 <span class="op">+</span></span>
<span id="cb1380-2"><a href="visualization3.html#cb1380-2"></a><span class="st">  </span><span class="co"># PLASMA colormapを使用する（option = &quot;C&quot;）</span></span>
<span id="cb1380-3"><a href="visualization3.html#cb1380-3"></a><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="dt">begin =</span> <span class="dv">0</span>, <span class="dt">end =</span> <span class="dv">1</span>, <span class="dt">option =</span> <span class="st">&quot;C&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-711-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="color引数が順序なし離散変数でマッピングされている場合" class="section level4" number="19.3.2.3">
<h4><span class="header-section-number">19.3.2.3</span> <code>color</code>引数が順序なし離散変数でマッピングされている場合</h4>
<p>　最後に順序なし離散変数の場合について解説します。ここでは<code>scale_color_manual()</code>関数を使用し、マッピングされている変数のそれぞれ値に対して具体的な色を指定する方法です。以下で説明する方法は、順序付き離散変数でも使用可能であるため、<code>Scale_Fig3</code>の図をそのまま利用してみたいと思います。</p>
<p>　<code>scale_color_manual()</code>の核心となる引数は<code>values</code>であり、ここに<code>"変数の値" = "色"</code>で指定します。この色は<code>"red"</code>のような具体的な色名でも、<code>"#FF0000"</code>のようなRGB表記でも構いません。</p>
<div class="sourceCode" id="cb1381"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1381-1"><a href="visualization3.html#cb1381-1"></a>ggplot2オブジェクト <span class="op">+</span></span>
<span id="cb1381-2"><a href="visualization3.html#cb1381-2"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;変数の値1&quot;</span> =<span class="st"> &quot;色1&quot;</span>,</span>
<span id="cb1381-3"><a href="visualization3.html#cb1381-3"></a>                                <span class="st">&quot;変数の値2&quot;</span> =<span class="st"> &quot;色2&quot;</span>,</span>
<span id="cb1381-4"><a href="visualization3.html#cb1381-4"></a>                                <span class="st">&quot;変数の値3&quot;</span> =<span class="st"> &quot;色3&quot;</span>,</span>
<span id="cb1381-5"><a href="visualization3.html#cb1381-5"></a>                                ...))</span></code></pre></div>
<p>　それでは<code>Polity_Type</code>の値が<code>"Autocracy"</code>の場合は<span style="color:darkred;font-weight:bold;">darkred</span>、<code>"Closed Anocracy"</code>は<span style="color:seagreen;font-weight:bold;">seagreen</span>、<code>"Open Anocracy"</code>は<span style="color:cornflowerblue;font-weight:bold;">cornflowerblue</span>、<code>"Democracy"</code>は<span style="color:orchid;font-weight:bold;">orchid</span>、<code>"Full Democracy"</code>は<span style="color:orange;font-weight:bold;">orange</span>にしてみましょう。</p>
<div class="sourceCode" id="cb1382"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1382-1"><a href="visualization3.html#cb1382-1"></a>Scale_Fig3 <span class="op">+</span></span>
<span id="cb1382-2"><a href="visualization3.html#cb1382-2"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;Autocracy&quot;</span>       =<span class="st"> &quot;darkred&quot;</span>,</span>
<span id="cb1382-3"><a href="visualization3.html#cb1382-3"></a>                                <span class="st">&quot;Closed Anocracy&quot;</span> =<span class="st"> &quot;seagreen&quot;</span>,</span>
<span id="cb1382-4"><a href="visualization3.html#cb1382-4"></a>                                <span class="st">&quot;Open Anocracy&quot;</span>   =<span class="st"> &quot;cornflowerblue&quot;</span>,</span>
<span id="cb1382-5"><a href="visualization3.html#cb1382-5"></a>                                <span class="st">&quot;Democracy&quot;</span>       =<span class="st"> &quot;orchid&quot;</span>,</span>
<span id="cb1382-6"><a href="visualization3.html#cb1382-6"></a>                                <span class="st">&quot;Full Democracy&quot;</span>  =<span class="st"> &quot;orange&quot;</span>))</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-713-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>　色を決める際は色覚多様性に気をつけるべきです。誰にとっても見やすい図にはUniversal Designが必要です。特によくある例が「緑と赤」の組み合わせです。緑も赤も暖色系であり、P型およびD型色弱の場合、両者の区別が難しいと言われています。しかも、色弱の方は意外と多いです。日本の場合、男性の5%、女性の0.2%と言われております。これには人種差もありまして、フランスや北欧の男性の場合は約10%です。一通り図を作成しましたら、色覚シミュレーターなどを使用して、誰にとっても見やすい色であるかを確認することも良いでしょう。また、{ggplot2}がデフォルトで採用しているVIRIDISは色弱に優しいカラーパレットと言われています。一般的に二色の組み合わせの場合、最も区別しやすい色は青とオレンジと言われいます。</p>
<p>　{ggplot2}における<code>color</code>スケールは非常に細かく調整可能であり、関連関数やパッケージも多く提供されています。本書では全てを紹介することはできませんが、ここまで紹介してきました例だけでも、自分好みに色を調整できるでしょう。</p>
</div>
</div>
<div id="alphaスケールの調整" class="section level3" number="19.3.3">
<h3><span class="header-section-number">19.3.3</span> <code>alpha</code>スケールの調整</h3>
<p>　次は点・線・面の透明度を指定する<code>alpha</code>スケールの調整です。もし、<code>alpha</code>に連続変数をマッピングすれば、マッピングした変数の値に応じて透明度が変わります。一般的に、値が大きいほど不透明となり、小さいほど透明になります。しかし、このような使い方はあまり見られません。プロット上のオブジェクトを透明度を指定するのは</p>
<ol style="list-style-type: decimal">
<li>特定箇所にオブジェクトが密集し、重なるオブジェクトの区別がつきにくい場合</li>
<li>特定の点・線・面を強調するため</li>
</ol>
<p>　以上の2ケースでしょう。また、ケース1の場合、<code>alpha</code>引数を<code>aes()</code>の内部ではなく、外側に指定し、具体的な数値を指定することになります。ここで注目するのはケース2です。たとえば、横軸に一人あたりGDP、縦軸に人間開発指数をマッピングした散布図を作成し、アジアの国のみハイライトしたいとします。この場合、アジアとその他の国で色分けしたり、丸と四角といった形で分けるのも可能ですが、「強調」が目的であれば、その他の国をやや透明にすることも可能でしょう。まず、<code>Asia</code>という変数を作成し、<code>Continent</code>の値が<code>"Asia"</code>なら<code>"Asia"</code>、その他の値なら<code>"Other"</code>の値を入れます。そして、<code>geom_point()</code>の<code>aes()</code>内に<code>alpha</code>引数を追加し、<code>Asia</code>変数でマッピングします。</p>
<div class="sourceCode" id="cb1383"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1383-1"><a href="visualization3.html#cb1383-1"></a>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1383-2"><a href="visualization3.html#cb1383-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Asia =</span> <span class="kw">if_else</span>(Continent <span class="op">==</span><span class="st"> &quot;Asia&quot;</span>, <span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Other&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1383-3"><a href="visualization3.html#cb1383-3"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1383-4"><a href="visualization3.html#cb1383-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> GDP_per_capita, <span class="dt">y =</span> HDI_<span class="dv">2018</span>, <span class="dt">alpha =</span> Asia), <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb1383-5"><a href="visualization3.html#cb1383-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;一人あたりGDP (USD)&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;人間開発指数&quot;</span>, <span class="dt">alpha =</span> <span class="st">&quot;大陸&quot;</span>) <span class="op">+</span></span>
<span id="cb1383-6"><a href="visualization3.html#cb1383-6"></a><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></span>
<span id="cb1383-7"><a href="visualization3.html#cb1383-7"></a><span class="st">  </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-714-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>　<code>Asia</code>の値によって透明度が異なりますが、私たちの目的は<code>Asia</code>を不透明にし、その他の点を透明にすることです。ここで登場するのが<code>scale_alpha_manual()</code>です。使い方はこれまで見てきた<code>scale_*_manual()</code>と非常に似ています。<code>values</code>引数にそれぞれの値と透明度を指定するだけです。透明度は1が不透明、0が透明です。アジアの透明度を1.0、その他の透明度を0.15とするなら、以下のように書きます。</p>
<div class="sourceCode" id="cb1384"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1384-1"><a href="visualization3.html#cb1384-1"></a>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1384-2"><a href="visualization3.html#cb1384-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Asia =</span> <span class="kw">if_else</span>(Continent <span class="op">==</span><span class="st"> &quot;Asia&quot;</span>, <span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Other&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1384-3"><a href="visualization3.html#cb1384-3"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1384-4"><a href="visualization3.html#cb1384-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> GDP_per_capita, <span class="dt">y =</span> HDI_<span class="dv">2018</span>, <span class="dt">alpha =</span> Asia), <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb1384-5"><a href="visualization3.html#cb1384-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;一人あたりGDP (USD)&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;人間開発指数&quot;</span>, <span class="dt">alpha =</span> <span class="st">&quot;大陸&quot;</span>) <span class="op">+</span></span>
<span id="cb1384-6"><a href="visualization3.html#cb1384-6"></a><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></span>
<span id="cb1384-7"><a href="visualization3.html#cb1384-7"></a><span class="st">  </span><span class="kw">scale_alpha_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;Asia&quot;</span> =<span class="st"> </span><span class="fl">1.0</span>, <span class="st">&quot;Other&quot;</span> =<span class="st"> </span><span class="fl">0.15</span>)) <span class="op">+</span></span>
<span id="cb1384-8"><a href="visualization3.html#cb1384-8"></a><span class="st">  </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-715-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>　これでアジアの国々がプロット上で強調されました。透明度スケールは連続変数（<code>scale_alpha_continuous()</code>）や離散変数（<code>scale_alpha_discrete()</code>）に使うことも可能ですが、透明度を「区別」でなく「強調」の目的で使うならば、<code>scale_alpha_manual()</code>でも十分だと考えられます。</p>
<p>　一つ注意して頂きたいのは、図をPDFで出力する際、半透明なオブジェクトが見えなかったり、逆に透明度が全く適用されない場合があります。PNGなどのビットマップ画像ならこのような問題は生じませんが、PDFの場合は注意が必要です<a href="#fn83" class="footnote-ref" id="fnref83"><sup>83</sup></a>。この場合、画像をPNGなどの形式にするか、半透明でなく「グレーと黒」のような組み合わせで作図した方が良いかも知れません。</p>
</div>
<div id="sizeスケールの調整" class="section level3" number="19.3.4">
<h3><span class="header-section-number">19.3.4</span> <code>size</code>スケールの調整</h3>
<p>　大きさに関するマッピングは幾何オブジェクトの<code>aes()</code>内に<code>size</code>引数を使用します。ここでの大きさというのは点の大きさと線の太さを意味します。<code>geom_point()</code>内の<code>size</code>は点の大きさ、<code>geom_line()</code>や<code>geom_segment()</code>の<code>size</code>は線の太さ、<code>geom_pointrange()</code>では両方を意味します。ただし、実質的に変数の値に応じて線の太さを変えることは強調<a href="#fn84" class="footnote-ref" id="fnref84"><sup>84</sup></a>を除けばあまり見られません。ここでは点の大きさに焦点を当てて解説します。</p>
<p>　それでは、横軸はフリーダム・ハウスのスコア（<code>FH_Total</code>）、縦軸は2018年人間開発指数（<code>HDI_2018</code>）として散布図を作成し、一人当たり購買力平価GDP（<code>PPP_per_capita</code>）に応じて点の大きさを指定します。</p>
<div class="sourceCode" id="cb1385"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1385-1"><a href="visualization3.html#cb1385-1"></a>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1385-2"><a href="visualization3.html#cb1385-2"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1385-3"><a href="visualization3.html#cb1385-3"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> FH_Total, <span class="dt">y =</span> HDI_<span class="dv">2018</span>, <span class="dt">size =</span> PPP_per_capita)) <span class="op">+</span></span>
<span id="cb1385-4"><a href="visualization3.html#cb1385-4"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;フリーダムハウススコア&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;2018年人間開発指数&quot;</span>, </span>
<span id="cb1385-5"><a href="visualization3.html#cb1385-5"></a>         <span class="dt">size =</span> <span class="st">&quot;一人あたり購買力平価GDP（USD）&quot;</span>) <span class="op">+</span></span>
<span id="cb1385-6"><a href="visualization3.html#cb1385-6"></a><span class="st">    </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>) <span class="op">+</span></span>
<span id="cb1385-7"><a href="visualization3.html#cb1385-7"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="co"># 凡例の図の下段にする</span></span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-716-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>　フリーダム・ハウススコアと人間開発指数は全般的には正の相関を示しています。そして、両指標が高い国（図の右上）は所得水準も高いことが分かります。ただし、フリーダム・ハウススコアが低くても人間開発指数が高い国（図の左上）もかなり見られますが、これらの国の共通点は所得水準が高いことです。つまり、人間開発指数と所得水準には強い相関関係があると考えられます（人間開発指数には所得水準も含まれるため、当たり前です）。</p>
<p>　大きさをマッピングすると、点が重なる箇所が広くなりますので、<code>alpha</code>引数で半透明にすることも有効でしょう。</p>
<div class="sourceCode" id="cb1386"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1386-1"><a href="visualization3.html#cb1386-1"></a>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1386-2"><a href="visualization3.html#cb1386-2"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1386-3"><a href="visualization3.html#cb1386-3"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> FH_Total, <span class="dt">y =</span> HDI_<span class="dv">2018</span>, <span class="dt">size =</span> PPP_per_capita),</span>
<span id="cb1386-4"><a href="visualization3.html#cb1386-4"></a>               <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span><span class="co"># 透明度の指定</span></span>
<span id="cb1386-5"><a href="visualization3.html#cb1386-5"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;フリーダムハウススコア&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;2018年人間開発指数&quot;</span>, </span>
<span id="cb1386-6"><a href="visualization3.html#cb1386-6"></a>         <span class="dt">size =</span> <span class="st">&quot;一人あたり購買力平価GDP（USD）&quot;</span>) <span class="op">+</span></span>
<span id="cb1386-7"><a href="visualization3.html#cb1386-7"></a><span class="st">    </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>) <span class="op">+</span></span>
<span id="cb1386-8"><a href="visualization3.html#cb1386-8"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) </span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-717-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>　この大きさのスケール調整はマッピングされた変数の尺度によって、<code>scale_size_continuous()</code>、<code>sclae_size_discrete()</code>、<code>scale_size_ordinal()</code>などを使用し、すべてマニュアルで調整したい場合は<code>scale_size_manual()</code>を使います。使い方はこれまでのスケール調整とほぼ同様です。たとえば、上記の図だと、大きさの凡例が3万、6万、9万となっていますが、これを1000, 10000, 100000といった対数スケールに変更してみましょう。</p>
<div class="sourceCode" id="cb1387"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1387-1"><a href="visualization3.html#cb1387-1"></a>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1387-2"><a href="visualization3.html#cb1387-2"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1387-3"><a href="visualization3.html#cb1387-3"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> FH_Total, <span class="dt">y =</span> HDI_<span class="dv">2018</span>, <span class="dt">size =</span> PPP_per_capita),</span>
<span id="cb1387-4"><a href="visualization3.html#cb1387-4"></a>               <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb1387-5"><a href="visualization3.html#cb1387-5"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;フリーダムハウススコア&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;2018年人間開発指数&quot;</span>, </span>
<span id="cb1387-6"><a href="visualization3.html#cb1387-6"></a>         <span class="dt">size =</span> <span class="st">&quot;一人あたり購買力平価GDP（USD）&quot;</span>) <span class="op">+</span></span>
<span id="cb1387-7"><a href="visualization3.html#cb1387-7"></a><span class="st">    </span><span class="kw">scale_size_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">1000</span>, <span class="dv">10000</span>, <span class="dv">100000</span>),</span>
<span id="cb1387-8"><a href="visualization3.html#cb1387-8"></a>                          <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;1000&quot;</span>, <span class="st">&quot;10000&quot;</span>, <span class="st">&quot;100000&quot;</span>)) <span class="op">+</span></span>
<span id="cb1387-9"><a href="visualization3.html#cb1387-9"></a><span class="st">    </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>) <span class="op">+</span></span>
<span id="cb1387-10"><a href="visualization3.html#cb1387-10"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) </span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-718-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>　この場合、図内の点の大きさに変化はありません。変わるのは凡例のみであり、値に応じた点のサイズに調整されます。連続変数でマッピングされている場合、一つ一つの値に応じてサイズを指定するのは非現実的であります。この場合、点の大きさ調整は{ggplot2}に任せて、凡例のサイズを調整するのが無難でしょう。</p>
<p>　ただし、点の最小サイズと最大サイズを調整したいケースもあるでしょう。最も小さい点のサイズを0.1に、最も大きい点のサイズを10にする場合、<code>range</code>引数を指定します。<code>range</code>引数の実引数は長さ2の数値型ベクトルです。</p>
<div class="sourceCode" id="cb1388"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1388-1"><a href="visualization3.html#cb1388-1"></a>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1388-2"><a href="visualization3.html#cb1388-2"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1388-3"><a href="visualization3.html#cb1388-3"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> FH_Total, <span class="dt">y =</span> HDI_<span class="dv">2018</span>, <span class="dt">size =</span> PPP_per_capita),</span>
<span id="cb1388-4"><a href="visualization3.html#cb1388-4"></a>               <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb1388-5"><a href="visualization3.html#cb1388-5"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;フリーダムハウススコア&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;2018年人間開発指数&quot;</span>, </span>
<span id="cb1388-6"><a href="visualization3.html#cb1388-6"></a>         <span class="dt">size =</span> <span class="st">&quot;一人あたり購買力平価GDP（USD）&quot;</span>) <span class="op">+</span></span>
<span id="cb1388-7"><a href="visualization3.html#cb1388-7"></a><span class="st">    </span><span class="kw">scale_size_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">1000</span>, <span class="dv">10000</span>, <span class="dv">100000</span>),</span>
<span id="cb1388-8"><a href="visualization3.html#cb1388-8"></a>                          <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;1000&quot;</span>, <span class="st">&quot;10000&quot;</span>, <span class="st">&quot;100000&quot;</span>),</span>
<span id="cb1388-9"><a href="visualization3.html#cb1388-9"></a>                          <span class="dt">range =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="dv">10</span>)) <span class="op">+</span></span>
<span id="cb1388-10"><a href="visualization3.html#cb1388-10"></a><span class="st">    </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>) <span class="op">+</span></span>
<span id="cb1388-11"><a href="visualization3.html#cb1388-11"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) </span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-719-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>　このように範囲が広がるほど、所得水準の差がより見やすくなります。他にもsizeは離散変数でマッピングさることも可能ですが、あまり相性は良くありません。離散変数でのマッピングはこれまで紹介しました<code>color</code>や<code>size</code>の方を参照してください。使い方は同じです。</p>
</div>
<div id="shapelinetypeスケールの調整" class="section level3" number="19.3.5">
<h3><span class="header-section-number">19.3.5</span> <code>shape</code>、<code>linetype</code>スケールの調整</h3>
<p>　<code>size</code>は連続変数と相性が良いですが、点や線の形である<code>shape</code>と<code>linetype</code>は離散変数、とりわけ順序なし離散変数（名目変数）と相性が良いです。なぜなら、点や線の形は高低・大小の情報を持たないからです。たとえば、丸の点は四角の点より大きいとか実線は破線より小さいといった情報はありません。したがって、<code>size</code>や<code>linetype</code>は名目変数に使うのが一般的です。たとえば、フリーダムハウスのスコアを横軸、人間開発指数を縦軸とし、G20加盟有無によって点の形が異なる散布図を作成するとします。G20をcharacter型、あるいはfactor型に変換し、<code>geom_point()</code>の幾何オブジェクトの<code>aes()</code>内に<code>shape</code>引数を指定します。</p>
<div class="sourceCode" id="cb1389"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1389-1"><a href="visualization3.html#cb1389-1"></a>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1389-2"><a href="visualization3.html#cb1389-2"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">G20 =</span> <span class="kw">if_else</span>(G20 <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;加盟国&quot;</span>, <span class="st">&quot;非加盟国&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1389-3"><a href="visualization3.html#cb1389-3"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1389-4"><a href="visualization3.html#cb1389-4"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> FH_Total, <span class="dt">y =</span> HDI_<span class="dv">2018</span>, <span class="dt">shape =</span> G20),</span>
<span id="cb1389-5"><a href="visualization3.html#cb1389-5"></a>               <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb1389-6"><a href="visualization3.html#cb1389-6"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;フリーダムハウススコア&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;2018年人間開発指数&quot;</span>, </span>
<span id="cb1389-7"><a href="visualization3.html#cb1389-7"></a>         <span class="dt">shape =</span> <span class="st">&quot;G20&quot;</span>) <span class="op">+</span></span>
<span id="cb1389-8"><a href="visualization3.html#cb1389-8"></a><span class="st">    </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>) <span class="op">+</span></span>
<span id="cb1389-9"><a href="visualization3.html#cb1389-9"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) </span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-720-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>　加盟国を丸（16または19）、非加盟国をダイヤモンド型（18）にするには<code>scale_shape_manual()</code>を使います。</p>
<div class="sourceCode" id="cb1390"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1390-1"><a href="visualization3.html#cb1390-1"></a>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1390-2"><a href="visualization3.html#cb1390-2"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">G20 =</span> <span class="kw">if_else</span>(G20 <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;加盟国&quot;</span>, <span class="st">&quot;非加盟国&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1390-3"><a href="visualization3.html#cb1390-3"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1390-4"><a href="visualization3.html#cb1390-4"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> FH_Total, <span class="dt">y =</span> HDI_<span class="dv">2018</span>, <span class="dt">shape =</span> G20),</span>
<span id="cb1390-5"><a href="visualization3.html#cb1390-5"></a>               <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb1390-6"><a href="visualization3.html#cb1390-6"></a><span class="st">    </span><span class="kw">scale_shape_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;加盟国&quot;</span> =<span class="st"> </span><span class="dv">19</span>, <span class="st">&quot;非加盟国&quot;</span> =<span class="st"> </span><span class="dv">18</span>)) <span class="op">+</span></span>
<span id="cb1390-7"><a href="visualization3.html#cb1390-7"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;フリーダムハウススコア&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;2018年人間開発指数&quot;</span>, </span>
<span id="cb1390-8"><a href="visualization3.html#cb1390-8"></a>         <span class="dt">shape =</span> <span class="st">&quot;G20&quot;</span>) <span class="op">+</span></span>
<span id="cb1390-9"><a href="visualization3.html#cb1390-9"></a><span class="st">    </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>) <span class="op">+</span></span>
<span id="cb1390-10"><a href="visualization3.html#cb1390-10"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) </span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-721-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>　ただし、各数字がどの形に対応しているかを事前に知っておく必要があります。よく使うのは0から25までであり、それぞれ対応するshapeを示したのが以下の図です。必要に応じてこのページを参照しても良いですし、Rコンソール上で<code>?pch</code>を入力しても0から23までの例を見ることが出来ます。</p>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-722-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>　注意していただきたいのは、<code>shape</code>のマッピングが有効でない状況があるという点です。それが先ほどの例です。先ほどの散布図の場合、次元を増やすことは、新しい次元で条件づけた場合の変数の関係性を調べることとなります。しかし、新しい次元による条件付き関連性があまり見られない場合、あるいは二種類以上の点の形があまり分離されていない場合は、次元の追加がもたらす恩恵が感じにくくなるでしょう。例えば以下のような散布図を比較してみましょう。図(A)の場合、縦軸の変数が閾値を超えるともう一つの変数との関係が弱まるということが分かります。たとえば、三角の点において両変数は正の相関を持ち、丸の点においては無相関に近いことが分かります。この場合、点の形は非常に有用な情報を含んでいると判断できます。一方、図(B)の場合、点の形から読み取れる情報が少ないですね。あえて言えば、グループ間の違いがあまりないことくらいでしょう。</p>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-723-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>　白黒のグラフの場合、色分けが出来ないため、次元拡張には点の形を変えることになります。しかし、色に来れば形は読み手にとって認知の負荷がかかりやすいです。下の図を見てください。100個の点がありますが、三角の点はいくつでしょうか。</p>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-724-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>　正解は5つです。あまり難しい問題ではないでしょう。一方、下の図はいかがでしょうか。</p>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-725-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>　どれも正解は5つです。本質的には同じ問題ですが、どの図の方が読みやすかったでしょうか。個人差はあるかも知れませんが、多くの方にとって後者の方が読みやすかったでしょう。最近、海外のジャーナルはカラーの図を使うことも可能ですので、色分けを優先的に考えましょう。白黒のみ受け付けられる場合でも、グループ数やサンプルサイズによっては点の形より、彩度や明るさの方が効果的な場合もあります。</p>
<p>　続きまして、<code>linetype</code>について解説します。線の形も色分けができない場合、よく使われる次元の増やし方です。ここでは日中韓台における人口1万人あたりCOVID-19新規感染者数の折れ線グラフを作成します。<code>COVID19_df</code>には人口のデータがないため、<code>left_join()</code>を使って<code>Country_df</code>と結合します。<code>left_join()</code>の使い方に関しては第<a href="datahandling2.html#datahandling2">14</a>章を参照してください。続いて、Character型である<code>Date</code>変数を<code>as.Date()</code>関数を使ってDate型へ変換します。1万人あたり新規感染者数は新規感染者数（<code>Confirmed_Day</code>）を人口（<code>Population</code>）で割り、1万をかけます。最後に<code>Country</code>列を基準に<code>filter()</code>を使用し、日中韓台のデータのみ残します。後は折れ線グラフを作成しますが、<code>geom_line()</code>内の<code>aes()</code>内に<code>linetype</code>引数を<code>Country</code>変数でマッピングします。</p>
<div class="sourceCode" id="cb1391"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1391-1"><a href="visualization3.html#cb1391-1"></a><span class="kw">left_join</span>(COVID19_df, Country_df, <span class="dt">by =</span> <span class="st">&quot;Country&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1391-2"><a href="visualization3.html#cb1391-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Date                 =</span> <span class="kw">as.Date</span>(Date),</span>
<span id="cb1391-3"><a href="visualization3.html#cb1391-3"></a>         <span class="dt">Confirmed_per_capita =</span> Confirmed_Day <span class="op">/</span><span class="st"> </span>Population <span class="op">*</span><span class="st"> </span><span class="dv">10000</span>) <span class="op">%&gt;%</span></span>
<span id="cb1391-4"><a href="visualization3.html#cb1391-4"></a><span class="st">  </span><span class="kw">filter</span>(Country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Japan&quot;</span>, <span class="st">&quot;China&quot;</span>, <span class="st">&quot;Taiwan&quot;</span>, <span class="st">&quot;South Korea&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1391-5"><a href="visualization3.html#cb1391-5"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1391-6"><a href="visualization3.html#cb1391-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Date, <span class="dt">y =</span> Confirmed_per_capita, <span class="dt">linetype =</span> Country)) <span class="op">+</span></span>
<span id="cb1391-7"><a href="visualization3.html#cb1391-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;月&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;1万人当たり新規感染者数&quot;</span>,<span class="dt">linetype =</span> <span class="st">&quot;国&quot;</span>) <span class="op">+</span></span>
<span id="cb1391-8"><a href="visualization3.html#cb1391-8"></a><span class="st">  </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>) <span class="op">+</span></span>
<span id="cb1391-9"><a href="visualization3.html#cb1391-9"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-726-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>　いかがでしょうか。<code>linetype</code>は<code>color</code>よりも識別性が非常に低いことが分かるでしょう。個人差もあるかも知れませんが、<code>shape</code>よりも低いのではないでしょうか。実線の中国を除けば、日本、韓国、台湾の線はなかなか区別できません。したがって、<code>linetype</code>は2つ、3つまでが限界だと考えられます。3つまででしたら、実線、破線、点線に分けることができるでしょう。ここでは、日本のみを実線とし、他の3カ国は「その他」として破線にしてみましょう。そのためには、日本か否かを示す<code>Japan</code>変数を作成します。また、<code>geom_line()</code>の<code>aes()</code>内には<code>groups</code>引数を追加し、<code>linetype</code>は<code>Japan</code>変数でマッピングします。</p>
<div class="sourceCode" id="cb1392"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1392-1"><a href="visualization3.html#cb1392-1"></a><span class="kw">left_join</span>(COVID19_df, Country_df, <span class="dt">by =</span> <span class="st">&quot;Country&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1392-2"><a href="visualization3.html#cb1392-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Date                 =</span> <span class="kw">as.Date</span>(Date),</span>
<span id="cb1392-3"><a href="visualization3.html#cb1392-3"></a>         <span class="dt">Confirmed_per_capita =</span> Confirmed_Day <span class="op">/</span><span class="st"> </span>Population <span class="op">*</span><span class="st"> </span><span class="dv">10000</span>,</span>
<span id="cb1392-4"><a href="visualization3.html#cb1392-4"></a>         <span class="dt">Japan                =</span> <span class="kw">if_else</span>(Country <span class="op">==</span><span class="st"> &quot;Japan&quot;</span>, <span class="st">&quot;日本&quot;</span>, <span class="st">&quot;その他&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1392-5"><a href="visualization3.html#cb1392-5"></a><span class="st">  </span><span class="kw">filter</span>(Country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Japan&quot;</span>, <span class="st">&quot;China&quot;</span>, <span class="st">&quot;Taiwan&quot;</span>, <span class="st">&quot;South Korea&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1392-6"><a href="visualization3.html#cb1392-6"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1392-7"><a href="visualization3.html#cb1392-7"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Date, <span class="dt">y =</span> Confirmed_per_capita, </span>
<span id="cb1392-8"><a href="visualization3.html#cb1392-8"></a>                <span class="dt">group =</span> Country, <span class="dt">linetype =</span> Japan)) <span class="op">+</span></span>
<span id="cb1392-9"><a href="visualization3.html#cb1392-9"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;月&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;1万人当たり新規感染者数&quot;</span>, <span class="dt">linetype =</span> <span class="st">&quot;国&quot;</span>) <span class="op">+</span></span>
<span id="cb1392-10"><a href="visualization3.html#cb1392-10"></a><span class="st">  </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>) <span class="op">+</span></span>
<span id="cb1392-11"><a href="visualization3.html#cb1392-11"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-727-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>　その他の国が実線となっているので、<code>scale_linetype_manual()</code>で<code>Japan</code>の値ごとに線のタイプを指定します。</p>
<div class="sourceCode" id="cb1393"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1393-1"><a href="visualization3.html#cb1393-1"></a><span class="kw">left_join</span>(COVID19_df, Country_df, <span class="dt">by =</span> <span class="st">&quot;Country&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1393-2"><a href="visualization3.html#cb1393-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Date                 =</span> <span class="kw">as.Date</span>(Date),</span>
<span id="cb1393-3"><a href="visualization3.html#cb1393-3"></a>         <span class="dt">Confirmed_per_capita =</span> Confirmed_Day <span class="op">/</span><span class="st"> </span>Population <span class="op">*</span><span class="st"> </span><span class="dv">10000</span>,</span>
<span id="cb1393-4"><a href="visualization3.html#cb1393-4"></a>         <span class="dt">Japan                =</span> <span class="kw">if_else</span>(Country <span class="op">==</span><span class="st"> &quot;Japan&quot;</span>, <span class="st">&quot;日本&quot;</span>, <span class="st">&quot;その他&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1393-5"><a href="visualization3.html#cb1393-5"></a><span class="st">  </span><span class="kw">filter</span>(Country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Japan&quot;</span>, <span class="st">&quot;China&quot;</span>, <span class="st">&quot;Taiwan&quot;</span>, <span class="st">&quot;South Korea&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1393-6"><a href="visualization3.html#cb1393-6"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1393-7"><a href="visualization3.html#cb1393-7"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Date, <span class="dt">y =</span> Confirmed_per_capita, </span>
<span id="cb1393-8"><a href="visualization3.html#cb1393-8"></a>                <span class="dt">group =</span> Country, <span class="dt">linetype =</span> Japan)) <span class="op">+</span></span>
<span id="cb1393-9"><a href="visualization3.html#cb1393-9"></a><span class="st">  </span><span class="kw">scale_linetype_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;日本&quot;</span> =<span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;その他&quot;</span> =<span class="st"> </span><span class="dv">2</span>)) <span class="op">+</span></span>
<span id="cb1393-10"><a href="visualization3.html#cb1393-10"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;月&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;1万人当たり新規感染者数&quot;</span>, <span class="dt">linetype =</span> <span class="st">&quot;国&quot;</span>) <span class="op">+</span></span>
<span id="cb1393-11"><a href="visualization3.html#cb1393-11"></a><span class="st">  </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>) <span class="op">+</span></span>
<span id="cb1393-12"><a href="visualization3.html#cb1393-12"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-728-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>　できれば、日本とその他の順番も逆にしたいですね。こちらは<code>Japan</code>変数をfactor化することで対応可能です。</p>
<div class="sourceCode" id="cb1394"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1394-1"><a href="visualization3.html#cb1394-1"></a><span class="kw">left_join</span>(COVID19_df, Country_df, <span class="dt">by =</span> <span class="st">&quot;Country&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1394-2"><a href="visualization3.html#cb1394-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Date                 =</span> <span class="kw">as.Date</span>(Date),</span>
<span id="cb1394-3"><a href="visualization3.html#cb1394-3"></a>         <span class="dt">Confirmed_per_capita =</span> Confirmed_Day <span class="op">/</span><span class="st"> </span>Population <span class="op">*</span><span class="st"> </span><span class="dv">10000</span>,</span>
<span id="cb1394-4"><a href="visualization3.html#cb1394-4"></a>         <span class="dt">Japan                =</span> <span class="kw">if_else</span>(Country <span class="op">==</span><span class="st"> &quot;Japan&quot;</span>, <span class="st">&quot;日本&quot;</span>, <span class="st">&quot;その他&quot;</span>),</span>
<span id="cb1394-5"><a href="visualization3.html#cb1394-5"></a>         <span class="dt">Japan                =</span> <span class="kw">factor</span>(Japan, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;日本&quot;</span>, <span class="st">&quot;その他&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb1394-6"><a href="visualization3.html#cb1394-6"></a><span class="st">  </span><span class="kw">filter</span>(Country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Japan&quot;</span>, <span class="st">&quot;China&quot;</span>, <span class="st">&quot;Taiwan&quot;</span>, <span class="st">&quot;South Korea&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1394-7"><a href="visualization3.html#cb1394-7"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1394-8"><a href="visualization3.html#cb1394-8"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Date, <span class="dt">y =</span> Confirmed_per_capita, </span>
<span id="cb1394-9"><a href="visualization3.html#cb1394-9"></a>                <span class="dt">group =</span> Country, <span class="dt">linetype =</span> Japan)) <span class="op">+</span></span>
<span id="cb1394-10"><a href="visualization3.html#cb1394-10"></a><span class="st">  </span><span class="kw">scale_linetype_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;日本&quot;</span> =<span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;その他&quot;</span> =<span class="st"> </span><span class="dv">2</span>)) <span class="op">+</span></span>
<span id="cb1394-11"><a href="visualization3.html#cb1394-11"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;月&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;1万人当たり新規感染者数&quot;</span>, <span class="dt">linetype =</span> <span class="st">&quot;国&quot;</span>) <span class="op">+</span></span>
<span id="cb1394-12"><a href="visualization3.html#cb1394-12"></a><span class="st">  </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>) <span class="op">+</span></span>
<span id="cb1394-13"><a href="visualization3.html#cb1394-13"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-729-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>これで完成ですがいかがでしょうか。複数の線を識別するという意味では色分け（<code>color</code>）が優れていますし、ハイライトなら透明度（<code>alpha</code>）か線の太さ（<code>size</code>）の方が良いでしょう。筆者（SONG）としましては<code>linetype</code>による次元の追加はあまりオススメしませんが、知っといて損はないでしょう。</p>
<hr />
</div>
</div>
<div id="visual3-theme" class="section level2" number="19.4">
<h2><span class="header-section-number">19.4</span> <code>theme_*()</code>と<code>theme()</code>: テーマの指定</h2>
<p>　続いて図全体の雰囲気を決める<code>theme_*()</code>レイヤーについて解説します。これらの使い方は非常に簡単であり、<code>ggplot</code>オブジェクトに<code>theme_*()</code>レイヤーを<code>+</code>で繋ぐだけです。もし、こちらのレイヤーを追加しない場合、デフォルトテーマとして<code>theme_gray()</code>が適用されます。{ggplot2}はいくつかのテーマを提供しており、以下がその例です。</p>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-730-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>　他にも{ggplot2}用のテーマをパッケージとしてまとめたものもあります。興味のある方は<a href="https://yutannihilation.github.io/allYourFigureAreBelongToUs/ggthemes/">ggtheme</a>や<a href="https://github.com/Mikata-Project/ggthemr">ggthemr</a>ページを確認してみてください。</p>
<p>　<code>theme_*()</code>内部ではいくつかの引数を指定することができます。最もよく使われるのが<code>base_family</code>引数であり、図で使用するフォントを指定する引数です。macOSユーザーだとヒラギノ角ゴジックW3が良く使われており、<code>base_family = "HiraKakuProN-W3"</code>で設定可能です。他にも全体の文字サイズを指定する<code>base_size</code>などがあります。</p>
<p>　テーマの微調整は主に<code>theme()</code>レイヤーで行います。こちらでは図の見た目に関する細かい調整ができます。実は<code>theme_*()</code>関数群は調整済み<code>theme()</code>レイヤーとして捉えることも出来ます。<code>theme_*()</code>と<code>theme()</code>を同時に使うことも可能であり、「全般的にはminimalテーマ（<code>theme_minimal()</code>）が好きだけど、ここだけはちょっと修正したい」場合に使用します。<code>theme()</code>では図の見た目に関する全ての部分が設定可能であるため、引数も膨大です。詳しくはコンソール上で<code>?theme</code>を入力し、ヘルプを確認してください。ここではいくつかの例のみを紹介します。</p>
<p>　まずは実習用データとして任意の棒グラフを作成し、<code>Theme_Fig</code>という名のオブジェクトとして保存しておきます。</p>
<div class="sourceCode" id="cb1395"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1395-1"><a href="visualization3.html#cb1395-1"></a>Theme_Fig &lt;-<span class="st"> </span>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1395-2"><a href="visualization3.html#cb1395-2"></a><span class="st">  </span><span class="co"># Freedom HouseのStatus、Continentでグループ化</span></span>
<span id="cb1395-3"><a href="visualization3.html#cb1395-3"></a><span class="st">  </span><span class="kw">group_by</span>(FH_Status, Continent) <span class="op">%&gt;%</span></span>
<span id="cb1395-4"><a href="visualization3.html#cb1395-4"></a><span class="st">  </span><span class="co"># 欠損値のある行を除き、PPP_per_capitaの平均値を計算</span></span>
<span id="cb1395-5"><a href="visualization3.html#cb1395-5"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">PPP     =</span> <span class="kw">mean</span>(PPP_per_capita, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb1395-6"><a href="visualization3.html#cb1395-6"></a>            <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1395-7"><a href="visualization3.html#cb1395-7"></a><span class="st">  </span><span class="co"># 欠損値の行を除去</span></span>
<span id="cb1395-8"><a href="visualization3.html#cb1395-8"></a><span class="st">  </span><span class="kw">drop_na</span>() <span class="op">%&gt;%</span></span>
<span id="cb1395-9"><a href="visualization3.html#cb1395-9"></a><span class="st">  </span><span class="co"># Freedom HouseのStatusを再ラベリングし、factor化</span></span>
<span id="cb1395-10"><a href="visualization3.html#cb1395-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">FH_Status =</span> <span class="kw">case_when</span>(FH_Status <span class="op">==</span><span class="st"> &quot;F&quot;</span>  <span class="op">~</span><span class="st"> &quot;Free&quot;</span>,</span>
<span id="cb1395-11"><a href="visualization3.html#cb1395-11"></a>                               FH_Status <span class="op">==</span><span class="st"> &quot;PF&quot;</span> <span class="op">~</span><span class="st"> &quot;Partially Free&quot;</span>,</span>
<span id="cb1395-12"><a href="visualization3.html#cb1395-12"></a>                               FH_Status <span class="op">==</span><span class="st"> &quot;NF&quot;</span> <span class="op">~</span><span class="st"> &quot;Not Free&quot;</span>),</span>
<span id="cb1395-13"><a href="visualization3.html#cb1395-13"></a>         <span class="dt">FH_Status =</span> <span class="kw">factor</span>(FH_Status, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Free&quot;</span>, <span class="st">&quot;Partially Free&quot;</span>,</span>
<span id="cb1395-14"><a href="visualization3.html#cb1395-14"></a>                                                  <span class="st">&quot;Not Free&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb1395-15"><a href="visualization3.html#cb1395-15"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1395-16"><a href="visualization3.html#cb1395-16"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> FH_Status, <span class="dt">y =</span> PPP, <span class="dt">fill =</span> Continent),</span>
<span id="cb1395-17"><a href="visualization3.html#cb1395-17"></a>           <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb1395-18"><a href="visualization3.html#cb1395-18"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Polity IV Score&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;PPP per capita (USD)&quot;</span>)</span>
<span id="cb1395-19"><a href="visualization3.html#cb1395-19"></a></span>
<span id="cb1395-20"><a href="visualization3.html#cb1395-20"></a>Theme_Fig</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-731-1.png" width="480" style="display: block; margin: auto;" /></p>
<p><strong>文字の大きさ</strong></p>
<p>　図全体における文字の大きさは<code>theme_*()</code>レイヤーの<code>base_size</code>から調整することもできますが、<code>theme()</code>からも可能です。文字に関する調整は<code>text</code>引数に対して<code>element_text()</code>実引数を指定します。大きさの場合、<code>element_text()</code>内に<code>size</code>引数を指定します。</p>
<div class="sourceCode" id="cb1396"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1396-1"><a href="visualization3.html#cb1396-1"></a>Theme_Fig <span class="op">+</span></span>
<span id="cb1396-2"><a href="visualization3.html#cb1396-2"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">16</span>))</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-732-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>　<code>element_text()</code>では文字の大きさ以外にも色（<code>color</code>）、回転の度合い（<code>angle</code>）などを指定することもできます。詳しくはRコンソール上で<code>?element_text</code>を入力し、ヘルプを確認してください。</p>
<p><strong>背景のグリッド</strong></p>
<p>　背景のグリッドを調整する際は<code>panel.gird.*</code>引数を使います。主に使用する場面はグリッドの除去する場合ですが、この場合は実引数として<code>element_blank()</code>を使います。もし、グリッドの色や太さなどを変更したい場合は<code>element_line()</code>を使用します。ここではグリッドを除去する方法について紹介します。</p>
<p>　グリッドを除去する場合、どのグリッドを除去するかを決めないといけません。例えば、すべてのグリッドを除去するためには<code>panel.grid = element_blank()</code>を使います。また、メジャーグリッドの除去には<code>panel.grid.major</code>（すべて）、<code>panel.grid.major.x</code>（横軸のみ）、<code>panel.grid.major.y</code>（縦軸のみ）を指定します。マイナーグリッドの場合は<code>major</code>を<code>minor</code>に替えてください。以下にはいくつかの例をお見せします。</p>
<div class="sourceCode" id="cb1397"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1397-1"><a href="visualization3.html#cb1397-1"></a><span class="co"># すべてのグリッドを除去</span></span>
<span id="cb1397-2"><a href="visualization3.html#cb1397-2"></a>Theme_Fig <span class="op">+</span></span>
<span id="cb1397-3"><a href="visualization3.html#cb1397-3"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-733-1.png" width="480" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1398"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1398-1"><a href="visualization3.html#cb1398-1"></a><span class="co"># x軸のメジャーグリッドを除去</span></span>
<span id="cb1398-2"><a href="visualization3.html#cb1398-2"></a>Theme_Fig <span class="op">+</span></span>
<span id="cb1398-3"><a href="visualization3.html#cb1398-3"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid.major.x =</span> <span class="kw">element_blank</span>())</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-733-2.png" width="480" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1399"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1399-1"><a href="visualization3.html#cb1399-1"></a><span class="co"># y軸のマイナーグリッドのみ除去</span></span>
<span id="cb1399-2"><a href="visualization3.html#cb1399-2"></a>Theme_Fig <span class="op">+</span></span>
<span id="cb1399-3"><a href="visualization3.html#cb1399-3"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor.y =</span> <span class="kw">element_blank</span>())</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-733-3.png" width="480" style="display: block; margin: auto;" /></p>
<p><strong>目盛りラベルの回転</strong></p>
<p>　横軸の目盛りラベルが長すぎるか大きすぎると、ラベルが重なる場合があります。この場合の対処方法としてはラベルの長さを短くしたり、改行（<code>\n</code>）を入れることが考えられますが、ラベルを若干回転することでも対処可能です。たとえば、横軸の目盛りラベルを調整する場合は<code>axis.text.x = element_text()</code>を指定し、<code>element_text()</code>内に<code>angle</code>引数を指定します。例えば、 <strong>反</strong>時計回りで25度回転させる場合は<code>angle = 25</code>と指定します。</p>
<div class="sourceCode" id="cb1400"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1400-1"><a href="visualization3.html#cb1400-1"></a>Theme_Fig <span class="op">+</span></span>
<span id="cb1400-2"><a href="visualization3.html#cb1400-2"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">16</span>),</span>
<span id="cb1400-3"><a href="visualization3.html#cb1400-3"></a>        <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">25</span>))</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-734-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>　この場合、ラベルは目盛りのすぐ下を基準に回転することになります。もし、ラベルの最後の文字を目盛りの下に移動させる場合は<code>hjust = 1</code>を追加します。</p>
<div class="sourceCode" id="cb1401"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1401-1"><a href="visualization3.html#cb1401-1"></a>Theme_Fig <span class="op">+</span></span>
<span id="cb1401-2"><a href="visualization3.html#cb1401-2"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">16</span>),</span>
<span id="cb1401-3"><a href="visualization3.html#cb1401-3"></a>        <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">25</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-735-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>　ちなみに、<code>angle = 90</code>などで指定するとラベルが重なる問題はほぼ完全に解決されますが、かなり読みづらくなるので、できれば<code>angle</code>の値は小さめにした方が読みやすくなります。</p>
<p><strong>凡例の位置</strong></p>
<p>　凡例を図の下段に移動させる場合は<code>legend.position</code>引数に<code>"bottom"</code>を指定するだけです。他にも<code>"top"</code>や<code>"left"</code>も可能ですが、凡例は一般的に図の右か下段に位置しますので、デフォルトのままに置くか、<code>"bottom"</code>くらいしか使わないでしょう。</p>
<div class="sourceCode" id="cb1402"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1402-1"><a href="visualization3.html#cb1402-1"></a><span class="co"># 凡例を図の下段へ移動</span></span>
<span id="cb1402-2"><a href="visualization3.html#cb1402-2"></a>Theme_Fig <span class="op">+</span></span>
<span id="cb1402-3"><a href="visualization3.html#cb1402-3"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-736-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>　もし、凡例を図の内部に置く場合は、長さ2のnumeric型ベクトルを指定します。図の左下なら<code>c(0, 0)</code>、左上なら<code>c(0, 1)</code>、右上は<code>c(1, 1)</code>、右下は<code>c(1, 0)</code>となります。これは図の大きさを横縦それぞれ1とした場合の位置を意味します。ここでは凡例を右上へ置いてみましょう。</p>
<div class="sourceCode" id="cb1403"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1403-1"><a href="visualization3.html#cb1403-1"></a><span class="co"># 凡例をプロットの右上へ</span></span>
<span id="cb1403-2"><a href="visualization3.html#cb1403-2"></a>Theme_Fig <span class="op">+</span></span>
<span id="cb1403-3"><a href="visualization3.html#cb1403-3"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-737-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>　これは凡例の中央が右上に来るようになります。これを是正するためには<code>legend.justification</code>引数を更に指定する必要があります。これにも長さ2のnumeric型ベクトルを指定しますが、これは凡例の中心をどこにするかを意味します。今回の例だと、<strong>凡例の</strong>右上を<code>c(1, 1)</code>に位置させたいので、ここも<code>c(1, 1)</code>と指定します。基本的に<code>legend.position</code>と<code>legend.justification</code>は同じ値にすれば問題ないでしょう。</p>
<div class="sourceCode" id="cb1404"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1404-1"><a href="visualization3.html#cb1404-1"></a><span class="co"># 凡例の中心を凡例の右上と指定</span></span>
<span id="cb1404-2"><a href="visualization3.html#cb1404-2"></a>Theme_Fig <span class="op">+</span></span>
<span id="cb1404-3"><a href="visualization3.html#cb1404-3"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1404-4"><a href="visualization3.html#cb1404-4"></a>        <span class="dt">legend.justification =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-738-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>　また、凡例の背景を透明にしたい場合は<code>legend.background = element_blank()</code>を指定します。</p>
<div class="sourceCode" id="cb1405"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1405-1"><a href="visualization3.html#cb1405-1"></a><span class="co"># 凡例を背景を透明に</span></span>
<span id="cb1405-2"><a href="visualization3.html#cb1405-2"></a>Theme_Fig <span class="op">+</span></span>
<span id="cb1405-3"><a href="visualization3.html#cb1405-3"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1405-4"><a href="visualization3.html#cb1405-4"></a>        <span class="dt">legend.justification =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1405-5"><a href="visualization3.html#cb1405-5"></a>        <span class="dt">legend.background =</span> <span class="kw">element_blank</span>())</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-739-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>　<code>theme()</code>関数が提供している昨日は非常に多く、それぞれの実引数として用いられる<code>element_text()</code>や<code>element_line()</code>、<code>element_rect()</code>にも様々な引数が提供されております。図を自分好みに微調整したい方はそれぞれの関数のヘルプを参照してください。</p>
<hr />
</div>
<div id="visual3-merge" class="section level2" number="19.5">
<h2><span class="header-section-number">19.5</span> 図の結合</h2>
<p>　{ggplot2}で作成した複数の図を一つの図としてまとめる場合、昔は{<a href="https://cran.r-project.org/web/packages/gridExtra/vignettes/arrangeGrob.html">gridExtra</a>}一択でした。しかし、今はもっと使いやすいパッケージがいくつか公開されており、ここでは{ggpubr}の<code>ggarrange()</code>を紹介します。使い方を紹介する前に、結合する図をいくつか用意し、それぞれ<code>Grid_Fig1</code>、<code>Gird_Fig2</code>、…<code>Grid_Fig4</code>と名付けます。</p>
<div class="sourceCode" id="cb1406"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1406-1"><a href="visualization3.html#cb1406-1"></a><span class="co"># Grid_Fig1: 散布図</span></span>
<span id="cb1406-2"><a href="visualization3.html#cb1406-2"></a><span class="co"># X軸: フリーダムハウス・スコア / Y軸: 一人あたり購買力平価GDP（対数）</span></span>
<span id="cb1406-3"><a href="visualization3.html#cb1406-3"></a>Grid_Fig1 &lt;-<span class="st"> </span>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1406-4"><a href="visualization3.html#cb1406-4"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1406-5"><a href="visualization3.html#cb1406-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> FH_Total, <span class="dt">y =</span> PPP_per_capita)) <span class="op">+</span></span>
<span id="cb1406-6"><a href="visualization3.html#cb1406-6"></a><span class="st">  </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></span>
<span id="cb1406-7"><a href="visualization3.html#cb1406-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;フリーダムハウススコア&quot;</span>, </span>
<span id="cb1406-8"><a href="visualization3.html#cb1406-8"></a>       <span class="dt">y =</span> <span class="st">&quot;一人あたり購買力平価GDP（対数）&quot;</span>) <span class="op">+</span></span>
<span id="cb1406-9"><a href="visualization3.html#cb1406-9"></a><span class="st">  </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>)</span>
<span id="cb1406-10"><a href="visualization3.html#cb1406-10"></a></span>
<span id="cb1406-11"><a href="visualization3.html#cb1406-11"></a><span class="co"># Grid_Fig2: 散布図</span></span>
<span id="cb1406-12"><a href="visualization3.html#cb1406-12"></a><span class="co"># X軸: フリーダムハウス・スコア / Y軸: 2018年人間開発指数</span></span>
<span id="cb1406-13"><a href="visualization3.html#cb1406-13"></a>Grid_Fig2 &lt;-<span class="st"> </span>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1406-14"><a href="visualization3.html#cb1406-14"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1406-15"><a href="visualization3.html#cb1406-15"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> FH_Total, <span class="dt">y =</span> HDI_<span class="dv">2018</span>)) <span class="op">+</span></span>
<span id="cb1406-16"><a href="visualization3.html#cb1406-16"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;フリーダムハウススコア&quot;</span>, </span>
<span id="cb1406-17"><a href="visualization3.html#cb1406-17"></a>       <span class="dt">y =</span> <span class="st">&quot;人間開発指数（2018年）&quot;</span>) <span class="op">+</span></span>
<span id="cb1406-18"><a href="visualization3.html#cb1406-18"></a><span class="st">  </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>)</span>
<span id="cb1406-19"><a href="visualization3.html#cb1406-19"></a></span>
<span id="cb1406-20"><a href="visualization3.html#cb1406-20"></a><span class="co"># Grid_Fig4: ヒストグラム</span></span>
<span id="cb1406-21"><a href="visualization3.html#cb1406-21"></a><span class="co"># X軸: フリーダムハウス・スコア</span></span>
<span id="cb1406-22"><a href="visualization3.html#cb1406-22"></a>Grid_Fig3 &lt;-<span class="st"> </span>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1406-23"><a href="visualization3.html#cb1406-23"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1406-24"><a href="visualization3.html#cb1406-24"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> FH_Total), <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb1406-25"><a href="visualization3.html#cb1406-25"></a>                 <span class="dt">binwidth =</span> <span class="dv">5</span>, <span class="dt">boundary =</span> <span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb1406-26"><a href="visualization3.html#cb1406-26"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;フリーダムハウススコア&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;国数&quot;</span>) <span class="op">+</span></span>
<span id="cb1406-27"><a href="visualization3.html#cb1406-27"></a><span class="st">  </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>)</span>
<span id="cb1406-28"><a href="visualization3.html#cb1406-28"></a></span>
<span id="cb1406-29"><a href="visualization3.html#cb1406-29"></a><span class="co"># Grid_Fig4: ヒストグラム</span></span>
<span id="cb1406-30"><a href="visualization3.html#cb1406-30"></a><span class="co"># Y軸: 一人あたり購買力平価GDP（対数）</span></span>
<span id="cb1406-31"><a href="visualization3.html#cb1406-31"></a><span class="co"># 時計回りで90度回転したヒストグラムを作成するために、yにマッピング</span></span>
<span id="cb1406-32"><a href="visualization3.html#cb1406-32"></a>Grid_Fig4 &lt;-<span class="st"> </span>Country_df <span class="op">%&gt;%</span></span>
<span id="cb1406-33"><a href="visualization3.html#cb1406-33"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1406-34"><a href="visualization3.html#cb1406-34"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">y =</span> PPP_per_capita), <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb1406-35"><a href="visualization3.html#cb1406-35"></a>                 <span class="dt">boundary =</span> <span class="dv">0</span>, <span class="dt">bins =</span> <span class="dv">15</span>) <span class="op">+</span></span>
<span id="cb1406-36"><a href="visualization3.html#cb1406-36"></a><span class="st">  </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></span>
<span id="cb1406-37"><a href="visualization3.html#cb1406-37"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;国数&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;一人あたり購買力平価GDP（対数）&quot;</span>) <span class="op">+</span></span>
<span id="cb1406-38"><a href="visualization3.html#cb1406-38"></a><span class="st">  </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;HiraKakuProN-W3&quot;</span>)</span></code></pre></div>
<p>　それぞれの図は以下の通りです。左上、右上、左下、右下の順でそれぞれ<code>Grid_Fig1</code>、<code>Grid_Fig2</code>、<code>Grid_Fig3</code>、<code>Grid_Fig4</code>です。</p>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-741-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>　まずは<code>Grid_Fig1</code>と<code>Grid_Fig2</code>を横に並べてみましょう。まずは{ggpubr}を読み込みます。</p>
<div class="sourceCode" id="cb1407"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1407-1"><a href="visualization3.html#cb1407-1"></a><span class="kw">library</span>(ggpubr)</span></code></pre></div>
<p>　図を並べる際は<code>ggarrange()</code>関数を使用し、まず、結合したい図のオブジェクトを入力します。また、2つの図を横に並べることは1行2列のレイアウトであることを意味するため、<code>nrow</code>と<code>ncol</code>引数の実引数としてそれぞれ1と2を指定します。</p>
<div class="sourceCode" id="cb1408"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1408-1"><a href="visualization3.html#cb1408-1"></a><span class="kw">ggarrange</span>(Grid_Fig1, Grid_Fig2, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-743-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>　右側にある<code>Grid_Fig2</code>の幅が若干広いような気がします。この場合、<code>aling = "hv"</code>を入れると綺麗に揃えられます。</p>
<div class="sourceCode" id="cb1409"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1409-1"><a href="visualization3.html#cb1409-1"></a><span class="kw">ggarrange</span>(Grid_Fig1, Grid_Fig2, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">align =</span> <span class="st">&quot;hv&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-744-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>　続きまして、3つの図を以下のように並べるとします。</p>
<table class=" lightable-classic table table-bordered" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto; margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
<code>Grid_Fig3</code>
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
</td>
</tr>
<tr>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
<code>Grid_Fig1</code>
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
<code>Grid_Fig4</code>
</td>
</tr>
</tbody>
</table>
<p>　今回は3つの図オブジェクトを入れるだけでは不十分です。なぜなら、<code>ggarrange()</code>関数は左上から右下の順番へ一つずつ図を入れるからです。もし、3つの図オブジェクトのみを入れると、以下のように配置されます。</p>
<table class=" lightable-classic table table-bordered" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto; margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
<code>Grid_Fig3</code>
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
<code>Grid_Fig1</code>
</td>
</tr>
<tr>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
<code>Grid_Fig4</code>
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
</td>
</tr>
</tbody>
</table>
<p>　これを回避するためには空欄とするグリッドに<code>NULL</code>を指定する必要があります。</p>
<div class="sourceCode" id="cb1410"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1410-1"><a href="visualization3.html#cb1410-1"></a><span class="kw">ggarrange</span>(Grid_Fig3, <span class="co"># 1行1列目</span></span>
<span id="cb1410-2"><a href="visualization3.html#cb1410-2"></a>          <span class="ot">NULL</span>,      <span class="co"># 1行2列目</span></span>
<span id="cb1410-3"><a href="visualization3.html#cb1410-3"></a>          Grid_Fig1, <span class="co"># 2行1列目</span></span>
<span id="cb1410-4"><a href="visualization3.html#cb1410-4"></a>          Grid_Fig4, <span class="co"># 2行2列目</span></span>
<span id="cb1410-5"><a href="visualization3.html#cb1410-5"></a>          <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">align =</span> <span class="st">&quot;hv&quot;</span>)</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-747-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>　次はヒストグラムを小さく調整します。左上の<code>Grid_Fig3</code>の上下の幅を、右下の<code>Grid_Fig4</code>は左右の幅を狭くします。このためには<code>widths</code>と<code>heights</code>引数が必要です。たとえば、<code>heights = c(0.3, 0.7)</code>だと1行目は全体の30%、2行目は全体の70%になります。今回は1行目と2行目の比率は3:7に、1列目と2列目の比は7:3とします。また、それぞれの図に(a)、(b)、(c)を付けます。空欄となるグリッドのラベルは<code>NA</code>か<code>""</code>にします。<code>NULL</code>ではないことに注意してください。</p>
<div class="sourceCode" id="cb1411"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1411-1"><a href="visualization3.html#cb1411-1"></a><span class="kw">ggarrange</span>(Grid_Fig3, </span>
<span id="cb1411-2"><a href="visualization3.html#cb1411-2"></a>          <span class="ot">NULL</span>, </span>
<span id="cb1411-3"><a href="visualization3.html#cb1411-3"></a>          Grid_Fig1, </span>
<span id="cb1411-4"><a href="visualization3.html#cb1411-4"></a>          Grid_Fig4,</span>
<span id="cb1411-5"><a href="visualization3.html#cb1411-5"></a>          <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">align =</span> <span class="st">&quot;hv&quot;</span>,</span>
<span id="cb1411-6"><a href="visualization3.html#cb1411-6"></a>          <span class="co"># グリットの大きさを調整</span></span>
<span id="cb1411-7"><a href="visualization3.html#cb1411-7"></a>          <span class="dt">widths =</span> <span class="kw">c</span>(<span class="fl">0.7</span>, <span class="fl">0.3</span>), <span class="dt">heights =</span> <span class="kw">c</span>(<span class="fl">0.3</span>, <span class="fl">0.7</span>),</span>
<span id="cb1411-8"><a href="visualization3.html#cb1411-8"></a>          <span class="co"># 各図にラベルを付ける</span></span>
<span id="cb1411-9"><a href="visualization3.html#cb1411-9"></a>          <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;(a)&quot;</span>, <span class="ot">NA</span>, <span class="st">&quot;(b)&quot;</span>, <span class="st">&quot;(c)&quot;</span>))</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-748-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>　左上の<code>Grid_Fig3</code>と左下の<code>Grid_Fig1</code>は横軸のラベルを共有しており、左下の<code>Grid_Fig1</code>と右下の<code>Grid_Fig4</code>は縦軸のラベルを共有しています。以下では<code>Grid_Fig3</code>の横軸ラベル、<code>Grid_Fig4</code>の縦軸ラベルを消します。ggplotオブジェクトに<code>theme(axis.title.x = element_blank())</code>を<code>+</code>で繋ぐと横軸のラベルが表示されなくなります。<code>ggarrange()</code>に入れるオブジェクトに直接アクセスし、それぞれの軸ラベルを消してみましょう<a href="#fn85" class="footnote-ref" id="fnref85"><sup>85</sup></a>。</p>
<div class="sourceCode" id="cb1412"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb1412-1"><a href="visualization3.html#cb1412-1"></a><span class="kw">ggarrange</span>(Grid_Fig3 <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title.x =</span> <span class="kw">element_blank</span>()), </span>
<span id="cb1412-2"><a href="visualization3.html#cb1412-2"></a>          <span class="ot">NULL</span>, </span>
<span id="cb1412-3"><a href="visualization3.html#cb1412-3"></a>          Grid_Fig1, </span>
<span id="cb1412-4"><a href="visualization3.html#cb1412-4"></a>          Grid_Fig4 <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>()),</span>
<span id="cb1412-5"><a href="visualization3.html#cb1412-5"></a>          <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">align =</span> <span class="st">&quot;hv&quot;</span>,</span>
<span id="cb1412-6"><a href="visualization3.html#cb1412-6"></a>          <span class="dt">widths =</span> <span class="kw">c</span>(<span class="fl">0.7</span>, <span class="fl">0.3</span>), <span class="dt">heights =</span> <span class="kw">c</span>(<span class="fl">0.3</span>, <span class="fl">0.7</span>),</span>
<span id="cb1412-7"><a href="visualization3.html#cb1412-7"></a>          <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;(a)&quot;</span>, <span class="ot">NA</span>, <span class="st">&quot;(b)&quot;</span>, <span class="st">&quot;(c)&quot;</span>))</span></code></pre></div>
<p><img src="R_Not_for_Everyone_files/figure-html/unnamed-chunk-749-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>　これで完成です。<code>ggarrange()</code>には他にもカスタマイズ可能な部分がいっぱいあります。詳細はコンソール上で<code>?ggarrange</code>を入力し、ヘルプを参照してください。</p>
<p>　他にも{egg}パッケージの<code>ggarrange()</code>、{cowplot}の<code>plot_grid()</code>、{patchwork}の<code>+</code>、<code>|</code>、<code>/</code>演算子などがあります。それぞれ強みがあり、便利なパッケージです。興味のある読者は以下のページで使い方を確認してみてください。</p>
<ul>
<li><a href="https://cran.r-project.org/web/packages/egg/vignettes/Overview.html">egg</a></li>
<li><a href="https://cran.r-project.org/web/packages/cowplot/vignettes/introduction.html">cowplot</a></li>
<li><a href="https://github.com/thomasp85/patchwork">patchwork</a></li>
</ul>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="81">
<li id="fn81"><p>例えば、回帰係数の点推定値と信頼区間を示す係数プロット（キャタピラー・プロット）を作成する際は<code>geom_pointrange()</code>と<code>coord_flip()</code>を組み合わせてきましたが、今の{ggplot2}は<code>geom_pointrange()</code>のみで自由自在に作成できます。<a href="visualization3.html#fnref81" class="footnote-back">↩︎</a></p></li>
<li id="fn82"><p>厳密には0から360までの全範囲の色を使うわけではありません。なぜなら、Hueは0度から360度、つまり循環する仕組みになっているからです。実際、Hueが[0, 360]の図を見ても、左上の色と右下の色は非常に似ていることが分かります。したがって、0から360を全て使用すると色の区別が難しくなるため、この場合は後半の色は仕様されません。<a href="visualization3.html#fnref82" class="footnote-back">↩︎</a></p></li>
<li id="fn83"><p>宋が論文を出した際、半透明なオブジェクトが査読者のPCでは出力されなかったことがあり、「お前、一体図の何を見ろと言ってるんだ」と怒られたことがあります。<a href="visualization3.html#fnref83" class="footnote-back">↩︎</a></p></li>
<li id="fn84"><p>強調したい線を太線にするなど<a href="visualization3.html#fnref84" class="footnote-back">↩︎</a></p></li>
<li id="fn85"><p>もし、横軸（x）の目盛りも消したい場合は<code>theme()</code>内に<code>axis.ticks.x = element_blank()</code>を、目盛りのラベルまで消したい場合は<code>axis.text.x  = element_blank()</code>を追加してください。横軸（y）の場合は<code>.x</code>の箇所を<code>.y</code>に書き換えてください。<a href="visualization3.html#fnref85" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="visualization2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualization4.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["R_Not_for_Everyone.pdf", "R_Not_for_Everyone.epub"],
"toc": {
"collapse": "section"
},
"toolbar": {
"position": "fixed"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
