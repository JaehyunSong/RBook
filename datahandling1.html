<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>13. データハンドリング [基礎編: 抽出] | 私たちのR: ベストプラクティスの探究</title>
  <meta name="description" content="R Not for Everyone: An Esoteric Guide." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="13. データハンドリング [基礎編: 抽出] | 私たちのR: ベストプラクティスの探究" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="R Not for Everyone: An Esoteric Guide." />
  <meta name="github-repo" content="JaehyunSong/RBook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="13. データハンドリング [基礎編: 抽出] | 私たちのR: ベストプラクティスの探究" />
  
  <meta name="twitter:description" content="R Not for Everyone: An Esoteric Guide." />
  

<meta name="author" content="宋財泫 (Jaehyun Song)・矢内勇生 (Yuki Yanai)" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="HTML/apple-favicon.png" />
  <link rel="shortcut icon" href="HTML/favicon.png" type="image/x-icon" />
<link rel="prev" href="functions.html"/>
<link rel="next" href="datahandling2.html"/>
<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.18/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-165592410-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-165592410-1');
  gtag('set', {'user_id': 'USER_ID'}); 
</script>

<meta name="google-site-verification" content="QJouPRaPKBPU1jDp6VaBuFbVV5imTI-Aazl_ScJwVgU" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="HTML/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">私たちのR</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> 紹介</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#progress"><i class="fa fa-check"></i><b>1.1</b> 進捗状況</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#purpose"><i class="fa fa-check"></i><b>1.2</b> 本書の目的と対象</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#about-author"><i class="fa fa-check"></i><b>1.3</b> 著者紹介</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#about-download"><i class="fa fa-check"></i><b>1.4</b> データのダウンロード</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#about-howtoread"><i class="fa fa-check"></i><b>1.5</b> 本書における表記法</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#about-copyright"><i class="fa fa-check"></i><b>1.6</b> 著作権</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="aboutR.html"><a href="aboutR.html"><i class="fa fa-check"></i><b>2</b> R?</a>
<ul>
<li class="chapter" data-level="2.1" data-path="aboutR.html"><a href="aboutR.html#WhatIsR"><i class="fa fa-check"></i><b>2.1</b> Rとは</a></li>
<li class="chapter" data-level="2.2" data-path="aboutR.html"><a href="aboutR.html#WhyR"><i class="fa fa-check"></i><b>2.2</b> Why R?</a></li>
<li class="chapter" data-level="2.3" data-path="aboutR.html"><a href="aboutR.html#GUI_IDE"><i class="fa fa-check"></i><b>2.3</b> GUIとIDE</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="aboutR.html"><a href="aboutR.html#gui"><i class="fa fa-check"></i><b>2.3.1</b> GUI</a></li>
<li class="chapter" data-level="2.3.2" data-path="aboutR.html"><a href="aboutR.html#aboutR-IDE"><i class="fa fa-check"></i><b>2.3.2</b> IDE</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>3</b> Rのインストール</a>
<ul>
<li class="chapter" data-level="3.1" data-path="installation.html"><a href="installation.html#install-package"><i class="fa fa-check"></i><b>3.1</b> パッケージのインストール</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="installation.html"><a href="installation.html#パッケージのインストール"><i class="fa fa-check"></i><b>3.1.1</b> パッケージのインストール</a></li>
<li class="chapter" data-level="3.1.2" data-path="installation.html"><a href="installation.html#パッケージの読み込み"><i class="fa fa-check"></i><b>3.1.2</b> パッケージの読み込み</a></li>
<li class="chapter" data-level="3.1.3" data-path="installation.html"><a href="installation.html#必須パッケージのインストール"><i class="fa fa-check"></i><b>3.1.3</b> 必須パッケージのインストール</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ide.html"><a href="ide.html"><i class="fa fa-check"></i><b>4</b> IDEの導入</a></li>
<li class="chapter" data-level="5" data-path="R-Customize.html"><a href="R-Customize.html"><i class="fa fa-check"></i><b>5</b> 分析環境のカスタマイズ</a>
<ul>
<li class="chapter" data-level="5.1" data-path="R-Customize.html"><a href="R-Customize.html#Customize-rprofile"><i class="fa fa-check"></i><b>5.1</b> .Rprofileの設定</a></li>
<li class="chapter" data-level="5.2" data-path="R-Customize.html"><a href="R-Customize.html#Customize-rstudio"><i class="fa fa-check"></i><b>5.2</b> RStudioのカスタマイズ</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="process.html"><a href="process.html"><i class="fa fa-check"></i><b>6</b> 分析の手順</a></li>
<li class="chapter" data-level="7" data-path="rbasic.html"><a href="rbasic.html"><i class="fa fa-check"></i><b>7</b> 基本的な操作</a>
<ul>
<li class="chapter" data-level="" data-path="rbasic.html"><a href="rbasic.html#目次"><i class="fa fa-check"></i>目次</a></li>
<li class="chapter" data-level="7.1" data-path="rbasic.html"><a href="rbasic.html#rbasic-compbasic"><i class="fa fa-check"></i><b>7.1</b> コンピュータの基礎知識</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="rbasic.html"><a href="rbasic.html#ファイル名"><i class="fa fa-check"></i><b>7.1.1</b> ファイル名</a></li>
<li class="chapter" data-level="7.1.2" data-path="rbasic.html"><a href="rbasic.html#ファイルシステムとパス"><i class="fa fa-check"></i><b>7.1.2</b> ファイルシステムとパス</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="rbasic.html"><a href="rbasic.html#rbasic-project"><i class="fa fa-check"></i><b>7.2</b> 「プロジェクト」のすゝめ</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="rbasic.html"><a href="rbasic.html#プロジェクト"><i class="fa fa-check"></i><b>7.2.1</b> プロジェクト</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="rbasic.html"><a href="rbasic.html#rbasic-calc"><i class="fa fa-check"></i><b>7.3</b> 電卓としてのR</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="rbasic.html"><a href="rbasic.html#算術演算子"><i class="fa fa-check"></i><b>7.3.1</b> 算術演算子</a></li>
<li class="chapter" data-level="7.3.2" data-path="rbasic.html"><a href="rbasic.html#論理演算子"><i class="fa fa-check"></i><b>7.3.2</b> 論理演算子</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="rbasic.html"><a href="rbasic.html#rbasic-input"><i class="fa fa-check"></i><b>7.4</b> 格納とオブジェクトの作成</a></li>
<li class="chapter" data-level="7.5" data-path="rbasic.html"><a href="rbasic.html#rbasic-extract"><i class="fa fa-check"></i><b>7.5</b> 要素の抽出</a></li>
<li class="chapter" data-level="7.6" data-path="rbasic.html"><a href="rbasic.html#rbasic-exercise"><i class="fa fa-check"></i><b>7.6</b> 演習問題</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="io.html"><a href="io.html"><i class="fa fa-check"></i><b>8</b> データの入出力</a>
<ul>
<li class="chapter" data-level="8.1" data-path="io.html"><a href="io.html#io-toc"><i class="fa fa-check"></i><b>8.1</b> 目次</a></li>
<li class="chapter" data-level="8.2" data-path="io.html"><a href="io.html#io-read"><i class="fa fa-check"></i><b>8.2</b> データの読み込み</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="io.html"><a href="io.html#csvファイルの場合"><i class="fa fa-check"></i><b>8.2.1</b> csvファイルの場合</a></li>
<li class="chapter" data-level="8.2.2" data-path="io.html"><a href="io.html#エンコーディングの話"><i class="fa fa-check"></i><b>8.2.2</b> エンコーディングの話</a></li>
<li class="chapter" data-level="8.2.3" data-path="io.html"><a href="io.html#その他のフォーマット"><i class="fa fa-check"></i><b>8.2.3</b> その他のフォーマット</a></li>
<li class="chapter" data-level="8.2.4" data-path="io.html"><a href="io.html#rdataファイルの場合"><i class="fa fa-check"></i><b>8.2.4</b> RDataファイルの場合</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="io.html"><a href="io.html#io-export"><i class="fa fa-check"></i><b>8.3</b> データの書き出し</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="io.html"><a href="io.html#csvファイル"><i class="fa fa-check"></i><b>8.3.1</b> csvファイル</a></li>
<li class="chapter" data-level="8.3.2" data-path="io.html"><a href="io.html#rdataファイル"><i class="fa fa-check"></i><b>8.3.2</b> RDataファイル</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="datatype.html"><a href="datatype.html"><i class="fa fa-check"></i><b>9</b> データの型</a>
<ul>
<li class="chapter" data-level="9.1" data-path="datatype.html"><a href="datatype.html#WhatIsDatatype"><i class="fa fa-check"></i><b>9.1</b> データ型とは</a></li>
<li class="chapter" data-level="9.2" data-path="datatype.html"><a href="datatype.html#type-logical"><i class="fa fa-check"></i><b>9.2</b> Logical</a></li>
<li class="chapter" data-level="9.3" data-path="datatype.html"><a href="datatype.html#type-numeric"><i class="fa fa-check"></i><b>9.3</b> Numeric</a></li>
<li class="chapter" data-level="9.4" data-path="datatype.html"><a href="datatype.html#type-complex"><i class="fa fa-check"></i><b>9.4</b> Complex</a></li>
<li class="chapter" data-level="9.5" data-path="datatype.html"><a href="datatype.html#type-character"><i class="fa fa-check"></i><b>9.5</b> Character</a></li>
<li class="chapter" data-level="9.6" data-path="datatype.html"><a href="datatype.html#type-factor"><i class="fa fa-check"></i><b>9.6</b> Factor</a></li>
<li class="chapter" data-level="9.7" data-path="datatype.html"><a href="datatype.html#type-date"><i class="fa fa-check"></i><b>9.7</b> Date</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="datatype.html"><a href="datatype.html#なぜdate型があるのか"><i class="fa fa-check"></i><b>9.7.1</b> なぜDate型があるのか</a></li>
<li class="chapter" data-level="9.7.2" data-path="datatype.html"><a href="datatype.html#date型の作り方"><i class="fa fa-check"></i><b>9.7.2</b> Date型の作り方</a></li>
<li class="chapter" data-level="9.7.3" data-path="datatype.html"><a href="datatype.html#posixctposixlt型について"><i class="fa fa-check"></i><b>9.7.3</b> POSIXct、POSIXlt型について</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="datatype.html"><a href="datatype.html#type-na"><i class="fa fa-check"></i><b>9.8</b> NA</a></li>
<li class="chapter" data-level="9.9" data-path="datatype.html"><a href="datatype.html#type-null"><i class="fa fa-check"></i><b>9.9</b> NULL</a></li>
<li class="chapter" data-level="9.10" data-path="datatype.html"><a href="datatype.html#type-nan"><i class="fa fa-check"></i><b>9.10</b> NaN</a></li>
<li class="chapter" data-level="9.11" data-path="datatype.html"><a href="datatype.html#type-inf"><i class="fa fa-check"></i><b>9.11</b> Inf</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="datastructure.html"><a href="datastructure.html"><i class="fa fa-check"></i><b>10</b> データの構造</a>
<ul>
<li class="chapter" data-level="10.1" data-path="datastructure.html"><a href="datastructure.html#structure-intro"><i class="fa fa-check"></i><b>10.1</b> 目次</a></li>
<li class="chapter" data-level="10.2" data-path="datastructure.html"><a href="datastructure.html#WhatIsDatastructure"><i class="fa fa-check"></i><b>10.2</b> データ構造とは</a></li>
<li class="chapter" data-level="10.3" data-path="datastructure.html"><a href="datastructure.html#structure-vector"><i class="fa fa-check"></i><b>10.3</b> ベクトル (vector)</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="datastructure.html"><a href="datastructure.html#ベクトルの作り方"><i class="fa fa-check"></i><b>10.3.1</b> ベクトルの作り方</a></li>
<li class="chapter" data-level="10.3.2" data-path="datastructure.html"><a href="datastructure.html#ベクトルの操作"><i class="fa fa-check"></i><b>10.3.2</b> ベクトルの操作</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="datastructure.html"><a href="datastructure.html#structure-matrix"><i class="fa fa-check"></i><b>10.4</b> 行列 (matrix)</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="datastructure.html"><a href="datastructure.html#行列の作り方"><i class="fa fa-check"></i><b>10.4.1</b> 行列の作り方</a></li>
<li class="chapter" data-level="10.4.2" data-path="datastructure.html"><a href="datastructure.html#行列の操作"><i class="fa fa-check"></i><b>10.4.2</b> 行列の操作</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="datastructure.html"><a href="datastructure.html#structure-dataframe"><i class="fa fa-check"></i><b>10.5</b> データフレーム (data.frame)</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="datastructure.html"><a href="datastructure.html#データフレームの作成"><i class="fa fa-check"></i><b>10.5.1</b> データフレームの作成</a></li>
<li class="chapter" data-level="10.5.2" data-path="datastructure.html"><a href="datastructure.html#データフレームの操作"><i class="fa fa-check"></i><b>10.5.2</b> データフレームの操作</a></li>
<li class="chapter" data-level="10.5.3" data-path="datastructure.html"><a href="datastructure.html#tibble型"><i class="fa fa-check"></i><b>10.5.3</b> tibble型</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="datastructure.html"><a href="datastructure.html#structure-list"><i class="fa fa-check"></i><b>10.6</b> リスト (list)</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="datastructure.html"><a href="datastructure.html#リスト型データの作成"><i class="fa fa-check"></i><b>10.6.1</b> リスト型データの作成</a></li>
<li class="chapter" data-level="10.6.2" data-path="datastructure.html"><a href="datastructure.html#リスト型データの操作"><i class="fa fa-check"></i><b>10.6.2</b> リスト型データの操作</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="datastructure.html"><a href="datastructure.html#structure-array"><i class="fa fa-check"></i><b>10.7</b> 配列 (array)</a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="datastructure.html"><a href="datastructure.html#配列型データの作成"><i class="fa fa-check"></i><b>10.7.1</b> 配列型データの作成</a></li>
<li class="chapter" data-level="10.7.2" data-path="datastructure.html"><a href="datastructure.html#配列型データの操作"><i class="fa fa-check"></i><b>10.7.2</b> 配列型データの操作</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="datastructure.html"><a href="datastructure.html#structure-exercise"><i class="fa fa-check"></i><b>10.8</b> 練習問題</a>
<ul>
<li class="chapter" data-level="10.8.1" data-path="datastructure.html"><a href="datastructure.html#ベクトル"><i class="fa fa-check"></i><b>10.8.1</b> ベクトル</a></li>
<li class="chapter" data-level="10.8.2" data-path="datastructure.html"><a href="datastructure.html#行列"><i class="fa fa-check"></i><b>10.8.2</b> 行列</a></li>
<li class="chapter" data-level="10.8.3" data-path="datastructure.html"><a href="datastructure.html#データフレーム"><i class="fa fa-check"></i><b>10.8.3</b> データフレーム</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="programming.html"><a href="programming.html"><i class="fa fa-check"></i><b>11</b> Rプログラミングの基礎</a>
<ul>
<li class="chapter" data-level="11.1" data-path="programming.html"><a href="programming.html#programming-intro"><i class="fa fa-check"></i><b>11.1</b> R言語の基礎概念</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="programming.html"><a href="programming.html#オブジェクト"><i class="fa fa-check"></i><b>11.1.1</b> オブジェクト</a></li>
<li class="chapter" data-level="11.1.2" data-path="programming.html"><a href="programming.html#クラス"><i class="fa fa-check"></i><b>11.1.2</b> クラス</a></li>
<li class="chapter" data-level="11.1.3" data-path="programming.html"><a href="programming.html#関数と引数"><i class="fa fa-check"></i><b>11.1.3</b> 関数と引数</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="programming.html"><a href="programming.html#programming-style"><i class="fa fa-check"></i><b>11.2</b> Rのコーディングスタイル</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="programming.html"><a href="programming.html#オブジェクト名"><i class="fa fa-check"></i><b>11.2.1</b> オブジェクト名</a></li>
<li class="chapter" data-level="11.2.2" data-path="programming.html"><a href="programming.html#改行"><i class="fa fa-check"></i><b>11.2.2</b> 改行</a></li>
<li class="chapter" data-level="11.2.3" data-path="programming.html"><a href="programming.html#スペースとインデント"><i class="fa fa-check"></i><b>11.2.3</b> スペースとインデント</a></li>
<li class="chapter" data-level="11.2.4" data-path="programming.html"><a href="programming.html#代入"><i class="fa fa-check"></i><b>11.2.4</b> 代入</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="programming.html"><a href="programming.html#programming-iteration"><i class="fa fa-check"></i><b>11.3</b> 反復</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="programming.html"><a href="programming.html#for-による反復"><i class="fa fa-check"></i><b>11.3.1</b> <code>for</code> による反復</a></li>
<li class="chapter" data-level="11.3.2" data-path="programming.html"><a href="programming.html#whileによる反復"><i class="fa fa-check"></i><b>11.3.2</b> <code>while</code>による反復</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="programming.html"><a href="programming.html#programming-condition"><i class="fa fa-check"></i><b>11.4</b> 条件分岐</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="programming.html"><a href="programming.html#ifelse-ifelse-による条件分岐"><i class="fa fa-check"></i><b>11.4.1</b> <code>if</code>、<code>else if</code>、<code>else</code> による条件分岐</a></li>
<li class="chapter" data-level="11.4.2" data-path="programming.html"><a href="programming.html#ifelseによる条件分岐"><i class="fa fa-check"></i><b>11.4.2</b> <code>ifelse()</code>による条件分岐</a></li>
<li class="chapter" data-level="11.4.3" data-path="programming.html"><a href="programming.html#switchによる条件分岐"><i class="fa fa-check"></i><b>11.4.3</b> <code>switch()</code>による条件分岐</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="programming.html"><a href="programming.html#programming-exercise"><i class="fa fa-check"></i><b>11.5</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>12</b> 関数の自作</a>
<ul>
<li class="chapter" data-level="12.1" data-path="functions.html"><a href="functions.html#func-intro"><i class="fa fa-check"></i><b>12.1</b> 関数の作成</a></li>
<li class="chapter" data-level="12.2" data-path="functions.html"><a href="functions.html#func-adv"><i class="fa fa-check"></i><b>12.2</b> ちょっと複雑な関数</a></li>
<li class="chapter" data-level="12.3" data-path="functions.html"><a href="functions.html#func-in-func"><i class="fa fa-check"></i><b>12.3</b> 関数 in 関数</a></li>
<li class="chapter" data-level="12.4" data-path="functions.html"><a href="functions.html#func-exercise"><i class="fa fa-check"></i><b>12.4</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="datahandling1.html"><a href="datahandling1.html"><i class="fa fa-check"></i><b>13</b> データハンドリング [基礎編: 抽出]</a>
<ul>
<li class="chapter" data-level="13.1" data-path="datahandling1.html"><a href="datahandling1.html#handling1-intro"><i class="fa fa-check"></i><b>13.1</b> データハンドリングとtidyverse</a></li>
<li class="chapter" data-level="13.2" data-path="datahandling1.html"><a href="datahandling1.html#handling1-pipe"><i class="fa fa-check"></i><b>13.2</b> パイプ演算子 (<code>%&gt;%</code>)</a></li>
<li class="chapter" data-level="13.3" data-path="datahandling1.html"><a href="datahandling1.html#handling1-select"><i class="fa fa-check"></i><b>13.3</b> 列の抽出</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="datahandling1.html"><a href="datahandling1.html#特定の列を抽出する"><i class="fa fa-check"></i><b>13.3.1</b> 特定の列を抽出する</a></li>
<li class="chapter" data-level="13.3.2" data-path="datahandling1.html"><a href="datahandling1.html#特定の列を抽出し列名を変更する"><i class="fa fa-check"></i><b>13.3.2</b> 特定の列を抽出し、列名を変更する</a></li>
<li class="chapter" data-level="13.3.3" data-path="datahandling1.html"><a href="datahandling1.html#特定の列を除外する"><i class="fa fa-check"></i><b>13.3.3</b> 特定の列を除外する</a></li>
<li class="chapter" data-level="13.3.4" data-path="datahandling1.html"><a href="datahandling1.html#隣接した列を指定する"><i class="fa fa-check"></i><b>13.3.4</b> 隣接した列を指定する</a></li>
<li class="chapter" data-level="13.3.5" data-path="datahandling1.html"><a href="datahandling1.html#一部の列の順番だけを変える"><i class="fa fa-check"></i><b>13.3.5</b> 一部の列の順番だけを変える</a></li>
<li class="chapter" data-level="13.3.6" data-path="datahandling1.html"><a href="datahandling1.html#selectの便利な機能"><i class="fa fa-check"></i><b>13.3.6</b> <code>select()</code>の便利な機能</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="datahandling1.html"><a href="datahandling1.html#handling1-filter"><i class="fa fa-check"></i><b>13.4</b> 行の抽出</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="datahandling1.html"><a href="datahandling1.html#指定した行を抽出する"><i class="fa fa-check"></i><b>13.4.1</b> 指定した行を抽出する</a></li>
<li class="chapter" data-level="13.4.2" data-path="datahandling1.html"><a href="datahandling1.html#条件に合致する行を抽出する"><i class="fa fa-check"></i><b>13.4.2</b> 条件に合致する行を抽出する</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="datahandling1.html"><a href="datahandling1.html#handling1-arrange"><i class="fa fa-check"></i><b>13.5</b> 行のソート</a></li>
<li class="chapter" data-level="13.6" data-path="datahandling1.html"><a href="datahandling1.html#handling1-exercise"><i class="fa fa-check"></i><b>13.6</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="datahandling2.html"><a href="datahandling2.html"><i class="fa fa-check"></i><b>14</b> データハンドリング [基礎編: 拡張]</a>
<ul>
<li class="chapter" data-level="14.1" data-path="datahandling2.html"><a href="datahandling2.html#handling2-summarise"><i class="fa fa-check"></i><b>14.1</b> 記述統計量の計算</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="datahandling2.html"><a href="datahandling2.html#summariseによる記述統計量の計算"><i class="fa fa-check"></i><b>14.1.1</b> <code>summarise()</code>による記述統計量の計算</a></li>
<li class="chapter" data-level="14.1.2" data-path="datahandling2.html"><a href="datahandling2.html#summariseに使える便利な関数"><i class="fa fa-check"></i><b>14.1.2</b> <code>summarise()</code>に使える便利な関数</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="datahandling2.html"><a href="datahandling2.html#handling2-group"><i class="fa fa-check"></i><b>14.2</b> グルーピング</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="datahandling2.html"><a href="datahandling2.html#group_byによるグループ化"><i class="fa fa-check"></i><b>14.2.1</b> <code>group_by()</code>によるグループ化</a></li>
<li class="chapter" data-level="14.2.2" data-path="datahandling2.html"><a href="datahandling2.html#複数の変数を用いたグループ化"><i class="fa fa-check"></i><b>14.2.2</b> 複数の変数を用いたグループ化</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="datahandling2.html"><a href="datahandling2.html#handling2-mutate"><i class="fa fa-check"></i><b>14.3</b> 変数の計算</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="datahandling2.html"><a href="datahandling2.html#mutate関数の使い方"><i class="fa fa-check"></i><b>14.3.1</b> <code>mutate()</code>関数の使い方</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="datahandling2.html"><a href="datahandling2.html#handling2-rowwise"><i class="fa fa-check"></i><b>14.4</b> 行単位の操作</a></li>
<li class="chapter" data-level="14.5" data-path="datahandling2.html"><a href="datahandling2.html#handling2-merge"><i class="fa fa-check"></i><b>14.5</b> データの結合</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="datahandling2.html"><a href="datahandling2.html#行の結合"><i class="fa fa-check"></i><b>14.5.1</b> 行の結合</a></li>
<li class="chapter" data-level="14.5.2" data-path="datahandling2.html"><a href="datahandling2.html#列の結合"><i class="fa fa-check"></i><b>14.5.2</b> 列の結合</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="datahandling2.html"><a href="datahandling2.html#handling2-exercise"><i class="fa fa-check"></i><b>14.6</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="factor.html"><a href="factor.html"><i class="fa fa-check"></i><b>15</b> データハンドリング [基礎編: factor型]</a>
<ul>
<li class="chapter" data-level="15.1" data-path="factor.html"><a href="factor.html#名目変数を含むグラフを作成する際の注意点"><i class="fa fa-check"></i><b>15.1</b> 名目変数を含むグラフを作成する際の注意点</a></li>
<li class="chapter" data-level="15.2" data-path="factor.html"><a href="factor.html#forcatsパッケージについて"><i class="fa fa-check"></i><b>15.2</b> <code>forcats</code>パッケージについて</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="factor.html"><a href="factor.html#fct_relevel-水準の順番を変更する"><i class="fa fa-check"></i><b>15.2.1</b> <code>fct_relevel()</code>: 水準の順番を変更する</a></li>
<li class="chapter" data-level="15.2.2" data-path="factor.html"><a href="factor.html#fct_recode-水準のラベルを変更する"><i class="fa fa-check"></i><b>15.2.2</b> <code>fct_recode()</code>: 水準のラベルを変更する</a></li>
<li class="chapter" data-level="15.2.3" data-path="factor.html"><a href="factor.html#fct_rev-水準の順番を反転させる"><i class="fa fa-check"></i><b>15.2.3</b> <code>fct_rev()</code>: 水準の順番を反転させる</a></li>
<li class="chapter" data-level="15.2.4" data-path="factor.html"><a href="factor.html#fct_infreq-頻度順に順番を変更する"><i class="fa fa-check"></i><b>15.2.4</b> <code>fct_infreq()</code>: 頻度順に順番を変更する</a></li>
<li class="chapter" data-level="15.2.5" data-path="factor.html"><a href="factor.html#fct_inorder-データ内の出現順番に順番を変更する"><i class="fa fa-check"></i><b>15.2.5</b> <code>fct_inorder()</code>: データ内の出現順番に順番を変更する</a></li>
<li class="chapter" data-level="15.2.6" data-path="factor.html"><a href="factor.html#fct_shift-水準の順番をずらす"><i class="fa fa-check"></i><b>15.2.6</b> <code>fct_shift()</code>: 水準の順番をずらす</a></li>
<li class="chapter" data-level="15.2.7" data-path="factor.html"><a href="factor.html#fct_shuffle-水準の順番をランダム化する"><i class="fa fa-check"></i><b>15.2.7</b> <code>fct_shuffle()</code>: 水準の順番をランダム化する</a></li>
<li class="chapter" data-level="15.2.8" data-path="factor.html"><a href="factor.html#fct_reorder-別の1変数の値を基準に水準の順番を変更する"><i class="fa fa-check"></i><b>15.2.8</b> <code>fct_reorder()</code>: 別の1変数の値を基準に水準の順番を変更する</a></li>
<li class="chapter" data-level="15.2.9" data-path="factor.html"><a href="factor.html#fct_reorder2-別の2変数の値を基準に水準の順番を変更する"><i class="fa fa-check"></i><b>15.2.9</b> <code>fct_reorder2()</code>: 別の2変数の値を基準に水準の順番を変更する</a></li>
<li class="chapter" data-level="15.2.10" data-path="factor.html"><a href="factor.html#fct_collapse-水準を統合する"><i class="fa fa-check"></i><b>15.2.10</b> <code>fct_collapse()</code>: 水準を統合する</a></li>
<li class="chapter" data-level="15.2.11" data-path="factor.html"><a href="factor.html#fct_drop-使われていない水準を除去する"><i class="fa fa-check"></i><b>15.2.11</b> <code>fct_drop()</code>: 使われていない水準を除去する</a></li>
<li class="chapter" data-level="15.2.12" data-path="factor.html"><a href="factor.html#fct_expand-水準を追加する"><i class="fa fa-check"></i><b>15.2.12</b> <code>fct_expand()</code>: 水準を追加する</a></li>
<li class="chapter" data-level="15.2.13" data-path="factor.html"><a href="factor.html#fct_explicit_na-欠損値に水準を与える"><i class="fa fa-check"></i><b>15.2.13</b> <code>fct_explicit_na()</code>: 欠損値に水準を与える</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="factor.html"><a href="factor.html#factor-excersie"><i class="fa fa-check"></i><b>15.3</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="tidydata.html"><a href="tidydata.html"><i class="fa fa-check"></i><b>16</b> 整然データ構造</a>
<ul>
<li class="chapter" data-level="16.1" data-path="tidydata.html"><a href="tidydata.html#tidydata-intro"><i class="fa fa-check"></i><b>16.1</b> 整然データ (tidy data)とは</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="tidydata.html"><a href="tidydata.html#つの列は1つの変数を表す"><i class="fa fa-check"></i><b>16.1.1</b> 1つの列は、1つの変数を表す</a></li>
<li class="chapter" data-level="16.1.2" data-path="tidydata.html"><a href="tidydata.html#つの行は1つの観測を表す"><i class="fa fa-check"></i><b>16.1.2</b> 1つの行は、1つの観測を表す</a></li>
<li class="chapter" data-level="16.1.3" data-path="tidydata.html"><a href="tidydata.html#つのセルは1つの値を表す"><i class="fa fa-check"></i><b>16.1.3</b> 1つのセルは、1つの値を表す</a></li>
<li class="chapter" data-level="16.1.4" data-path="tidydata.html"><a href="tidydata.html#つの表は1つの観測単位をもつ"><i class="fa fa-check"></i><b>16.1.4</b> 1つの表は、1つの観測単位をもつ</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="tidydata.html"><a href="tidydata.html#tidydata-gather"><i class="fa fa-check"></i><b>16.2</b> Wide型からLong型へ</a></li>
<li class="chapter" data-level="16.3" data-path="tidydata.html"><a href="tidydata.html#tidydata-spread"><i class="fa fa-check"></i><b>16.3</b> Long型からWide型へ</a></li>
<li class="chapter" data-level="16.4" data-path="tidydata.html"><a href="tidydata.html#tidydata-separate"><i class="fa fa-check"></i><b>16.4</b> 列の操作</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="visualization1.html"><a href="visualization1.html"><i class="fa fa-check"></i><b>17</b> 可視化[理論]</a>
<ul>
<li class="chapter" data-level="17.1" data-path="visualization1.html"><a href="visualization1.html#visual-packages"><i class="fa fa-check"></i><b>17.1</b> 可視化のためのパッケージ</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="visualization1.html"><a href="visualization1.html#base-r"><i class="fa fa-check"></i><b>17.1.1</b> Base R</a></li>
<li class="chapter" data-level="17.1.2" data-path="visualization1.html"><a href="visualization1.html#latticeパッケージ"><i class="fa fa-check"></i><b>17.1.2</b> {lattice}パッケージ</a></li>
<li class="chapter" data-level="17.1.3" data-path="visualization1.html"><a href="visualization1.html#ggplot2パッケージ"><i class="fa fa-check"></i><b>17.1.3</b> {ggplot2}パッケージ</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="visualization1.html"><a href="visualization1.html#visual-ggplot"><i class="fa fa-check"></i><b>17.2</b> グラフィックの文法</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="visualization1.html"><a href="visualization1.html#グラフィックの文法"><i class="fa fa-check"></i><b>17.2.1</b> グラフィックの文法</a></li>
<li class="chapter" data-level="17.2.2" data-path="visualization1.html"><a href="visualization1.html#ggplot2のイメージ"><i class="fa fa-check"></i><b>17.2.2</b> ggplot2のイメージ</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="visualization1.html"><a href="visualization1.html#グラフィックの構成要素"><i class="fa fa-check"></i><b>17.3</b> グラフィックの構成要素</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="visualization1.html"><a href="visualization1.html#データ"><i class="fa fa-check"></i><b>17.3.1</b> データ</a></li>
<li class="chapter" data-level="17.3.2" data-path="visualization1.html"><a href="visualization1.html#幾何オブジェクト"><i class="fa fa-check"></i><b>17.3.2</b> 幾何オブジェクト</a></li>
<li class="chapter" data-level="17.3.3" data-path="visualization1.html"><a href="visualization1.html#マッピング"><i class="fa fa-check"></i><b>17.3.3</b> マッピング</a></li>
<li class="chapter" data-level="17.3.4" data-path="visualization1.html"><a href="visualization1.html#マッピング-その他"><i class="fa fa-check"></i><b>17.3.4</b> マッピング: その他</a></li>
<li class="chapter" data-level="17.3.5" data-path="visualization1.html"><a href="visualization1.html#座標系"><i class="fa fa-check"></i><b>17.3.5</b> 座標系</a></li>
<li class="chapter" data-level="17.3.6" data-path="visualization1.html"><a href="visualization1.html#スケール"><i class="fa fa-check"></i><b>17.3.6</b> スケール</a></li>
<li class="chapter" data-level="17.3.7" data-path="visualization1.html"><a href="visualization1.html#ファセット"><i class="fa fa-check"></i><b>17.3.7</b> ファセット</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="visualization1.html"><a href="visualization1.html#visual-principal"><i class="fa fa-check"></i><b>17.4</b> 良いグラフとは</a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="visualization1.html"><a href="visualization1.html#データインク比"><i class="fa fa-check"></i><b>17.4.1</b> データ・インク比</a></li>
<li class="chapter" data-level="17.4.2" data-path="visualization1.html"><a href="visualization1.html#次元プロット"><i class="fa fa-check"></i><b>17.4.2</b> 3次元プロット</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="visualization2.html"><a href="visualization2.html"><i class="fa fa-check"></i><b>18</b> 可視化[基礎]</a>
<ul>
<li class="chapter" data-level="18.1" data-path="visualization2.html"><a href="visualization2.html#本章の内容"><i class="fa fa-check"></i><b>18.1</b> 本章の内容</a></li>
<li class="chapter" data-level="18.2" data-path="visualization2.html"><a href="visualization2.html#visual2-data"><i class="fa fa-check"></i><b>18.2</b> 実習用データ</a></li>
<li class="chapter" data-level="18.3" data-path="visualization2.html"><a href="visualization2.html#visual2-barplot"><i class="fa fa-check"></i><b>18.3</b> 棒グラフ</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="visualization2.html"><a href="visualization2.html#ケース数のグラフ"><i class="fa fa-check"></i><b>18.3.1</b> ケース数のグラフ</a></li>
<li class="chapter" data-level="18.3.2" data-path="visualization2.html"><a href="visualization2.html#記述統計量のグラフ"><i class="fa fa-check"></i><b>18.3.2</b> 記述統計量のグラフ</a></li>
<li class="chapter" data-level="18.3.3" data-path="visualization2.html"><a href="visualization2.html#次元を追加する"><i class="fa fa-check"></i><b>18.3.3</b> 次元を追加する</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="visualization2.html"><a href="visualization2.html#visual2-histogram"><i class="fa fa-check"></i><b>18.4</b> ヒストグラム</a>
<ul>
<li class="chapter" data-level="18.4.1" data-path="visualization2.html"><a href="visualization2.html#ヒストグラムの棒の大きさを調整する"><i class="fa fa-check"></i><b>18.4.1</b> ヒストグラムの棒の大きさを調整する</a></li>
<li class="chapter" data-level="18.4.2" data-path="visualization2.html"><a href="visualization2.html#密度を追加する"><i class="fa fa-check"></i><b>18.4.2</b> 密度を追加する</a></li>
<li class="chapter" data-level="18.4.3" data-path="visualization2.html"><a href="visualization2.html#次元を追加する-1"><i class="fa fa-check"></i><b>18.4.3</b> 次元を追加する</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="visualization2.html"><a href="visualization2.html#visual2-box"><i class="fa fa-check"></i><b>18.5</b> 箱ひげ図</a>
<ul>
<li class="chapter" data-level="18.5.1" data-path="visualization2.html"><a href="visualization2.html#個別のデータを表示する"><i class="fa fa-check"></i><b>18.5.1</b> 個別のデータを表示する</a></li>
<li class="chapter" data-level="18.5.2" data-path="visualization2.html"><a href="visualization2.html#次元を追加する-2"><i class="fa fa-check"></i><b>18.5.2</b> 次元を追加する</a></li>
<li class="chapter" data-level="18.5.3" data-path="visualization2.html"><a href="visualization2.html#複数の変数の場合"><i class="fa fa-check"></i><b>18.5.3</b> 複数の変数の場合</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="visualization2.html"><a href="visualization2.html#visual2-scatter"><i class="fa fa-check"></i><b>18.6</b> 散布図</a>
<ul>
<li class="chapter" data-level="18.6.1" data-path="visualization2.html"><a href="visualization2.html#次元を追加する-3"><i class="fa fa-check"></i><b>18.6.1</b> 次元を追加する</a></li>
<li class="chapter" data-level="18.6.2" data-path="visualization2.html"><a href="visualization2.html#一部の点をハイライトする"><i class="fa fa-check"></i><b>18.6.2</b> 一部の点をハイライトする</a></li>
</ul></li>
<li class="chapter" data-level="18.7" data-path="visualization2.html"><a href="visualization2.html#visual2-line"><i class="fa fa-check"></i><b>18.7</b> 折れ線グラフ</a>
<ul>
<li class="chapter" data-level="18.7.1" data-path="visualization2.html"><a href="visualization2.html#一部の線をハイライトする"><i class="fa fa-check"></i><b>18.7.1</b> 一部の線をハイライトする</a></li>
</ul></li>
<li class="chapter" data-level="18.8" data-path="visualization2.html"><a href="visualization2.html#図の保存"><i class="fa fa-check"></i><b>18.8</b> 図の保存</a>
<ul>
<li class="chapter" data-level="18.8.1" data-path="visualization2.html"><a href="visualization2.html#ggsaveを利用した図の保存"><i class="fa fa-check"></i><b>18.8.1</b> <code>ggsave()</code>を利用した図の保存</a></li>
<li class="chapter" data-level="18.8.2" data-path="visualization2.html"><a href="visualization2.html#quartzを利用した図の保存"><i class="fa fa-check"></i><b>18.8.2</b> <code>quartz()</code>を利用した図の保存</a></li>
</ul></li>
<li class="chapter" data-level="18.9" data-path="visualization2.html"><a href="visualization2.html#まとめ"><i class="fa fa-check"></i><b>18.9</b> まとめ</a></li>
<li class="chapter" data-level="18.10" data-path="visualization2.html"><a href="visualization2.html#visual2-excersie"><i class="fa fa-check"></i><b>18.10</b> 練習問題</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="visualization3.html"><a href="visualization3.html"><i class="fa fa-check"></i><b>19</b> 可視化[応用]</a>
<ul>
<li class="chapter" data-level="19.1" data-path="visualization3.html"><a href="visualization3.html#visual3-labs"><i class="fa fa-check"></i><b>19.1</b> <code>labs()</code>: ラベルの修正</a></li>
<li class="chapter" data-level="19.2" data-path="visualization3.html"><a href="visualization3.html#visual3-coordinate"><i class="fa fa-check"></i><b>19.2</b> <code>coord_*()</code>: 座標系の調整</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="visualization3.html"><a href="visualization3.html#直交座標系の操作"><i class="fa fa-check"></i><b>19.2.1</b> 直交座標系の操作</a></li>
<li class="chapter" data-level="19.2.2" data-path="visualization3.html"><a href="visualization3.html#座標系の変換"><i class="fa fa-check"></i><b>19.2.2</b> 座標系の変換</a></li>
<li class="chapter" data-level="19.2.3" data-path="visualization3.html"><a href="visualization3.html#座標系の回転"><i class="fa fa-check"></i><b>19.2.3</b> 座標系の回転</a></li>
<li class="chapter" data-level="19.2.4" data-path="visualization3.html"><a href="visualization3.html#座標系の固定"><i class="fa fa-check"></i><b>19.2.4</b> 座標系の固定</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="visualization3.html"><a href="visualization3.html#visual3-scale"><i class="fa fa-check"></i><b>19.3</b> <code>scale_*_*()</code>: スケールの調整</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="visualization3.html"><a href="visualization3.html#横軸縦軸スケールの調整"><i class="fa fa-check"></i><b>19.3.1</b> 横軸・縦軸スケールの調整</a></li>
<li class="chapter" data-level="19.3.2" data-path="visualization3.html"><a href="visualization3.html#colorスケールの調整"><i class="fa fa-check"></i><b>19.3.2</b> <code>color</code>スケールの調整</a></li>
<li class="chapter" data-level="19.3.3" data-path="visualization3.html"><a href="visualization3.html#alphaスケールの調整"><i class="fa fa-check"></i><b>19.3.3</b> <code>alpha</code>スケールの調整</a></li>
<li class="chapter" data-level="19.3.4" data-path="visualization3.html"><a href="visualization3.html#sizeスケールの調整"><i class="fa fa-check"></i><b>19.3.4</b> <code>size</code>スケールの調整</a></li>
<li class="chapter" data-level="19.3.5" data-path="visualization3.html"><a href="visualization3.html#shapelinetypeスケールの調整"><i class="fa fa-check"></i><b>19.3.5</b> <code>shape</code>、<code>linetype</code>スケールの調整</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="visualization3.html"><a href="visualization3.html#visual3-theme"><i class="fa fa-check"></i><b>19.4</b> <code>theme_*()</code>と<code>theme()</code>: テーマの指定</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="visualization3.html"><a href="visualization3.html#文字の大きさ"><i class="fa fa-check"></i><b>19.4.1</b> 文字の大きさ</a></li>
<li class="chapter" data-level="19.4.2" data-path="visualization3.html"><a href="visualization3.html#背景のグリッド"><i class="fa fa-check"></i><b>19.4.2</b> 背景のグリッド</a></li>
<li class="chapter" data-level="19.4.3" data-path="visualization3.html"><a href="visualization3.html#目盛りラベルの回転"><i class="fa fa-check"></i><b>19.4.3</b> 目盛りラベルの回転</a></li>
<li class="chapter" data-level="19.4.4" data-path="visualization3.html"><a href="visualization3.html#scale__を用いたラベル重複の回避"><i class="fa fa-check"></i><b>19.4.4</b> <code>scale_*_*()</code>を用いたラベル重複の回避</a></li>
<li class="chapter" data-level="19.4.5" data-path="visualization3.html"><a href="visualization3.html#凡例の位置"><i class="fa fa-check"></i><b>19.4.5</b> 凡例の位置</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="visualization3.html"><a href="visualization3.html#visual3-merge"><i class="fa fa-check"></i><b>19.5</b> 図の結合</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="visualization4.html"><a href="visualization4.html"><i class="fa fa-check"></i><b>20</b> 可視化[発展]</a>
<ul>
<li class="chapter" data-level="20.1" data-path="visualization4.html"><a href="visualization4.html#visual4-intro"><i class="fa fa-check"></i><b>20.1</b> 概要</a></li>
<li class="chapter" data-level="20.2" data-path="visualization4.html"><a href="visualization4.html#visual4-violin"><i class="fa fa-check"></i><b>20.2</b> バイオリンプロット</a></li>
<li class="chapter" data-level="20.3" data-path="visualization4.html"><a href="visualization4.html#visual4-rug"><i class="fa fa-check"></i><b>20.3</b> ラグプロット</a></li>
<li class="chapter" data-level="20.4" data-path="visualization4.html"><a href="visualization4.html#visual4-ridge"><i class="fa fa-check"></i><b>20.4</b> リッジプロット</a></li>
<li class="chapter" data-level="20.5" data-path="visualization4.html"><a href="visualization4.html#visual4-pointrange"><i class="fa fa-check"></i><b>20.5</b> エラーバー付き散布図</a></li>
<li class="chapter" data-level="20.6" data-path="visualization4.html"><a href="visualization4.html#visual4-lollipop"><i class="fa fa-check"></i><b>20.6</b> ロリーポップチャート</a></li>
<li class="chapter" data-level="20.7" data-path="visualization4.html"><a href="visualization4.html#visual4-smooth"><i class="fa fa-check"></i><b>20.7</b> 平滑化ライン</a></li>
<li class="chapter" data-level="20.8" data-path="visualization4.html"><a href="visualization4.html#visual4-heatmap"><i class="fa fa-check"></i><b>20.8</b> ヒートマップ</a></li>
<li class="chapter" data-level="20.9" data-path="visualization4.html"><a href="visualization4.html#visual4-contour"><i class="fa fa-check"></i><b>20.9</b> 等高線図</a></li>
<li class="chapter" data-level="20.10" data-path="visualization4.html"><a href="visualization4.html#visual4-map"><i class="fa fa-check"></i><b>20.10</b> 地図</a>
<ul>
<li class="chapter" data-level="20.10.1" data-path="visualization4.html"><a href="visualization4.html#世界地図"><i class="fa fa-check"></i><b>20.10.1</b> 世界地図</a></li>
<li class="chapter" data-level="20.10.2" data-path="visualization4.html"><a href="visualization4.html#日本地図全体"><i class="fa fa-check"></i><b>20.10.2</b> 日本地図（全体）</a></li>
<li class="chapter" data-level="20.10.3" data-path="visualization4.html"><a href="visualization4.html#日本地図特定の都道府県"><i class="fa fa-check"></i><b>20.10.3</b> 日本地図（特定の都道府県）</a></li>
</ul></li>
<li class="chapter" data-level="20.11" data-path="visualization4.html"><a href="visualization4.html#visual4-dag"><i class="fa fa-check"></i><b>20.11</b> 非巡回有向グラフ</a>
<ul>
<li class="chapter" data-level="20.11.1" data-path="visualization4.html"><a href="visualization4.html#ノードの位置を指定する"><i class="fa fa-check"></i><b>20.11.1</b> ノードの位置を指定する</a></li>
</ul></li>
<li class="chapter" data-level="20.12" data-path="visualization4.html"><a href="visualization4.html#visual4-bump"><i class="fa fa-check"></i><b>20.12</b> バンプチャート</a></li>
<li class="chapter" data-level="20.13" data-path="visualization4.html"><a href="visualization4.html#visual4-alluvial"><i class="fa fa-check"></i><b>20.13</b> 沖積図</a></li>
<li class="chapter" data-level="20.14" data-path="visualization4.html"><a href="visualization4.html#visual4-dendrogram"><i class="fa fa-check"></i><b>20.14</b> デンドログラム</a></li>
<li class="chapter" data-level="20.15" data-path="visualization4.html"><a href="visualization4.html#visual4-tree"><i class="fa fa-check"></i><b>20.15</b> ツリーマップ</a></li>
<li class="chapter" data-level="20.16" data-path="visualization4.html"><a href="visualization4.html#visual4-mosaic"><i class="fa fa-check"></i><b>20.16</b> モザイクプロット</a></li>
<li class="chapter" data-level="20.17" data-path="visualization4.html"><a href="visualization4.html#visual4-further"><i class="fa fa-check"></i><b>20.17</b> その他のグラフ</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="datahandling3.html"><a href="datahandling3.html"><i class="fa fa-check"></i><b>21</b> データハンドリング[応用編]</a></li>
<li class="chapter" data-level="22" data-path="string.html"><a href="string.html"><i class="fa fa-check"></i><b>22</b> 文字列の処理</a></li>
<li class="chapter" data-level="23" data-path="scraping.html"><a href="scraping.html"><i class="fa fa-check"></i><b>23</b> スクレイピング</a></li>
<li class="chapter" data-level="24" data-path="iteration.html"><a href="iteration.html"><i class="fa fa-check"></i><b>24</b> 反復処理</a>
<ul>
<li class="chapter" data-level="24.1" data-path="iteration.html"><a href="iteration.html#iteration-abstract"><i class="fa fa-check"></i><b>24.1</b> 概要</a></li>
<li class="chapter" data-level="24.2" data-path="iteration.html"><a href="iteration.html#iteration-intro"><i class="fa fa-check"></i><b>24.2</b> <code>*apply()</code>関数群と<code>map_*()</code>関数群</a></li>
<li class="chapter" data-level="24.3" data-path="iteration.html"><a href="iteration.html#iteration-two-arguments"><i class="fa fa-check"></i><b>24.3</b> 引数が2つ以上の場合</a></li>
<li class="chapter" data-level="24.4" data-path="iteration.html"><a href="iteration.html#iteration-df"><i class="fa fa-check"></i><b>24.4</b> データフレームと{purrr}</a>
<ul>
<li class="chapter" data-level="24.4.1" data-path="iteration.html"><a href="iteration.html#iteration-tibble"><i class="fa fa-check"></i><b>24.4.1</b> tibbleの話</a></li>
</ul></li>
<li class="chapter" data-level="24.5" data-path="iteration.html"><a href="iteration.html#iteration-model1"><i class="fa fa-check"></i><b>24.5</b> モデルの反復推定</a>
<ul>
<li class="chapter" data-level="24.5.1" data-path="iteration.html"><a href="iteration.html#iteration-split1"><i class="fa fa-check"></i><b>24.5.1</b> サンプルの分割とモデル推定（<code>split()</code>利用）</a></li>
<li class="chapter" data-level="24.5.2" data-path="iteration.html"><a href="iteration.html#iteration-split2"><i class="fa fa-check"></i><b>24.5.2</b> サンプルの分割とモデル推定（<code>nest()</code>利用）</a></li>
<li class="chapter" data-level="24.5.3" data-path="iteration.html"><a href="iteration.html#iteration-range"><i class="fa fa-check"></i><b>24.5.3</b> データの範囲を指定したモデル推定</a></li>
<li class="chapter" data-level="24.5.4" data-path="iteration.html"><a href="iteration.html#iteration-variables"><i class="fa fa-check"></i><b>24.5.4</b> 説明・応答変数を指定したモデル推定</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="25" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>25</b> R Markdown [基礎]</a>
<ul>
<li class="chapter" data-level="25.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-intro"><i class="fa fa-check"></i><b>25.1</b> R Markdownとは</a></li>
<li class="chapter" data-level="25.2" data-path="rmarkdown.html"><a href="rmarkdown.html#とりあえずknit"><i class="fa fa-check"></i><b>25.2</b> とりあえずKnit</a></li>
<li class="chapter" data-level="25.3" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-grammar"><i class="fa fa-check"></i><b>25.3</b> Markdown文法の基本</a>
<ul>
<li class="chapter" data-level="25.3.1" data-path="rmarkdown.html"><a href="rmarkdown.html#改行-1"><i class="fa fa-check"></i><b>25.3.1</b> 改行</a></li>
<li class="chapter" data-level="25.3.2" data-path="rmarkdown.html"><a href="rmarkdown.html#強調"><i class="fa fa-check"></i><b>25.3.2</b> 強調</a></li>
<li class="chapter" data-level="25.3.3" data-path="rmarkdown.html"><a href="rmarkdown.html#箇条書き"><i class="fa fa-check"></i><b>25.3.3</b> 箇条書き</a></li>
<li class="chapter" data-level="25.3.4" data-path="rmarkdown.html"><a href="rmarkdown.html#見出し"><i class="fa fa-check"></i><b>25.3.4</b> 見出し</a></li>
<li class="chapter" data-level="25.3.5" data-path="rmarkdown.html"><a href="rmarkdown.html#区切り線"><i class="fa fa-check"></i><b>25.3.5</b> 区切り線</a></li>
<li class="chapter" data-level="25.3.6" data-path="rmarkdown.html"><a href="rmarkdown.html#表"><i class="fa fa-check"></i><b>25.3.6</b> 表</a></li>
<li class="chapter" data-level="25.3.7" data-path="rmarkdown.html"><a href="rmarkdown.html#画像"><i class="fa fa-check"></i><b>25.3.7</b> 画像</a></li>
<li class="chapter" data-level="25.3.8" data-path="rmarkdown.html"><a href="rmarkdown.html#リンク"><i class="fa fa-check"></i><b>25.3.8</b> リンク</a></li>
<li class="chapter" data-level="25.3.9" data-path="rmarkdown.html"><a href="rmarkdown.html#脚注"><i class="fa fa-check"></i><b>25.3.9</b> 脚注</a></li>
<li class="chapter" data-level="25.3.10" data-path="rmarkdown.html"><a href="rmarkdown.html#数式"><i class="fa fa-check"></i><b>25.3.10</b> 数式</a></li>
<li class="chapter" data-level="25.3.11" data-path="rmarkdown.html"><a href="rmarkdown.html#引用"><i class="fa fa-check"></i><b>25.3.11</b> 引用</a></li>
<li class="chapter" data-level="25.3.12" data-path="rmarkdown.html"><a href="rmarkdown.html#コメント"><i class="fa fa-check"></i><b>25.3.12</b> コメント</a></li>
<li class="chapter" data-level="25.3.13" data-path="rmarkdown.html"><a href="rmarkdown.html#コード"><i class="fa fa-check"></i><b>25.3.13</b> コード</a></li>
</ul></li>
<li class="chapter" data-level="25.4" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-chunk"><i class="fa fa-check"></i><b>25.4</b> チャンクのオプション</a>
<ul>
<li class="chapter" data-level="25.4.1" data-path="rmarkdown.html"><a href="rmarkdown.html#チャンク名とチャンク間依存関係"><i class="fa fa-check"></i><b>25.4.1</b> チャンク名とチャンク間依存関係</a></li>
<li class="chapter" data-level="25.4.2" data-path="rmarkdown.html"><a href="rmarkdown.html#コードまたは結果の表示非常時"><i class="fa fa-check"></i><b>25.4.2</b> コードまたは結果の表示/非常時</a></li>
<li class="chapter" data-level="25.4.3" data-path="rmarkdown.html"><a href="rmarkdown.html#プロット"><i class="fa fa-check"></i><b>25.4.3</b> プロット</a></li>
<li class="chapter" data-level="25.4.4" data-path="rmarkdown.html"><a href="rmarkdown.html#コードの見栄"><i class="fa fa-check"></i><b>25.4.4</b> コードの見栄</a></li>
</ul></li>
<li class="chapter" data-level="25.5" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-header"><i class="fa fa-check"></i><b>25.5</b> ヘッダーのオプション</a>
<ul>
<li class="chapter" data-level="25.5.1" data-path="rmarkdown.html"><a href="rmarkdown.html#目次の追加"><i class="fa fa-check"></i><b>25.5.1</b> 目次の追加</a></li>
<li class="chapter" data-level="25.5.2" data-path="rmarkdown.html"><a href="rmarkdown.html#コードのハイライト"><i class="fa fa-check"></i><b>25.5.2</b> コードのハイライト</a></li>
</ul></li>
<li class="chapter" data-level="25.6" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-japanese"><i class="fa fa-check"></i><b>25.6</b> 日本語が含まれているPDFの出力</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="rmarkdown2.html"><a href="rmarkdown2.html"><i class="fa fa-check"></i><b>26</b> R Markdown [応用]</a>
<ul>
<li class="chapter" data-level="26.1" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmarkdown2-table"><i class="fa fa-check"></i><b>26.1</b> 表の作成</a></li>
<li class="chapter" data-level="26.2" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-slide"><i class="fa fa-check"></i><b>26.2</b> R Markdownを用いたスライド作成</a>
<ul>
<li class="chapter" data-level="26.2.1" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-brak"><i class="fa fa-check"></i><b>26.2.1</b> スライド区分</a></li>
<li class="chapter" data-level="26.2.2" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-chunk"><i class="fa fa-check"></i><b>26.2.2</b> コード</a></li>
<li class="chapter" data-level="26.2.3" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-highlight"><i class="fa fa-check"></i><b>26.2.3</b> ハイライト</a></li>
<li class="chapter" data-level="26.2.4" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-operation"><i class="fa fa-check"></i><b>26.2.4</b> Xaringanスライドの操作</a></li>
<li class="chapter" data-level="26.2.5" data-path="rmarkdown2.html"><a href="rmarkdown2.html#rmakrdown2-japanese"><i class="fa fa-check"></i><b>26.2.5</b> 日本語フォントの指定</a></li>
<li class="chapter" data-level="26.2.6" data-path="rmarkdown2.html"><a href="rmarkdown2.html#スライドのpdf出力"><i class="fa fa-check"></i><b>26.2.6</b> スライドのPDF出力</a></li>
<li class="chapter" data-level="26.2.7" data-path="rmarkdown2.html"><a href="rmarkdown2.html#もっと詳しく"><i class="fa fa-check"></i><b>26.2.7</b> もっと詳しく</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="27" data-path="oop.html"><a href="oop.html"><i class="fa fa-check"></i><b>27</b> オブジェクト指向型プログラミング</a>
<ul>
<li class="chapter" data-level="27.1" data-path="oop.html"><a href="oop.html#oop-intro"><i class="fa fa-check"></i><b>27.1</b> まずは例から</a></li>
<li class="chapter" data-level="27.2" data-path="oop.html"><a href="oop.html#what-is-oop"><i class="fa fa-check"></i><b>27.2</b> OOPとは</a>
<ul>
<li class="chapter" data-level="27.2.1" data-path="oop.html"><a href="oop.html#オブジェクト-1"><i class="fa fa-check"></i><b>27.2.1</b> オブジェクト</a></li>
<li class="chapter" data-level="27.2.2" data-path="oop.html"><a href="oop.html#クラス-1"><i class="fa fa-check"></i><b>27.2.2</b> クラス</a></li>
<li class="chapter" data-level="27.2.3" data-path="oop.html"><a href="oop.html#メソッドと多態性"><i class="fa fa-check"></i><b>27.2.3</b> メソッドと多態性</a></li>
<li class="chapter" data-level="27.2.4" data-path="oop.html"><a href="oop.html#継承"><i class="fa fa-check"></i><b>27.2.4</b> 継承</a></li>
</ul></li>
<li class="chapter" data-level="27.3" data-path="oop.html"><a href="oop.html#oop-in-r"><i class="fa fa-check"></i><b>27.3</b> RにおけるOOP</a>
<ul>
<li class="chapter" data-level="27.3.1" data-path="oop.html"><a href="oop.html#オブジェクトに任意のクラスを付ける"><i class="fa fa-check"></i><b>27.3.1</b> オブジェクトに任意のクラスを付ける</a></li>
<li class="chapter" data-level="27.3.2" data-path="oop.html"><a href="oop.html#メソッドの作り方"><i class="fa fa-check"></i><b>27.3.2</b> メソッドの作り方</a></li>
<li class="chapter" data-level="27.3.3" data-path="oop.html"><a href="oop.html#検証用関数を作る"><i class="fa fa-check"></i><b>27.3.3</b> 検証用関数を作る</a></li>
</ul></li>
<li class="chapter" data-level="27.4" data-path="oop.html"><a href="oop.html#oop-sample"><i class="fa fa-check"></i><b>27.4</b> 例題</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="solution.html"><a href="solution.html"><i class="fa fa-check"></i><b>28</b> 演習問題の回答</a>
<ul>
<li class="chapter" data-level="28.1" data-path="solution.html"><a href="solution.html#solution-rbasic"><i class="fa fa-check"></i><b>28.1</b> 基本的な操作</a></li>
<li class="chapter" data-level="28.2" data-path="solution.html"><a href="solution.html#solution-datastructure"><i class="fa fa-check"></i><b>28.2</b> データの構造</a>
<ul>
<li class="chapter" data-level="28.2.1" data-path="solution.html"><a href="solution.html#ベクトル-1"><i class="fa fa-check"></i><b>28.2.1</b> ベクトル</a></li>
<li class="chapter" data-level="28.2.2" data-path="solution.html"><a href="solution.html#行列-1"><i class="fa fa-check"></i><b>28.2.2</b> 行列</a></li>
<li class="chapter" data-level="28.2.3" data-path="solution.html"><a href="solution.html#データフレーム-1"><i class="fa fa-check"></i><b>28.2.3</b> データフレーム</a></li>
</ul></li>
<li class="chapter" data-level="28.3" data-path="solution.html"><a href="solution.html#rプログラミングの基礎"><i class="fa fa-check"></i><b>28.3</b> Rプログラミングの基礎</a></li>
<li class="chapter" data-level="28.4" data-path="solution.html"><a href="solution.html#関数の自作"><i class="fa fa-check"></i><b>28.4</b> 関数の自作</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="sessioninfo.html"><a href="sessioninfo.html"><i class="fa fa-check"></i><b>29</b> 本書の執筆環境</a></li>
<li class="chapter" data-level="30" data-path="reference.html"><a href="reference.html"><i class="fa fa-check"></i><b>30</b> 参考資料</a></li>
<li class="divider"></li>
<p style = "text-align:center;"><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="クリエイティブ・コモンズ・ライセンス" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a></p>
<p style = "text-align:center;"><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></p>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">私たちのR: ベストプラクティスの探究</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="datahandling1" class="section level1" number="13">
<h1><span class="header-section-number">13.</span> データハンドリング [基礎編: 抽出]</h1>
<p>ここでは比較的綺麗に整形されているデータフレームを扱う方法について考えます。ここでいう「比較的綺麗なデータ」とは、すぐに分析に使えるレベルのデータを意味します。したがって、ここではデータ内の値を変更するような作業は行いません。基本的に分析しやすくなるように列の順番を替えたり、特定の列や行のみを抽出したり、データの順番を並び替える作業に注目します。</p>
<p>本性では以下の3つの内容を中心に解説します。</p>
<ol style="list-style-type: decimal">
<li>パイプ演算子 (<code>%&gt;%</code>)に慣れる</li>
<li>特定の行と列の抽出</li>
<li>データのソート</li>
</ol>
<p>本章で学習する内容でデータを加工した場合、得られる結果物は元のデータの一部 (subset)となります。データの中身の値を変えたり、新しい列を追加したり、平均値などの記述統計量をまとめたりする方法については次の第<a href="datahandling2.html#datahandling2">14</a>章で解説します。</p>
<hr />
<div id="handling1-intro" class="section level2" number="13.1">
<h2><span class="header-section-number">13.1</span> データハンドリングとtidyverse</h2>
<blockquote>
<p>The tidyverse is an opinionated collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures. (Tidyverseホームページから)</p>
</blockquote>
<p>Tidyverseとはデータサイエンスのために考案された、強い信念と思想に基づいたRパッケージの集合です。Tidyverseに属するパッケージは思想、文法およびデータ構造を共有しています。Tidyverseの中核をなすパッケージは<code>ggplot2</code>(第<a href="visualization1.html#visualization1">17</a>、<a href="visualization2.html#visualization2">18</a>、<a href="visualization3.html#visualization3">19</a>章)、<code>dplyr</code>(第<a href="datahandling1.html#datahandling1">13</a>、<a href="datahandling2.html#datahandling2">14</a>章)、<code>tidyr</code>(第<a href="tidydata.html#tidydata">16</a>章)、<code>readr</code>(第<a href="io.html#io-read">8.2</a>章)、<code>purrr</code> (第<a href="iteration.html#iteration">24</a>章)、<code>tibble</code>(第<a href="datastructure.html#structure-dataframe">10.5</a>章)、<code>stringr</code> (第<a href="string.html#string">22</a>章)、<code>forcats</code> (第<a href="factor.html#factor">15</a>章)があり、このパッケージを支える数十のパッケージが含まれています。これらのパッケージは個別に読み込む必要はなく、<code>tidyverse</code>パッケージを読み込むだけで十分です。</p>
<div class="sourceCode" id="cb774"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb774-1"><a href="datahandling1.html#cb774-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p>Rにおけるデータハンドリング (データ操作)の標準が<code>dplyr</code>と<code>tidyr</code>中心となり、文字列の処理は<code>stringr</code>、factor型の操作は<code>forcats</code>、大量のモデルを自動的に分析し、結果を処理するためには<code>tibble</code>と<code>purrr</code>、可視化は<code>ggplot2</code>が主に使われています。これらのパッケージ間、あるいはパッケージ内におけるオブジェクトのやり取りは全てパイプ演算子を通じて行われています。また、これらのパッケージは整然データ (tidydata)を想定するか、整然データの作成するに特化しています。</p>
<p>tidyverseの思想に基づいた「tidyverse流のコーディング」は現在のRそのものと言っても過言ではありません。ただし、tidyverseじゃないと出来ないデータハンドリング、可視化などはありません。tidyverseはデータサイエンスの思想に近いものであり、「異なる思想を持っているからこのような分析はできない」といったものはありません。tidyverseという概念が提唱される前にもRは存在し、tidyverse無き世界で今と同じことをやってきました。ただし、tidyverse流で書かれたRコードは可読性が優れ、コードを書く手間も短くなります。tidyverseの考え方がRのける「標準語」として定着しつつあるのは否めない事実であり、学習する誘引としては十分すぎるでしょう。</p>
<hr />
</div>
<div id="handling1-pipe" class="section level2" number="13.2">
<h2><span class="header-section-number">13.2</span> パイプ演算子 (<code>%&gt;%</code>)</h2>
<p><code>dplyr</code>パッケージを利用する前にパイプ演算子について説明します。パイプ演算子は<code>dplyr</code>に含まれている演算子ではなく、<code>magrittr</code>という別のパッケージから提供される演算子ですが、<code>tidyverse</code>パッケージを読み込むと自動的に読み込まれます。パイプ演算子は<code>x %&gt;% y()</code>のような書き方となりますが、これは「<code>x</code>を<code>y()</code>の第一引数として渡す」ことを意味します。<code>x</code>の部分はベクトルやデータフレームのようなオブジェクトでも、関数でも構いません。なぜなら、関数から得られた結果もまたベクトルやデータフレームといったものになるからです。つまり、<code>x() %&gt;% y()</code>という使い方も可能です。そして、パイプは無限に繋ぐこともできます。「データ<code>df</code>を関数<code>x()</code>で処理をし、その結果をまた関数<code>y()</code>で処理する」ことは、パイプを使うと<code>df %&gt;% x() %&gt;% y()</code>のような書き方となります。</p>
<p>たとえば、「<code>paste(3, "+", 5, "=", 8)</code>を実行し、その結果を<code>rep()</code>関数を使って3回複製し、それを<code>print()</code>を使って出力する」コードを考えてみましょう。方法としては2つ考えられます。まずは、それぞれの処理を別途のオブジェクトに格納する方法です。そして二つ目は関数の中に関数を使う方法です。</p>
<div class="sourceCode" id="cb775"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb775-1"><a href="datahandling1.html#cb775-1"></a><span class="co"># 方法1: 一関数一オブジェクト</span></span>
<span id="cb775-2"><a href="datahandling1.html#cb775-2"></a>Result1 <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="dv">3</span>, <span class="st">&quot;+&quot;</span>, <span class="dv">5</span>, <span class="st">&quot;=&quot;</span>, <span class="dv">8</span>)</span>
<span id="cb775-3"><a href="datahandling1.html#cb775-3"></a>Result2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(Result1, <span class="dv">3</span>)</span>
<span id="cb775-4"><a href="datahandling1.html#cb775-4"></a><span class="fu">print</span>(Result2)</span></code></pre></div>
<pre><code>## [1] &quot;3 + 5 = 8&quot; &quot;3 + 5 = 8&quot; &quot;3 + 5 = 8&quot;</code></pre>
<div class="sourceCode" id="cb777"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb777-1"><a href="datahandling1.html#cb777-1"></a><span class="co"># 方法2: 関数の中に関数の中に関数</span></span>
<span id="cb777-2"><a href="datahandling1.html#cb777-2"></a><span class="fu">print</span>(<span class="fu">rep</span>(<span class="fu">paste</span>(<span class="dv">3</span>, <span class="st">&quot;+&quot;</span>, <span class="dv">5</span>, <span class="st">&quot;=&quot;</span>, <span class="dv">8</span>), <span class="dv">3</span>))</span></code></pre></div>
<pre><code>## [1] &quot;3 + 5 = 8&quot; &quot;3 + 5 = 8&quot; &quot;3 + 5 = 8&quot;</code></pre>
<p>どれも結果は同じです。コードを書く手間を考えれば、後者の方が楽かも知れませんが、可読性があまりよくありません。一方、前者は可読性は良いものの、コードも長くなり、オブジェクトを2つも作ってしまうのでメモリの無駄遣いになります。</p>
<p>コードの可読性と書く手間、両方を満足する書き方がパイプ演算子<code>%&gt;%</code>です。まずは、例から見ましょう。</p>
<div class="sourceCode" id="cb779"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb779-1"><a href="datahandling1.html#cb779-1"></a><span class="co"># %&gt;%を使う</span></span>
<span id="cb779-2"><a href="datahandling1.html#cb779-2"></a><span class="fu">paste</span>(<span class="dv">3</span>, <span class="st">&quot;+&quot;</span>, <span class="dv">5</span>, <span class="st">&quot;=&quot;</span>, <span class="dv">8</span>) <span class="sc">%&gt;%</span> <span class="fu">rep</span>(<span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## [1] &quot;3 + 5 = 8&quot; &quot;3 + 5 = 8&quot; &quot;3 + 5 = 8&quot;</code></pre>
<p>まず、結果は先ほどと同じです。それではコードの説明をしましょう。まずは、<code>paste(3, "+", 5, "=", 8)</code>を実行します。そしてその結果をそのまま<code>rep()</code>関数の第一引数として渡されます。つまり、<code>rep(paste(3, "+", 5, "=", 8), 3)</code>になるわけです。ここでは<code>rep(3)</code>と書きましたが、第一引数が渡されたため、<code>3</code>は第二引数扱いになります (パイプ演算子前のオブジェクトを第二、三引数として渡す方法は適宜説明します。)。そして、これをまた<code>print()</code>関数に渡します。結果としては<code>print(rep(paste(3, "+", 5, "=", 8), 3))</code>となります。</p>
<p>関数を重ねると読む順番は「カッコの内側から外側へ」になりますが、パイプ演算子を使うと「左 (上)から右 (下)へ」といったより自然な読み方が可能になります。また、以下のコードのように、パイプ演算子後に改行を行うことでより読みやすいコードになります。これからはパイプ演算子の後は必ず改行をします。</p>
<div class="sourceCode" id="cb781"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb781-1"><a href="datahandling1.html#cb781-1"></a><span class="co"># 改行 (+字下げ)したらもっと読みやすくなる</span></span>
<span id="cb781-2"><a href="datahandling1.html#cb781-2"></a><span class="fu">paste</span>(<span class="dv">3</span>, <span class="st">&quot;+&quot;</span>, <span class="dv">5</span>, <span class="st">&quot;=&quot;</span>, <span class="dv">8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb781-3"><a href="datahandling1.html#cb781-3"></a>    <span class="fu">rep</span>(<span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb781-4"><a href="datahandling1.html#cb781-4"></a>    <span class="fu">print</span>()</span></code></pre></div>
<p>パイプ演算子を使わない方法は図<a href="datahandling1.html#fig:pipe1">13.1</a>のようにイメージできます。一回の処理ごとに結果を保存し、それをまた次の処理時においてデータとして使うイメージです。</p>
<div class="figure" style="text-align: center"><span id="fig:pipe1"></span>
<img src="figures/Handling1/Pipeline1.png" alt="パイプ演算子を使わない場合" width="80%" />
<p class="caption">
図 13.1: パイプ演算子を使わない場合
</p>
</div>
<p>一方、図<a href="datahandling1.html#fig:pipe2">13.2</a>はパイプ演算子を使う場合のプロセスです。処理後の結果を保存せず、すぐに次のプロセスに渡すことで、メモリ (図だとボウル)や時間、コードの無駄を減らすことができます。むろん、図<a href="datahandling1.html#fig:pipe1">13.1</a>の結果1を使って色々試してみたい場合は、一旦結果1までは格納し、適宜引き出して使った方が効率的でしょう。パイプ演算子はたしかに便利で、「今どき」のRの書き方を象徴するようなものですが、一つの結果を出すまであまりにも多くのパイプ演算子を使うことはあ望ましくありません。</p>
<div class="figure" style="text-align: center"><span id="fig:pipe2"></span>
<img src="figures/Handling1/Pipeline2.png" alt="パイプ演算子を使う場合" width="100%" />
<p class="caption">
図 13.2: パイプ演算子を使う場合
</p>
</div>
<p>データハンドリングもこれど同様に、様々な作業を順に沿って行う必要があります。例えば、「(1) 列を選択して、(2) 欠損値を含む列を除去して、 (3) ある変数の値を100倍にして、(4) ある変数の値がが小さい行から大きい順へ並び替える」といった手順です。これらの作業はパイプ演算子を使えば、スムーズに行うことが可能です。</p>
</div>
<div id="handling1-select" class="section level2" number="13.3">
<h2><span class="header-section-number">13.3</span> 列の抽出</h2>
<p>それでは今回の実習用データを読み込みましょう。<a href="Data/Ramen.csv">Ramen.csv</a>には「<a href="https://www.gnavi.co.jp">ぐるなび</a>」から取得したラーメン屋6292店舗の情報が入っています。具体的には東京、神奈川、千葉、埼玉、大阪、京都、兵庫、奈良、和歌山それぞれ都府県にあるラーメン屋の中から最大1000店舗の情報を抽出したものです。東京都は、ぐるなびに登録したラーメン屋が3000店舗以上ですが、1000店舗の基準はぐるなびの「おすすめ」の順で上位1000店舗となります。また、店側またはぐるなびが登録したカテゴリを基準に抽出したため、実際はラーメン屋ではないにもかかわらずラーメン屋としてデータ内に含まれている可能性があります。</p>
<p>まず、このデータを読み込み、<code>df</code>という名付けます。</p>
<div class="sourceCode" id="cb782"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb782-1"><a href="datahandling1.html#cb782-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;Data/Ramen.csv&quot;</span>)</span></code></pre></div>
<pre><code>## 
## ── Column specification ────────────────────────────────────────────────────────
## cols(
##   ID = col_character(),
##   Name = col_character(),
##   Pref = col_character(),
##   Zipcode = col_double(),
##   Latitude = col_double(),
##   Longitude = col_double(),
##   Line = col_character(),
##   Station = col_character(),
##   Walk = col_double(),
##   Bus = col_double(),
##   Car = col_double(),
##   Budget = col_double(),
##   ScoreN = col_double(),
##   Score = col_double()
## )</code></pre>
<p>データの中身を確認してみましょう。</p>
<div class="sourceCode" id="cb784"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb784-1"><a href="datahandling1.html#cb784-1"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 6,292 x 14
##    ID     Name  Pref  Zipcode Latitude Longitude Line  Station  Walk   Bus   Car
##    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 e5396… 居酒… 東京… 1040031     35.7      140. 地下… 銀座一…     3    NA    NA
##  2 gfeb6… 本格… 東京… 1100005     35.7      140. 地下… 仲御徒…     1    NA    NA
##  3 ggt59… 食べ… 東京… 1250041     35.8      140. ＪＲ… 金町駅      2    NA    NA
##  4 g1813… 博多… 東京… 1920904     35.7      139. ＪＲ  八王子…     1    NA    NA
##  5 ggww1… まさ… 東京… 1500042     35.7      140. 地下… 渋谷駅      7    NA    NA
##  6 gdzk5… 完全… 東京… 1000013     35.7      140. 地下… 虎ノ門…     3    NA    NA
##  7 ga2g2… 鶏そ… 東京… 1760006     35.7      140. 西武… 江古田…     2    NA    NA
##  8 gg9m1… 宴会… 東京… 1010021     35.7      140. ＪＲ  秋葉原…     4    NA    NA
##  9 gdvk2… 中国… 東京… 1000006     35.7      140. ＪＲ  有楽町…     1    NA    NA
## 10 gggb2… 中国… 東京… 1140002     35.8      140. 地下… 王子駅      2    NA    NA
## # … with 6,282 more rows, and 3 more variables: Budget &lt;dbl&gt;, ScoreN &lt;dbl&gt;,
## #   Score &lt;dbl&gt;</code></pre>
<p>1行目の<code># A tibble: 2,000 x 12</code>から、ケース数 (店舗数)は2000、変数は12個あることが分かります。各変数の詳細は以下の通りです。</p>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;text-align: center;">
変数名
</th>
<th style="text-align:left;text-align: center;">
説明
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<code>ID</code>
</td>
<td style="text-align:left;">
店舗ID
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>Name</code>
</td>
<td style="text-align:left;">
店舗名
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>Pref</code>
</td>
<td style="text-align:left;">
店舗の所在地 (都府県)
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>Zipcode</code>
</td>
<td style="text-align:left;">
店舗の郵便番号
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>Latitude</code>
</td>
<td style="text-align:left;">
緯度
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>Longitude</code>
</td>
<td style="text-align:left;">
経度
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>Line</code>
</td>
<td style="text-align:left;">
最寄りの駅の路線
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>Station</code>
</td>
<td style="text-align:left;">
最寄りの駅
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>Walk</code>
</td>
<td style="text-align:left;">
最寄りの駅からの距離 (徒歩; 分)
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>Bus</code>
</td>
<td style="text-align:left;">
最寄りの駅からの距離 (バス; 分)
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>Car</code>
</td>
<td style="text-align:left;">
最寄りの駅からの距離 (車; 分)
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>Budget</code>
</td>
<td style="text-align:left;">
平均予算 (円)
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>ScoreN</code>
</td>
<td style="text-align:left;">
口コミの数
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>Score</code>
</td>
<td style="text-align:left;">
口コミ評価の平均値
</td>
</tr>
</tbody>
</table>
<p>それではここからは<code>df</code>を用いた<code>dplyr</code>の様々な機能を紹介していきます。</p>
<div id="特定の列を抽出する" class="section level3" number="13.3.1">
<h3><span class="header-section-number">13.3.1</span> 特定の列を抽出する</h3>
<p>まずは、データフレームから特定の列のみを残す、除去する方法について紹介します。たとえば、<code>df</code>から<code>ID</code>、<code>Name</code>、<code>Pref</code>、<code>Score</code>のみを残すとします。<code>dplyr</code>を使わない方法と<code>dplyr</code>の<code>select()</code>関数を使った方法を紹介します。</p>
<div class="sourceCode" id="cb786"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb786-1"><a href="datahandling1.html#cb786-1"></a><span class="co"># dplyrを使わない方法</span></span>
<span id="cb786-2"><a href="datahandling1.html#cb786-2"></a>df[, <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;Name&quot;</span>, <span class="st">&quot;Pref&quot;</span>, <span class="st">&quot;Score&quot;</span>)]</span></code></pre></div>
<pre><code>## # A tibble: 6,292 x 4
##    ID      Name                                                     Pref   Score
##    &lt;chr&gt;   &lt;chr&gt;                                                    &lt;chr&gt;  &lt;dbl&gt;
##  1 e539604 居酒屋 龍記 京橋店                                       東京都 NA   
##  2 gfeb600 本格上海料理 新錦江 上野御徒町本店                       東京都  4.5 
##  3 ggt5900 食べ飲み放題×中華ビストロ NOZOMI（のぞみ）               東京都 NA   
##  4 g181340 博多餃子軒 八王子店 タピオカ店 Bull Pulu（ブルプル）併設 東京都 NA   
##  5 ggww100 まさ屋 渋谷店                                            東京都 NA   
##  6 gdzk500 完全個室 上海レストラン 檸檬 霞ヶ関ビル内店              東京都 NA   
##  7 ga2g202 鶏そば きらり                                            東京都 NA   
##  8 gg9m100 宴会個室×餃子酒場 北京飯店 秋葉原本店                    東京都  3.33
##  9 gdvk200 中国料理 宝龍                                            東京都  2.5 
## 10 gggb200 中国料理 天安門                                          東京都 NA   
## # … with 6,282 more rows</code></pre>
<div class="sourceCode" id="cb788"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb788-1"><a href="datahandling1.html#cb788-1"></a><span class="co"># dplyr::select()を使う方法</span></span>
<span id="cb788-2"><a href="datahandling1.html#cb788-2"></a><span class="co"># select(df, ID, Name, Pref, Score)でもOK</span></span>
<span id="cb788-3"><a href="datahandling1.html#cb788-3"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb788-4"><a href="datahandling1.html#cb788-4"></a>  <span class="fu">select</span>(ID, Name, Pref, Score)</span></code></pre></div>
<pre><code>## # A tibble: 6,292 x 4
##    ID      Name                                                     Pref   Score
##    &lt;chr&gt;   &lt;chr&gt;                                                    &lt;chr&gt;  &lt;dbl&gt;
##  1 e539604 居酒屋 龍記 京橋店                                       東京都 NA   
##  2 gfeb600 本格上海料理 新錦江 上野御徒町本店                       東京都  4.5 
##  3 ggt5900 食べ飲み放題×中華ビストロ NOZOMI（のぞみ）               東京都 NA   
##  4 g181340 博多餃子軒 八王子店 タピオカ店 Bull Pulu（ブルプル）併設 東京都 NA   
##  5 ggww100 まさ屋 渋谷店                                            東京都 NA   
##  6 gdzk500 完全個室 上海レストラン 檸檬 霞ヶ関ビル内店              東京都 NA   
##  7 ga2g202 鶏そば きらり                                            東京都 NA   
##  8 gg9m100 宴会個室×餃子酒場 北京飯店 秋葉原本店                    東京都  3.33
##  9 gdvk200 中国料理 宝龍                                            東京都  2.5 
## 10 gggb200 中国料理 天安門                                          東京都 NA   
## # … with 6,282 more rows</code></pre>
<p>どれも結果は同じですが、<code>select()</code>関数を使った方がより読みやすいコードになっているでしょう。むろん、<code>select()</code>関数を使わない方がスッキリする方も知るかも知れません。実際、自分でパッケージなどを作成する際は<code>select()</code>を使わない場合が多いです。ただし、一般的な分析の流れでは<code>select()</code>の方がコードも意味も明確となり、パイプ演算子でつなぐのも容易です。</p>
<p><code>select()</code>関数の使い方は非常に簡単です。第一引数はデータフレームですが、パイプ演算子を使う場合は省略可能です。第二引数以降の引数はデータフレームの変数名です。つまり、ここには残す変数名のみを書くだけで十分です。</p>
<p>また、<code>select()</code>関数を使って列の順番を変えることもできます。たとえば、<code>ID</code>、<code>Pref</code>、<code>Name</code>、<code>Score</code>の順で列を残すなら、この順番で引数を書くだけです。</p>
<div class="sourceCode" id="cb790"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb790-1"><a href="datahandling1.html#cb790-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb790-2"><a href="datahandling1.html#cb790-2"></a>  <span class="fu">select</span>(ID, Pref, Name)</span></code></pre></div>
<pre><code>## # A tibble: 6,292 x 3
##    ID      Pref   Name                                                    
##    &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;                                                   
##  1 e539604 東京都 居酒屋 龍記 京橋店                                      
##  2 gfeb600 東京都 本格上海料理 新錦江 上野御徒町本店                      
##  3 ggt5900 東京都 食べ飲み放題×中華ビストロ NOZOMI（のぞみ）              
##  4 g181340 東京都 博多餃子軒 八王子店 タピオカ店 Bull Pulu（ブルプル）併設
##  5 ggww100 東京都 まさ屋 渋谷店                                           
##  6 gdzk500 東京都 完全個室 上海レストラン 檸檬 霞ヶ関ビル内店             
##  7 ga2g202 東京都 鶏そば きらり                                           
##  8 gg9m100 東京都 宴会個室×餃子酒場 北京飯店 秋葉原本店                   
##  9 gdvk200 東京都 中国料理 宝龍                                           
## 10 gggb200 東京都 中国料理 天安門                                         
## # … with 6,282 more rows</code></pre>
</div>
<div id="特定の列を抽出し列名を変更する" class="section level3" number="13.3.2">
<h3><span class="header-section-number">13.3.2</span> 特定の列を抽出し、列名を変更する</h3>
<p>また、特定の列を残す際、変数名を変更することも可能です。今回も<code>ID</code>、<code>Name</code>、<code>Pref</code>、<code>Score</code>のみを残しますが、<code>Pref</code>列は<code>Prefecture</code>に変えてみましょう。</p>
<div class="sourceCode" id="cb792"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb792-1"><a href="datahandling1.html#cb792-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb792-2"><a href="datahandling1.html#cb792-2"></a>  <span class="fu">select</span>(ID, Name, <span class="at">Prefecture =</span> Pref, Score)</span></code></pre></div>
<pre><code>## # A tibble: 6,292 x 4
##    ID      Name                                                 Prefecture Score
##    &lt;chr&gt;   &lt;chr&gt;                                                &lt;chr&gt;      &lt;dbl&gt;
##  1 e539604 居酒屋 龍記 京橋店                                   東京都     NA   
##  2 gfeb600 本格上海料理 新錦江 上野御徒町本店                   東京都      4.5 
##  3 ggt5900 食べ飲み放題×中華ビストロ NOZOMI（のぞみ）           東京都     NA   
##  4 g181340 博多餃子軒 八王子店 タピオカ店 Bull Pulu（ブルプル…  東京都     NA   
##  5 ggww100 まさ屋 渋谷店                                        東京都     NA   
##  6 gdzk500 完全個室 上海レストラン 檸檬 霞ヶ関ビル内店          東京都     NA   
##  7 ga2g202 鶏そば きらり                                        東京都     NA   
##  8 gg9m100 宴会個室×餃子酒場 北京飯店 秋葉原本店                東京都      3.33
##  9 gdvk200 中国料理 宝龍                                        東京都      2.5 
## 10 gggb200 中国料理 天安門                                      東京都     NA   
## # … with 6,282 more rows</code></pre>
<p>抽出する際、変数を<code>新しい変数名 = 既存の変数名</code>にするだけで、変数名が簡単に変更できました。もし、特定の列は抽出しないものの、変数名を変えるにはどうすれば良いでしょうか。ここでは<code>df</code>の<code>Pref</code>を<code>Prefecture</code>に、<code>Walk</code>を<code>Distance</code>に変更してみます。<code>dplyr</code>を使わない場合と<code>dplyr</code>の<code>rename()</code>関数を使う場合を両方紹介します。</p>
<p>まずは、<code>name()</code>関数についてですが、これはデータフレームの変数名をベクトルとして出力する関数です。</p>
<div class="sourceCode" id="cb794"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb794-1"><a href="datahandling1.html#cb794-1"></a><span class="fu">names</span>(df)</span></code></pre></div>
<pre><code>##  [1] &quot;ID&quot;        &quot;Name&quot;      &quot;Pref&quot;      &quot;Zipcode&quot;   &quot;Latitude&quot;  &quot;Longitude&quot;
##  [7] &quot;Line&quot;      &quot;Station&quot;   &quot;Walk&quot;      &quot;Bus&quot;       &quot;Car&quot;       &quot;Budget&quot;   
## [13] &quot;ScoreN&quot;    &quot;Score&quot;</code></pre>
<p>察しの良い読者は気づいたかも知れませんが、<code>names(データフレーム名)</code>の結果はベクトルであり、上書きも可能です。つまり、<code>names(df)</code>の3番目と9番目の要素を<code>"Prefecture"</code>と<code>"Distance"</code>に上書きすることができるということです。</p>
<div class="sourceCode" id="cb796"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb796-1"><a href="datahandling1.html#cb796-1"></a><span class="co"># dplyrを使わずに列名を変更する方法</span></span>
<span id="cb796-2"><a href="datahandling1.html#cb796-2"></a><span class="fu">names</span>(df)[<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">9</span>)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Prefecture&quot;</span>, <span class="st">&quot;Distance&quot;</span>)</span>
<span id="cb796-3"><a href="datahandling1.html#cb796-3"></a></span>
<span id="cb796-4"><a href="datahandling1.html#cb796-4"></a><span class="co"># dfの中身を出力</span></span>
<span id="cb796-5"><a href="datahandling1.html#cb796-5"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 6,292 x 14
##    ID     Name      Prefecture Zipcode Latitude Longitude Line  Station Distance
##    &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
##  1 e5396… 居酒屋 …  東京都     1040031     35.7      140. 地下… 銀座一…        3
##  2 gfeb6… 本格上海… 東京都     1100005     35.7      140. 地下… 仲御徒…        1
##  3 ggt59… 食べ飲み… 東京都     1250041     35.8      140. ＪＲ… 金町駅         2
##  4 g1813… 博多餃子… 東京都     1920904     35.7      139. ＪＲ  八王子…        1
##  5 ggww1… まさ屋 …  東京都     1500042     35.7      140. 地下… 渋谷駅         7
##  6 gdzk5… 完全個室… 東京都     1000013     35.7      140. 地下… 虎ノ門…        3
##  7 ga2g2… 鶏そば …  東京都     1760006     35.7      140. 西武… 江古田…        2
##  8 gg9m1… 宴会個室… 東京都     1010021     35.7      140. ＪＲ  秋葉原…        4
##  9 gdvk2… 中国料理… 東京都     1000006     35.7      140. ＪＲ  有楽町…        1
## 10 gggb2… 中国料理… 東京都     1140002     35.8      140. 地下… 王子駅         2
## # … with 6,282 more rows, and 5 more variables: Bus &lt;dbl&gt;, Car &lt;dbl&gt;,
## #   Budget &lt;dbl&gt;, ScoreN &lt;dbl&gt;, Score &lt;dbl&gt;</code></pre>
<p>簡単に変数名の変更ができました。続いて、<code>dplyr</code>の<code>rename()</code>関数を使った方法です。今回は、<code>Prefecture</code>を<code>Pref</code>に、<code>Distance</code>を<code>Walk</code>に戻して見ましょう。そして、出力するだけにとどまらず、<code>df</code>に上書きしましょう。</p>
<div class="sourceCode" id="cb798"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb798-1"><a href="datahandling1.html#cb798-1"></a><span class="co"># dfのPrefectureをPrefに、DistanceをWalkに変更し、上書きする</span></span>
<span id="cb798-2"><a href="datahandling1.html#cb798-2"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb798-3"><a href="datahandling1.html#cb798-3"></a>  <span class="fu">rename</span>(<span class="at">Pref =</span> Prefecture, <span class="at">Walk =</span> Distance)</span></code></pre></div>
<p>これで終わりです。実は<code>select()</code>関数と使い方がほぼ同じです。ただし、残す変数名を指定する必要がなく、名前を変更する変数名と新しい変数名を入れるだけです。変数が少ないデータなら<code>select()</code>でもあまり不便は感じないかも知れませんが、変数が多くなると<code>rename()</code>関数は非常に便利です。</p>
</div>
<div id="特定の列を除外する" class="section level3" number="13.3.3">
<h3><span class="header-section-number">13.3.3</span> 特定の列を除外する</h3>
<p>逆に、一部の変数をデータフレームから除去したい場合もあるでしょう。たとえば、緯度 (<code>Latitude</code>)と経度 (<code>Longitude</code>)はラーメン屋の情報としては不要かもしれません。この2つの変数を除外するためにはどうすれば良いでしょうか。まず考えられるのは、この2つの変数を除いた変数を指定・抽出する方法です。</p>
<div class="sourceCode" id="cb799"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb799-1"><a href="datahandling1.html#cb799-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb799-2"><a href="datahandling1.html#cb799-2"></a>  <span class="fu">select</span>(ID, Name, Pref, Zipcode, </span>
<span id="cb799-3"><a href="datahandling1.html#cb799-3"></a>         Line, Station, Walk, Bus, Car, Budget, ScoreN, Score)</span></code></pre></div>
<pre><code>## # A tibble: 6,292 x 12
##    ID    Name  Pref  Zipcode Line  Station  Walk   Bus   Car Budget ScoreN Score
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 e539… 居酒… 東京… 1040031 地下… 銀座一…     3    NA    NA   3000      0 NA   
##  2 gfeb… 本格… 東京… 1100005 地下… 仲御徒…     1    NA    NA   2000      2  4.5 
##  3 ggt5… 食べ… 東京… 1250041 ＪＲ… 金町駅      2    NA    NA   2980      0 NA   
##  4 g181… 博多… 東京… 1920904 ＪＲ  八王子…     1    NA    NA   2000      0 NA   
##  5 ggww… まさ… 東京… 1500042 地下… 渋谷駅      7    NA    NA    380      0 NA   
##  6 gdzk… 完全… 東京… 1000013 地下… 虎ノ門…     3    NA    NA   2980      0 NA   
##  7 ga2g… 鶏そ… 東京… 1760006 西武… 江古田…     2    NA    NA    850      0 NA   
##  8 gg9m… 宴会… 東京… 1010021 ＪＲ  秋葉原…     4    NA    NA   2000      3  3.33
##  9 gdvk… 中国… 東京… 1000006 ＪＲ  有楽町…     1    NA    NA   1000      2  2.5 
## 10 gggb… 中国… 東京… 1140002 地下… 王子駅      2    NA    NA   2000      0 NA   
## # … with 6,282 more rows</code></pre>
<p>かなり長いコードになりましたね。しかし、もっと簡単な方法があります。それは<code>-</code>を使う方法です。</p>
<div class="sourceCode" id="cb801"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb801-1"><a href="datahandling1.html#cb801-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb801-2"><a href="datahandling1.html#cb801-2"></a>  <span class="fu">select</span>(<span class="sc">-</span>Latitude, <span class="sc">-</span>Longitude) <span class="co"># select(-c(Latitude, Longitude))</span></span></code></pre></div>
<pre><code>## # A tibble: 6,292 x 12
##    ID    Name  Pref  Zipcode Line  Station  Walk   Bus   Car Budget ScoreN Score
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 e539… 居酒… 東京… 1040031 地下… 銀座一…     3    NA    NA   3000      0 NA   
##  2 gfeb… 本格… 東京… 1100005 地下… 仲御徒…     1    NA    NA   2000      2  4.5 
##  3 ggt5… 食べ… 東京… 1250041 ＪＲ… 金町駅      2    NA    NA   2980      0 NA   
##  4 g181… 博多… 東京… 1920904 ＪＲ  八王子…     1    NA    NA   2000      0 NA   
##  5 ggww… まさ… 東京… 1500042 地下… 渋谷駅      7    NA    NA    380      0 NA   
##  6 gdzk… 完全… 東京… 1000013 地下… 虎ノ門…     3    NA    NA   2980      0 NA   
##  7 ga2g… 鶏そ… 東京… 1760006 西武… 江古田…     2    NA    NA    850      0 NA   
##  8 gg9m… 宴会… 東京… 1010021 ＪＲ  秋葉原…     4    NA    NA   2000      3  3.33
##  9 gdvk… 中国… 東京… 1000006 ＪＲ  有楽町…     1    NA    NA   1000      2  2.5 
## 10 gggb… 中国… 東京… 1140002 地下… 王子駅      2    NA    NA   2000      0 NA   
## # … with 6,282 more rows</code></pre>
<p>除外したい変数名の前に<code>-</code>を付けただけです。また、<code>-Latitude</code>と<code>-Longitude</code>をそれぞれ指定せず、<code>-c(Latitude, Longitude)</code>のように<code>c()</code>でまとめるのも可能です。</p>
</div>
<div id="隣接した列を指定する" class="section level3" number="13.3.4">
<h3><span class="header-section-number">13.3.4</span> 隣接した列を指定する</h3>
<p>先ほど、<code>df</code>から緯度 (<code>Latitude</code>)と経度 (<code>Longitude</code>)を除外する例を考えてみましょう。<code>-</code>を使うと簡単ですが、場合によっては残す変数名を指定する必要もあります。</p>
<div class="sourceCode" id="cb803"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb803-1"><a href="datahandling1.html#cb803-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb803-2"><a href="datahandling1.html#cb803-2"></a>  <span class="fu">select</span>(ID, Name, Pref, Zipcode, </span>
<span id="cb803-3"><a href="datahandling1.html#cb803-3"></a>         Line, Station, Walk, Bus, Car, Budget, ScoreN, Score)</span></code></pre></div>
<p>よく考えてみれば、<code>ID</code>から<code>Zipcode</code>は隣接した列ですし、<code>Line</code>から<code>Score</code>までもそうです。これは<code>names()</code>関数で確認できます。</p>
<div class="sourceCode" id="cb804"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb804-1"><a href="datahandling1.html#cb804-1"></a><span class="fu">names</span>(df)</span></code></pre></div>
<pre><code>##  [1] &quot;ID&quot;        &quot;Name&quot;      &quot;Pref&quot;      &quot;Zipcode&quot;   &quot;Latitude&quot;  &quot;Longitude&quot;
##  [7] &quot;Line&quot;      &quot;Station&quot;   &quot;Walk&quot;      &quot;Bus&quot;       &quot;Car&quot;       &quot;Budget&quot;   
## [13] &quot;ScoreN&quot;    &quot;Score&quot;</code></pre>
<p>ここで便利な演算子が<code>:</code>です。これまで、<code>x</code>から<code>y</code>までの公差1の等差数列を作成する際に<code>x:y</code>を使って来ましたが、これに非常に似ています。データフレームの「<code>x</code>列から<code>y</code>列まで」の表記も<code>select()</code>関数内では<code>:</code>と書くことができます。したがって、上記のコードは以下のように短縮化可能です。</p>
<div class="sourceCode" id="cb806"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb806-1"><a href="datahandling1.html#cb806-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb806-2"><a href="datahandling1.html#cb806-2"></a>  <span class="fu">select</span>(ID<span class="sc">:</span>Zipcode, Line<span class="sc">:</span>Score)</span></code></pre></div>
<p>「<code>df</code>の<code>ID</code>から<code>Zipcode</code>まで、そして<code>Line</code>から<code>Score</code>までの列を選択する」という意味です。非常に便利な演算子ですので、<code>-</code>と合わせて覚えておきましょう。</p>
</div>
<div id="一部の列の順番だけを変える" class="section level3" number="13.3.5">
<h3><span class="header-section-number">13.3.5</span> 一部の列の順番だけを変える</h3>
<p>ある列の位置を替えたいとします。たとえば、<code>Score</code>と<code>ScoreN</code>をそれぞれ1列目、2列目にしたい場合、どうすれば良いでしょうか。これまで勉強したことを考えると、以下のようなコードで問題ないでしょう。</p>
<div class="sourceCode" id="cb807"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb807-1"><a href="datahandling1.html#cb807-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb807-2"><a href="datahandling1.html#cb807-2"></a>  <span class="fu">select</span>(Score, ScoreN, ID<span class="sc">:</span>Budget)</span></code></pre></div>
<pre><code>## # A tibble: 6,292 x 14
##    Score ScoreN ID    Name  Pref  Zipcode Latitude Longitude Line  Station  Walk
##    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;
##  1 NA         0 e539… 居酒… 東京… 1040031     35.7      140. 地下… 銀座一…     3
##  2  4.5       2 gfeb… 本格… 東京… 1100005     35.7      140. 地下… 仲御徒…     1
##  3 NA         0 ggt5… 食べ… 東京… 1250041     35.8      140. ＪＲ… 金町駅      2
##  4 NA         0 g181… 博多… 東京… 1920904     35.7      139. ＪＲ  八王子…     1
##  5 NA         0 ggww… まさ… 東京… 1500042     35.7      140. 地下… 渋谷駅      7
##  6 NA         0 gdzk… 完全… 東京… 1000013     35.7      140. 地下… 虎ノ門…     3
##  7 NA         0 ga2g… 鶏そ… 東京… 1760006     35.7      140. 西武… 江古田…     2
##  8  3.33      3 gg9m… 宴会… 東京… 1010021     35.7      140. ＪＲ  秋葉原…     4
##  9  2.5       2 gdvk… 中国… 東京… 1000006     35.7      140. ＪＲ  有楽町…     1
## 10 NA         0 gggb… 中国… 東京… 1140002     35.8      140. 地下… 王子駅      2
## # … with 6,282 more rows, and 3 more variables: Bus &lt;dbl&gt;, Car &lt;dbl&gt;,
## #   Budget &lt;dbl&gt;</code></pre>
<p>しかし、<code>dplyr</code>には<code>relocate()</code>というより便利な専用関数を提供しています。<code>relocate()</code>には変数名を指定するだけですが、ここで指定した変数がデータフレームの最初列の方に移動します。</p>
<div class="sourceCode" id="cb809"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb809-1"><a href="datahandling1.html#cb809-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb809-2"><a href="datahandling1.html#cb809-2"></a>  <span class="fu">relocate</span>(Score, ScoreN)</span></code></pre></div>
<pre><code>## # A tibble: 6,292 x 14
##    Score ScoreN ID    Name  Pref  Zipcode Latitude Longitude Line  Station  Walk
##    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;
##  1 NA         0 e539… 居酒… 東京… 1040031     35.7      140. 地下… 銀座一…     3
##  2  4.5       2 gfeb… 本格… 東京… 1100005     35.7      140. 地下… 仲御徒…     1
##  3 NA         0 ggt5… 食べ… 東京… 1250041     35.8      140. ＪＲ… 金町駅      2
##  4 NA         0 g181… 博多… 東京… 1920904     35.7      139. ＪＲ  八王子…     1
##  5 NA         0 ggww… まさ… 東京… 1500042     35.7      140. 地下… 渋谷駅      7
##  6 NA         0 gdzk… 完全… 東京… 1000013     35.7      140. 地下… 虎ノ門…     3
##  7 NA         0 ga2g… 鶏そ… 東京… 1760006     35.7      140. 西武… 江古田…     2
##  8  3.33      3 gg9m… 宴会… 東京… 1010021     35.7      140. ＪＲ  秋葉原…     4
##  9  2.5       2 gdvk… 中国… 東京… 1000006     35.7      140. ＪＲ  有楽町…     1
## 10 NA         0 gggb… 中国… 東京… 1140002     35.8      140. 地下… 王子駅      2
## # … with 6,282 more rows, and 3 more variables: Bus &lt;dbl&gt;, Car &lt;dbl&gt;,
## #   Budget &lt;dbl&gt;</code></pre>
<p><code>relocate()</code>を使うと<code>ID:Budget</code>が省略可能となり、より短いコードになります。もう一つの例は、最初に持ってくるのではなく、「ある変数の前」または「ある変数の後」に移動させるケースです。これも<code>relocate()</code>で可能ですが、もう一つの引数が必要です。<code>Pref</code>と<code>Zipcdoe</code>の順番を変えるなら、まずは以下のような方法が考えられます。</p>
<div class="sourceCode" id="cb811"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb811-1"><a href="datahandling1.html#cb811-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb811-2"><a href="datahandling1.html#cb811-2"></a>  <span class="fu">select</span>(ID<span class="sc">:</span>Name, Zipcode, Pref, Latitude<span class="sc">:</span>Score)</span></code></pre></div>
<pre><code>## # A tibble: 6,292 x 14
##    ID     Name  Zipcode Pref  Latitude Longitude Line  Station  Walk   Bus   Car
##    &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 e5396… 居酒… 1040031 東京…     35.7      140. 地下… 銀座一…     3    NA    NA
##  2 gfeb6… 本格… 1100005 東京…     35.7      140. 地下… 仲御徒…     1    NA    NA
##  3 ggt59… 食べ… 1250041 東京…     35.8      140. ＪＲ… 金町駅      2    NA    NA
##  4 g1813… 博多… 1920904 東京…     35.7      139. ＪＲ  八王子…     1    NA    NA
##  5 ggww1… まさ… 1500042 東京…     35.7      140. 地下… 渋谷駅      7    NA    NA
##  6 gdzk5… 完全… 1000013 東京…     35.7      140. 地下… 虎ノ門…     3    NA    NA
##  7 ga2g2… 鶏そ… 1760006 東京…     35.7      140. 西武… 江古田…     2    NA    NA
##  8 gg9m1… 宴会… 1010021 東京…     35.7      140. ＪＲ  秋葉原…     4    NA    NA
##  9 gdvk2… 中国… 1000006 東京…     35.7      140. ＪＲ  有楽町…     1    NA    NA
## 10 gggb2… 中国… 1140002 東京…     35.8      140. 地下… 王子駅      2    NA    NA
## # … with 6,282 more rows, and 3 more variables: Budget &lt;dbl&gt;, ScoreN &lt;dbl&gt;,
## #   Score &lt;dbl&gt;</code></pre>
<p>これを<code>relocate()</code>で書き換えるなら、<code>.after</code>または<code>.before</code>引数が必要になります。<code>relocate(変数名1, .after = 変数名2)</code>は「変数1を変数2の直後に移動させる」
ことを意味します。</p>
<div class="sourceCode" id="cb813"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb813-1"><a href="datahandling1.html#cb813-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb813-2"><a href="datahandling1.html#cb813-2"></a>  <span class="fu">relocate</span>(Pref, <span class="at">.after =</span> Zipcode)</span></code></pre></div>
<pre><code>## # A tibble: 6,292 x 14
##    ID     Name  Zipcode Pref  Latitude Longitude Line  Station  Walk   Bus   Car
##    &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 e5396… 居酒… 1040031 東京…     35.7      140. 地下… 銀座一…     3    NA    NA
##  2 gfeb6… 本格… 1100005 東京…     35.7      140. 地下… 仲御徒…     1    NA    NA
##  3 ggt59… 食べ… 1250041 東京…     35.8      140. ＪＲ… 金町駅      2    NA    NA
##  4 g1813… 博多… 1920904 東京…     35.7      139. ＪＲ  八王子…     1    NA    NA
##  5 ggww1… まさ… 1500042 東京…     35.7      140. 地下… 渋谷駅      7    NA    NA
##  6 gdzk5… 完全… 1000013 東京…     35.7      140. 地下… 虎ノ門…     3    NA    NA
##  7 ga2g2… 鶏そ… 1760006 東京…     35.7      140. 西武… 江古田…     2    NA    NA
##  8 gg9m1… 宴会… 1010021 東京…     35.7      140. ＪＲ  秋葉原…     4    NA    NA
##  9 gdvk2… 中国… 1000006 東京…     35.7      140. ＪＲ  有楽町…     1    NA    NA
## 10 gggb2… 中国… 1140002 東京…     35.8      140. 地下… 王子駅      2    NA    NA
## # … with 6,282 more rows, and 3 more variables: Budget &lt;dbl&gt;, ScoreN &lt;dbl&gt;,
## #   Score &lt;dbl&gt;</code></pre>
<p><code>.before</code>を使うことできます。この場合は「<code>Zipcode</code>を<code>Pref</code>の直前に移動させる」
ことを指定する必要があります。結果は省略しますが、自分でコードを走らせ、上と同じ結果が得られるかを確認してみてください。</p>
<div class="sourceCode" id="cb815"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb815-1"><a href="datahandling1.html#cb815-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb815-2"><a href="datahandling1.html#cb815-2"></a>  <span class="fu">relocate</span>(Zipcode, <span class="at">.before =</span> Pref)</span></code></pre></div>
</div>
<div id="selectの便利な機能" class="section level3" number="13.3.6">
<h3><span class="header-section-number">13.3.6</span> <code>select()</code>の便利な機能</h3>
<p><code>select()</code>関数は他にも便利な機能がいくつかあります。ここではいくつの機能を紹介しますが、より詳しい内容は<code>?dplyr::select</code>を参照してください。</p>
<p><strong><code>starts_with()</code>と<code>ends_with()</code>、<code>contains()</code>、<code>num_range()</code>: 特定の文字を含む変数を選択する</strong></p>
<p>まずは、特定の文字を含む変数名を指定する方法です。<code>starts_with("X")</code>、<code>ends_with("X")</code>、<code>contains("X")</code>は変数名が<code>"X"</code>で始まるか、<code>"X"</code>で終わるか、<code>"X"</code>を含むかを判断し、条件に合う変数名を返す関数です。実際の例を見ましょう。</p>
<div class="sourceCode" id="cb816"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb816-1"><a href="datahandling1.html#cb816-1"></a><span class="co"># ID、Nameに続いて、Scoreで始まる変数名を抽出</span></span>
<span id="cb816-2"><a href="datahandling1.html#cb816-2"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb816-3"><a href="datahandling1.html#cb816-3"></a>  <span class="fu">select</span>(ID, Name, <span class="fu">starts_with</span>(<span class="st">&quot;Score&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 6,292 x 4
##    ID      Name                                                     ScoreN Score
##    &lt;chr&gt;   &lt;chr&gt;                                                     &lt;dbl&gt; &lt;dbl&gt;
##  1 e539604 居酒屋 龍記 京橋店                                            0 NA   
##  2 gfeb600 本格上海料理 新錦江 上野御徒町本店                            2  4.5 
##  3 ggt5900 食べ飲み放題×中華ビストロ NOZOMI（のぞみ）                    0 NA   
##  4 g181340 博多餃子軒 八王子店 タピオカ店 Bull Pulu（ブルプル）併設      0 NA   
##  5 ggww100 まさ屋 渋谷店                                                 0 NA   
##  6 gdzk500 完全個室 上海レストラン 檸檬 霞ヶ関ビル内店                   0 NA   
##  7 ga2g202 鶏そば きらり                                                 0 NA   
##  8 gg9m100 宴会個室×餃子酒場 北京飯店 秋葉原本店                         3  3.33
##  9 gdvk200 中国料理 宝龍                                                 2  2.5 
## 10 gggb200 中国料理 天安門                                               0 NA   
## # … with 6,282 more rows</code></pre>
<div class="sourceCode" id="cb818"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb818-1"><a href="datahandling1.html#cb818-1"></a><span class="co"># eで終わる変数名を除去</span></span>
<span id="cb818-2"><a href="datahandling1.html#cb818-2"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb818-3"><a href="datahandling1.html#cb818-3"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">&quot;e&quot;</span>)) <span class="co"># !ends_with(&quot;e&quot;)も可能</span></span></code></pre></div>
<pre><code>## # A tibble: 6,292 x 8
##    ID      Pref   Station       Walk   Bus   Car Budget ScoreN
##    &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 e539604 東京都 銀座一丁目駅     3    NA    NA   3000      0
##  2 gfeb600 東京都 仲御徒町駅       1    NA    NA   2000      2
##  3 ggt5900 東京都 金町駅           2    NA    NA   2980      0
##  4 g181340 東京都 八王子駅         1    NA    NA   2000      0
##  5 ggww100 東京都 渋谷駅           7    NA    NA    380      0
##  6 gdzk500 東京都 虎ノ門駅         3    NA    NA   2980      0
##  7 ga2g202 東京都 江古田駅         2    NA    NA    850      0
##  8 gg9m100 東京都 秋葉原駅         4    NA    NA   2000      3
##  9 gdvk200 東京都 有楽町駅         1    NA    NA   1000      2
## 10 gggb200 東京都 王子駅           2    NA    NA   2000      0
## # … with 6,282 more rows</code></pre>
<div class="sourceCode" id="cb820"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb820-1"><a href="datahandling1.html#cb820-1"></a><span class="co"># reを含む変数名を抽出するが、ScoreNは除去する</span></span>
<span id="cb820-2"><a href="datahandling1.html#cb820-2"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb820-3"><a href="datahandling1.html#cb820-3"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;re&quot;</span>), <span class="sc">-</span>ScoreN)</span></code></pre></div>
<pre><code>## # A tibble: 6,292 x 2
##    Pref   Score
##    &lt;chr&gt;  &lt;dbl&gt;
##  1 東京都 NA   
##  2 東京都  4.5 
##  3 東京都 NA   
##  4 東京都 NA   
##  5 東京都 NA   
##  6 東京都 NA   
##  7 東京都 NA   
##  8 東京都  3.33
##  9 東京都  2.5 
## 10 東京都 NA   
## # … with 6,282 more rows</code></pre>
<p>他の使い方としては<code>X1</code>、<code>X2</code>のような「文字+数字」の変数を選択する際、<code>starts_with()</code>が活躍します。たとえば、以下のような<code>myDF1</code>があるとします。</p>
<div class="sourceCode" id="cb822"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb822-1"><a href="datahandling1.html#cb822-1"></a><span class="co"># tibble()でなく、data.frame()も使用可能です。</span></span>
<span id="cb822-2"><a href="datahandling1.html#cb822-2"></a>myDF1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb822-3"><a href="datahandling1.html#cb822-3"></a>  <span class="at">ID  =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb822-4"><a href="datahandling1.html#cb822-4"></a>  <span class="at">X1  =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">7</span>),</span>
<span id="cb822-5"><a href="datahandling1.html#cb822-5"></a>  <span class="at">Y1  =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb822-6"><a href="datahandling1.html#cb822-6"></a>  <span class="at">X1D =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">9</span>),</span>
<span id="cb822-7"><a href="datahandling1.html#cb822-7"></a>  <span class="at">X2  =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">0</span>, <span class="dv">2</span>),</span>
<span id="cb822-8"><a href="datahandling1.html#cb822-8"></a>  <span class="at">Y2  =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>),</span>
<span id="cb822-9"><a href="datahandling1.html#cb822-9"></a>  <span class="at">X2D =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb822-10"><a href="datahandling1.html#cb822-10"></a>  <span class="at">X3  =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">2</span>),</span>
<span id="cb822-11"><a href="datahandling1.html#cb822-11"></a>  <span class="at">Y3  =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb822-12"><a href="datahandling1.html#cb822-12"></a>  <span class="at">X3D =</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">8</span>)</span>
<span id="cb822-13"><a href="datahandling1.html#cb822-13"></a>)</span>
<span id="cb822-14"><a href="datahandling1.html#cb822-14"></a></span>
<span id="cb822-15"><a href="datahandling1.html#cb822-15"></a>myDF1</span></code></pre></div>
<pre><code>## # A tibble: 5 x 10
##      ID    X1    Y1   X1D    X2    Y2   X2D    X3    Y3   X3D
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     2     3     4     5     3     8     3     1     9
## 2     2     4     5     2     5     3     9     0     5     1
## 3     3     6     1     1     6     2     5     3     9     3
## 4     4     2     1     6     0     3     0     0     1     3
## 5     5     7     0     9     2     1     1     2     3     8</code></pre>
<p>この<code>myDF1</code>から<code>ID</code>、<code>Y1</code>、<code>Y2</code>、<code>Y3</code>を抽出するにはどうすれば良いでしょうか。これらの変数は隣接していないため、<code>:</code>も使えませんが、<code>starts_with()</code>を使えば簡単です。</p>
<div class="sourceCode" id="cb824"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb824-1"><a href="datahandling1.html#cb824-1"></a>myDF1 <span class="sc">%&gt;%</span></span>
<span id="cb824-2"><a href="datahandling1.html#cb824-2"></a>  <span class="fu">select</span>(ID, <span class="fu">starts_with</span>(<span class="st">&quot;Y&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##      ID    Y1    Y2    Y3
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     3     3     1
## 2     2     5     3     5
## 3     3     1     2     9
## 4     4     1     3     1
## 5     5     0     1     3</code></pre>
<p>それでは、<code>ID</code>、<code>X1</code>、<code>X2</code>、<code>X3</code>はどうでしょうか。<code>starts_with("X")</code>だと、<code>X1c</code>なども選択されてしまいますね。ここで<code>-ends_with()</code>の出番です。つまり、「まずは<code>starts_with("X")</code>で<code>X</code>で始まる変数を選択し、続いて、<code>D</code>で終わるものを除外すればいいじゃん？」です。それでは、やってみましょうか。</p>
<div class="sourceCode" id="cb826"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb826-1"><a href="datahandling1.html#cb826-1"></a>myDF1 <span class="sc">%&gt;%</span></span>
<span id="cb826-2"><a href="datahandling1.html#cb826-2"></a>  <span class="fu">select</span>(ID, <span class="fu">starts_with</span>(<span class="st">&quot;X&quot;</span>), <span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">&quot;D&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 5 x 3
##      X1    X2    X3
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     2     5     3
## 2     4     5     0
## 3     6     6     3
## 4     2     0     0
## 5     7     2     2</code></pre>
<p>あらら、<code>ID</code>も同時になくなりましたね<a href="#fn66" class="footnote-ref" id="fnref66"><sup>66</sup></a>。実はこのような時のために用意された関数があり、それが<code>num_range()</code>です。<code>num_range()</code>の第一引数は<code>starts_with()</code>関数と同じですが、第二引数も必要です。この第二引数にはnumeric型のベクトルが必要です。<code>1:3</code>でも、<code>c(1, 2, 3)</code>でも構いません。たとえば、<code>ID</code>、<code>X1</code>、<code>X2</code>、<code>X3</code>するには以下のように書きます。</p>
<div class="sourceCode" id="cb828"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb828-1"><a href="datahandling1.html#cb828-1"></a>myDF1 <span class="sc">%&gt;%</span></span>
<span id="cb828-2"><a href="datahandling1.html#cb828-2"></a>  <span class="fu">select</span>(ID, <span class="fu">num_range</span>(<span class="st">&quot;X&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>))</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##      ID    X1    X2    X3
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     2     5     3
## 2     2     4     5     0
## 3     3     6     6     3
## 4     4     2     0     0
## 5     5     7     2     2</code></pre>
<p>ぱっぱらぱー！</p>
<p><strong><code>all_of()</code>と<code>any_of()</code>: 文字型ベクトルを用いた変数の選択</strong></p>
<p><code>all_of()</code>と<code>any_of()</code>は<code>select()</code>内の変数名として文字型ベクトルを使う際に用いる関数です。これは抽出したい列名が既にcharacter型ベクトルとして用意されている場合、便利な関数です。たとえば、以下の<code>Name_Vec</code>を考えてみましょう。</p>
<div class="sourceCode" id="cb830"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb830-1"><a href="datahandling1.html#cb830-1"></a>Name_Vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;X1&quot;</span>, <span class="st">&quot;X2&quot;</span>, <span class="st">&quot;X3&quot;</span>)</span></code></pre></div>
<p>この<code>Name_Vec</code>の要素と同じ列名を持つ列と<code>ID</code>列を<code>myDF1</code>から抽出する方法は以下の2通りです。</p>
<div class="sourceCode" id="cb831"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb831-1"><a href="datahandling1.html#cb831-1"></a>myDF1[, <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>, Name_Vec)]</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##      ID    X1    X2    X3
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     2     5     3
## 2     2     4     5     0
## 3     3     6     6     3
## 4     4     2     0     0
## 5     5     7     2     2</code></pre>
<div class="sourceCode" id="cb833"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb833-1"><a href="datahandling1.html#cb833-1"></a>myDF1 <span class="sc">%&gt;%</span></span>
<span id="cb833-2"><a href="datahandling1.html#cb833-2"></a>  <span class="fu">select</span>(ID, <span class="fu">all_of</span>(Name_Vec))</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##      ID    X1    X2    X3
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     2     5     3
## 2     2     4     5     0
## 3     3     6     6     3
## 4     4     2     0     0
## 5     5     7     2     2</code></pre>
<p>今の例だと、<code>select()</code>を使わない前者の方が便利かも知れませんが、<code>select()</code>内に外の変数名も指定する場合も多いので、後者の方が汎用性は高いです。私から見れば、今の例でも後者の方が読みやすく、使いやすいと思います。</p>
<p>それでは以下のような<code>Name_Vec</code>はどうでしょう。今回は、<code>myDF1</code>に含まれていない<code>X4</code>と<code>X5</code>もあります。</p>
<div class="sourceCode" id="cb835"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb835-1"><a href="datahandling1.html#cb835-1"></a>Name_Vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;X1&quot;</span>, <span class="st">&quot;X2&quot;</span>, <span class="st">&quot;X3&quot;</span>, <span class="st">&quot;X4&quot;</span>, <span class="st">&quot;X5&quot;</span>)</span>
<span id="cb835-2"><a href="datahandling1.html#cb835-2"></a></span>
<span id="cb835-3"><a href="datahandling1.html#cb835-3"></a>myDF1 <span class="sc">%&gt;%</span></span>
<span id="cb835-4"><a href="datahandling1.html#cb835-4"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(Name_Vec))</span></code></pre></div>
<pre><code>## Error: Can&#39;t subset columns that don&#39;t exist.
##   Columns `X4` and `X5` don&#39;t exist.</code></pre>
<p>このようにエラーが出てしまします。つまり、<code>all_of()</code>の場合、引数の要素全てがデータフレームに存在する必要があります。もし、ないものは無視して、合致する列だけ取り出したいはどうすれば良いでしょうか。そこで登場するのが<code>any_of()</code>です。</p>
<div class="sourceCode" id="cb837"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb837-1"><a href="datahandling1.html#cb837-1"></a>myDF1 <span class="sc">%&gt;%</span></span>
<span id="cb837-2"><a href="datahandling1.html#cb837-2"></a>  <span class="fu">select</span>(<span class="fu">any_of</span>(Name_Vec))</span></code></pre></div>
<pre><code>## # A tibble: 5 x 3
##      X1    X2    X3
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     2     5     3
## 2     4     5     0
## 3     6     6     3
## 4     2     0     0
## 5     7     2     2</code></pre>
<p><code>any_of()</code>の方がより使いやすいと思う方も多いでしょうが、必ずしもそうとは限りません。たとえば、<code>Name_Vec</code>に誤字などが含まれる場合、<code>any_of()</code>だと誤字が含まれている変数は取り出しません。この場合はむしろちゃんとエラーを表示してくれた方が嬉しいですね。</p>
<p><strong><code>last_col()</code>: 最後の列を選択する</strong></p>
<p>普段あまり使わない機能ですが、最後の列を選択する<code>last_col()</code>という関数もあります。たとえば、<code>last_col(0)</code>にすると最後の列を選択し、<code>last_col(1)</code>なら最後から2番目の列を選択します。たとえば、<code>df</code>から<code>ID</code>と最後の列を取り出してみましょう。</p>
<div class="sourceCode" id="cb839"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb839-1"><a href="datahandling1.html#cb839-1"></a><span class="co"># IDと最後の列のみを抽出</span></span>
<span id="cb839-2"><a href="datahandling1.html#cb839-2"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb839-3"><a href="datahandling1.html#cb839-3"></a>  <span class="fu">select</span>(ID, <span class="fu">last_col</span>(<span class="dv">0</span>))</span></code></pre></div>
<pre><code>## # A tibble: 6,292 x 2
##    ID      Score
##    &lt;chr&gt;   &lt;dbl&gt;
##  1 e539604 NA   
##  2 gfeb600  4.5 
##  3 ggt5900 NA   
##  4 g181340 NA   
##  5 ggww100 NA   
##  6 gdzk500 NA   
##  7 ga2g202 NA   
##  8 gg9m100  3.33
##  9 gdvk200  2.5 
## 10 gggb200 NA   
## # … with 6,282 more rows</code></pre>
<p>最後の2行分を取り出すことも可能です。この場合は<code>last_col()</code>の引数を長さ1ベクトルでなく、長さ2以上のベクトルにします。最後の行が<code>0</code>、その手前の行が<code>1</code>ですから、中の引数は<code>1:0</code>となります。<code>0:1</code>でも可能ですが、結果が若干異なります。</p>
<div class="sourceCode" id="cb841"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb841-1"><a href="datahandling1.html#cb841-1"></a><span class="co"># IDと最後の2列分を抽出 (引数を1:0と設定)</span></span>
<span id="cb841-2"><a href="datahandling1.html#cb841-2"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb841-3"><a href="datahandling1.html#cb841-3"></a>  <span class="fu">select</span>(ID, <span class="fu">last_col</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">0</span>))</span></code></pre></div>
<pre><code>## # A tibble: 6,292 x 3
##    ID      ScoreN Score
##    &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1 e539604      0 NA   
##  2 gfeb600      2  4.5 
##  3 ggt5900      0 NA   
##  4 g181340      0 NA   
##  5 ggww100      0 NA   
##  6 gdzk500      0 NA   
##  7 ga2g202      0 NA   
##  8 gg9m100      3  3.33
##  9 gdvk200      2  2.5 
## 10 gggb200      0 NA   
## # … with 6,282 more rows</code></pre>
<div class="sourceCode" id="cb843"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb843-1"><a href="datahandling1.html#cb843-1"></a><span class="co"># IDと最後の2列分を抽出 (引数を0:1と設定)</span></span>
<span id="cb843-2"><a href="datahandling1.html#cb843-2"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb843-3"><a href="datahandling1.html#cb843-3"></a>  <span class="fu">select</span>(ID, <span class="fu">last_col</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>))</span></code></pre></div>
<pre><code>## # A tibble: 6,292 x 3
##    ID      Score ScoreN
##    &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1 e539604 NA         0
##  2 gfeb600  4.5       2
##  3 ggt5900 NA         0
##  4 g181340 NA         0
##  5 ggww100 NA         0
##  6 gdzk500 NA         0
##  7 ga2g202 NA         0
##  8 gg9m100  3.33      3
##  9 gdvk200  2.5       2
## 10 gggb200 NA         0
## # … with 6,282 more rows</code></pre>
<p><code>last_col()</code>の引数を<code>1:0</code>にするか<code>0:1</code>にするかによって抽出される順番が異なります。<code>1:0</code>は<code>c(1, 0)</code>、<code>0:1</code>は<code>c(0, 1)</code>と同じであることを考えると理由は簡単です。<code>c(1, 0)</code>の場合、<code>last_col(1), last_col(0)</code>の順番で処理をし、<code>c(0, 1)</code>は<code>last_col(0)</code>、<code>last_col(1)</code>の順番で処理を行うからです。</p>
<p>この<code>last_col()</code>の引数を空っぽにするとそれは最後の列を意味します。これを利用すれば、「ある変数の最後の列へ移動させる」こともできます。たとえば、<code>ID</code>を最後の列に移動させたい場合、<code>relocate(ID, .after = last_col())</code>のように書きます。</p>
<p><strong><code>where()</code>: データ型から変数を選択する</strong></p>
<p>最後に、「numeric型の列のみ抽出したい」、「character型の列だけほしい」場合に便利な<code>where()</code>関数を紹介します。<code>where()</code>の中に入る引数は一つだけであり、データ型を判定する関数名が入ります。たとえば、numeric型か否かを判断する関数は<code>is.numeric</code>です。<code>df</code>からnumeric型の変数のみを抽出したい場合は以下のように書きます。</p>
<div class="sourceCode" id="cb845"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb845-1"><a href="datahandling1.html#cb845-1"></a><span class="co"># numeric型の列を抽出する</span></span>
<span id="cb845-2"><a href="datahandling1.html#cb845-2"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb845-3"><a href="datahandling1.html#cb845-3"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span></code></pre></div>
<pre><code>## # A tibble: 6,292 x 9
##    Zipcode Latitude Longitude  Walk   Bus   Car Budget ScoreN Score
##      &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 1040031     35.7      140.     3    NA    NA   3000      0 NA   
##  2 1100005     35.7      140.     1    NA    NA   2000      2  4.5 
##  3 1250041     35.8      140.     2    NA    NA   2980      0 NA   
##  4 1920904     35.7      139.     1    NA    NA   2000      0 NA   
##  5 1500042     35.7      140.     7    NA    NA    380      0 NA   
##  6 1000013     35.7      140.     3    NA    NA   2980      0 NA   
##  7 1760006     35.7      140.     2    NA    NA    850      0 NA   
##  8 1010021     35.7      140.     4    NA    NA   2000      3  3.33
##  9 1000006     35.7      140.     1    NA    NA   1000      2  2.5 
## 10 1140002     35.8      140.     2    NA    NA   2000      0 NA   
## # … with 6,282 more rows</code></pre>
<p><code>!</code>を使って条件に合致する列を除外することも可能です。もし、character型の列を除外する場合は以下のように<code>!where(is.character)</code>を指定します。</p>
<div class="sourceCode" id="cb847"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb847-1"><a href="datahandling1.html#cb847-1"></a><span class="co"># character型でない列を抽出する</span></span>
<span id="cb847-2"><a href="datahandling1.html#cb847-2"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb847-3"><a href="datahandling1.html#cb847-3"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">where</span>(is.character))</span></code></pre></div>
<pre><code>## # A tibble: 6,292 x 9
##    Zipcode Latitude Longitude  Walk   Bus   Car Budget ScoreN Score
##      &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 1040031     35.7      140.     3    NA    NA   3000      0 NA   
##  2 1100005     35.7      140.     1    NA    NA   2000      2  4.5 
##  3 1250041     35.8      140.     2    NA    NA   2980      0 NA   
##  4 1920904     35.7      139.     1    NA    NA   2000      0 NA   
##  5 1500042     35.7      140.     7    NA    NA    380      0 NA   
##  6 1000013     35.7      140.     3    NA    NA   2980      0 NA   
##  7 1760006     35.7      140.     2    NA    NA    850      0 NA   
##  8 1010021     35.7      140.     4    NA    NA   2000      3  3.33
##  9 1000006     35.7      140.     1    NA    NA   1000      2  2.5 
## 10 1140002     35.8      140.     2    NA    NA   2000      0 NA   
## # … with 6,282 more rows</code></pre>
<p><code>&amp;</code>を使って複数の条件を使うことも可能です。たとえば、<code>ID</code>変数に加えて「<code>"L"</code>で始まる変数の中でnumeric型の列を抽出」するコードは以下のようになります。</p>
<div class="sourceCode" id="cb849"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb849-1"><a href="datahandling1.html#cb849-1"></a><span class="co"># IDと、Lで始まるnumeric型の列を抽出する</span></span>
<span id="cb849-2"><a href="datahandling1.html#cb849-2"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb849-3"><a href="datahandling1.html#cb849-3"></a>  <span class="fu">select</span>(ID, <span class="fu">starts_with</span>(<span class="st">&quot;L&quot;</span>) <span class="sc">&amp;</span> <span class="fu">where</span>(is.numeric))</span></code></pre></div>
<pre><code>## # A tibble: 6,292 x 3
##    ID      Latitude Longitude
##    &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;
##  1 e539604     35.7      140.
##  2 gfeb600     35.7      140.
##  3 ggt5900     35.8      140.
##  4 g181340     35.7      139.
##  5 ggww100     35.7      140.
##  6 gdzk500     35.7      140.
##  7 ga2g202     35.7      140.
##  8 gg9m100     35.7      140.
##  9 gdvk200     35.7      140.
## 10 gggb200     35.8      140.
## # … with 6,282 more rows</code></pre>
<hr />
</div>
</div>
<div id="handling1-filter" class="section level2" number="13.4">
<h2><span class="header-section-number">13.4</span> 行の抽出</h2>
<div id="指定した行を抽出する" class="section level3" number="13.4.1">
<h3><span class="header-section-number">13.4.1</span> 指定した行を抽出する</h3>
<p>他にも特定の行を抽出する場合があります。たとえば、「<code>df</code>の最初の5行」や「<code>df</code>の8行目のケース」といった場合です。この操作には<code>dplyr</code>の<code>slice_*()</code>関数群が便利です。それではそれぞれの関数の使い方について紹介していきます。その前に、実習用データとして<code>df</code>から一部の列のみを抽出した<code>selelct.df</code>を作成します。</p>
<div class="sourceCode" id="cb851"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb851-1"><a href="datahandling1.html#cb851-1"></a>select.df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb851-2"><a href="datahandling1.html#cb851-2"></a>  <span class="fu">select</span>(ID, Name, Pref, Budget, Score)</span></code></pre></div>
<p><strong><code>slice()</code>: 指定した番号の行のみ抽出する</strong></p>
<p><code>select.df</code>から2, 8, 9行目の行を抽出したいとします。このような簡単な操作はパッケージを使わず、以下のように抽出することができます。</p>
<div class="sourceCode" id="cb852"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb852-1"><a href="datahandling1.html#cb852-1"></a><span class="co"># select.dfから2, 8, 9行目の行を抽出し、出力する</span></span>
<span id="cb852-2"><a href="datahandling1.html#cb852-2"></a>select.df[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">8</span>, <span class="dv">9</span>),]</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   ID      Name                                  Pref   Budget Score
##   &lt;chr&gt;   &lt;chr&gt;                                 &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1 gfeb600 本格上海料理 新錦江 上野御徒町本店    東京都   2000  4.5 
## 2 gg9m100 宴会個室×餃子酒場 北京飯店 秋葉原本店 東京都   2000  3.33
## 3 gdvk200 中国料理 宝龍                         東京都   1000  2.5</code></pre>
<p>しかし、以下の<code>slice()</code>関数を使うとパイプ演算子を前後に付けることが可能であり<a href="#fn67" class="footnote-ref" id="fnref67"><sup>67</sup></a>、コードの可読性も高いです。<code>slice()</code>関数には以下のように抽出したい行の番号を入れるだけです。</p>
<div class="sourceCode" id="cb854"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb854-1"><a href="datahandling1.html#cb854-1"></a><span class="co"># select.dfから2, 8, 9行目の行を抽出し、出力する</span></span>
<span id="cb854-2"><a href="datahandling1.html#cb854-2"></a>select.df <span class="sc">%&gt;%</span> </span>
<span id="cb854-3"><a href="datahandling1.html#cb854-3"></a>  <span class="fu">slice</span>(<span class="dv">2</span>, <span class="dv">8</span>, <span class="dv">9</span>) <span class="co"># slice(c(2, 8, 9))もOK</span></span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   ID      Name                                  Pref   Budget Score
##   &lt;chr&gt;   &lt;chr&gt;                                 &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1 gfeb600 本格上海料理 新錦江 上野御徒町本店    東京都   2000  4.5 
## 2 gg9m100 宴会個室×餃子酒場 北京飯店 秋葉原本店 東京都   2000  3.33
## 3 gdvk200 中国料理 宝龍                         東京都   1000  2.5</code></pre>
<p><code>slice(2, 8, 9)</code>でも<code>slice(c(2, 8, 9))</code>でも構いません。また、隣接した行でしたら<code>:</code>を使うことも可能です。たとえば、10行目から15行目まで抽出する場合は<code>slice(10:15)</code>のような書き方も出来ます。</p>
<p><strong><code>slice_head()</code>: 最初のn行を抽出する</strong></p>
<div class="sourceCode" id="cb856"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb856-1"><a href="datahandling1.html#cb856-1"></a><span class="co"># select.dfから最初の3行抽出し、出力する</span></span>
<span id="cb856-2"><a href="datahandling1.html#cb856-2"></a>select.df <span class="sc">%&gt;%</span> </span>
<span id="cb856-3"><a href="datahandling1.html#cb856-3"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   ID      Name                                       Pref   Budget Score
##   &lt;chr&gt;   &lt;chr&gt;                                      &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1 e539604 居酒屋 龍記 京橋店                         東京都   3000  NA  
## 2 gfeb600 本格上海料理 新錦江 上野御徒町本店         東京都   2000   4.5
## 3 ggt5900 食べ飲み放題×中華ビストロ NOZOMI（のぞみ） 東京都   2980  NA</code></pre>
<p>これは<code>head(データ名, n = 出力する個数)</code>と同じ動きをする関数です。注意点としては引数<code>n =</code>を必ず付ける点です。たとえば、<code>slice_head(3)</code>にすると、<code>select.df</code>の3行目のみ抽出されます。</p>
<p><strong><code>slice_tail()</code>: 最後のn行を抽出する</strong></p>
<div class="sourceCode" id="cb858"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb858-1"><a href="datahandling1.html#cb858-1"></a><span class="co"># select.dfから最後の7行を抽出し、出力する</span></span>
<span id="cb858-2"><a href="datahandling1.html#cb858-2"></a>select.df <span class="sc">%&gt;%</span> </span>
<span id="cb858-3"><a href="datahandling1.html#cb858-3"></a>  <span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">7</span>)</span></code></pre></div>
<pre><code>## # A tibble: 7 x 5
##   ID      Name                    Pref     Budget Score
##   &lt;chr&gt;   &lt;chr&gt;                   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;
## 1 5508852 場鶴                    和歌山県     NA    NA
## 2 7113351 来来亭 橋本店           和歌山県     NA    NA
## 3 6364939 ばり馬 和歌山紀三井寺店 和歌山県     NA    NA
## 4 7103349 ramen BIRDMAN           和歌山県     NA    NA
## 5 7315303 薩摩ラーメン 斗天王     和歌山県     NA    NA
## 6 7703472 まるしげ                和歌山県     NA    NA
## 7 6395035 暴豚製麺所              和歌山県     NA    NA</code></pre>
<p>これは<code>tail(データ名, n = 出力する個数)</code>と同じ動きをする関数です。ちなみに、この<code>n</code>引数も<code>n =</code>を明記する必要があります。</p>
<p><strong><code>slice_max()</code>: 指定した変数が大きい順でn行抽出する</strong></p>
<p><code>slice_max()</code>は指定した変数が大きい順で<code>n</code>行抽出する関数です。たとえば、<code>Budget</code>が高い順で4店舗を抽出する場合は以下のように書きます。</p>
<div class="sourceCode" id="cb860"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb860-1"><a href="datahandling1.html#cb860-1"></a><span class="co"># select.dfからScoreの値が高い順で5行を抽出し、出力する</span></span>
<span id="cb860-2"><a href="datahandling1.html#cb860-2"></a>select.df <span class="sc">%&gt;%</span> </span>
<span id="cb860-3"><a href="datahandling1.html#cb860-3"></a>  <span class="fu">slice_max</span>(Budget, <span class="at">n =</span> <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 5
##   ID      Name                                              Pref    Budget Score
##   &lt;chr&gt;   &lt;chr&gt;                                             &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;
## 1 g670609 横浜ベイシェラトン ホテル＆タワーズ 中国料理 彩龍 神奈川…   8000    NA
## 2 g910420 JASMINE 憶江南                                    東京都    7000    NA
## 3 7176666 赤坂焼鳥 鳳                                       東京都    7000    NA
## 4 b612800 羽衣 銀座本店                                     東京都    6000    NA</code></pre>
<p><strong><code>slice_min()</code>: 指定した変数が小さい順でn行抽出する</strong></p>
<p>一方、<code>slice_min()</code>関数が小さい順で抽出します。</p>
<div class="sourceCode" id="cb862"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb862-1"><a href="datahandling1.html#cb862-1"></a><span class="co"># select.dfからScoreの値が低い順で3行を抽出し、出力する</span></span>
<span id="cb862-2"><a href="datahandling1.html#cb862-2"></a>select.df <span class="sc">%&gt;%</span> </span>
<span id="cb862-3"><a href="datahandling1.html#cb862-3"></a>  <span class="fu">slice_min</span>(Score, <span class="at">n =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 5
##   ID      Name                        Pref   Budget Score
##   &lt;chr&gt;   &lt;chr&gt;                       &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1 6384909 葛西大勝軒                  東京都     NA     1
## 2 6929243 由丸 アトレヴィ大塚店       東京都     NA     1
## 3 5816075 ラーメン戯拉戯拉            千葉県     NA     1
## 4 5495086 らあめん花月嵐 坂戸わかば店 埼玉県     NA     1</code></pre>
<p>ただし、<code>n = 3</code>と指定したはずなのに、4行が抽出されました。これは同点のケースがあるからです。実際、<code>select.df</code>には<code>Score</code>が1のケースが4つあります。もし、同点の存在により<code>n</code>に収まらない場合、<code>slice_max()</code>、<code>slice_min()</code>関数は<code>n</code>を超える行を出力します。これを強制的に<code>n</code>行に合わせるためには<code>with_ties = FALSE</code>引数を付けます。この場合、データで格納されている順で<code>n</code>個のみ出力されます。</p>
<div class="sourceCode" id="cb864"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb864-1"><a href="datahandling1.html#cb864-1"></a>select.df <span class="sc">%&gt;%</span> </span>
<span id="cb864-2"><a href="datahandling1.html#cb864-2"></a>  <span class="fu">slice_min</span>(Score, <span class="at">n =</span> <span class="dv">3</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   ID      Name                  Pref   Budget Score
##   &lt;chr&gt;   &lt;chr&gt;                 &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1 6384909 葛西大勝軒            東京都     NA     1
## 2 6929243 由丸 アトレヴィ大塚店 東京都     NA     1
## 3 5816075 ラーメン戯拉戯拉      千葉県     NA     1</code></pre>
<p><strong><code>slice_sample()</code>: 無作為にn行を抽出する</strong></p>
<p>最後に無作為に<code>n</code>行を抽出する<code>slice_sample()</code>関数です。引数は<code>n</code>であり、抽出したい行数を指定します。たとえば、<code>select.df</code>から無作為に10行抽出したい場合は、</p>
<div class="sourceCode" id="cb866"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb866-1"><a href="datahandling1.html#cb866-1"></a><span class="co"># select.dfから無作為に5行を抽出し、出力する</span></span>
<span id="cb866-2"><a href="datahandling1.html#cb866-2"></a>select.df <span class="sc">%&gt;%</span> </span>
<span id="cb866-3"><a href="datahandling1.html#cb866-3"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 5
##    ID      Name                                      Pref   Budget Score
##    &lt;chr&gt;   &lt;chr&gt;                                     &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1 5495695 一番軒                                    千葉県     NA    NA
##  2 gfbz503 札幌や 溜池山王店                         東京都    700     3
##  3 7071567 めん処 紅葉                               東京都    800    NA
##  4 7697491 中野屋らーめん ザ ジロウ 阪急茨木市駅前店 大阪府     NA    NA
##  5 5508285 来来亭 明石大久保店                       兵庫県     NA    NA
##  6 7433064 陽はまたのぼる                            東京都     NA    NA
##  7 geur301 博多一瑞亭 三田店                         東京都    900    NA
##  8 5683498 麺屋英                                    埼玉県     NA    NA
##  9 5496219 大ちゃんらーめん                          千葉県     NA    NA
## 10 6426984 田原本 塩元帥                             奈良県     NA    NA</code></pre>
<p>のように書きます。ブートストラップ法や機械学習における交差検証 (cross-validation)の際に有用な関数ですが、ブートストラップや機械学習のパッケージの多くはサンプル分割の関数を提供しているため、あまり使う機会はないでしょう。また、<code>slice_sample()</code>関数をブートストラップ法のために用いる場合は、ケースを反復抽出する必要があり、<code>replace = TRUE</code>を付けると反復抽出を行います。デフォルト値は<code>FALSE</code>です。</p>
</div>
<div id="条件に合致する行を抽出する" class="section level3" number="13.4.2">
<h3><span class="header-section-number">13.4.2</span> 条件に合致する行を抽出する</h3>
<p>これまで見てきた<code>slice()</code>を用いる行の抽出は、実際あまり使う機会がありません。多くの場合、「何かの条件と合致するケースのみ抽出する」または、「何かの条件と合致しないケースのみを抽出する」やこれらの組み合わせで行の抽出を行います。そこで登場するのが<code>dplyr()</code>パッケージの<code>filter()</code>関数です。<code>filter()</code>関数の使い方は以下の通りです。</p>
<div class="sourceCode" id="cb868"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb868-1"><a href="datahandling1.html#cb868-1"></a><span class="co"># dplyr::filter()の使い方</span></span>
<span id="cb868-2"><a href="datahandling1.html#cb868-2"></a><span class="fu">filter</span>(データフレーム名, 条件1, 条件2, ...)</span></code></pre></div>
<p>むろん、第一引数がデータですから、<code>%&gt;%</code>を使うことも可能です。</p>
<div class="sourceCode" id="cb869"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb869-1"><a href="datahandling1.html#cb869-1"></a><span class="co"># dplyr::filter()の使い方 (パイプを使う方法)</span></span>
<span id="cb869-2"><a href="datahandling1.html#cb869-2"></a>データフレーム名 <span class="sc">%&gt;%</span></span>
<span id="cb869-3"><a href="datahandling1.html#cb869-3"></a>  <span class="fu">filter</span>(条件1, 条件2, ...)</span></code></pre></div>
<p>まずは、条件が一つの場合を考えてみましょう。ここでは「<code>Pref</code>が<code>"京都府"</code>であるケースのみに絞り、<code>Name</code>と<code>Station</code>、<code>Score</code>列のみを出力する」ケースを考えてみましょう。まず、<code>filter()</code>関数で行を抽出し、続いて<code>select()</code>関数で抽出する列を指定します。むろん、今回の場合、<code>filter()</code>と<code>select()</code>の順番は替えても構いません。</p>
<div class="sourceCode" id="cb870"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb870-1"><a href="datahandling1.html#cb870-1"></a><span class="co"># dfからPrefが&quot;京都府&quot;であるケースのみ残し、df2という名で保存</span></span>
<span id="cb870-2"><a href="datahandling1.html#cb870-2"></a>df2 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb870-3"><a href="datahandling1.html#cb870-3"></a>  <span class="fu">filter</span>(Pref <span class="sc">==</span> <span class="st">&quot;京都府&quot;</span>)</span>
<span id="cb870-4"><a href="datahandling1.html#cb870-4"></a></span>
<span id="cb870-5"><a href="datahandling1.html#cb870-5"></a><span class="co"># df2からName, Station, Score列を抽出</span></span>
<span id="cb870-6"><a href="datahandling1.html#cb870-6"></a>df2 <span class="sc">%&gt;%</span></span>
<span id="cb870-7"><a href="datahandling1.html#cb870-7"></a>  <span class="fu">select</span>(Name, Station, Score)</span></code></pre></div>
<pre><code>## # A tibble: 414 x 3
##    Name                                                    Station    Score
##    &lt;chr&gt;                                                   &lt;chr&gt;      &lt;dbl&gt;
##  1 中国料理 鳳麟                                           くいな橋駅 NA   
##  2 黒毛和牛一頭買い焼肉と 炊き立て土鍋ご飯 市場小路 烏丸店 四条駅      3.19
##  3 京の中華 ハマムラ みやこみち店                          京都駅     NA   
##  4 焼肉処 真 桂店                                          桂駅       NA   
##  5 祇園京都ラーメン                                        祇園四条駅 NA   
##  6 創作料理 串カツ トンカツ jiro                           新田辺駅   NA   
##  7 祇園 晩餐のあと                                         祇園四条駅 NA   
##  8 DETAIL                                                  東山駅     NA   
##  9 めんや龍神                                              北大路駅   NA   
## 10 無尽蔵 京都八条家                                       京都駅      3.5 
## # … with 404 more rows</code></pre>
<p>これは<code>df</code>から<code>Pref == "京都府"</code>のケースのみ残したものを<code>df2</code>として格納し、それをまた<code>select()</code>関数を使って列を抽出するコードです。これでも問題ありませんが、これだとパイプ演算子の便利さが分かりません。パイプ演算子は複数使うことが可能です。</p>
<div class="sourceCode" id="cb872"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb872-1"><a href="datahandling1.html#cb872-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb872-2"><a href="datahandling1.html#cb872-2"></a>  <span class="fu">filter</span>(Pref <span class="sc">==</span> <span class="st">&quot;京都府&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb872-3"><a href="datahandling1.html#cb872-3"></a>  <span class="fu">select</span>(Name, Station, Score)</span></code></pre></div>
<pre><code>## # A tibble: 414 x 3
##    Name                                                    Station    Score
##    &lt;chr&gt;                                                   &lt;chr&gt;      &lt;dbl&gt;
##  1 中国料理 鳳麟                                           くいな橋駅 NA   
##  2 黒毛和牛一頭買い焼肉と 炊き立て土鍋ご飯 市場小路 烏丸店 四条駅      3.19
##  3 京の中華 ハマムラ みやこみち店                          京都駅     NA   
##  4 焼肉処 真 桂店                                          桂駅       NA   
##  5 祇園京都ラーメン                                        祇園四条駅 NA   
##  6 創作料理 串カツ トンカツ jiro                           新田辺駅   NA   
##  7 祇園 晩餐のあと                                         祇園四条駅 NA   
##  8 DETAIL                                                  東山駅     NA   
##  9 めんや龍神                                              北大路駅   NA   
## 10 無尽蔵 京都八条家                                       京都駅      3.5 
## # … with 404 more rows</code></pre>
<p>全く同じ結果ですが、無駄に<code>df2</code>というデータフレームを作らず済むので、メモリの観点からも嬉しいですし、何よりコードが短く、しかも可読性も上がりました。</p>
<p>今回は<code>==</code>を使って<strong>合致する</strong>ものに絞りましたが、<code>!=</code>を使って<strong>合致しない</strong>ものに絞ることも可能です。または、比較演算子 (<code>&lt;</code>、<code>&gt;</code>、<code>&gt;=</code>、<code>&lt;=</code>など)を使うことも可能です。それでは、組み込み数 (<code>ScoreN</code>)が<em>0ではない</em>ケースを取り出し、<code>Name</code>、<code>Station</code>、<code>ScoreN</code>、<code>Score</code>列を出力させてみましょう。</p>
<div class="sourceCode" id="cb874"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb874-1"><a href="datahandling1.html#cb874-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb874-2"><a href="datahandling1.html#cb874-2"></a>  <span class="fu">filter</span>(ScoreN <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb874-3"><a href="datahandling1.html#cb874-3"></a>  <span class="fu">select</span>(Name, Station, <span class="fu">starts_with</span>(<span class="st">&quot;Score&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1,344 x 4
##    Name                                             Station         ScoreN Score
##    &lt;chr&gt;                                            &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt;
##  1 本格上海料理 新錦江 上野御徒町本店               仲御徒町駅           2  4.5 
##  2 宴会個室×餃子酒場 北京飯店 秋葉原本店            秋葉原駅             3  3.33
##  3 中国料理 宝龍                                    有楽町駅             2  2.5 
##  4 麺達 うま家                                      高田馬場駅           2  3   
##  5 刀削麺・火鍋・西安料理 XI’AN（シーアン） 後楽園… 後楽園駅             1 NA   
##  6 七志らーめん 渋谷道玄坂店                        渋谷駅               7  4.5 
##  7 永楽                                             京成小岩駅           6  4.42
##  8 よってこや お台場店                              お台場海浜公園…      1  4   
##  9 ラーメン武藤製麺所                               竹ノ塚駅             4  3.5 
## 10 桂花ラーメン 新宿末広店                          新宿三丁目駅         8  3   
## # … with 1,334 more rows</code></pre>
<p>これで口コミ数が1以上の店舗のみに絞ることができました。ただし、店によっては口コミはあっても、評価 (<code>Score</code>)が付いていないところもあります。たとえば、「刀削麺・火鍋・西安料理 XI’AN（シーアン） 後楽園店」の場合、口コミはありますが、評価はありません。したがって、今回は評価が付いている店舗に絞ってみましょう。</p>
<div class="sourceCode" id="cb876"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb876-1"><a href="datahandling1.html#cb876-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb876-2"><a href="datahandling1.html#cb876-2"></a>  <span class="fu">filter</span>(Score <span class="sc">!=</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span></span>
<span id="cb876-3"><a href="datahandling1.html#cb876-3"></a>  <span class="fu">select</span>(Name, Station, <span class="fu">starts_with</span>(<span class="st">&quot;Score&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 0 x 4
## # … with 4 variables: Name &lt;chr&gt;, Station &lt;chr&gt;, ScoreN &lt;dbl&gt;, Score &lt;dbl&gt;</code></pre>
<p>あらら、何の結果も表示されませんでした。これは<code>filter()</code>内の条件に合致するケースが存在しないことを意味します。しかし、先ほどの結果を見ても、評価が付いている店はいっぱいありましたね。これはなぜでしょう。</p>
<p>察しの良い読者さんは気づいているかと思いますが、第<a href="datatype.html#type-na">9.8</a>章で説明した通り、<code>NA</code>か否かを判定する際は<code>==</code>や<code>!=</code>は使えません。<code>is.na()</code>を使います。<code>filter(is.na(Score))</code>なら「<code>Score</code>が<code>NA</code><strong>である</strong>ケースに絞る」ことを意味しますが、今回は「<code>Score</code>が<code>NA</code><strong>でない</strong>ケースに絞る」ことが目的ですので、<code>is.na()</code>の前に<code>!</code>を付けます。</p>
<div class="sourceCode" id="cb878"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb878-1"><a href="datahandling1.html#cb878-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb878-2"><a href="datahandling1.html#cb878-2"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Score)) <span class="sc">%&gt;%</span></span>
<span id="cb878-3"><a href="datahandling1.html#cb878-3"></a>  <span class="fu">select</span>(Name, Station, <span class="fu">starts_with</span>(<span class="st">&quot;Score&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1,134 x 4
##    Name                                  Station          ScoreN Score
##    &lt;chr&gt;                                 &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt;
##  1 本格上海料理 新錦江 上野御徒町本店    仲御徒町駅            2  4.5 
##  2 宴会個室×餃子酒場 北京飯店 秋葉原本店 秋葉原駅              3  3.33
##  3 中国料理 宝龍                         有楽町駅              2  2.5 
##  4 麺達 うま家                           高田馬場駅            2  3   
##  5 七志らーめん 渋谷道玄坂店             渋谷駅                7  4.5 
##  6 永楽                                  京成小岩駅            6  4.42
##  7 よってこや お台場店                   お台場海浜公園駅      1  4   
##  8 ラーメン武藤製麺所                    竹ノ塚駅              4  3.5 
##  9 桂花ラーメン 新宿末広店               新宿三丁目駅          8  3   
## 10 北斗 新橋店                           新橋駅                4  2.5 
## # … with 1,124 more rows</code></pre>
<p>これで口コミ評価が登録された店舗に絞ることができました。</p>
<p>続いて、複数の条件を持つケースを考えてみましょう。例えば、「京都府内の店舗で、口コミ評価が3.5以上の店舗」を出力したい場合、以下のようなコードとなります。</p>
<div class="sourceCode" id="cb880"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb880-1"><a href="datahandling1.html#cb880-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb880-2"><a href="datahandling1.html#cb880-2"></a>  <span class="fu">filter</span>(Pref <span class="sc">==</span> <span class="st">&quot;京都府&quot;</span>, Score <span class="sc">&gt;=</span> <span class="fl">3.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb880-3"><a href="datahandling1.html#cb880-3"></a>  <span class="fu">select</span>(Name, Station, ScoreN, Score)</span></code></pre></div>
<pre><code>## # A tibble: 53 x 4
##    Name               Station    ScoreN Score
##    &lt;chr&gt;              &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
##  1 無尽蔵 京都八条家  京都駅          2  3.5 
##  2 一蘭 京都河原町店  河原町駅        2  3.75
##  3 ミスター・ギョーザ 西大路駅        8  4.06
##  4 一蘭 京都八幡店    樟葉駅          3  4   
##  5 中華料理 清華園    京都駅          3  5   
##  6 まがり             &lt;NA&gt;            2  4   
##  7 魁力屋 北山店      北大路駅        2  4.25
##  8 大中BAL横店        &lt;NA&gt;            7  4.1 
##  9 こうちゃん         西舞鶴駅        1  5   
## 10 大黒ラーメン       伏見桃山駅      4  4.25
## # … with 43 more rows</code></pre>
<p>条件を<code>filter()</code>内に追加するだけです。今回は<code>!is.na(Score)</code>は不要です。なぜなら、<code>Score &gt;= 3.5</code>という条件で既に欠損値は対象外になるからです。条件文が複数ある場合、ANDかORかを指定する必要があります。つまり、条件文AとBがある場合、「AとB両方満たすものを出力する」か「AとBどちらかを満たすものを出力するか」を指定する必要があります。今の結果ってANDでしたよね。<code>filter()</code>関数は、別途の指定がない場合、全てAND扱いになります。RのAND演算子は<code>&amp;</code>ですので、以上のコードは以下のコードと同じです。</p>
<div class="sourceCode" id="cb882"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb882-1"><a href="datahandling1.html#cb882-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb882-2"><a href="datahandling1.html#cb882-2"></a>  <span class="fu">filter</span>(Pref <span class="sc">==</span> <span class="st">&quot;京都府&quot;</span> <span class="sc">&amp;</span> Score <span class="sc">&gt;=</span> <span class="fl">3.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb882-3"><a href="datahandling1.html#cb882-3"></a>  <span class="fu">select</span>(Name, Station, ScoreN, Score)</span></code></pre></div>
<pre><code>## # A tibble: 53 x 4
##    Name               Station    ScoreN Score
##    &lt;chr&gt;              &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
##  1 無尽蔵 京都八条家  京都駅          2  3.5 
##  2 一蘭 京都河原町店  河原町駅        2  3.75
##  3 ミスター・ギョーザ 西大路駅        8  4.06
##  4 一蘭 京都八幡店    樟葉駅          3  4   
##  5 中華料理 清華園    京都駅          3  5   
##  6 まがり             &lt;NA&gt;            2  4   
##  7 魁力屋 北山店      北大路駅        2  4.25
##  8 大中BAL横店        &lt;NA&gt;            7  4.1 
##  9 こうちゃん         西舞鶴駅        1  5   
## 10 大黒ラーメン       伏見桃山駅      4  4.25
## # … with 43 more rows</code></pre>
<p>AND演算子 (<code>&amp;</code>)が使えるということはOR演算子 (<code>|</code>)も使えることを意味します。たとえば、<code>Station</code>が<code>"高田馬場駅"</code>か<code>"三田駅"</code>の条件を指定したい場合、</p>
<div class="sourceCode" id="cb884"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb884-1"><a href="datahandling1.html#cb884-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb884-2"><a href="datahandling1.html#cb884-2"></a>  <span class="fu">filter</span>(Station <span class="sc">==</span> <span class="st">&quot;高田馬場駅&quot;</span> <span class="sc">|</span> Station <span class="sc">==</span> <span class="st">&quot;三田駅&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb884-3"><a href="datahandling1.html#cb884-3"></a>  <span class="fu">select</span>(Name, Station, ScoreN, Score)</span></code></pre></div>
<pre><code>## # A tibble: 14 x 4
##    Name                                 Station    ScoreN Score
##    &lt;chr&gt;                                &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
##  1 麺達 うま家                          高田馬場駅      2  3   
##  2 らぁ麺 やまぐち                      高田馬場駅      7  4.08
##  3 博多一瑞亭 三田店                    三田駅          0 NA   
##  4 つけ麺屋 ひまわり                    高田馬場駅      4  2.75
##  5 石器ラーメン 高田馬場                高田馬場駅      0 NA   
##  6 旨辛らーめん 表裏                    高田馬場駅      0 NA   
##  7 三歩一                               高田馬場駅      8  4.56
##  8 えぞ菊 戸塚店                        高田馬場駅      4  3.62
##  9 麺屋　宗                             高田馬場駅      5  4.2 
## 10 とんこつラーメン 博多風龍 高田馬場店 高田馬場駅      2  3   
## 11 横浜家系ラーメン 馬場壱家            高田馬場駅      0 NA   
## 12 らーめん よし丸                      高田馬場駅      1  5   
## 13 札幌ラーメン どさん子 三田店         三田駅          0 NA   
## 14 天下一品 三田店                      三田駅          0 NA</code></pre>
<p>のように書きます（ちなみに高田馬場の「やまぐち」は本当に美味しいです）。むろん、複数の変数を用いたORも可能です。たとえば、「<code>Pref</code>が<code>"京都府"</code>か<code>Score</code>が3以上」のような条件も可能ですが (<code>Pref == "京都府" | Score &gt;= 3</code>)、実際、このような例はあまりありません。よく使うのは「変数<code>X</code>が<code>a</code>か<code>b</code>か<code>c</code>か」のような例です。ただし、この場合は<code>|</code>を使わないもっと簡単な方法があります。それは第<a href="programming.html#programming-condition">11.4</a>章で紹介した<code>%in%</code>演算子です。以下のコードは上のコードと同じものです。</p>
<div class="sourceCode" id="cb886"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb886-1"><a href="datahandling1.html#cb886-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb886-2"><a href="datahandling1.html#cb886-2"></a>  <span class="fu">filter</span>(Station <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;高田馬場駅&quot;</span>, <span class="st">&quot;三田駅&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb886-3"><a href="datahandling1.html#cb886-3"></a>  <span class="fu">select</span>(Name, Station, ScoreN, Score)</span></code></pre></div>
<pre><code>## # A tibble: 14 x 4
##    Name                                 Station    ScoreN Score
##    &lt;chr&gt;                                &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
##  1 麺達 うま家                          高田馬場駅      2  3   
##  2 らぁ麺 やまぐち                      高田馬場駅      7  4.08
##  3 博多一瑞亭 三田店                    三田駅          0 NA   
##  4 つけ麺屋 ひまわり                    高田馬場駅      4  2.75
##  5 石器ラーメン 高田馬場                高田馬場駅      0 NA   
##  6 旨辛らーめん 表裏                    高田馬場駅      0 NA   
##  7 三歩一                               高田馬場駅      8  4.56
##  8 えぞ菊 戸塚店                        高田馬場駅      4  3.62
##  9 麺屋　宗                             高田馬場駅      5  4.2 
## 10 とんこつラーメン 博多風龍 高田馬場店 高田馬場駅      2  3   
## 11 横浜家系ラーメン 馬場壱家            高田馬場駅      0 NA   
## 12 らーめん よし丸                      高田馬場駅      1  5   
## 13 札幌ラーメン どさん子 三田店         三田駅          0 NA   
## 14 天下一品 三田店                      三田駅          0 NA</code></pre>
<p>結局、<code>|</code>が使われるケースがかなり限定されます。あるとすれば、「変数<code>X</code>が<code>a</code>以下か、<code>b</code>以上か」のようなケースですね。ただし、<code>&amp;</code>と<code>|</code>を同時に使うケースは考えられます。たとえば、大阪駅と京都駅周辺のうまいラーメン屋を調べるとします。問題は美味しさの基準ですが、3.5点以上としましょう。ただし、京都府民はラーメンに非常に厳しく、3点以上なら美味しいと仮定します。この場合、「(<code>Station</code>が<code>"大阪駅"</code>かつ<code>Score &gt;= 3.5</code>)、または(<code>Station</code>が<code>"京都駅"</code>かつ<code>Score &gt;= 3</code>)」のような条件が必要になります。<code>()</code>は「<code>()</code>の中から判定せよ」という、普通の算数での使い方と同じです。それでは、実際に検索してみましょう。</p>
<div class="sourceCode" id="cb888"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb888-1"><a href="datahandling1.html#cb888-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb888-2"><a href="datahandling1.html#cb888-2"></a>  <span class="fu">filter</span>((Station <span class="sc">==</span> <span class="st">&quot;大阪駅&quot;</span> <span class="sc">&amp;</span> Score <span class="sc">&gt;=</span> <span class="fl">3.5</span>) <span class="sc">|</span> (Station <span class="sc">==</span> <span class="st">&quot;京都駅&quot;</span> <span class="sc">&amp;</span> Score <span class="sc">&gt;=</span> <span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb888-3"><a href="datahandling1.html#cb888-3"></a>  <span class="fu">select</span>(Name, Station, Walk, ScoreN, Score)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   Name                      Station  Walk ScoreN Score
##   &lt;chr&gt;                     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 Lei can ting 大阪ルクア店 大阪駅      3      3  4   
## 2 神座 ルクア大阪店         大阪駅      1     10  3.94
## 3 みつか坊主 醸             大阪駅     10      4  5   
## 4 無尽蔵 京都八条家         京都駅      5      2  3.5 
## 5 中華料理 清華園           京都駅     10      3  5   
## 6 ますたに 京都拉麺小路店   京都駅      9      3  3.67</code></pre>
<p>Songが大好きな神座がヒットして嬉しいです。</p>
<hr />
</div>
</div>
<div id="handling1-arrange" class="section level2" number="13.5">
<h2><span class="header-section-number">13.5</span> 行のソート</h2>
<p>続いて、行のソートについて解説します。「食べログ」などのレビューサービスを利用する場合、口コミ評価が高い順で見るのが一般的でしょう<a href="#fn68" class="footnote-ref" id="fnref68"><sup>68</sup></a>。また、サッカーのランキングも多くは1位から下の順位で掲載されるのが一般的です。ここではこのようにある変数の値順に行を並び替える方法について説明します。</p>
<p>ソートには<code>dplyr</code>パッケージの<code>arrange()</code>関数を使います。引数は変数名のみです。たとえば、奈良県のラーメン屋を検索してみましょう。並び替える順は駅から近い店舗を上位に、遠い店舗を下位に並べます。このような順は<strong>昇順 (ascending)</strong>と呼ばれ、ランキング表などでよく見ます。駅から近い順にソートするので、まず最寄りの駅情報が欠損でないことが必要です。また、ラーメン屋の評価も気になるので口コミが1つ以上付いている店舗に絞りましょう。表示する列は店舗名、最寄りの駅、徒歩距離、口コミ数、点数です。</p>
<div class="sourceCode" id="cb890"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb890-1"><a href="datahandling1.html#cb890-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb890-2"><a href="datahandling1.html#cb890-2"></a>  <span class="fu">filter</span>(Pref <span class="sc">==</span> <span class="st">&quot;奈良県&quot;</span>, <span class="sc">!</span><span class="fu">is.na</span>(Station), ScoreN <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb890-3"><a href="datahandling1.html#cb890-3"></a>  <span class="fu">select</span>(Name, Station, Walk, ScoreN, Score) <span class="sc">%&gt;%</span></span>
<span id="cb890-4"><a href="datahandling1.html#cb890-4"></a>  <span class="fu">arrange</span>(Walk) <span class="sc">%&gt;%</span></span>
<span id="cb890-5"><a href="datahandling1.html#cb890-5"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code></pre></div>
<pre><code>## # A tibble: 24 x 5
##    Name                                  Station             Walk ScoreN Score
##    &lt;chr&gt;                                 &lt;chr&gt;              &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 麺屋 あまのじゃく 本店                富雄駅                 2      2  4.5 
##  2 紀州和歌山らーめんきぶんや 奈良富雄店 富雄駅                 4      1  4   
##  3 ラーメン家 みつ葉                     富雄駅                 4      1  3.5 
##  4 天下一品 新大宮店                     新大宮駅               6      1  3   
##  5 麺屋 一徳                             天理駅                 7      1  3   
##  6 丸源ラーメン 橿原店                   金橋駅                 8      1  3.5 
##  7 らーめん食堂 よってこや 平群店        元山上口駅            10      1  4   
##  8 天理スタミナラーメン本店              櫟本駅                11      2  3.25
##  9 博多長浜らーめん夢街道 奈良土橋店     真菅駅                11      1  3.5 
## 10 ぶ～け                                奈良駅                11      1  5   
## 11 つけめん らーめん元喜神 押熊店        学研奈良登美ヶ丘駅    12      4  4.12
## 12 彩華ラーメン 本店                     前栽駅                12      5  3.6 
## 13 力皇                                  天理駅                13      1  3.5 
## 14 らーめん きみちゃん                   京終駅                14      2  4.5 
## 15 無鉄砲がむしゃら                      帯解駅                15      2  4   
## 16 彩華ラーメン 田原本店                 石見駅                15      1  4   
## 17 神座 大和高田店                       大和高田駅            17      2  3.75
## 18 彩華ラーメン 奈良店                   尼ヶ辻駅              17      3  4.33
## 19 彩華ラーメン 桜井店                   大福駅                18      1  3   
## 20 天下一品 東生駒店                     東生駒駅              19      1  3.5 
## 21 まりお流ラーメン                      新大宮駅              20      1  5   
## 22 どうとんぼり神座 奈良柏木店           西ノ京駅              22      1  3   
## 23 河童ラーメン本舗 押熊店               学研奈良登美ヶ丘駅    28      1  4   
## 24 博多長浜らーめん 夢街道 四条大路店    新大宮駅              29      4  2.88</code></pre>
<p>3行まではこれまで習ってきたもので、4行目がソートの関数、<code>arrange()</code>です。引数はソートの基準となる変数で、今回は最寄りの駅からの徒歩距離を表す<code>Walk</code>です。5行目は省略可能ですが、<code>tibble</code>クラスの場合、10行までしか出力されないので、<code>print(n = Inf)</code>で「すべての行を表示」させます。<code>n</code>を指定することで出力される行数が調整可能です。奈良県のラーメン屋の中で最寄りの駅から最も近い店は「<a href="https://www.menya-amanojaku.com">麺屋 あまのじゃく 本店</a>」で徒歩2分でした。京田辺店も駅から約2分ですし、近いですね。ちなみにSongはここの塩とんこつが好きです。世界一こってりなラーメンとも言われる「チョモランマ」で有名な「<a href="http://www.marioramen.com">まりお流ラーメン</a>」は新大宮駅から徒歩20分でかなり遠いことが分かります。</p>
<p>続いて、駅からの距離ではなく、評価が高い順にしてみましょう。評価が高いほど上に来るので、今回は昇順でなく、<strong>降順 (descending)</strong>でソートする必要があります。<code>arrange()</code>関数は基本的に、指定された変数を基準に昇順でソートします。降順にするためには<code>desc()</code>関数を更に用います。たとえば、<code>arrange(desc(変数名))</code>のようにです。それでは実際にやってみましょう。上のコードの4行目を<code>arange(Walk)</code>から<code>arrange(desc(Score))</code>にちょっと修正するだけです。</p>
<div class="sourceCode" id="cb892"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb892-1"><a href="datahandling1.html#cb892-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb892-2"><a href="datahandling1.html#cb892-2"></a>  <span class="fu">filter</span>(Pref <span class="sc">==</span> <span class="st">&quot;奈良県&quot;</span>, <span class="sc">!</span><span class="fu">is.na</span>(Station), ScoreN <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb892-3"><a href="datahandling1.html#cb892-3"></a>  <span class="fu">select</span>(Name, Station, Walk, ScoreN, Score) <span class="sc">%&gt;%</span></span>
<span id="cb892-4"><a href="datahandling1.html#cb892-4"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Score)) <span class="sc">%&gt;%</span></span>
<span id="cb892-5"><a href="datahandling1.html#cb892-5"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code></pre></div>
<pre><code>## # A tibble: 24 x 5
##    Name                                  Station             Walk ScoreN Score
##    &lt;chr&gt;                                 &lt;chr&gt;              &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 まりお流ラーメン                      新大宮駅              20      1  5   
##  2 ぶ～け                                奈良駅                11      1  5   
##  3 麺屋 あまのじゃく 本店                富雄駅                 2      2  4.5 
##  4 らーめん きみちゃん                   京終駅                14      2  4.5 
##  5 彩華ラーメン 奈良店                   尼ヶ辻駅              17      3  4.33
##  6 つけめん らーめん元喜神 押熊店        学研奈良登美ヶ丘駅    12      4  4.12
##  7 河童ラーメン本舗 押熊店               学研奈良登美ヶ丘駅    28      1  4   
##  8 無鉄砲がむしゃら                      帯解駅                15      2  4   
##  9 紀州和歌山らーめんきぶんや 奈良富雄店 富雄駅                 4      1  4   
## 10 彩華ラーメン 田原本店                 石見駅                15      1  4   
## 11 らーめん食堂 よってこや 平群店        元山上口駅            10      1  4   
## 12 神座 大和高田店                       大和高田駅            17      2  3.75
## 13 彩華ラーメン 本店                     前栽駅                12      5  3.6 
## 14 天下一品 東生駒店                     東生駒駅              19      1  3.5 
## 15 力皇                                  天理駅                13      1  3.5 
## 16 博多長浜らーめん夢街道 奈良土橋店     真菅駅                11      1  3.5 
## 17 ラーメン家 みつ葉                     富雄駅                 4      1  3.5 
## 18 丸源ラーメン 橿原店                   金橋駅                 8      1  3.5 
## 19 天理スタミナラーメン本店              櫟本駅                11      2  3.25
## 20 麺屋 一徳                             天理駅                 7      1  3   
## 21 どうとんぼり神座 奈良柏木店           西ノ京駅              22      1  3   
## 22 彩華ラーメン 桜井店                   大福駅                18      1  3   
## 23 天下一品 新大宮店                     新大宮駅               6      1  3   
## 24 博多長浜らーめん 夢街道 四条大路店    新大宮駅              29      4  2.88</code></pre>
<p>よく考えてみれば、「評価が同点の場合、どうなるの?」と疑問を抱く方がいるかも知れません。たとえば、7行目の「河童ラーメン本舗 押熊店」と8行目の「無鉄砲がむしゃら」はどれも評価が4点ですが、「河童ラーメン本舗 押熊店」が先に表示されます。そのこれは簡単です。同点の場合、データセット内で上に位置する行が先に表示されます。これを確認するには<code>which()</code>関数を使います。<code>()</code>内に条件文を指定することで、この条件に合致する要素の位置を返します。もし、条件に合致するものが複数あった場合は全ての位置を返します<a href="#fn69" class="footnote-ref" id="fnref69"><sup>69</sup></a>。</p>
<div class="sourceCode" id="cb894"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb894-1"><a href="datahandling1.html#cb894-1"></a><span class="fu">which</span>(df<span class="sc">$</span>Name <span class="sc">==</span> <span class="st">&quot;河童ラーメン本舗 押熊店&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 6021</code></pre>
<div class="sourceCode" id="cb896"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb896-1"><a href="datahandling1.html#cb896-1"></a><span class="fu">which</span>(df<span class="sc">$</span>Name <span class="sc">==</span> <span class="st">&quot;無鉄砲がむしゃら&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 6040</code></pre>
<p>データ内に「河童ラーメン本舗 押熊店」がより上に位置することが分かります。「もし同点なら口コミ評価数が多いところにしたい」場合はどうすれば良いでしょうか。これは<code>arrange()</code>内に変数名を足すだけで十分です。</p>
<div class="sourceCode" id="cb898"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb898-1"><a href="datahandling1.html#cb898-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb898-2"><a href="datahandling1.html#cb898-2"></a>  <span class="fu">filter</span>(Pref <span class="sc">==</span> <span class="st">&quot;奈良県&quot;</span>, <span class="sc">!</span><span class="fu">is.na</span>(Station), ScoreN <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb898-3"><a href="datahandling1.html#cb898-3"></a>  <span class="fu">select</span>(Name, Station, Walk, ScoreN, Score) <span class="sc">%&gt;%</span></span>
<span id="cb898-4"><a href="datahandling1.html#cb898-4"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Score), <span class="fu">desc</span>(ScoreN)) <span class="sc">%&gt;%</span></span>
<span id="cb898-5"><a href="datahandling1.html#cb898-5"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code></pre></div>
<pre><code>## # A tibble: 24 x 5
##    Name                                  Station             Walk ScoreN Score
##    &lt;chr&gt;                                 &lt;chr&gt;              &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 まりお流ラーメン                      新大宮駅              20      1  5   
##  2 ぶ～け                                奈良駅                11      1  5   
##  3 麺屋 あまのじゃく 本店                富雄駅                 2      2  4.5 
##  4 らーめん きみちゃん                   京終駅                14      2  4.5 
##  5 彩華ラーメン 奈良店                   尼ヶ辻駅              17      3  4.33
##  6 つけめん らーめん元喜神 押熊店        学研奈良登美ヶ丘駅    12      4  4.12
##  7 無鉄砲がむしゃら                      帯解駅                15      2  4   
##  8 河童ラーメン本舗 押熊店               学研奈良登美ヶ丘駅    28      1  4   
##  9 紀州和歌山らーめんきぶんや 奈良富雄店 富雄駅                 4      1  4   
## 10 彩華ラーメン 田原本店                 石見駅                15      1  4   
## 11 らーめん食堂 よってこや 平群店        元山上口駅            10      1  4   
## 12 神座 大和高田店                       大和高田駅            17      2  3.75
## 13 彩華ラーメン 本店                     前栽駅                12      5  3.6 
## 14 天下一品 東生駒店                     東生駒駅              19      1  3.5 
## 15 力皇                                  天理駅                13      1  3.5 
## 16 博多長浜らーめん夢街道 奈良土橋店     真菅駅                11      1  3.5 
## 17 ラーメン家 みつ葉                     富雄駅                 4      1  3.5 
## 18 丸源ラーメン 橿原店                   金橋駅                 8      1  3.5 
## 19 天理スタミナラーメン本店              櫟本駅                11      2  3.25
## 20 麺屋 一徳                             天理駅                 7      1  3   
## 21 どうとんぼり神座 奈良柏木店           西ノ京駅              22      1  3   
## 22 彩華ラーメン 桜井店                   大福駅                18      1  3   
## 23 天下一品 新大宮店                     新大宮駅               6      1  3   
## 24 博多長浜らーめん 夢街道 四条大路店    新大宮駅              29      4  2.88</code></pre>
<p>ソートの基準は<code>arrange()</code>内において先に指定された変数の順番となります。「口コミ評価も評価数も同じなら、駅から近いところにしたい」場合は変数が3つとなり、<code>Score</code>、<code>ScoreN</code>、<code>Walk</code>の順で入れます。</p>
<div class="sourceCode" id="cb900"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb900-1"><a href="datahandling1.html#cb900-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb900-2"><a href="datahandling1.html#cb900-2"></a>  <span class="fu">filter</span>(Pref <span class="sc">==</span> <span class="st">&quot;奈良県&quot;</span>, <span class="sc">!</span><span class="fu">is.na</span>(Station), ScoreN <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb900-3"><a href="datahandling1.html#cb900-3"></a>  <span class="fu">select</span>(Name, Station, Walk, ScoreN, Score) <span class="sc">%&gt;%</span></span>
<span id="cb900-4"><a href="datahandling1.html#cb900-4"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Score), <span class="fu">desc</span>(ScoreN), Walk) <span class="sc">%&gt;%</span></span>
<span id="cb900-5"><a href="datahandling1.html#cb900-5"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code></pre></div>
<pre><code>## # A tibble: 24 x 5
##    Name                                  Station             Walk ScoreN Score
##    &lt;chr&gt;                                 &lt;chr&gt;              &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 ぶ～け                                奈良駅                11      1  5   
##  2 まりお流ラーメン                      新大宮駅              20      1  5   
##  3 麺屋 あまのじゃく 本店                富雄駅                 2      2  4.5 
##  4 らーめん きみちゃん                   京終駅                14      2  4.5 
##  5 彩華ラーメン 奈良店                   尼ヶ辻駅              17      3  4.33
##  6 つけめん らーめん元喜神 押熊店        学研奈良登美ヶ丘駅    12      4  4.12
##  7 無鉄砲がむしゃら                      帯解駅                15      2  4   
##  8 紀州和歌山らーめんきぶんや 奈良富雄店 富雄駅                 4      1  4   
##  9 らーめん食堂 よってこや 平群店        元山上口駅            10      1  4   
## 10 彩華ラーメン 田原本店                 石見駅                15      1  4   
## 11 河童ラーメン本舗 押熊店               学研奈良登美ヶ丘駅    28      1  4   
## 12 神座 大和高田店                       大和高田駅            17      2  3.75
## 13 彩華ラーメン 本店                     前栽駅                12      5  3.6 
## 14 ラーメン家 みつ葉                     富雄駅                 4      1  3.5 
## 15 丸源ラーメン 橿原店                   金橋駅                 8      1  3.5 
## 16 博多長浜らーめん夢街道 奈良土橋店     真菅駅                11      1  3.5 
## 17 力皇                                  天理駅                13      1  3.5 
## 18 天下一品 東生駒店                     東生駒駅              19      1  3.5 
## 19 天理スタミナラーメン本店              櫟本駅                11      2  3.25
## 20 天下一品 新大宮店                     新大宮駅               6      1  3   
## 21 麺屋 一徳                             天理駅                 7      1  3   
## 22 彩華ラーメン 桜井店                   大福駅                18      1  3   
## 23 どうとんぼり神座 奈良柏木店           西ノ京駅              22      1  3   
## 24 博多長浜らーめん 夢街道 四条大路店    新大宮駅              29      4  2.88</code></pre>
<hr />
</div>
<div id="handling1-exercise" class="section level2" number="13.6">
<h2><span class="header-section-number">13.6</span> 練習問題</h2>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="66">
<li id="fn66"><p>実は<code>select(starts_with("X"), -ends_with("D"), ID)</code>のように順番を変えると<code>ID</code>は最後の列になりますが、とりあえず残ります。なぜなら、<code>select()</code>関数は左側から右側の方へコードを実行するからです。<a href="datahandling1.html#fnref66" class="footnote-back">↩︎</a></p></li>
<li id="fn67"><p>実は<code>select.df[, c(2, 8, 9)]</code>でも前後にパイプ演算子を使うことは可能ですが、コードが読みにくくなるため、推奨しません。<a href="datahandling1.html#fnref67" class="footnote-back">↩︎</a></p></li>
<li id="fn68"><p>サービスによってはこの機能が有料になっていたりもしますね。<a href="datahandling1.html#fnref68" class="footnote-back">↩︎</a></p></li>
<li id="fn69"><p>たとえば、データ内に「ラーメンショップ」という店舗は3店舗あり、この場合、長さ3のベクトルが返されます。<a href="datahandling1.html#fnref69" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="functions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="datahandling2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["R_Not_for_Everyone.pdf", "R_Not_for_Everyone.epub"],
"toc": {
"collapse": "section"
},
"toolbar": {
"position": "fixed"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
