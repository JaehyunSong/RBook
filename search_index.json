[
["tidydata.html", "13. 整然データ構造 13.1 整然データ (tidy data)とは 13.2 Wide型からLong型へ 13.3 Long型からWide型へ 13.4 列の分割", " 13. 整然データ構造 本章ではグラフの作成に適した形へデータを整形することについて学習します。ただし、これはグラフに限られた話ではありません。作図に適したデータは分析にも適します。 13.1 整然データ (tidy data)とは 分析や作図に適したデータの形は整然データ、または簡潔データ (tidy data)と呼ばれます。整然データの概念はtidyverse世界の産みの親であるHadely Wickham先生が提唱した概念であり、詳細はHadley先生が2014年に発表した論文1を参照してください。 整然データは目指す到達点は非常に単純です。それは「データの構造 (structure)と意味 (semantic)を一致させる」ことです。そして、この「意味」を出来る限り小さい単位で分解します。 例えば、3人で構成されたあるクラス内の被験者が投薬の前後に測った数学成績があるとします。投薬前の成績は\"Control\"、投薬後の状況を\"Treatment\"とします。これをまとめたのが表13.1です。 表 13.1: Messy Dataの例 (1) Name Control Treatment Hadley 90 90 Song 80 25 Yanai 100 95 また、以上の表は転置も可能であり、以下のように表現することが可能です (表13.2)。 表 13.2: Messy Dataの例 (2) Treat Hadely Song Yanai Control 90 80 100 Treatment 90 25 95 2つのデータが持つ情報は全く同じです。これは「同じ意味を持つが、異なる構造を持つ」とも言えます。このような多様性が生じる意味は行と列のあり方が各値を説明するに十分ではないからです。異なるデータ構造として表現される余地があるということです。 たとえば、表13.1の場合、各列は以下のような3つの情報があります。 Name: 被験者名 Control: 投薬前の数学成績 Treatment: 投薬後の数学成績 このデータの問題は「投薬有無」と「数学成績」が2回登場したという点です。1は問題ありませんが、2と3の値は「投薬有無 \\(\\times\\) 数学成績」の組み合わせです。一つの変数に2つの情報が含まれていますね。これによって、投薬有無を行にしても列にしてもいいわけです。「ならばこっちの方が柔軟だしいいのでは?」と思う方もいるかも知れません。しかし、パソコンはこの曖昧さが嫌いです。なぜなら、人間のような思考ができないからです。データフレームは縦ベクトルの集合であるから、各列には一つの情報のみ格納する必要があります。たとえば、以下のように列を変更するとしましょう。 Name: 被験者名 Treat: 投薬有無 Math_Score: 数学成績 Treatは投薬前なら\"Control\"の値を、投薬後なら\"Treatment\"の値が入ります。Math_Socreには数学成績が入ります。これに則って表に直したのが表13.3です。 表 13.3: 整然データの例 Name Treat Math_Score Hadley Control 90 Hadley Treatment 90 Song Control 80 Song Treatment 25 Yanai Control 100 Yanai Treatment 95 表が長くなりましたが、これなら一つの列に2つ以上の情報が含まれることはありません。この場合、表13.1と表13.2のように、行と列を転置することができるでしょうか。 表 13.4: 表13.3を転置した場合 Name Hadley Hadley Song Song Yanai Yanai Treat Control Treatment Control Treatment Control Treatment Math_Score 90 90 80 25 100 95 その結果が表13.4ですが、いかがでしょうか。まず、列名が重複している時点でアウトですし、人間が見ても非常に分かりにくい表になりました。また、一つの列に異なるデータ (この場合、character型とnumeirc型)が混在しています。パソコンから見てはわけのわからないデータになったわけです。 ここまで来たら整然データのイメージはある程度掴めたかも知れません。具体的に整然データとは次の4つの条件を満たすデータです(Wickham, 2014)。 1つの列は、1つの変数を表す。 1つの行は、1つの観測を表す。 1つのセル（特定の列の特定の行）は、1つの値を表す。 1つの表は、1つの観測単位 (unit of observation)をもつ（異なる観測単位が混ざっていない）。 以下でも、表13.1と表13.3を対比しながら、以上の4条件をより詳しく説明します。 13.1.1 1つの列は、1つの変数を表す 表13.1と表13.3に含まれる情報は以下の3つで共通しています。 被験者名 投薬有無 数学成績 これらの情報がそれぞれデータの変数になるわけですが、整然データは一つの列が一つの変数を表します。 図 13.1: 1つの列は、1つの変数を表す 13.1.2 1つの行は、1つの観測を表す 図 13.2: 1つの行は、1つの観測を表す 13.1.3 1つのセルは、1つの値を表す 図 13.3: 1つのセルは、1つの値を表す 13.1.4 1つの表は、1つの観測単位をもつ 図 13.4: 1つの表は、1つの観測単位をもつ 13.2 Wide型からLong型へ 13.3 Long型からWide型へ 13.4 列の分割 参考資料 "]
]
