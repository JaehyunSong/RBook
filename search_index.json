[["visualization4.html", "20. 可視化[発展] 20.1 バイオリンプロット 20.2 ラグプロット 20.3 リッジプロット 20.4 エラーバー付き散布図 20.5 ロリーポップチャート 20.6 平滑化ライン 20.7 ヒートマップ", " 20. 可視化[発展] pacman::p_load(tidyverse) Country_df &lt;- read_csv(&quot;Data/Countries.csv&quot;) COVID19_df &lt;- read_csv(&quot;Data/COVID19_Worldwide.csv&quot;, guess_max = 10000) 20.1 バイオリンプロット Country_df %&gt;% ggplot() + geom_violin(aes(x = Continent, y = PPP_per_capita, fill = Continent)) + geom_boxplot(aes(x = Continent, y = PPP_per_capita), width = 0.2) + labs(y = &quot;PPP per capita (USD)&quot;) + scale_y_continuous(breaks = c(0, 1000, 10000, 100000), labels = c(0, 1000, 10000, 100000), trans = &quot;log10&quot;) + guides(fill = &quot;none&quot;) + theme_minimal(base_size = 12) 20.2 ラグプロット Country_df %&gt;% ggplot() + geom_point(aes(x = FH_Total, y = PPP_per_capita)) + geom_rug(aes(x = FH_Total, y = PPP_per_capita)) + labs(x = &quot;Freedom House Score&quot;, y = &quot;PPP per capita (USD)&quot;) + scale_y_continuous(breaks = seq(0, 120000, by = 10000), labels = seq(0, 120000, by = 10000)) + guides(fill = &quot;none&quot;) + theme_minimal(base_size = 12) 20.3 リッジプロット pacman::p_load(ggridges) # デフォルトのリッジプロット Country_df %&gt;% ggplot() + geom_density_ridges(aes(x = HDI_2018, y = Continent), alpha = 0.5) + labs(x = &quot;2018年人間開発指数&quot;, y = &quot;大陸&quot;) + theme_minimal(base_family = &quot;HiraKakuProN-W3&quot;, base_size = 12) ## Picking joint bandwidth of 0.054 # ラグプロット付きのリッジプロット Country_df %&gt;% ggplot() + geom_density_ridges(aes(x = HDI_2018, y = Continent, fill = Continent), alpha = 0.5, jittered_points = TRUE, position = position_points_jitter(width = 0, height = 0), point_shape = &quot;|&quot;, point_size = 3) + guides(fill = &quot;none&quot;) + labs(x = &quot;2018年人間開発指数&quot;, y = &quot;大陸&quot;) + theme_minimal(base_family = &quot;HiraKakuProN-W3&quot;, base_size = 12) ## Picking joint bandwidth of 0.054 # ヒストグラムのリッジプロット Country_df %&gt;% ggplot() + geom_density_ridges(aes(x = HDI_2018, y = Continent), alpha = 0.5, stat = &quot;binline&quot;, scale = 1) + labs(x = &quot;2018年人間開発指数&quot;, y = &quot;大陸&quot;) + theme_minimal(base_family = &quot;HiraKakuProN-W3&quot;, base_size = 12) ## `stat_binline()` using `bins = 30`. Pick better value with `binwidth`. 20.4 エラーバー付き散布図 Pointrange_df &lt;- tibble( Continent = c(&quot;Asia&quot;, &quot;Europe&quot;, &quot;Africa&quot;, &quot;America&quot;), Coef = c(65.3, 588.0, 53.4, 316.0), Conf_lwr = c(-250.0, 376.0, -14.5, 128.0), Conf_upr = c(380.0, 801.0, 121.0, 504.0) ) Pointrange_df ## # A tibble: 4 x 4 ## # Groups: Continent [4] ## Continent Coef Conf_lwr Conf_upr ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Asia 65.3 -250. 380. ## 2 Europe 588. 376. 801. ## 3 Africa 53.4 -14.5 121. ## 4 America 316. 128. 504. 実は以上のデータは以下のようなコードで作成されています。{purrr}パッケージの使い方に慣れる必要があるので、第24章を参照してください。 Pointrange_df &lt;- Country_df %&gt;% filter(Continent != &quot;Oceania&quot;) %&gt;% group_by(Continent) %&gt;% nest() %&gt;% mutate(Fit = map(data, ~lm(PPP_per_capita ~ FH_Total, data = .)), Est = map(Fit, broom::tidy, conf.int = TRUE)) %&gt;% unnest(Est) %&gt;% filter(term == &quot;FH_Total&quot;) %&gt;% select(Continent, Coef = estimate, Conf_lwr = conf.low, Conf_upr = conf.high) Country_df %&gt;% filter(Continent != &quot;Oceania&quot;) %&gt;% group_by(Continent) %&gt;% nest() %&gt;% mutate(Fit = map(data, ~lm(PPP_per_capita ~ FH_Total, data = .)), Est = map(Fit, broom::tidy, conf.int = TRUE)) %&gt;% unnest(Est) %&gt;% filter(term == &quot;FH_Total&quot;) %&gt;% select(Continent, Coef = estimate, Conf_lwr = conf.low, Conf_upr = conf.high) %&gt;% ggplot() + geom_hline(yintercept = 0, linetype = 2) + geom_pointrange(aes(x = Continent, y = Coef, ymin = Conf_lwr, ymax = Conf_upr), size = 0.75) + labs(y = expression(paste(beta[1], &quot; with 95% CI&quot;))) + theme_bw(base_size = 12) 20.5 ロリーポップチャート Country_df %&gt;% filter(Continent == &quot;Europe&quot;) %&gt;% drop_na(PPP_per_capita) %&gt;% ggplot() + geom_bar(aes(y = Country, x = PPP_per_capita), stat = &quot;identity&quot;) + labs(x = &quot;一人あたり購買力平価GDP&quot;, y = &quot;国&quot;) + theme_bw(base_family = &quot;HiraKakuProN-W3&quot;, base_size = 12) Country_df %&gt;% filter(Continent == &quot;Europe&quot;) %&gt;% drop_na(PPP_per_capita) %&gt;% ggplot() + geom_segment(aes(y = Country, yend = Country, x = 0, xend = PPP_per_capita)) + geom_point(aes(y = Country, x = PPP_per_capita), color = &quot;orange&quot;) + labs(x = &quot;一人あたり購買力平価GDP (USD)&quot;, y = &quot;国&quot;) + theme_bw(base_family = &quot;HiraKakuProN-W3&quot;, base_size = 12) + theme(panel.grid.major.y = element_blank(), panel.border = element_blank(), axis.ticks.y = element_blank()) Country_df %&gt;% filter(Continent == &quot;Europe&quot;) %&gt;% drop_na(PPP_per_capita) %&gt;% arrange(PPP_per_capita) %&gt;% mutate(Country = fct_inorder(Country)) %&gt;% ggplot() + geom_segment(aes(y = Country, yend = Country, x = 0, xend = PPP_per_capita)) + geom_point(aes(y = Country, x = PPP_per_capita), color = &quot;orange&quot;) + labs(x = &quot;一人あたり購買力平価GDP (USD)&quot;, y = &quot;国&quot;) + theme_bw(base_family = &quot;HiraKakuProN-W3&quot;, base_size = 12) + theme(panel.grid.major.y = element_blank(), panel.border = element_blank(), axis.ticks.y = element_blank()) 20.6 平滑化ライン Country_df %&gt;% ggplot(aes(x = FH_Total, y = PPP_per_capita)) + geom_point() + geom_smooth(formula = y ~ x, method = &quot;loess&quot;, se = TRUE) + labs(x = &quot;Freedom House Score&quot;, y = &quot;PPP per capita (USD)&quot;) + scale_y_continuous(breaks = seq(0, 120000, by = 10000), labels = seq(0, 120000, by = 10000)) + guides(fill = &quot;none&quot;) + theme_minimal(base_size = 12) Country_df %&gt;% mutate(OECD = if_else(OECD == 1, &quot;加盟国&quot;, &quot;非加盟国&quot;)) %&gt;% ggplot(aes(x = FH_Total, y = PPP_per_capita, color = OECD)) + geom_point() + geom_smooth(formula = y ~ x, method = &quot;lm&quot;, se = TRUE) + labs(x = &quot;Freedom House Score&quot;, y = &quot;PPP per capita (USD)&quot;) + scale_y_continuous(breaks = seq(0, 120000, by = 10000), labels = seq(0, 120000, by = 10000)) + coord_cartesian(ylim = c(0, 120000)) + guides(fill = &quot;none&quot;) + theme_bw(base_family = &quot;HiraKakuProN-W3&quot;, base_size = 12) 20.7 ヒートマップ COVID19_df %&gt;% left_join(Country_df, by = &quot;Country&quot;) %&gt;% filter(Continent == &quot;Asia&quot;) %&gt;% separate(col = Date, into = c(&quot;Year&quot;, &quot;Month&quot;, &quot;Day&quot;)) %&gt;% group_by(Country, Month) %&gt;% summarise(Confirmed_New = sum(Confirmed_Day), Death = sum(Death_Day), .groups = &quot;drop&quot;) %&gt;% mutate(Death = log10(Death + 1), Country = fct_inorder(Country), Country = fct_rev(Country)) %&gt;% ggplot() + geom_tile(aes(x = Month, y = Country, fill = Death)) + scale_fill_gradient2(low = &quot;cornflowerblue&quot;, mid = &quot;cornsilk&quot;, high = &quot;brown3&quot;, midpoint = 2) "]]
